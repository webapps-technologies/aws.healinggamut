function H_(r,o){const c=Object.create(null),l=r.split(",");for(let f=0;f<l.length;f++)c[l[f]]=!0;return o?f=>!!c[f.toLowerCase()]:f=>!!c[f]}const In={},ml=[],Fs=()=>{},W5=()=>!1,Oh=r=>r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&(r.charCodeAt(2)>122||r.charCodeAt(2)<97),xy=r=>r.startsWith("onUpdate:"),ei=Object.assign,Vy=(r,o)=>{const c=r.indexOf(o);c>-1&&r.splice(c,1)},G5=Object.prototype.hasOwnProperty,en=(r,o)=>G5.call(r,o),Xt=Array.isArray,El=r=>kl(r)==="[object Map]",rd=r=>kl(r)==="[object Set]",rD=r=>kl(r)==="[object Date]",H5=r=>kl(r)==="[object RegExp]",ve=r=>typeof r=="function",ni=r=>typeof r=="string",Cl=r=>typeof r=="symbol",bn=r=>r!==null&&typeof r=="object",Fy=r=>(bn(r)||ve(r))&&ve(r.then)&&ve(r.catch),MP=Object.prototype.toString,kl=r=>MP.call(r),Y5=r=>kl(r).slice(8,-1),UP=r=>kl(r)==="[object Object]",By=r=>ni(r)&&r!=="NaN"&&r[0]!=="-"&&""+parseInt(r,10)===r,sh=H_(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Y_=r=>{const o=Object.create(null);return c=>o[c]||(o[c]=r(c))},K5=/-(\w)/g,Mr=Y_(r=>r.replace(K5,(o,c)=>c?c.toUpperCase():"")),q5=/\B([A-Z])/g,Rs=Y_(r=>r.replace(q5,"-$1").toLowerCase()),Nh=Y_(r=>r.charAt(0).toUpperCase()+r.slice(1)),oh=Y_(r=>r?`on${Nh(r)}`:""),Xa=(r,o)=>!Object.is(r,o),gl=(r,o)=>{for(let c=0;c<r.length;c++)r[c](o)},C_=(r,o,c)=>{Object.defineProperty(r,o,{configurable:!0,enumerable:!1,value:c})},I_=r=>{const o=parseFloat(r);return isNaN(o)?r:o},b_=r=>{const o=ni(r)?Number(r):NaN;return isNaN(o)?r:o};let sD;const JT=()=>sD||(sD=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),z5="Infinity,undefined,NaN,isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl,BigInt,console",J5=H_(z5);function Dh(r){if(Xt(r)){const o={};for(let c=0;c<r.length;c++){const l=r[c],f=ni(l)?Z5(l):Dh(l);if(f)for(const E in f)o[E]=f[E]}return o}else if(ni(r)||bn(r))return r}const X5=/;(?![^(]*\))/g,Q5=/:([^]+)/,$5=/\/\*[^]*?\*\//g;function Z5(r){const o={};return r.replace($5,"").split(X5).forEach(c=>{if(c){const l=c.split(Q5);l.length>1&&(o[l[0].trim()]=l[1].trim())}}),o}function Ph(r){let o="";if(ni(r))o=r;else if(Xt(r))for(let c=0;c<r.length;c++){const l=Ph(r[c]);l&&(o+=l+" ")}else if(bn(r))for(const c in r)r[c]&&(o+=c+" ");return o.trim()}function t6(r){if(!r)return null;let{class:o,style:c}=r;return o&&!ni(o)&&(r.class=Ph(o)),c&&(r.style=Dh(c)),r}const e6="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",n6=H_(e6);function xP(r){return!!r||r===""}function i6(r,o){if(r.length!==o.length)return!1;let c=!0;for(let l=0;c&&l<r.length;l++)c=Qa(r[l],o[l]);return c}function Qa(r,o){if(r===o)return!0;let c=rD(r),l=rD(o);if(c||l)return c&&l?r.getTime()===o.getTime():!1;if(c=Cl(r),l=Cl(o),c||l)return r===o;if(c=Xt(r),l=Xt(o),c||l)return c&&l?i6(r,o):!1;if(c=bn(r),l=bn(o),c||l){if(!c||!l)return!1;const f=Object.keys(r).length,E=Object.keys(o).length;if(f!==E)return!1;for(const T in r){const w=r.hasOwnProperty(T),N=o.hasOwnProperty(T);if(w&&!N||!w&&N||!Qa(r[T],o[T]))return!1}}return String(r)===String(o)}function K_(r,o){return r.findIndex(c=>Qa(c,o))}const r6=r=>ni(r)?r:r==null?"":Xt(r)||bn(r)&&(r.toString===MP||!ve(r.toString))?JSON.stringify(r,VP,2):String(r),VP=(r,o)=>o&&o.__v_isRef?VP(r,o.value):El(o)?{[`Map(${o.size})`]:[...o.entries()].reduce((c,[l,f])=>(c[`${l} =>`]=f,c),{})}:rd(o)?{[`Set(${o.size})`]:[...o.values()]}:bn(o)&&!Xt(o)&&!UP(o)?String(o):o;let Zr;class jy{constructor(o=!1){this.detached=o,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Zr,!o&&Zr&&(this.index=(Zr.scopes||(Zr.scopes=[])).push(this)-1)}get active(){return this._active}run(o){if(this._active){const c=Zr;try{return Zr=this,o()}finally{Zr=c}}}on(){Zr=this}off(){Zr=this.parent}stop(o){if(this._active){let c,l;for(c=0,l=this.effects.length;c<l;c++)this.effects[c].stop();for(c=0,l=this.cleanups.length;c<l;c++)this.cleanups[c]();if(this.scopes)for(c=0,l=this.scopes.length;c<l;c++)this.scopes[c].stop(!0);if(!this.detached&&this.parent&&!o){const f=this.parent.scopes.pop();f&&f!==this&&(this.parent.scopes[this.index]=f,f.index=this.index)}this.parent=void 0,this._active=!1}}}function FP(r){return new jy(r)}function BP(r,o=Zr){o&&o.active&&o.effects.push(r)}function jP(){return Zr}function s6(r){Zr&&Zr.cleanups.push(r)}const Wy=r=>{const o=new Set(r);return o.w=0,o.n=0,o},WP=r=>(r.w&$a)>0,GP=r=>(r.n&$a)>0,o6=({deps:r})=>{if(r.length)for(let o=0;o<r.length;o++)r[o].w|=$a},a6=r=>{const{deps:o}=r;if(o.length){let c=0;for(let l=0;l<o.length;l++){const f=o[l];WP(f)&&!GP(f)?f.delete(r):o[c++]=f,f.w&=~$a,f.n&=~$a}o.length=c}},w_=new WeakMap;let th=0,$a=1;const XT=30;let Us;const zc=Symbol(""),QT=Symbol("");class Il{constructor(o,c=null,l){this.fn=o,this.scheduler=c,this.active=!0,this.deps=[],this.parent=void 0,BP(this,l)}run(){if(!this.active)return this.fn();let o=Us,c=Ka;for(;o;){if(o===this)return;o=o.parent}try{return this.parent=Us,Us=this,Ka=!0,$a=1<<++th,th<=XT?o6(this):oD(this),this.fn()}finally{th<=XT&&a6(this),$a=1<<--th,Us=this.parent,Ka=c,this.parent=void 0,this.deferStop&&this.stop()}}stop(){Us===this?this.deferStop=!0:this.active&&(oD(this),this.onStop&&this.onStop(),this.active=!1)}}function oD(r){const{deps:o}=r;if(o.length){for(let c=0;c<o.length;c++)o[c].delete(r);o.length=0}}function c6(r,o){r.effect instanceof Il&&(r=r.effect.fn);const c=new Il(r);o&&(ei(c,o),o.scope&&BP(c,o.scope)),(!o||!o.lazy)&&c.run();const l=c.run.bind(c);return l.effect=c,l}function d6(r){r.effect.stop()}let Ka=!0;const HP=[];function Ll(){HP.push(Ka),Ka=!1}function Ml(){const r=HP.pop();Ka=r===void 0?!0:r}function Ur(r,o,c){if(Ka&&Us){let l=w_.get(r);l||w_.set(r,l=new Map);let f=l.get(c);f||l.set(c,f=Wy()),YP(f)}}function YP(r,o){let c=!1;th<=XT?GP(r)||(r.n|=$a,c=!WP(r)):c=!r.has(Us),c&&(r.add(Us),Us.deps.push(r))}function zo(r,o,c,l,f,E){const T=w_.get(r);if(!T)return;let w=[];if(o==="clear")w=[...T.values()];else if(c==="length"&&Xt(r)){const N=Number(l);T.forEach((D,k)=>{(k==="length"||!Cl(k)&&k>=N)&&w.push(D)})}else switch(c!==void 0&&w.push(T.get(c)),o){case"add":Xt(r)?By(c)&&w.push(T.get("length")):(w.push(T.get(zc)),El(r)&&w.push(T.get(QT)));break;case"delete":Xt(r)||(w.push(T.get(zc)),El(r)&&w.push(T.get(QT)));break;case"set":El(r)&&w.push(T.get(zc));break}if(w.length===1)w[0]&&$T(w[0]);else{const N=[];for(const D of w)D&&N.push(...D);$T(Wy(N))}}function $T(r,o){const c=Xt(r)?r:[...r];for(const l of c)l.computed&&aD(l);for(const l of c)l.computed||aD(l)}function aD(r,o){(r!==Us||r.allowRecurse)&&(r.scheduler?r.scheduler():r.run())}function l6(r,o){var c;return(c=w_.get(r))==null?void 0:c.get(o)}const u6=H_("__proto__,__v_isRef,__isVue"),KP=new Set(Object.getOwnPropertyNames(Symbol).filter(r=>r!=="arguments"&&r!=="caller").map(r=>Symbol[r]).filter(Cl)),cD=h6();function h6(){const r={};return["includes","indexOf","lastIndexOf"].forEach(o=>{r[o]=function(...c){const l=ze(this);for(let E=0,T=this.length;E<T;E++)Ur(l,"get",E+"");const f=l[o](...c);return f===-1||f===!1?l[o](...c.map(ze)):f}}),["push","pop","shift","unshift","splice"].forEach(o=>{r[o]=function(...c){Ll();const l=ze(this)[o].apply(this,c);return Ml(),l}}),r}function p6(r){const o=ze(this);return Ur(o,"has",r),o.hasOwnProperty(r)}class qP{constructor(o=!1,c=!1){this._isReadonly=o,this._shallow=c}get(o,c,l){const f=this._isReadonly,E=this._shallow;if(c==="__v_isReactive")return!f;if(c==="__v_isReadonly")return f;if(c==="__v_isShallow")return E;if(c==="__v_raw"&&l===(f?E?ZP:$P:E?QP:XP).get(o))return o;const T=Xt(o);if(!f){if(T&&en(cD,c))return Reflect.get(cD,c,l);if(c==="hasOwnProperty")return p6}const w=Reflect.get(o,c,l);return(Cl(c)?KP.has(c):u6(c))||(f||Ur(o,"get",c),E)?w:Oi(w)?T&&By(c)?w:w.value:bn(w)?f?Yy(w):Ul(w):w}}class zP extends qP{constructor(o=!1){super(!1,o)}set(o,c,l,f){let E=o[c];if(td(E)&&Oi(E)&&!Oi(l))return!1;if(!this._shallow&&(!mh(l)&&!td(l)&&(E=ze(E),l=ze(l)),!Xt(o)&&Oi(E)&&!Oi(l)))return E.value=l,!0;const T=Xt(o)&&By(c)?Number(c)<o.length:en(o,c),w=Reflect.set(o,c,l,f);return o===ze(f)&&(T?Xa(l,E)&&zo(o,"set",c,l):zo(o,"add",c,l)),w}deleteProperty(o,c){const l=en(o,c);o[c];const f=Reflect.deleteProperty(o,c);return f&&l&&zo(o,"delete",c,void 0),f}has(o,c){const l=Reflect.has(o,c);return(!Cl(c)||!KP.has(c))&&Ur(o,"has",c),l}ownKeys(o){return Ur(o,"iterate",Xt(o)?"length":zc),Reflect.ownKeys(o)}}class JP extends qP{constructor(o=!1){super(!0,o)}set(o,c){return!0}deleteProperty(o,c){return!0}}const f6=new zP,_6=new JP,m6=new zP(!0),E6=new JP(!0),Gy=r=>r,q_=r=>Reflect.getPrototypeOf(r);function Xf(r,o,c=!1,l=!1){r=r.__v_raw;const f=ze(r),E=ze(o);c||(Xa(o,E)&&Ur(f,"get",o),Ur(f,"get",E));const{has:T}=q_(f),w=l?Gy:c?zy:Eh;if(T.call(f,o))return w(r.get(o));if(T.call(f,E))return w(r.get(E));r!==f&&r.get(o)}function Qf(r,o=!1){const c=this.__v_raw,l=ze(c),f=ze(r);return o||(Xa(r,f)&&Ur(l,"has",r),Ur(l,"has",f)),r===f?c.has(r):c.has(r)||c.has(f)}function $f(r,o=!1){return r=r.__v_raw,!o&&Ur(ze(r),"iterate",zc),Reflect.get(r,"size",r)}function dD(r){r=ze(r);const o=ze(this);return q_(o).has.call(o,r)||(o.add(r),zo(o,"add",r,r)),this}function lD(r,o){o=ze(o);const c=ze(this),{has:l,get:f}=q_(c);let E=l.call(c,r);E||(r=ze(r),E=l.call(c,r));const T=f.call(c,r);return c.set(r,o),E?Xa(o,T)&&zo(c,"set",r,o):zo(c,"add",r,o),this}function uD(r){const o=ze(this),{has:c,get:l}=q_(o);let f=c.call(o,r);f||(r=ze(r),f=c.call(o,r)),l&&l.call(o,r);const E=o.delete(r);return f&&zo(o,"delete",r,void 0),E}function hD(){const r=ze(this),o=r.size!==0,c=r.clear();return o&&zo(r,"clear",void 0,void 0),c}function Zf(r,o){return function(l,f){const E=this,T=E.__v_raw,w=ze(T),N=o?Gy:r?zy:Eh;return!r&&Ur(w,"iterate",zc),T.forEach((D,k)=>l.call(f,N(D),N(k),E))}}function t_(r,o,c){return function(...l){const f=this.__v_raw,E=ze(f),T=El(E),w=r==="entries"||r===Symbol.iterator&&T,N=r==="keys"&&T,D=f[r](...l),k=c?Gy:o?zy:Eh;return!o&&Ur(E,"iterate",N?QT:zc),{next(){const{value:M,done:j}=D.next();return j?{value:M,done:j}:{value:w?[k(M[0]),k(M[1])]:k(M),done:j}},[Symbol.iterator](){return this}}}}function Ma(r){return function(...o){return r==="delete"?!1:r==="clear"?void 0:this}}function g6(){const r={get(E){return Xf(this,E)},get size(){return $f(this)},has:Qf,add:dD,set:lD,delete:uD,clear:hD,forEach:Zf(!1,!1)},o={get(E){return Xf(this,E,!1,!0)},get size(){return $f(this)},has:Qf,add:dD,set:lD,delete:uD,clear:hD,forEach:Zf(!1,!0)},c={get(E){return Xf(this,E,!0)},get size(){return $f(this,!0)},has(E){return Qf.call(this,E,!0)},add:Ma("add"),set:Ma("set"),delete:Ma("delete"),clear:Ma("clear"),forEach:Zf(!0,!1)},l={get(E){return Xf(this,E,!0,!0)},get size(){return $f(this,!0)},has(E){return Qf.call(this,E,!0)},add:Ma("add"),set:Ma("set"),delete:Ma("delete"),clear:Ma("clear"),forEach:Zf(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(E=>{r[E]=t_(E,!1,!1),c[E]=t_(E,!0,!1),o[E]=t_(E,!1,!0),l[E]=t_(E,!0,!0)}),[r,c,o,l]}const[S6,T6,y6,R6]=g6();function z_(r,o){const c=o?r?R6:y6:r?T6:S6;return(l,f,E)=>f==="__v_isReactive"?!r:f==="__v_isReadonly"?r:f==="__v_raw"?l:Reflect.get(en(c,f)&&f in l?c:l,f,E)}const v6={get:z_(!1,!1)},C6={get:z_(!1,!0)},I6={get:z_(!0,!1)},b6={get:z_(!0,!0)},XP=new WeakMap,QP=new WeakMap,$P=new WeakMap,ZP=new WeakMap;function w6(r){switch(r){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function A6(r){return r.__v_skip||!Object.isExtensible(r)?0:w6(Y5(r))}function Ul(r){return td(r)?r:J_(r,!1,f6,v6,XP)}function Hy(r){return J_(r,!1,m6,C6,QP)}function Yy(r){return J_(r,!0,_6,I6,$P)}function O6(r){return J_(r,!0,E6,b6,ZP)}function J_(r,o,c,l,f){if(!bn(r)||r.__v_raw&&!(o&&r.__v_isReactive))return r;const E=f.get(r);if(E)return E;const T=A6(r);if(T===0)return r;const w=new Proxy(r,T===2?l:c);return f.set(r,w),w}function Jc(r){return td(r)?Jc(r.__v_raw):!!(r&&r.__v_isReactive)}function td(r){return!!(r&&r.__v_isReadonly)}function mh(r){return!!(r&&r.__v_isShallow)}function Ky(r){return Jc(r)||td(r)}function ze(r){const o=r&&r.__v_raw;return o?ze(o):r}function qy(r){return C_(r,"__v_skip",!0),r}const Eh=r=>bn(r)?Ul(r):r,zy=r=>bn(r)?Yy(r):r;function Jy(r){Ka&&Us&&(r=ze(r),YP(r.dep||(r.dep=Wy())))}function X_(r,o){r=ze(r);const c=r.dep;c&&$T(c)}function Oi(r){return!!(r&&r.__v_isRef===!0)}function Xc(r){return ek(r,!1)}function tk(r){return ek(r,!0)}function ek(r,o){return Oi(r)?r:new N6(r,o)}class N6{constructor(o,c){this.__v_isShallow=c,this.dep=void 0,this.__v_isRef=!0,this._rawValue=c?o:ze(o),this._value=c?o:Eh(o)}get value(){return Jy(this),this._value}set value(o){const c=this.__v_isShallow||mh(o)||td(o);o=c?o:ze(o),Xa(o,this._rawValue)&&(this._rawValue=o,this._value=c?o:Eh(o),X_(this))}}function D6(r){X_(r)}function qa(r){return Oi(r)?r.value:r}function P6(r){return ve(r)?r():qa(r)}const k6={get:(r,o,c)=>qa(Reflect.get(r,o,c)),set:(r,o,c,l)=>{const f=r[o];return Oi(f)&&!Oi(c)?(f.value=c,!0):Reflect.set(r,o,c,l)}};function Xy(r){return Jc(r)?r:new Proxy(r,k6)}class L6{constructor(o){this.dep=void 0,this.__v_isRef=!0;const{get:c,set:l}=o(()=>Jy(this),()=>X_(this));this._get=c,this._set=l}get value(){return this._get()}set value(o){this._set(o)}}function M6(r){return new L6(r)}function U6(r){const o=Xt(r)?new Array(r.length):{};for(const c in r)o[c]=nk(r,c);return o}class x6{constructor(o,c,l){this._object=o,this._key=c,this._defaultValue=l,this.__v_isRef=!0}get value(){const o=this._object[this._key];return o===void 0?this._defaultValue:o}set value(o){this._object[this._key]=o}get dep(){return l6(ze(this._object),this._key)}}class V6{constructor(o){this._getter=o,this.__v_isRef=!0,this.__v_isReadonly=!0}get value(){return this._getter()}}function F6(r,o,c){return Oi(r)?r:ve(r)?new V6(r):bn(r)&&arguments.length>1?nk(r,o,c):Xc(r)}function nk(r,o,c){const l=r[o];return Oi(l)?l:new x6(r,o,c)}class B6{constructor(o,c,l,f){this._setter=c,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this._dirty=!0,this.effect=new Il(o,()=>{this._dirty||(this._dirty=!0,X_(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!f,this.__v_isReadonly=l}get value(){const o=ze(this);return Jy(o),(o._dirty||!o._cacheable)&&(o._dirty=!1,o._value=o.effect.run()),o._value}set value(o){this._setter(o)}}function j6(r,o,c=!1){let l,f;const E=ve(r);return E?(l=r,f=Fs):(l=r.get,f=r.set),new B6(l,f,E||!f,c)}function W6(r,...o){}function G6(r,o){}function Jo(r,o,c,l){let f;try{f=l?r(...l):r()}catch(E){sd(E,o,c)}return f}function is(r,o,c,l){if(ve(r)){const E=Jo(r,o,c,l);return E&&Fy(E)&&E.catch(T=>{sd(T,o,c)}),E}const f=[];for(let E=0;E<r.length;E++)f.push(is(r[E],o,c,l));return f}function sd(r,o,c,l=!0){const f=o?o.vnode:null;if(o){let E=o.parent;const T=o.proxy,w=c;for(;E;){const D=E.ec;if(D){for(let k=0;k<D.length;k++)if(D[k](r,T,w)===!1)return}E=E.parent}const N=o.appContext.config.errorHandler;if(N){Jo(N,null,10,[r,T,w]);return}}H6(r,c,f,l)}function H6(r,o,c,l=!0){console.error(r)}let gh=!1,ZT=!1;const er=[];let ho=0;const Sl=[];let Go=null,Hc=0;const ik=Promise.resolve();let Qy=null;function Q_(r){const o=Qy||ik;return r?o.then(this?r.bind(this):r):o}function Y6(r){let o=ho+1,c=er.length;for(;o<c;){const l=o+c>>>1,f=er[l],E=Sh(f);E<r||E===r&&f.pre?o=l+1:c=l}return o}function $_(r){(!er.length||!er.includes(r,gh&&r.allowRecurse?ho+1:ho))&&(r.id==null?er.push(r):er.splice(Y6(r.id),0,r),rk())}function rk(){!gh&&!ZT&&(ZT=!0,Qy=ik.then(sk))}function K6(r){const o=er.indexOf(r);o>ho&&er.splice(o,1)}function A_(r){Xt(r)?Sl.push(...r):(!Go||!Go.includes(r,r.allowRecurse?Hc+1:Hc))&&Sl.push(r),rk()}function pD(r,o=gh?ho+1:0){for(;o<er.length;o++){const c=er[o];c&&c.pre&&(er.splice(o,1),o--,c())}}function O_(r){if(Sl.length){const o=[...new Set(Sl)];if(Sl.length=0,Go){Go.push(...o);return}for(Go=o,Go.sort((c,l)=>Sh(c)-Sh(l)),Hc=0;Hc<Go.length;Hc++)Go[Hc]();Go=null,Hc=0}}const Sh=r=>r.id==null?1/0:r.id,q6=(r,o)=>{const c=Sh(r)-Sh(o);if(c===0){if(r.pre&&!o.pre)return-1;if(o.pre&&!r.pre)return 1}return c};function sk(r){ZT=!1,gh=!0,er.sort(q6);const o=Fs;try{for(ho=0;ho<er.length;ho++){const c=er[ho];c&&c.active!==!1&&Jo(c,null,14)}}finally{ho=0,er.length=0,O_(),gh=!1,Qy=null,(er.length||Sl.length)&&sk()}}let ul,e_=[];function ok(r,o){var c,l;ul=r,ul?(ul.enabled=!0,e_.forEach(({event:f,args:E})=>ul.emit(f,...E)),e_=[]):typeof window<"u"&&window.HTMLElement&&!((l=(c=window.navigator)==null?void 0:c.userAgent)!=null&&l.includes("jsdom"))?((o.__VUE_DEVTOOLS_HOOK_REPLAY__=o.__VUE_DEVTOOLS_HOOK_REPLAY__||[]).push(E=>{ok(E,o)}),setTimeout(()=>{ul||(o.__VUE_DEVTOOLS_HOOK_REPLAY__=null,e_=[])},3e3)):e_=[]}function z6(r,o,...c){if(r.isUnmounted)return;const l=r.vnode.props||In;let f=c;const E=o.startsWith("update:"),T=E&&o.slice(7);if(T&&T in l){const k=`${T==="modelValue"?"model":T}Modifiers`,{number:M,trim:j}=l[k]||In;j&&(f=c.map(nt=>ni(nt)?nt.trim():nt)),M&&(f=c.map(I_))}let w,N=l[w=oh(o)]||l[w=oh(Mr(o))];!N&&E&&(N=l[w=oh(Rs(o))]),N&&is(N,r,6,f);const D=l[w+"Once"];if(D){if(!r.emitted)r.emitted={};else if(r.emitted[w])return;r.emitted[w]=!0,is(D,r,6,f)}}function ak(r,o,c=!1){const l=o.emitsCache,f=l.get(r);if(f!==void 0)return f;const E=r.emits;let T={},w=!1;if(!ve(r)){const N=D=>{const k=ak(D,o,!0);k&&(w=!0,ei(T,k))};!c&&o.mixins.length&&o.mixins.forEach(N),r.extends&&N(r.extends),r.mixins&&r.mixins.forEach(N)}return!E&&!w?(bn(r)&&l.set(r,null),null):(Xt(E)?E.forEach(N=>T[N]=null):ei(T,E),bn(r)&&l.set(r,T),T)}function Z_(r,o){return!r||!Oh(o)?!1:(o=o.slice(2).replace(/Once$/,""),en(r,o[0].toLowerCase()+o.slice(1))||en(r,Rs(o))||en(r,o))}let xi=null,tm=null;function Th(r){const o=xi;return xi=r,tm=r&&r.type.__scopeId||null,o}function J6(r){tm=r}function X6(){tm=null}const Q6=r=>$y;function $y(r,o=xi,c){if(!o||r._n)return r;const l=(...f)=>{l._d&&oy(-1);const E=Th(o);let T;try{T=r(...f)}finally{Th(E),l._d&&oy(1)}return T};return l._n=!0,l._c=!0,l._d=!0,l}function f_(r){const{type:o,vnode:c,proxy:l,withProxy:f,props:E,propsOptions:[T],slots:w,attrs:N,emit:D,render:k,renderCache:M,data:j,setupState:nt,ctx:rt,inheritAttrs:at}=r;let Ot,wt;const dt=Th(r);try{if(c.shapeFlag&4){const Q=f||l,St=Q;Ot=ts(k.call(St,Q,M,E,nt,j,rt)),wt=N}else{const Q=o;Ot=ts(Q.length>1?Q(E,{attrs:N,slots:w,emit:D}):Q(E,null)),wt=o.props?N:Z6(N)}}catch(Q){lh.length=0,sd(Q,r,1),Ot=Hn(nr)}let it=Ot;if(wt&&at!==!1){const Q=Object.keys(wt),{shapeFlag:St}=it;Q.length&&St&7&&(T&&Q.some(xy)&&(wt=tY(wt,T)),it=Eo(it,wt))}return c.dirs&&(it=Eo(it),it.dirs=it.dirs?it.dirs.concat(c.dirs):c.dirs),c.transition&&(it.transition=c.transition),Ot=it,Th(dt),Ot}function $6(r){let o;for(let c=0;c<r.length;c++){const l=r[c];if(Za(l)){if(l.type!==nr||l.children==="v-if"){if(o)return;o=l}}else return}return o}const Z6=r=>{let o;for(const c in r)(c==="class"||c==="style"||Oh(c))&&((o||(o={}))[c]=r[c]);return o},tY=(r,o)=>{const c={};for(const l in r)(!xy(l)||!(l.slice(9)in o))&&(c[l]=r[l]);return c};function eY(r,o,c){const{props:l,children:f,component:E}=r,{props:T,children:w,patchFlag:N}=o,D=E.emitsOptions;if(o.dirs||o.transition)return!0;if(c&&N>=0){if(N&1024)return!0;if(N&16)return l?fD(l,T,D):!!T;if(N&8){const k=o.dynamicProps;for(let M=0;M<k.length;M++){const j=k[M];if(T[j]!==l[j]&&!Z_(D,j))return!0}}}else return(f||w)&&(!w||!w.$stable)?!0:l===T?!1:l?T?fD(l,T,D):!0:!!T;return!1}function fD(r,o,c){const l=Object.keys(o);if(l.length!==Object.keys(r).length)return!0;for(let f=0;f<l.length;f++){const E=l[f];if(o[E]!==r[E]&&!Z_(c,E))return!0}return!1}function Zy({vnode:r,parent:o},c){for(;o&&o.subTree===r;)(r=o.vnode).el=c,o=o.parent}const tR="components",nY="directives";function iY(r,o){return eR(tR,r,!0,o)||r}const ck=Symbol.for("v-ndc");function rY(r){return ni(r)?eR(tR,r,!1)||r:r||ck}function sY(r){return eR(nY,r)}function eR(r,o,c=!0,l=!1){const f=xi||Ri;if(f){const E=f.type;if(r===tR){const w=dy(E,!1);if(w&&(w===o||w===Mr(o)||w===Nh(Mr(o))))return E}const T=_D(f[r]||E[r],o)||_D(f.appContext[r],o);return!T&&l?E:T}}function _D(r,o){return r&&(r[o]||r[Mr(o)]||r[Nh(Mr(o))])}const dk=r=>r.__isSuspense,oY={name:"Suspense",__isSuspense:!0,process(r,o,c,l,f,E,T,w,N,D){r==null?cY(o,c,l,f,E,T,w,N,D):dY(r,o,c,l,f,T,w,N,D)},hydrate:lY,create:nR,normalize:uY},aY=oY;function yh(r,o){const c=r.props&&r.props[o];ve(c)&&c()}function cY(r,o,c,l,f,E,T,w,N){const{p:D,o:{createElement:k}}=N,M=k("div"),j=r.suspense=nR(r,f,l,o,M,c,E,T,w,N);D(null,j.pendingBranch=r.ssContent,M,null,l,j,E,T),j.deps>0?(yh(r,"onPending"),yh(r,"onFallback"),D(null,r.ssFallback,o,c,l,null,E,T),Tl(j,r.ssFallback)):j.resolve(!1,!0)}function dY(r,o,c,l,f,E,T,w,{p:N,um:D,o:{createElement:k}}){const M=o.suspense=r.suspense;M.vnode=o,o.el=r.el;const j=o.ssContent,nt=o.ssFallback,{activeBranch:rt,pendingBranch:at,isInFallback:Ot,isHydrating:wt}=M;if(at)M.pendingBranch=j,xs(j,at)?(N(at,j,M.hiddenContainer,null,f,M,E,T,w),M.deps<=0?M.resolve():Ot&&(N(rt,nt,c,l,f,null,E,T,w),Tl(M,nt))):(M.pendingId++,wt?(M.isHydrating=!1,M.activeBranch=at):D(at,f,M),M.deps=0,M.effects.length=0,M.hiddenContainer=k("div"),Ot?(N(null,j,M.hiddenContainer,null,f,M,E,T,w),M.deps<=0?M.resolve():(N(rt,nt,c,l,f,null,E,T,w),Tl(M,nt))):rt&&xs(j,rt)?(N(rt,j,c,l,f,M,E,T,w),M.resolve(!0)):(N(null,j,M.hiddenContainer,null,f,M,E,T,w),M.deps<=0&&M.resolve()));else if(rt&&xs(j,rt))N(rt,j,c,l,f,M,E,T,w),Tl(M,j);else if(yh(o,"onPending"),M.pendingBranch=j,M.pendingId++,N(null,j,M.hiddenContainer,null,f,M,E,T,w),M.deps<=0)M.resolve();else{const{timeout:dt,pendingId:it}=M;dt>0?setTimeout(()=>{M.pendingId===it&&M.fallback(nt)},dt):dt===0&&M.fallback(nt)}}function nR(r,o,c,l,f,E,T,w,N,D,k=!1){const{p:M,m:j,um:nt,n:rt,o:{parentNode:at,remove:Ot}}=D;let wt;const dt=hY(r);dt&&o!=null&&o.pendingBranch&&(wt=o.pendingId,o.deps++);const it=r.props?b_(r.props.timeout):void 0,Q={vnode:r,parent:o,parentComponent:c,isSVG:T,container:l,hiddenContainer:f,anchor:E,deps:0,pendingId:0,timeout:typeof it=="number"?it:-1,activeBranch:null,pendingBranch:null,isInFallback:!0,isHydrating:k,isUnmounted:!1,effects:[],resolve(St=!1,Ft=!1){const{vnode:jt,activeBranch:At,pendingBranch:Wt,pendingId:xt,effects:ae,parentComponent:Mt,container:fe}=Q;let _n=!1;if(Q.isHydrating)Q.isHydrating=!1;else if(!St){_n=At&&Wt.transition&&Wt.transition.mode==="out-in",_n&&(At.transition.afterLeave=()=>{xt===Q.pendingId&&(j(Wt,fe,rt(At),0),A_(ae))});let{anchor:be}=Q;At&&(be=rt(At),nt(At,Mt,Q,!0)),_n||j(Wt,fe,be,0)}Tl(Q,Wt),Q.pendingBranch=null,Q.isInFallback=!1;let ln=Q.parent,Zt=!1;for(;ln;){if(ln.pendingBranch){ln.effects.push(...ae),Zt=!0;break}ln=ln.parent}!Zt&&!_n&&A_(ae),Q.effects=[],dt&&o&&o.pendingBranch&&wt===o.pendingId&&(o.deps--,o.deps===0&&!Ft&&o.resolve()),yh(jt,"onResolve")},fallback(St){if(!Q.pendingBranch)return;const{vnode:Ft,activeBranch:jt,parentComponent:At,container:Wt,isSVG:xt}=Q;yh(Ft,"onFallback");const ae=()=>{Q.isInFallback&&(M(null,St,Wt,rt(jt),At,null,xt,w,N),Tl(Q,St))},Mt=St.transition&&St.transition.mode==="out-in";Mt&&(jt.transition.afterLeave=ae),Q.isInFallback=!0,nt(jt,At,null,!0),Mt||ae()},move(St,Ft,jt){Q.activeBranch&&j(Q.activeBranch,St,Ft,jt),Q.container=St},next(){return Q.activeBranch&&rt(Q.activeBranch)},registerDep(St,Ft){const jt=!!Q.pendingBranch;jt&&Q.deps++;const At=St.vnode.el;St.asyncDep.catch(Wt=>{sd(Wt,St,0)}).then(Wt=>{if(St.isUnmounted||Q.isUnmounted||Q.pendingId!==St.suspenseId)return;St.asyncResolved=!0;const{vnode:xt}=St;ay(St,Wt,!1),At&&(xt.el=At);const ae=!At&&St.subTree.el;Ft(St,xt,at(At||St.subTree.el),At?null:rt(St.subTree),Q,T,N),ae&&Ot(ae),Zy(St,xt.el),jt&&--Q.deps===0&&Q.resolve()})},unmount(St,Ft){Q.isUnmounted=!0,Q.activeBranch&&nt(Q.activeBranch,c,St,Ft),Q.pendingBranch&&nt(Q.pendingBranch,c,St,Ft)}};return Q}function lY(r,o,c,l,f,E,T,w,N){const D=o.suspense=nR(o,l,c,r.parentNode,document.createElement("div"),null,f,E,T,w,!0),k=N(r,D.pendingBranch=o.ssContent,c,D,E,T);return D.deps===0&&D.resolve(!1,!0),k}function uY(r){const{shapeFlag:o,children:c}=r,l=o&32;r.ssContent=mD(l?c.default:c),r.ssFallback=l?mD(c.fallback):Hn(nr)}function mD(r){let o;if(ve(r)){const c=id&&r._c;c&&(r._d=!1,om()),r=r(),c&&(r._d=!0,o=Lr,Vk())}return Xt(r)&&(r=$6(r)),r=ts(r),o&&!r.dynamicChildren&&(r.dynamicChildren=o.filter(c=>c!==r)),r}function lk(r,o){o&&o.pendingBranch?Xt(r)?o.effects.push(...r):o.effects.push(r):A_(r)}function Tl(r,o){r.activeBranch=o;const{vnode:c,parentComponent:l}=r,f=c.el=o.el;l&&l.subTree===c&&(l.vnode.el=f,Zy(l,f))}function hY(r){var o;return((o=r.props)==null?void 0:o.suspensible)!=null&&r.props.suspensible!==!1}function pY(r,o){return kh(r,null,o)}function uk(r,o){return kh(r,null,{flush:"post"})}function fY(r,o){return kh(r,null,{flush:"sync"})}const n_={};function _o(r,o,c){return kh(r,o,c)}function kh(r,o,{immediate:c,deep:l,flush:f,onTrack:E,onTrigger:T}=In){var w;const N=jP()===((w=Ri)==null?void 0:w.scope)?Ri:null;let D,k=!1,M=!1;if(Oi(r)?(D=()=>r.value,k=mh(r)):Jc(r)?(D=()=>r,l=!0):Xt(r)?(M=!0,k=r.some(Q=>Jc(Q)||mh(Q)),D=()=>r.map(Q=>{if(Oi(Q))return Q.value;if(Jc(Q))return Kc(Q);if(ve(Q))return Jo(Q,N,2)})):ve(r)?o?D=()=>Jo(r,N,2):D=()=>{if(!(N&&N.isUnmounted))return j&&j(),is(r,N,3,[nt])}:D=Fs,o&&l){const Q=D;D=()=>Kc(Q())}let j,nt=Q=>{j=dt.onStop=()=>{Jo(Q,N,4),j=dt.onStop=void 0}},rt;if(wl)if(nt=Fs,o?c&&is(o,N,3,[D(),M?[]:void 0,nt]):D(),f==="sync"){const Q=Jk();rt=Q.__watcherHandles||(Q.__watcherHandles=[])}else return Fs;let at=M?new Array(r.length).fill(n_):n_;const Ot=()=>{if(dt.active)if(o){const Q=dt.run();(l||k||(M?Q.some((St,Ft)=>Xa(St,at[Ft])):Xa(Q,at)))&&(j&&j(),is(o,N,3,[Q,at===n_?void 0:M&&at[0]===n_?[]:at,nt]),at=Q)}else dt.run()};Ot.allowRecurse=!!o;let wt;f==="sync"?wt=Ot:f==="post"?wt=()=>Wi(Ot,N&&N.suspense):(Ot.pre=!0,N&&(Ot.id=N.uid),wt=()=>$_(Ot));const dt=new Il(D,wt);o?c?Ot():at=dt.run():f==="post"?Wi(dt.run.bind(dt),N&&N.suspense):dt.run();const it=()=>{dt.stop(),N&&N.scope&&Vy(N.scope.effects,dt)};return rt&&rt.push(it),it}function _Y(r,o,c){const l=this.proxy,f=ni(r)?r.includes(".")?hk(l,r):()=>l[r]:r.bind(l,l);let E;ve(o)?E=o:(E=o.handler,c=o);const T=Ri;tc(this);const w=kh(f,E.bind(l),c);return T?tc(T):za(),w}function hk(r,o){const c=o.split(".");return()=>{let l=r;for(let f=0;f<c.length&&l;f++)l=l[c[f]];return l}}function Kc(r,o){if(!bn(r)||r.__v_skip||(o=o||new Set,o.has(r)))return r;if(o.add(r),Oi(r))Kc(r.value,o);else if(Xt(r))for(let c=0;c<r.length;c++)Kc(r[c],o);else if(rd(r)||El(r))r.forEach(c=>{Kc(c,o)});else if(UP(r))for(const c in r)Kc(r[c],o);return r}function mY(r,o){const c=xi;if(c===null)return r;const l=cm(c)||c.proxy,f=r.dirs||(r.dirs=[]);for(let E=0;E<o.length;E++){let[T,w,N,D=In]=o[E];T&&(ve(T)&&(T={mounted:T,updated:T}),T.deep&&Kc(w),f.push({dir:T,instance:l,value:w,oldValue:void 0,arg:N,modifiers:D}))}return r}function uo(r,o,c,l){const f=r.dirs,E=o&&o.dirs;for(let T=0;T<f.length;T++){const w=f[T];E&&(w.oldValue=E[T].value);let N=w.dir[l];N&&(Ll(),is(N,c,8,[r.el,w,r,o]),Ml())}}const ja=Symbol("_leaveCb"),i_=Symbol("_enterCb");function iR(){const r={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Uh(()=>{r.isMounted=!0}),rm(()=>{r.isUnmounting=!0}),r}const Ss=[Function,Array],rR={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Ss,onEnter:Ss,onAfterEnter:Ss,onEnterCancelled:Ss,onBeforeLeave:Ss,onLeave:Ss,onAfterLeave:Ss,onLeaveCancelled:Ss,onBeforeAppear:Ss,onAppear:Ss,onAfterAppear:Ss,onAppearCancelled:Ss},EY={name:"BaseTransition",props:rR,setup(r,{slots:o}){const c=ta(),l=iR();let f;return()=>{const E=o.default&&em(o.default(),!0);if(!E||!E.length)return;let T=E[0];if(E.length>1){for(const at of E)if(at.type!==nr){T=at;break}}const w=ze(r),{mode:N}=w;if(l.isLeaving)return IT(T);const D=ED(T);if(!D)return IT(T);const k=bl(D,w,l,c);ed(D,k);const M=c.subTree,j=M&&ED(M);let nt=!1;const{getTransitionKey:rt}=D.type;if(rt){const at=rt();f===void 0?f=at:at!==f&&(f=at,nt=!0)}if(j&&j.type!==nr&&(!xs(D,j)||nt)){const at=bl(j,w,l,c);if(ed(j,at),N==="out-in")return l.isLeaving=!0,at.afterLeave=()=>{l.isLeaving=!1,c.update.active!==!1&&c.update()},IT(T);N==="in-out"&&D.type!==nr&&(at.delayLeave=(Ot,wt,dt)=>{const it=fk(l,j);it[String(j.key)]=j,Ot[ja]=()=>{wt(),Ot[ja]=void 0,delete k.delayedLeave},k.delayedLeave=dt})}return T}}},pk=EY;function fk(r,o){const{leavingVNodes:c}=r;let l=c.get(o.type);return l||(l=Object.create(null),c.set(o.type,l)),l}function bl(r,o,c,l){const{appear:f,mode:E,persisted:T=!1,onBeforeEnter:w,onEnter:N,onAfterEnter:D,onEnterCancelled:k,onBeforeLeave:M,onLeave:j,onAfterLeave:nt,onLeaveCancelled:rt,onBeforeAppear:at,onAppear:Ot,onAfterAppear:wt,onAppearCancelled:dt}=o,it=String(r.key),Q=fk(c,r),St=(At,Wt)=>{At&&is(At,l,9,Wt)},Ft=(At,Wt)=>{const xt=Wt[1];St(At,Wt),Xt(At)?At.every(ae=>ae.length<=1)&&xt():At.length<=1&&xt()},jt={mode:E,persisted:T,beforeEnter(At){let Wt=w;if(!c.isMounted)if(f)Wt=at||w;else return;At[ja]&&At[ja](!0);const xt=Q[it];xt&&xs(r,xt)&&xt.el[ja]&&xt.el[ja](),St(Wt,[At])},enter(At){let Wt=N,xt=D,ae=k;if(!c.isMounted)if(f)Wt=Ot||N,xt=wt||D,ae=dt||k;else return;let Mt=!1;const fe=At[i_]=_n=>{Mt||(Mt=!0,_n?St(ae,[At]):St(xt,[At]),jt.delayedLeave&&jt.delayedLeave(),At[i_]=void 0)};Wt?Ft(Wt,[At,fe]):fe()},leave(At,Wt){const xt=String(r.key);if(At[i_]&&At[i_](!0),c.isUnmounting)return Wt();St(M,[At]);let ae=!1;const Mt=At[ja]=fe=>{ae||(ae=!0,Wt(),fe?St(rt,[At]):St(nt,[At]),At[ja]=void 0,Q[xt]===r&&delete Q[xt])};Q[xt]=r,j?Ft(j,[At,Mt]):Mt()},clone(At){return bl(At,o,c,l)}};return jt}function IT(r){if(Mh(r))return r=Eo(r),r.children=null,r}function ED(r){return Mh(r)?r.children?r.children[0]:void 0:r}function ed(r,o){r.shapeFlag&6&&r.component?ed(r.component.subTree,o):r.shapeFlag&128?(r.ssContent.transition=o.clone(r.ssContent),r.ssFallback.transition=o.clone(r.ssFallback)):r.transition=o}function em(r,o=!1,c){let l=[],f=0;for(let E=0;E<r.length;E++){let T=r[E];const w=c==null?T.key:String(c)+String(T.key!=null?T.key:E);T.type===Gi?(T.patchFlag&128&&f++,l=l.concat(em(T.children,o,w))):(o||T.type!==nr)&&l.push(w!=null?Eo(T,{key:w}):T)}if(f>1)for(let E=0;E<l.length;E++)l[E].patchFlag=-2;return l}/*! #__NO_SIDE_EFFECTS__ */function Lh(r,o){return ve(r)?(()=>ei({name:r.name},o,{setup:r}))():r}const Qc=r=>!!r.type.__asyncLoader;/*! #__NO_SIDE_EFFECTS__ */function gY(r){ve(r)&&(r={loader:r});const{loader:o,loadingComponent:c,errorComponent:l,delay:f=200,timeout:E,suspensible:T=!0,onError:w}=r;let N=null,D,k=0;const M=()=>(k++,N=null,j()),j=()=>{let nt;return N||(nt=N=o().catch(rt=>{if(rt=rt instanceof Error?rt:new Error(String(rt)),w)return new Promise((at,Ot)=>{w(rt,()=>at(M()),()=>Ot(rt),k+1)});throw rt}).then(rt=>nt!==N&&N?N:(rt&&(rt.__esModule||rt[Symbol.toStringTag]==="Module")&&(rt=rt.default),D=rt,rt)))};return Lh({name:"AsyncComponentWrapper",__asyncLoader:j,get __asyncResolved(){return D},setup(){const nt=Ri;if(D)return()=>bT(D,nt);const rt=dt=>{N=null,sd(dt,nt,13,!l)};if(T&&nt.suspense||wl)return j().then(dt=>()=>bT(dt,nt)).catch(dt=>(rt(dt),()=>l?Hn(l,{error:dt}):null));const at=Xc(!1),Ot=Xc(),wt=Xc(!!f);return f&&setTimeout(()=>{wt.value=!1},f),E!=null&&setTimeout(()=>{if(!at.value&&!Ot.value){const dt=new Error(`Async component timed out after ${E}ms.`);rt(dt),Ot.value=dt}},E),j().then(()=>{at.value=!0,nt.parent&&Mh(nt.parent.vnode)&&$_(nt.parent.update)}).catch(dt=>{rt(dt),Ot.value=dt}),()=>{if(at.value&&D)return bT(D,nt);if(Ot.value&&l)return Hn(l,{error:Ot.value});if(c&&!wt.value)return Hn(c)}}})}function bT(r,o){const{ref:c,props:l,children:f,ce:E}=o.vnode,T=Hn(r,l,f);return T.ref=c,T.ce=E,delete o.vnode.ce,T}const Mh=r=>r.type.__isKeepAlive,SY={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(r,{slots:o}){const c=ta(),l=c.ctx;if(!l.renderer)return()=>{const dt=o.default&&o.default();return dt&&dt.length===1?dt[0]:dt};const f=new Map,E=new Set;let T=null;const w=c.suspense,{renderer:{p:N,m:D,um:k,o:{createElement:M}}}=l,j=M("div");l.activate=(dt,it,Q,St,Ft)=>{const jt=dt.component;D(dt,it,Q,0,w),N(jt.vnode,dt,it,Q,jt,w,St,dt.slotScopeIds,Ft),Wi(()=>{jt.isDeactivated=!1,jt.a&&gl(jt.a);const At=dt.props&&dt.props.onVnodeMounted;At&&kr(At,jt.parent,dt)},w)},l.deactivate=dt=>{const it=dt.component;D(dt,j,null,1,w),Wi(()=>{it.da&&gl(it.da);const Q=dt.props&&dt.props.onVnodeUnmounted;Q&&kr(Q,it.parent,dt),it.isDeactivated=!0},w)};function nt(dt){wT(dt),k(dt,c,w,!0)}function rt(dt){f.forEach((it,Q)=>{const St=dy(it.type);St&&(!dt||!dt(St))&&at(Q)})}function at(dt){const it=f.get(dt);!T||!xs(it,T)?nt(it):T&&wT(T),f.delete(dt),E.delete(dt)}_o(()=>[r.include,r.exclude],([dt,it])=>{dt&&rt(Q=>eh(dt,Q)),it&&rt(Q=>!eh(it,Q))},{flush:"post",deep:!0});let Ot=null;const wt=()=>{Ot!=null&&f.set(Ot,AT(c.subTree))};return Uh(wt),im(wt),rm(()=>{f.forEach(dt=>{const{subTree:it,suspense:Q}=c,St=AT(it);if(dt.type===St.type&&dt.key===St.key){wT(St);const Ft=St.component.da;Ft&&Wi(Ft,Q);return}nt(dt)})}),()=>{if(Ot=null,!o.default)return null;const dt=o.default(),it=dt[0];if(dt.length>1)return T=null,dt;if(!Za(it)||!(it.shapeFlag&4)&&!(it.shapeFlag&128))return T=null,it;let Q=AT(it);const St=Q.type,Ft=dy(Qc(Q)?Q.type.__asyncResolved||{}:St),{include:jt,exclude:At,max:Wt}=r;if(jt&&(!Ft||!eh(jt,Ft))||At&&Ft&&eh(At,Ft))return T=Q,it;const xt=Q.key==null?St:Q.key,ae=f.get(xt);return Q.el&&(Q=Eo(Q),it.shapeFlag&128&&(it.ssContent=Q)),Ot=xt,ae?(Q.el=ae.el,Q.component=ae.component,Q.transition&&ed(Q,Q.transition),Q.shapeFlag|=512,E.delete(xt),E.add(xt)):(E.add(xt),Wt&&E.size>parseInt(Wt,10)&&at(E.values().next().value)),Q.shapeFlag|=256,T=Q,dk(it.type)?it:Q}}},TY=SY;function eh(r,o){return Xt(r)?r.some(c=>eh(c,o)):ni(r)?r.split(",").includes(o):H5(r)?r.test(o):!1}function _k(r,o){Ek(r,"a",o)}function mk(r,o){Ek(r,"da",o)}function Ek(r,o,c=Ri){const l=r.__wdc||(r.__wdc=()=>{let f=c;for(;f;){if(f.isDeactivated)return;f=f.parent}return r()});if(nm(o,l,c),c){let f=c.parent;for(;f&&f.parent;)Mh(f.parent.vnode)&&yY(l,o,c,f),f=f.parent}}function yY(r,o,c,l){const f=nm(o,r,l,!0);sm(()=>{Vy(l[o],f)},c)}function wT(r){r.shapeFlag&=-257,r.shapeFlag&=-513}function AT(r){return r.shapeFlag&128?r.ssContent:r}function nm(r,o,c=Ri,l=!1){if(c){const f=c[r]||(c[r]=[]),E=o.__weh||(o.__weh=(...T)=>{if(c.isUnmounted)return;Ll(),tc(c);const w=is(o,c,r,T);return za(),Ml(),w});return l?f.unshift(E):f.push(E),E}}const Zo=r=>(o,c=Ri)=>(!wl||r==="sp")&&nm(r,(...l)=>o(...l),c),gk=Zo("bm"),Uh=Zo("m"),Sk=Zo("bu"),im=Zo("u"),rm=Zo("bum"),sm=Zo("um"),Tk=Zo("sp"),yk=Zo("rtg"),Rk=Zo("rtc");function vk(r,o=Ri){nm("ec",r,o)}function RY(r,o,c,l){let f;const E=c&&c[l];if(Xt(r)||ni(r)){f=new Array(r.length);for(let T=0,w=r.length;T<w;T++)f[T]=o(r[T],T,void 0,E&&E[T])}else if(typeof r=="number"){f=new Array(r);for(let T=0;T<r;T++)f[T]=o(T+1,T,void 0,E&&E[T])}else if(bn(r))if(r[Symbol.iterator])f=Array.from(r,(T,w)=>o(T,w,void 0,E&&E[w]));else{const T=Object.keys(r);f=new Array(T.length);for(let w=0,N=T.length;w<N;w++){const D=T[w];f[w]=o(r[D],D,w,E&&E[w])}}else f=[];return c&&(c[l]=f),f}function vY(r,o){for(let c=0;c<o.length;c++){const l=o[c];if(Xt(l))for(let f=0;f<l.length;f++)r[l[f].name]=l[f].fn;else l&&(r[l.name]=l.key?(...f)=>{const E=l.fn(...f);return E&&(E.key=l.key),E}:l.fn)}return r}function CY(r,o,c={},l,f){if(xi.isCE||xi.parent&&Qc(xi.parent)&&xi.parent.isCE)return o!=="default"&&(c.name=o),Hn("slot",c,l&&l());let E=r[o];E&&E._c&&(E._d=!1),om();const T=E&&Ck(E(c)),w=cR(Gi,{key:c.key||T&&T.key||`_${o}`},T||(l?l():[]),T&&r._===1?64:-2);return!f&&w.scopeId&&(w.slotScopeIds=[w.scopeId+"-s"]),E&&E._c&&(E._d=!0),w}function Ck(r){return r.some(o=>Za(o)?!(o.type===nr||o.type===Gi&&!Ck(o.children)):!0)?r:null}function IY(r,o){const c={};for(const l in r)c[o&&/[A-Z]/.test(l)?`on:${l}`:oh(l)]=r[l];return c}const ty=r=>r?Hk(r)?cm(r)||r.proxy:ty(r.parent):null,ah=ei(Object.create(null),{$:r=>r,$el:r=>r.vnode.el,$data:r=>r.data,$props:r=>r.props,$attrs:r=>r.attrs,$slots:r=>r.slots,$refs:r=>r.refs,$parent:r=>ty(r.parent),$root:r=>ty(r.root),$emit:r=>r.emit,$options:r=>sR(r),$forceUpdate:r=>r.f||(r.f=()=>$_(r.update)),$nextTick:r=>r.n||(r.n=Q_.bind(r.proxy)),$watch:r=>_Y.bind(r)}),OT=(r,o)=>r!==In&&!r.__isScriptSetup&&en(r,o),ey={get({_:r},o){const{ctx:c,setupState:l,data:f,props:E,accessCache:T,type:w,appContext:N}=r;let D;if(o[0]!=="$"){const nt=T[o];if(nt!==void 0)switch(nt){case 1:return l[o];case 2:return f[o];case 4:return c[o];case 3:return E[o]}else{if(OT(l,o))return T[o]=1,l[o];if(f!==In&&en(f,o))return T[o]=2,f[o];if((D=r.propsOptions[0])&&en(D,o))return T[o]=3,E[o];if(c!==In&&en(c,o))return T[o]=4,c[o];ny&&(T[o]=0)}}const k=ah[o];let M,j;if(k)return o==="$attrs"&&Ur(r,"get",o),k(r);if((M=w.__cssModules)&&(M=M[o]))return M;if(c!==In&&en(c,o))return T[o]=4,c[o];if(j=N.config.globalProperties,en(j,o))return j[o]},set({_:r},o,c){const{data:l,setupState:f,ctx:E}=r;return OT(f,o)?(f[o]=c,!0):l!==In&&en(l,o)?(l[o]=c,!0):en(r.props,o)||o[0]==="$"&&o.slice(1)in r?!1:(E[o]=c,!0)},has({_:{data:r,setupState:o,accessCache:c,ctx:l,appContext:f,propsOptions:E}},T){let w;return!!c[T]||r!==In&&en(r,T)||OT(o,T)||(w=E[0])&&en(w,T)||en(l,T)||en(ah,T)||en(f.config.globalProperties,T)},defineProperty(r,o,c){return c.get!=null?r._.accessCache[o]=0:en(c,"value")&&this.set(r,o,c.value,null),Reflect.defineProperty(r,o,c)}},bY=ei({},ey,{get(r,o){if(o!==Symbol.unscopables)return ey.get(r,o,r)},has(r,o){return o[0]!=="_"&&!J5(o)}});function wY(){return null}function AY(){return null}function OY(r){}function NY(r){}function DY(){return null}function PY(){}function kY(r,o){return null}function LY(){return Ik().slots}function MY(){return Ik().attrs}function UY(r,o,c){const l=ta();if(c&&c.local){const f=Xc(r[o]);return _o(()=>r[o],E=>f.value=E),_o(f,E=>{E!==r[o]&&l.emit(`update:${o}`,E)}),f}else return{__v_isRef:!0,get value(){return r[o]},set value(f){l.emit(`update:${o}`,f)}}}function Ik(){const r=ta();return r.setupContext||(r.setupContext=qk(r))}function Rh(r){return Xt(r)?r.reduce((o,c)=>(o[c]=null,o),{}):r}function xY(r,o){const c=Rh(r);for(const l in o){if(l.startsWith("__skip"))continue;let f=c[l];f?Xt(f)||ve(f)?f=c[l]={type:f,default:o[l]}:f.default=o[l]:f===null&&(f=c[l]={default:o[l]}),f&&o[`__skip_${l}`]&&(f.skipFactory=!0)}return c}function VY(r,o){return!r||!o?r||o:Xt(r)&&Xt(o)?r.concat(o):ei({},Rh(r),Rh(o))}function FY(r,o){const c={};for(const l in r)o.includes(l)||Object.defineProperty(c,l,{enumerable:!0,get:()=>r[l]});return c}function BY(r){const o=ta();let c=r();return za(),Fy(c)&&(c=c.catch(l=>{throw tc(o),l})),[c,()=>tc(o)]}let ny=!0;function jY(r){const o=sR(r),c=r.proxy,l=r.ctx;ny=!1,o.beforeCreate&&gD(o.beforeCreate,r,"bc");const{data:f,computed:E,methods:T,watch:w,provide:N,inject:D,created:k,beforeMount:M,mounted:j,beforeUpdate:nt,updated:rt,activated:at,deactivated:Ot,beforeDestroy:wt,beforeUnmount:dt,destroyed:it,unmounted:Q,render:St,renderTracked:Ft,renderTriggered:jt,errorCaptured:At,serverPrefetch:Wt,expose:xt,inheritAttrs:ae,components:Mt,directives:fe,filters:_n}=o;if(D&&WY(D,l,null),T)for(const be in T){const ee=T[be];ve(ee)&&(l[be]=ee.bind(c))}if(f){const be=f.call(c,c);bn(be)&&(r.data=Ul(be))}if(ny=!0,E)for(const be in E){const ee=E[be],fr=ve(ee)?ee.bind(c,c):ve(ee.get)?ee.get.bind(c,c):Fs,ws=!ve(ee)&&ve(ee.set)?ee.set.bind(c):Fs,Vr=ns({get:fr,set:ws});Object.defineProperty(l,be,{enumerable:!0,configurable:!0,get:()=>Vr.value,set:Vi=>Vr.value=Vi})}if(w)for(const be in w)bk(w[be],l,c,be);if(N){const be=ve(N)?N.call(c):N;Reflect.ownKeys(be).forEach(ee=>{ch(ee,be[ee])})}k&&gD(k,r,"c");function Zt(be,ee){Xt(ee)?ee.forEach(fr=>be(fr.bind(c))):ee&&be(ee.bind(c))}if(Zt(gk,M),Zt(Uh,j),Zt(Sk,nt),Zt(im,rt),Zt(_k,at),Zt(mk,Ot),Zt(vk,At),Zt(Rk,Ft),Zt(yk,jt),Zt(rm,dt),Zt(sm,Q),Zt(Tk,Wt),Xt(xt))if(xt.length){const be=r.exposed||(r.exposed={});xt.forEach(ee=>{Object.defineProperty(be,ee,{get:()=>c[ee],set:fr=>c[ee]=fr})})}else r.exposed||(r.exposed={});St&&r.render===Fs&&(r.render=St),ae!=null&&(r.inheritAttrs=ae),Mt&&(r.components=Mt),fe&&(r.directives=fe)}function WY(r,o,c=Fs){Xt(r)&&(r=iy(r));for(const l in r){const f=r[l];let E;bn(f)?"default"in f?E=rs(f.from||l,f.default,!0):E=rs(f.from||l):E=rs(f),Oi(E)?Object.defineProperty(o,l,{enumerable:!0,configurable:!0,get:()=>E.value,set:T=>E.value=T}):o[l]=E}}function gD(r,o,c){is(Xt(r)?r.map(l=>l.bind(o.proxy)):r.bind(o.proxy),o,c)}function bk(r,o,c,l){const f=l.includes(".")?hk(c,l):()=>c[l];if(ni(r)){const E=o[r];ve(E)&&_o(f,E)}else if(ve(r))_o(f,r.bind(c));else if(bn(r))if(Xt(r))r.forEach(E=>bk(E,o,c,l));else{const E=ve(r.handler)?r.handler.bind(c):o[r.handler];ve(E)&&_o(f,E,r)}}function sR(r){const o=r.type,{mixins:c,extends:l}=o,{mixins:f,optionsCache:E,config:{optionMergeStrategies:T}}=r.appContext,w=E.get(o);let N;return w?N=w:!f.length&&!c&&!l?N=o:(N={},f.length&&f.forEach(D=>N_(N,D,T,!0)),N_(N,o,T)),bn(o)&&E.set(o,N),N}function N_(r,o,c,l=!1){const{mixins:f,extends:E}=o;E&&N_(r,E,c,!0),f&&f.forEach(T=>N_(r,T,c,!0));for(const T in o)if(!(l&&T==="expose")){const w=GY[T]||c&&c[T];r[T]=w?w(r[T],o[T]):o[T]}return r}const GY={data:SD,props:TD,emits:TD,methods:nh,computed:nh,beforeCreate:pr,created:pr,beforeMount:pr,mounted:pr,beforeUpdate:pr,updated:pr,beforeDestroy:pr,beforeUnmount:pr,destroyed:pr,unmounted:pr,activated:pr,deactivated:pr,errorCaptured:pr,serverPrefetch:pr,components:nh,directives:nh,watch:YY,provide:SD,inject:HY};function SD(r,o){return o?r?function(){return ei(ve(r)?r.call(this,this):r,ve(o)?o.call(this,this):o)}:o:r}function HY(r,o){return nh(iy(r),iy(o))}function iy(r){if(Xt(r)){const o={};for(let c=0;c<r.length;c++)o[r[c]]=r[c];return o}return r}function pr(r,o){return r?[...new Set([].concat(r,o))]:o}function nh(r,o){return r?ei(Object.create(null),r,o):o}function TD(r,o){return r?Xt(r)&&Xt(o)?[...new Set([...r,...o])]:ei(Object.create(null),Rh(r),Rh(o??{})):o}function YY(r,o){if(!r)return o;if(!o)return r;const c=ei(Object.create(null),r);for(const l in o)c[l]=pr(r[l],o[l]);return c}function wk(){return{app:null,config:{isNativeTag:W5,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let KY=0;function qY(r,o){return function(l,f=null){ve(l)||(l=ei({},l)),f!=null&&!bn(f)&&(f=null);const E=wk(),T=new WeakSet;let w=!1;const N=E.app={_uid:KY++,_component:l,_props:f,_container:null,_context:E,_instance:null,version:Qk,get config(){return E.config},set config(D){},use(D,...k){return T.has(D)||(D&&ve(D.install)?(T.add(D),D.install(N,...k)):ve(D)&&(T.add(D),D(N,...k))),N},mixin(D){return E.mixins.includes(D)||E.mixins.push(D),N},component(D,k){return k?(E.components[D]=k,N):E.components[D]},directive(D,k){return k?(E.directives[D]=k,N):E.directives[D]},mount(D,k,M){if(!w){const j=Hn(l,f);return j.appContext=E,k&&o?o(j,D):r(j,D,M),w=!0,N._container=D,D.__vue_app__=N,cm(j.component)||j.component.proxy}},unmount(){w&&(r(null,N._container),delete N._container.__vue_app__)},provide(D,k){return E.provides[D]=k,N},runWithContext(D){vh=N;try{return D()}finally{vh=null}}};return N}}let vh=null;function ch(r,o){if(Ri){let c=Ri.provides;const l=Ri.parent&&Ri.parent.provides;l===c&&(c=Ri.provides=Object.create(l)),c[r]=o}}function rs(r,o,c=!1){const l=Ri||xi;if(l||vh){const f=l?l.parent==null?l.vnode.appContext&&l.vnode.appContext.provides:l.parent.provides:vh._context.provides;if(f&&r in f)return f[r];if(arguments.length>1)return c&&ve(o)?o.call(l&&l.proxy):o}}function zY(){return!!(Ri||xi||vh)}function JY(r,o,c,l=!1){const f={},E={};C_(E,am,1),r.propsDefaults=Object.create(null),Ak(r,o,f,E);for(const T in r.propsOptions[0])T in f||(f[T]=void 0);c?r.props=l?f:Hy(f):r.type.props?r.props=f:r.props=E,r.attrs=E}function XY(r,o,c,l){const{props:f,attrs:E,vnode:{patchFlag:T}}=r,w=ze(f),[N]=r.propsOptions;let D=!1;if((l||T>0)&&!(T&16)){if(T&8){const k=r.vnode.dynamicProps;for(let M=0;M<k.length;M++){let j=k[M];if(Z_(r.emitsOptions,j))continue;const nt=o[j];if(N)if(en(E,j))nt!==E[j]&&(E[j]=nt,D=!0);else{const rt=Mr(j);f[rt]=ry(N,w,rt,nt,r,!1)}else nt!==E[j]&&(E[j]=nt,D=!0)}}}else{Ak(r,o,f,E)&&(D=!0);let k;for(const M in w)(!o||!en(o,M)&&((k=Rs(M))===M||!en(o,k)))&&(N?c&&(c[M]!==void 0||c[k]!==void 0)&&(f[M]=ry(N,w,M,void 0,r,!0)):delete f[M]);if(E!==w)for(const M in E)(!o||!en(o,M))&&(delete E[M],D=!0)}D&&zo(r,"set","$attrs")}function Ak(r,o,c,l){const[f,E]=r.propsOptions;let T=!1,w;if(o)for(let N in o){if(sh(N))continue;const D=o[N];let k;f&&en(f,k=Mr(N))?!E||!E.includes(k)?c[k]=D:(w||(w={}))[k]=D:Z_(r.emitsOptions,N)||(!(N in l)||D!==l[N])&&(l[N]=D,T=!0)}if(E){const N=ze(c),D=w||In;for(let k=0;k<E.length;k++){const M=E[k];c[M]=ry(f,N,M,D[M],r,!en(D,M))}}return T}function ry(r,o,c,l,f,E){const T=r[c];if(T!=null){const w=en(T,"default");if(w&&l===void 0){const N=T.default;if(T.type!==Function&&!T.skipFactory&&ve(N)){const{propsDefaults:D}=f;c in D?l=D[c]:(tc(f),l=D[c]=N.call(null,o),za())}else l=N}T[0]&&(E&&!w?l=!1:T[1]&&(l===""||l===Rs(c))&&(l=!0))}return l}function Ok(r,o,c=!1){const l=o.propsCache,f=l.get(r);if(f)return f;const E=r.props,T={},w=[];let N=!1;if(!ve(r)){const k=M=>{N=!0;const[j,nt]=Ok(M,o,!0);ei(T,j),nt&&w.push(...nt)};!c&&o.mixins.length&&o.mixins.forEach(k),r.extends&&k(r.extends),r.mixins&&r.mixins.forEach(k)}if(!E&&!N)return bn(r)&&l.set(r,ml),ml;if(Xt(E))for(let k=0;k<E.length;k++){const M=Mr(E[k]);yD(M)&&(T[M]=In)}else if(E)for(const k in E){const M=Mr(k);if(yD(M)){const j=E[k],nt=T[M]=Xt(j)||ve(j)?{type:j}:ei({},j);if(nt){const rt=CD(Boolean,nt.type),at=CD(String,nt.type);nt[0]=rt>-1,nt[1]=at<0||rt<at,(rt>-1||en(nt,"default"))&&w.push(M)}}}const D=[T,w];return bn(r)&&l.set(r,D),D}function yD(r){return r[0]!=="$"}function RD(r){const o=r&&r.toString().match(/^\s*(function|class) (\w+)/);return o?o[2]:r===null?"null":""}function vD(r,o){return RD(r)===RD(o)}function CD(r,o){return Xt(o)?o.findIndex(c=>vD(c,r)):ve(o)&&vD(o,r)?0:-1}const Nk=r=>r[0]==="_"||r==="$stable",oR=r=>Xt(r)?r.map(ts):[ts(r)],QY=(r,o,c)=>{if(o._n)return o;const l=$y((...f)=>oR(o(...f)),c);return l._c=!1,l},Dk=(r,o,c)=>{const l=r._ctx;for(const f in r){if(Nk(f))continue;const E=r[f];if(ve(E))o[f]=QY(f,E,l);else if(E!=null){const T=oR(E);o[f]=()=>T}}},Pk=(r,o)=>{const c=oR(o);r.slots.default=()=>c},$Y=(r,o)=>{if(r.vnode.shapeFlag&32){const c=o._;c?(r.slots=ze(o),C_(o,"_",c)):Dk(o,r.slots={})}else r.slots={},o&&Pk(r,o);C_(r.slots,am,1)},ZY=(r,o,c)=>{const{vnode:l,slots:f}=r;let E=!0,T=In;if(l.shapeFlag&32){const w=o._;w?c&&w===1?E=!1:(ei(f,o),!c&&w===1&&delete f._):(E=!o.$stable,Dk(o,f)),T=o}else o&&(Pk(r,o),T={default:1});if(E)for(const w in f)!Nk(w)&&T[w]==null&&delete f[w]};function D_(r,o,c,l,f=!1){if(Xt(r)){r.forEach((j,nt)=>D_(j,o&&(Xt(o)?o[nt]:o),c,l,f));return}if(Qc(l)&&!f)return;const E=l.shapeFlag&4?cm(l.component)||l.component.proxy:l.el,T=f?null:E,{i:w,r:N}=r,D=o&&o.r,k=w.refs===In?w.refs={}:w.refs,M=w.setupState;if(D!=null&&D!==N&&(ni(D)?(k[D]=null,en(M,D)&&(M[D]=null)):Oi(D)&&(D.value=null)),ve(N))Jo(N,w,12,[T,k]);else{const j=ni(N),nt=Oi(N);if(j||nt){const rt=()=>{if(r.f){const at=j?en(M,N)?M[N]:k[N]:N.value;f?Xt(at)&&Vy(at,E):Xt(at)?at.includes(E)||at.push(E):j?(k[N]=[E],en(M,N)&&(M[N]=k[N])):(N.value=[E],r.k&&(k[r.k]=N.value))}else j?(k[N]=T,en(M,N)&&(M[N]=T)):nt&&(N.value=T,r.k&&(k[r.k]=T))};T?(rt.id=-1,Wi(rt,c)):rt()}}}let Ua=!1;const r_=r=>/svg/.test(r.namespaceURI)&&r.tagName!=="foreignObject",s_=r=>r.nodeType===8;function tK(r){const{mt:o,p:c,o:{patchProp:l,createText:f,nextSibling:E,parentNode:T,remove:w,insert:N,createComment:D}}=r,k=(it,Q)=>{if(!Q.hasChildNodes()){c(null,it,Q),O_(),Q._vnode=it;return}Ua=!1,M(Q.firstChild,it,null,null,null),O_(),Q._vnode=it,Ua&&console.error("Hydration completed but contains mismatches.")},M=(it,Q,St,Ft,jt,At=!1)=>{const Wt=s_(it)&&it.data==="[",xt=()=>at(it,Q,St,Ft,jt,Wt),{type:ae,ref:Mt,shapeFlag:fe,patchFlag:_n}=Q;let ln=it.nodeType;Q.el=it,_n===-2&&(At=!1,Q.dynamicChildren=null);let Zt=null;switch(ae){case nd:ln!==3?Q.children===""?(N(Q.el=f(""),T(it),it),Zt=it):Zt=xt():(it.data!==Q.children&&(Ua=!0,it.data=Q.children),Zt=E(it));break;case nr:dt(it)?(Zt=E(it),wt(Q.el=it.content.firstChild,it,St)):ln!==8||Wt?Zt=xt():Zt=E(it);break;case $c:if(Wt&&(it=E(it),ln=it.nodeType),ln===1||ln===3){Zt=it;const be=!Q.children.length;for(let ee=0;ee<Q.staticCount;ee++)be&&(Q.children+=Zt.nodeType===1?Zt.outerHTML:Zt.data),ee===Q.staticCount-1&&(Q.anchor=Zt),Zt=E(Zt);return Wt?E(Zt):Zt}else xt();break;case Gi:Wt?Zt=rt(it,Q,St,Ft,jt,At):Zt=xt();break;default:if(fe&1)(ln!==1||Q.type.toLowerCase()!==it.tagName.toLowerCase())&&!dt(it)?Zt=xt():Zt=j(it,Q,St,Ft,jt,At);else if(fe&6){Q.slotScopeIds=jt;const be=T(it);if(Wt?Zt=Ot(it):s_(it)&&it.data==="teleport start"?Zt=Ot(it,it.data,"teleport end"):Zt=E(it),o(Q,be,null,St,Ft,r_(be),At),Qc(Q)){let ee;Wt?(ee=Hn(Gi),ee.anchor=Zt?Zt.previousSibling:be.lastChild):ee=it.nodeType===3?lR(""):Hn("div"),ee.el=it,Q.component.subTree=ee}}else fe&64?ln!==8?Zt=xt():Zt=Q.type.hydrate(it,Q,St,Ft,jt,At,r,nt):fe&128&&(Zt=Q.type.hydrate(it,Q,St,Ft,r_(T(it)),jt,At,r,M))}return Mt!=null&&D_(Mt,null,Ft,Q),Zt},j=(it,Q,St,Ft,jt,At)=>{At=At||!!Q.dynamicChildren;const{type:Wt,props:xt,patchFlag:ae,shapeFlag:Mt,dirs:fe,transition:_n}=Q,ln=Wt==="input"||Wt==="option";if(ln||ae!==-1){if(fe&&uo(Q,null,St,"created"),xt)if(ln||!At||ae&48)for(const ee in xt)(ln&&(ee.endsWith("value")||ee==="indeterminate")||Oh(ee)&&!sh(ee)||ee[0]===".")&&l(it,ee,null,xt[ee],!1,void 0,St);else xt.onClick&&l(it,"onClick",null,xt.onClick,!1,void 0,St);let Zt;(Zt=xt&&xt.onVnodeBeforeMount)&&kr(Zt,St,Q);let be=!1;if(dt(it)){be=Uk(Ft,_n)&&St&&St.vnode.props&&St.vnode.props.appear;const ee=it.content.firstChild;be&&_n.beforeEnter(ee),wt(ee,it,St),Q.el=it=ee}if(fe&&uo(Q,null,St,"beforeMount"),((Zt=xt&&xt.onVnodeMounted)||fe||be)&&lk(()=>{Zt&&kr(Zt,St,Q),be&&_n.enter(it),fe&&uo(Q,null,St,"mounted")},Ft),Mt&16&&!(xt&&(xt.innerHTML||xt.textContent))){let ee=nt(it.firstChild,Q,it,St,Ft,jt,At);for(;ee;){Ua=!0;const fr=ee;ee=ee.nextSibling,w(fr)}}else Mt&8&&it.textContent!==Q.children&&(Ua=!0,it.textContent=Q.children)}return it.nextSibling},nt=(it,Q,St,Ft,jt,At,Wt)=>{Wt=Wt||!!Q.dynamicChildren;const xt=Q.children,ae=xt.length;for(let Mt=0;Mt<ae;Mt++){const fe=Wt?xt[Mt]:xt[Mt]=ts(xt[Mt]);if(it)it=M(it,fe,Ft,jt,At,Wt);else{if(fe.type===nd&&!fe.children)continue;Ua=!0,c(null,fe,St,null,Ft,jt,r_(St),At)}}return it},rt=(it,Q,St,Ft,jt,At)=>{const{slotScopeIds:Wt}=Q;Wt&&(jt=jt?jt.concat(Wt):Wt);const xt=T(it),ae=nt(E(it),Q,xt,St,Ft,jt,At);return ae&&s_(ae)&&ae.data==="]"?E(Q.anchor=ae):(Ua=!0,N(Q.anchor=D("]"),xt,ae),ae)},at=(it,Q,St,Ft,jt,At)=>{if(Ua=!0,Q.el=null,At){const ae=Ot(it);for(;;){const Mt=E(it);if(Mt&&Mt!==ae)w(Mt);else break}}const Wt=E(it),xt=T(it);return w(it),c(null,Q,xt,Wt,St,Ft,r_(xt),jt),Wt},Ot=(it,Q="[",St="]")=>{let Ft=0;for(;it;)if(it=E(it),it&&s_(it)&&(it.data===Q&&Ft++,it.data===St)){if(Ft===0)return E(it);Ft--}return it},wt=(it,Q,St)=>{const Ft=Q.parentNode;Ft&&Ft.replaceChild(it,Q);let jt=St;for(;jt;)jt.vnode.el===Q&&(jt.vnode.el=jt.subTree.el=it),jt=jt.parent},dt=it=>it.nodeType===1&&it.tagName.toLowerCase()==="template";return[k,M]}const Wi=lk;function kk(r){return Mk(r)}function Lk(r){return Mk(r,tK)}function Mk(r,o){const c=JT();c.__VUE__=!0;const{insert:l,remove:f,patchProp:E,createElement:T,createText:w,createComment:N,setText:D,setElementText:k,parentNode:M,nextSibling:j,setScopeId:nt=Fs,insertStaticContent:rt}=r,at=(H,K,et,pt=null,Tt=null,Rt=null,Gt=!1,Pt=null,Ut=!!K.dynamicChildren)=>{if(H===K)return;H&&!xs(H,K)&&(pt=_t(H),Vi(H,Tt,Rt,!0),H=null),K.patchFlag===-2&&(Ut=!1,K.dynamicChildren=null);const{type:Ct,ref:se,shapeFlag:Qt}=K;switch(Ct){case nd:Ot(H,K,et,pt);break;case nr:wt(H,K,et,pt);break;case $c:H==null&&dt(K,et,pt,Gt);break;case Gi:Mt(H,K,et,pt,Tt,Rt,Gt,Pt,Ut);break;default:Qt&1?St(H,K,et,pt,Tt,Rt,Gt,Pt,Ut):Qt&6?fe(H,K,et,pt,Tt,Rt,Gt,Pt,Ut):(Qt&64||Qt&128)&&Ct.process(H,K,et,pt,Tt,Rt,Gt,Pt,Ut,Vt)}se!=null&&Tt&&D_(se,H&&H.ref,Rt,K||H,!K)},Ot=(H,K,et,pt)=>{if(H==null)l(K.el=w(K.children),et,pt);else{const Tt=K.el=H.el;K.children!==H.children&&D(Tt,K.children)}},wt=(H,K,et,pt)=>{H==null?l(K.el=N(K.children||""),et,pt):K.el=H.el},dt=(H,K,et,pt)=>{[H.el,H.anchor]=rt(H.children,K,et,pt,H.el,H.anchor)},it=({el:H,anchor:K},et,pt)=>{let Tt;for(;H&&H!==K;)Tt=j(H),l(H,et,pt),H=Tt;l(K,et,pt)},Q=({el:H,anchor:K})=>{let et;for(;H&&H!==K;)et=j(H),f(H),H=et;f(K)},St=(H,K,et,pt,Tt,Rt,Gt,Pt,Ut)=>{Gt=Gt||K.type==="svg",H==null?Ft(K,et,pt,Tt,Rt,Gt,Pt,Ut):Wt(H,K,Tt,Rt,Gt,Pt,Ut)},Ft=(H,K,et,pt,Tt,Rt,Gt,Pt)=>{let Ut,Ct;const{type:se,props:Qt,shapeFlag:ce,transition:ge,dirs:De}=H;if(Ut=H.el=T(H.type,Rt,Qt&&Qt.is,Qt),ce&8?k(Ut,H.children):ce&16&&At(H.children,Ut,null,pt,Tt,Rt&&se!=="foreignObject",Gt,Pt),De&&uo(H,null,pt,"created"),jt(Ut,H,H.scopeId,Gt,pt),Qt){for(const _e in Qt)_e!=="value"&&!sh(_e)&&E(Ut,_e,null,Qt[_e],Rt,H.children,pt,Tt,Ii);"value"in Qt&&E(Ut,"value",null,Qt.value),(Ct=Qt.onVnodeBeforeMount)&&kr(Ct,pt,H)}De&&uo(H,null,pt,"beforeMount");const Sn=Uk(Tt,ge);Sn&&ge.beforeEnter(Ut),l(Ut,K,et),((Ct=Qt&&Qt.onVnodeMounted)||Sn||De)&&Wi(()=>{Ct&&kr(Ct,pt,H),Sn&&ge.enter(Ut),De&&uo(H,null,pt,"mounted")},Tt)},jt=(H,K,et,pt,Tt)=>{if(et&&nt(H,et),pt)for(let Rt=0;Rt<pt.length;Rt++)nt(H,pt[Rt]);if(Tt){let Rt=Tt.subTree;if(K===Rt){const Gt=Tt.vnode;jt(H,Gt,Gt.scopeId,Gt.slotScopeIds,Tt.parent)}}},At=(H,K,et,pt,Tt,Rt,Gt,Pt,Ut=0)=>{for(let Ct=Ut;Ct<H.length;Ct++){const se=H[Ct]=Pt?Wa(H[Ct]):ts(H[Ct]);at(null,se,K,et,pt,Tt,Rt,Gt,Pt)}},Wt=(H,K,et,pt,Tt,Rt,Gt)=>{const Pt=K.el=H.el;let{patchFlag:Ut,dynamicChildren:Ct,dirs:se}=K;Ut|=H.patchFlag&16;const Qt=H.props||In,ce=K.props||In;let ge;et&&jc(et,!1),(ge=ce.onVnodeBeforeUpdate)&&kr(ge,et,K,H),se&&uo(K,H,et,"beforeUpdate"),et&&jc(et,!0);const De=Tt&&K.type!=="foreignObject";if(Ct?xt(H.dynamicChildren,Ct,Pt,et,pt,De,Rt):Gt||ee(H,K,Pt,null,et,pt,De,Rt,!1),Ut>0){if(Ut&16)ae(Pt,K,Qt,ce,et,pt,Tt);else if(Ut&2&&Qt.class!==ce.class&&E(Pt,"class",null,ce.class,Tt),Ut&4&&E(Pt,"style",Qt.style,ce.style,Tt),Ut&8){const Sn=K.dynamicProps;for(let _e=0;_e<Sn.length;_e++){const xn=Sn[_e],_r=Qt[xn],Io=ce[xn];(Io!==_r||xn==="value")&&E(Pt,xn,_r,Io,Tt,H.children,et,pt,Ii)}}Ut&1&&H.children!==K.children&&k(Pt,K.children)}else!Gt&&Ct==null&&ae(Pt,K,Qt,ce,et,pt,Tt);((ge=ce.onVnodeUpdated)||se)&&Wi(()=>{ge&&kr(ge,et,K,H),se&&uo(K,H,et,"updated")},pt)},xt=(H,K,et,pt,Tt,Rt,Gt)=>{for(let Pt=0;Pt<K.length;Pt++){const Ut=H[Pt],Ct=K[Pt],se=Ut.el&&(Ut.type===Gi||!xs(Ut,Ct)||Ut.shapeFlag&70)?M(Ut.el):et;at(Ut,Ct,se,null,pt,Tt,Rt,Gt,!0)}},ae=(H,K,et,pt,Tt,Rt,Gt)=>{if(et!==pt){if(et!==In)for(const Pt in et)!sh(Pt)&&!(Pt in pt)&&E(H,Pt,et[Pt],null,Gt,K.children,Tt,Rt,Ii);for(const Pt in pt){if(sh(Pt))continue;const Ut=pt[Pt],Ct=et[Pt];Ut!==Ct&&Pt!=="value"&&E(H,Pt,Ct,Ut,Gt,K.children,Tt,Rt,Ii)}"value"in pt&&E(H,"value",et.value,pt.value)}},Mt=(H,K,et,pt,Tt,Rt,Gt,Pt,Ut)=>{const Ct=K.el=H?H.el:w(""),se=K.anchor=H?H.anchor:w("");let{patchFlag:Qt,dynamicChildren:ce,slotScopeIds:ge}=K;ge&&(Pt=Pt?Pt.concat(ge):ge),H==null?(l(Ct,et,pt),l(se,et,pt),At(K.children,et,se,Tt,Rt,Gt,Pt,Ut)):Qt>0&&Qt&64&&ce&&H.dynamicChildren?(xt(H.dynamicChildren,ce,et,Tt,Rt,Gt,Pt),(K.key!=null||Tt&&K===Tt.subTree)&&aR(H,K,!0)):ee(H,K,et,se,Tt,Rt,Gt,Pt,Ut)},fe=(H,K,et,pt,Tt,Rt,Gt,Pt,Ut)=>{K.slotScopeIds=Pt,H==null?K.shapeFlag&512?Tt.ctx.activate(K,et,pt,Gt,Ut):_n(K,et,pt,Tt,Rt,Gt,Ut):ln(H,K,Ut)},_n=(H,K,et,pt,Tt,Rt,Gt)=>{const Pt=H.component=Gk(H,pt,Tt);if(Mh(H)&&(Pt.ctx.renderer=Vt),Yk(Pt),Pt.asyncDep){if(Tt&&Tt.registerDep(Pt,Zt),!H.el){const Ut=Pt.subTree=Hn(nr);wt(null,Ut,K,et)}return}Zt(Pt,H,K,et,Tt,Rt,Gt)},ln=(H,K,et)=>{const pt=K.component=H.component;if(eY(H,K,et))if(pt.asyncDep&&!pt.asyncResolved){be(pt,K,et);return}else pt.next=K,K6(pt.update),pt.update();else K.el=H.el,pt.vnode=K},Zt=(H,K,et,pt,Tt,Rt,Gt)=>{const Pt=()=>{if(H.isMounted){let{next:se,bu:Qt,u:ce,parent:ge,vnode:De}=H,Sn=se,_e;jc(H,!1),se?(se.el=De.el,be(H,se,Gt)):se=De,Qt&&gl(Qt),(_e=se.props&&se.props.onVnodeBeforeUpdate)&&kr(_e,ge,se,De),jc(H,!0);const xn=f_(H),_r=H.subTree;H.subTree=xn,at(_r,xn,M(_r.el),_t(_r),H,Tt,Rt),se.el=xn.el,Sn===null&&Zy(H,xn.el),ce&&Wi(ce,Tt),(_e=se.props&&se.props.onVnodeUpdated)&&Wi(()=>kr(_e,ge,se,De),Tt)}else{let se;const{el:Qt,props:ce}=K,{bm:ge,m:De,parent:Sn}=H,_e=Qc(K);if(jc(H,!1),ge&&gl(ge),!_e&&(se=ce&&ce.onVnodeBeforeMount)&&kr(se,Sn,K),jc(H,!0),Qt&&$e){const xn=()=>{H.subTree=f_(H),$e(Qt,H.subTree,H,Tt,null)};_e?K.type.__asyncLoader().then(()=>!H.isUnmounted&&xn()):xn()}else{const xn=H.subTree=f_(H);at(null,xn,et,pt,H,Tt,Rt),K.el=xn.el}if(De&&Wi(De,Tt),!_e&&(se=ce&&ce.onVnodeMounted)){const xn=K;Wi(()=>kr(se,Sn,xn),Tt)}(K.shapeFlag&256||Sn&&Qc(Sn.vnode)&&Sn.vnode.shapeFlag&256)&&H.a&&Wi(H.a,Tt),H.isMounted=!0,K=et=pt=null}},Ut=H.effect=new Il(Pt,()=>$_(Ct),H.scope),Ct=H.update=()=>Ut.run();Ct.id=H.uid,jc(H,!0),Ct()},be=(H,K,et)=>{K.component=H;const pt=H.vnode.props;H.vnode=K,H.next=null,XY(H,K.props,pt,et),ZY(H,K.children,et),Ll(),pD(),Ml()},ee=(H,K,et,pt,Tt,Rt,Gt,Pt,Ut=!1)=>{const Ct=H&&H.children,se=H?H.shapeFlag:0,Qt=K.children,{patchFlag:ce,shapeFlag:ge}=K;if(ce>0){if(ce&128){ws(Ct,Qt,et,pt,Tt,Rt,Gt,Pt,Ut);return}else if(ce&256){fr(Ct,Qt,et,pt,Tt,Rt,Gt,Pt,Ut);return}}ge&8?(se&16&&Ii(Ct,Tt,Rt),Qt!==Ct&&k(et,Qt)):se&16?ge&16?ws(Ct,Qt,et,pt,Tt,Rt,Gt,Pt,Ut):Ii(Ct,Tt,Rt,!0):(se&8&&k(et,""),ge&16&&At(Qt,et,pt,Tt,Rt,Gt,Pt,Ut))},fr=(H,K,et,pt,Tt,Rt,Gt,Pt,Ut)=>{H=H||ml,K=K||ml;const Ct=H.length,se=K.length,Qt=Math.min(Ct,se);let ce;for(ce=0;ce<Qt;ce++){const ge=K[ce]=Ut?Wa(K[ce]):ts(K[ce]);at(H[ce],ge,et,null,Tt,Rt,Gt,Pt,Ut)}Ct>se?Ii(H,Tt,Rt,!0,!1,Qt):At(K,et,pt,Tt,Rt,Gt,Pt,Ut,Qt)},ws=(H,K,et,pt,Tt,Rt,Gt,Pt,Ut)=>{let Ct=0;const se=K.length;let Qt=H.length-1,ce=se-1;for(;Ct<=Qt&&Ct<=ce;){const ge=H[Ct],De=K[Ct]=Ut?Wa(K[Ct]):ts(K[Ct]);if(xs(ge,De))at(ge,De,et,null,Tt,Rt,Gt,Pt,Ut);else break;Ct++}for(;Ct<=Qt&&Ct<=ce;){const ge=H[Qt],De=K[ce]=Ut?Wa(K[ce]):ts(K[ce]);if(xs(ge,De))at(ge,De,et,null,Tt,Rt,Gt,Pt,Ut);else break;Qt--,ce--}if(Ct>Qt){if(Ct<=ce){const ge=ce+1,De=ge<se?K[ge].el:pt;for(;Ct<=ce;)at(null,K[Ct]=Ut?Wa(K[Ct]):ts(K[Ct]),et,De,Tt,Rt,Gt,Pt,Ut),Ct++}}else if(Ct>ce)for(;Ct<=Qt;)Vi(H[Ct],Tt,Rt,!0),Ct++;else{const ge=Ct,De=Ct,Sn=new Map;for(Ct=De;Ct<=ce;Ct++){const Vn=K[Ct]=Ut?Wa(K[Ct]):ts(K[Ct]);Vn.key!=null&&Sn.set(Vn.key,Ct)}let _e,xn=0;const _r=ce-De+1;let Io=!1,cd=0;const ic=new Array(_r);for(Ct=0;Ct<_r;Ct++)ic[Ct]=0;for(Ct=ge;Ct<=Qt;Ct++){const Vn=H[Ct];if(xn>=_r){Vi(Vn,Tt,Rt,!0);continue}let or;if(Vn.key!=null)or=Sn.get(Vn.key);else for(_e=De;_e<=ce;_e++)if(ic[_e-De]===0&&xs(Vn,K[_e])){or=_e;break}or===void 0?Vi(Vn,Tt,Rt,!0):(ic[or-De]=Ct+1,or>=cd?cd=or:Io=!0,at(Vn,K[or],et,null,Tt,Rt,Gt,Pt,Ut),xn++)}const Pn=Io?eK(ic):ml;for(_e=Pn.length-1,Ct=_r-1;Ct>=0;Ct--){const Vn=De+Ct,or=K[Vn],oi=Vn+1<se?K[Vn+1].el:pt;ic[Ct]===0?at(null,or,et,oi,Tt,Rt,Gt,Pt,Ut):Io&&(_e<0||Ct!==Pn[_e]?Vr(or,et,oi,2):_e--)}}},Vr=(H,K,et,pt,Tt=null)=>{const{el:Rt,type:Gt,transition:Pt,children:Ut,shapeFlag:Ct}=H;if(Ct&6){Vr(H.component.subTree,K,et,pt);return}if(Ct&128){H.suspense.move(K,et,pt);return}if(Ct&64){Gt.move(H,K,et,Vt);return}if(Gt===Gi){l(Rt,K,et);for(let Qt=0;Qt<Ut.length;Qt++)Vr(Ut[Qt],K,et,pt);l(H.anchor,K,et);return}if(Gt===$c){it(H,K,et);return}if(pt!==2&&Ct&1&&Pt)if(pt===0)Pt.beforeEnter(Rt),l(Rt,K,et),Wi(()=>Pt.enter(Rt),Tt);else{const{leave:Qt,delayLeave:ce,afterLeave:ge}=Pt,De=()=>l(Rt,K,et),Sn=()=>{Qt(Rt,()=>{De(),ge&&ge()})};ce?ce(Rt,De,Sn):Sn()}else l(Rt,K,et)},Vi=(H,K,et,pt=!1,Tt=!1)=>{const{type:Rt,props:Gt,ref:Pt,children:Ut,dynamicChildren:Ct,shapeFlag:se,patchFlag:Qt,dirs:ce}=H;if(Pt!=null&&D_(Pt,null,et,H,!0),se&256){K.ctx.deactivate(H);return}const ge=se&1&&ce,De=!Qc(H);let Sn;if(De&&(Sn=Gt&&Gt.onVnodeBeforeUnmount)&&kr(Sn,K,H),se&6)nc(H.component,et,pt);else{if(se&128){H.suspense.unmount(et,pt);return}ge&&uo(H,null,K,"beforeUnmount"),se&64?H.type.remove(H,K,et,Tt,Vt,pt):Ct&&(Rt!==Gi||Qt>0&&Qt&64)?Ii(Ct,K,et,!1,!0):(Rt===Gi&&Qt&384||!Tt&&se&16)&&Ii(Ut,K,et),pt&&vo(H)}(De&&(Sn=Gt&&Gt.onVnodeUnmounted)||ge)&&Wi(()=>{Sn&&kr(Sn,K,H),ge&&uo(H,null,K,"unmounted")},et)},vo=H=>{const{type:K,el:et,anchor:pt,transition:Tt}=H;if(K===Gi){Co(et,pt);return}if(K===$c){Q(H);return}const Rt=()=>{f(et),Tt&&!Tt.persisted&&Tt.afterLeave&&Tt.afterLeave()};if(H.shapeFlag&1&&Tt&&!Tt.persisted){const{leave:Gt,delayLeave:Pt}=Tt,Ut=()=>Gt(et,Rt);Pt?Pt(H.el,Rt,Ut):Ut()}else Rt()},Co=(H,K)=>{let et;for(;H!==K;)et=j(H),f(H),H=et;f(K)},nc=(H,K,et)=>{const{bum:pt,scope:Tt,update:Rt,subTree:Gt,um:Pt}=H;pt&&gl(pt),Tt.stop(),Rt&&(Rt.active=!1,Vi(Gt,H,K,et)),Pt&&Wi(Pt,K),Wi(()=>{H.isUnmounted=!0},K),K&&K.pendingBranch&&!K.isUnmounted&&H.asyncDep&&!H.asyncResolved&&H.suspenseId===K.pendingId&&(K.deps--,K.deps===0&&K.resolve())},Ii=(H,K,et,pt=!1,Tt=!1,Rt=0)=>{for(let Gt=Rt;Gt<H.length;Gt++)Vi(H[Gt],K,et,pt,Tt)},_t=H=>H.shapeFlag&6?_t(H.component.subTree):H.shapeFlag&128?H.suspense.next():j(H.anchor||H.el),qt=(H,K,et)=>{H==null?K._vnode&&Vi(K._vnode,null,null,!0):at(K._vnode||null,H,K,null,null,null,et),pD(),O_(),K._vnode=H},Vt={p:at,um:Vi,m:Vr,r:vo,mt:_n,mc:At,pc:ee,pbc:xt,n:_t,o:r};let re,$e;return o&&([re,$e]=o(Vt)),{render:qt,hydrate:re,createApp:qY(qt,re)}}function jc({effect:r,update:o},c){r.allowRecurse=o.allowRecurse=c}function Uk(r,o){return(!r||r&&!r.pendingBranch)&&o&&!o.persisted}function aR(r,o,c=!1){const l=r.children,f=o.children;if(Xt(l)&&Xt(f))for(let E=0;E<l.length;E++){const T=l[E];let w=f[E];w.shapeFlag&1&&!w.dynamicChildren&&((w.patchFlag<=0||w.patchFlag===32)&&(w=f[E]=Wa(f[E]),w.el=T.el),c||aR(T,w)),w.type===nd&&(w.el=T.el)}}function eK(r){const o=r.slice(),c=[0];let l,f,E,T,w;const N=r.length;for(l=0;l<N;l++){const D=r[l];if(D!==0){if(f=c[c.length-1],r[f]<D){o[l]=f,c.push(l);continue}for(E=0,T=c.length-1;E<T;)w=E+T>>1,r[c[w]]<D?E=w+1:T=w;D<r[c[E]]&&(E>0&&(o[l]=c[E-1]),c[E]=l)}}for(E=c.length,T=c[E-1];E-- >0;)c[E]=T,T=o[T];return c}const nK=r=>r.__isTeleport,dh=r=>r&&(r.disabled||r.disabled===""),ID=r=>typeof SVGElement<"u"&&r instanceof SVGElement,sy=(r,o)=>{const c=r&&r.to;return ni(c)?o?o(c):null:c},iK={name:"Teleport",__isTeleport:!0,process(r,o,c,l,f,E,T,w,N,D){const{mc:k,pc:M,pbc:j,o:{insert:nt,querySelector:rt,createText:at,createComment:Ot}}=D,wt=dh(o.props);let{shapeFlag:dt,children:it,dynamicChildren:Q}=o;if(r==null){const St=o.el=at(""),Ft=o.anchor=at("");nt(St,c,l),nt(Ft,c,l);const jt=o.target=sy(o.props,rt),At=o.targetAnchor=at("");jt&&(nt(At,jt),T=T||ID(jt));const Wt=(xt,ae)=>{dt&16&&k(it,xt,ae,f,E,T,w,N)};wt?Wt(c,Ft):jt&&Wt(jt,At)}else{o.el=r.el;const St=o.anchor=r.anchor,Ft=o.target=r.target,jt=o.targetAnchor=r.targetAnchor,At=dh(r.props),Wt=At?c:Ft,xt=At?St:jt;if(T=T||ID(Ft),Q?(j(r.dynamicChildren,Q,Wt,f,E,T,w),aR(r,o,!0)):N||M(r,o,Wt,xt,f,E,T,w,!1),wt)At?o.props&&r.props&&o.props.to!==r.props.to&&(o.props.to=r.props.to):o_(o,c,St,D,1);else if((o.props&&o.props.to)!==(r.props&&r.props.to)){const ae=o.target=sy(o.props,rt);ae&&o_(o,ae,null,D,0)}else At&&o_(o,Ft,jt,D,1)}xk(o)},remove(r,o,c,l,{um:f,o:{remove:E}},T){const{shapeFlag:w,children:N,anchor:D,targetAnchor:k,target:M,props:j}=r;if(M&&E(k),T&&E(D),w&16){const nt=T||!dh(j);for(let rt=0;rt<N.length;rt++){const at=N[rt];f(at,o,c,nt,!!at.dynamicChildren)}}},move:o_,hydrate:rK};function o_(r,o,c,{o:{insert:l},m:f},E=2){E===0&&l(r.targetAnchor,o,c);const{el:T,anchor:w,shapeFlag:N,children:D,props:k}=r,M=E===2;if(M&&l(T,o,c),(!M||dh(k))&&N&16)for(let j=0;j<D.length;j++)f(D[j],o,c,2);M&&l(w,o,c)}function rK(r,o,c,l,f,E,{o:{nextSibling:T,parentNode:w,querySelector:N}},D){const k=o.target=sy(o.props,N);if(k){const M=k._lpa||k.firstChild;if(o.shapeFlag&16)if(dh(o.props))o.anchor=D(T(r),o,w(r),c,l,f,E),o.targetAnchor=M;else{o.anchor=T(r);let j=M;for(;j;)if(j=T(j),j&&j.nodeType===8&&j.data==="teleport anchor"){o.targetAnchor=j,k._lpa=o.targetAnchor&&T(o.targetAnchor);break}D(M,o,k,c,l,f,E)}xk(o)}return o.anchor&&T(o.anchor)}const sK=iK;function xk(r){const o=r.ctx;if(o&&o.ut){let c=r.children[0].el;for(;c&&c!==r.targetAnchor;)c.nodeType===1&&c.setAttribute("data-v-owner",o.uid),c=c.nextSibling;o.ut()}}const Gi=Symbol.for("v-fgt"),nd=Symbol.for("v-txt"),nr=Symbol.for("v-cmt"),$c=Symbol.for("v-stc"),lh=[];let Lr=null;function om(r=!1){lh.push(Lr=r?null:[])}function Vk(){lh.pop(),Lr=lh[lh.length-1]||null}let id=1;function oy(r){id+=r}function Fk(r){return r.dynamicChildren=id>0?Lr||ml:null,Vk(),id>0&&Lr&&Lr.push(r),r}function oK(r,o,c,l,f,E){return Fk(dR(r,o,c,l,f,E,!0))}function cR(r,o,c,l,f){return Fk(Hn(r,o,c,l,f,!0))}function Za(r){return r?r.__v_isVNode===!0:!1}function xs(r,o){return r.type===o.type&&r.key===o.key}function aK(r){}const am="__vInternal",Bk=({key:r})=>r??null,__=({ref:r,ref_key:o,ref_for:c})=>(typeof r=="number"&&(r=""+r),r!=null?ni(r)||Oi(r)||ve(r)?{i:xi,r,k:o,f:!!c}:r:null);function dR(r,o=null,c=null,l=0,f=null,E=r===Gi?0:1,T=!1,w=!1){const N={__v_isVNode:!0,__v_skip:!0,type:r,props:o,key:o&&Bk(o),ref:o&&__(o),scopeId:tm,slotScopeIds:null,children:c,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:E,patchFlag:l,dynamicProps:f,dynamicChildren:null,appContext:null,ctx:xi};return w?(uR(N,c),E&128&&r.normalize(N)):c&&(N.shapeFlag|=ni(c)?8:16),id>0&&!T&&Lr&&(N.patchFlag>0||E&6)&&N.patchFlag!==32&&Lr.push(N),N}const Hn=cK;function cK(r,o=null,c=null,l=0,f=null,E=!1){if((!r||r===ck)&&(r=nr),Za(r)){const w=Eo(r,o,!0);return c&&uR(w,c),id>0&&!E&&Lr&&(w.shapeFlag&6?Lr[Lr.indexOf(r)]=w:Lr.push(w)),w.patchFlag|=-2,w}if(EK(r)&&(r=r.__vccOpts),o){o=jk(o);let{class:w,style:N}=o;w&&!ni(w)&&(o.class=Ph(w)),bn(N)&&(Ky(N)&&!Xt(N)&&(N=ei({},N)),o.style=Dh(N))}const T=ni(r)?1:dk(r)?128:nK(r)?64:bn(r)?4:ve(r)?2:0;return dR(r,o,c,l,f,T,E,!0)}function jk(r){return r?Ky(r)||am in r?ei({},r):r:null}function Eo(r,o,c=!1){const{props:l,ref:f,patchFlag:E,children:T}=r,w=o?Wk(l||{},o):l;return{__v_isVNode:!0,__v_skip:!0,type:r.type,props:w,key:w&&Bk(w),ref:o&&o.ref?c&&f?Xt(f)?f.concat(__(o)):[f,__(o)]:__(o):f,scopeId:r.scopeId,slotScopeIds:r.slotScopeIds,children:T,target:r.target,targetAnchor:r.targetAnchor,staticCount:r.staticCount,shapeFlag:r.shapeFlag,patchFlag:o&&r.type!==Gi?E===-1?16:E|16:E,dynamicProps:r.dynamicProps,dynamicChildren:r.dynamicChildren,appContext:r.appContext,dirs:r.dirs,transition:r.transition,component:r.component,suspense:r.suspense,ssContent:r.ssContent&&Eo(r.ssContent),ssFallback:r.ssFallback&&Eo(r.ssFallback),el:r.el,anchor:r.anchor,ctx:r.ctx,ce:r.ce}}function lR(r=" ",o=0){return Hn(nd,null,r,o)}function dK(r,o){const c=Hn($c,null,r);return c.staticCount=o,c}function lK(r="",o=!1){return o?(om(),cR(nr,null,r)):Hn(nr,null,r)}function ts(r){return r==null||typeof r=="boolean"?Hn(nr):Xt(r)?Hn(Gi,null,r.slice()):typeof r=="object"?Wa(r):Hn(nd,null,String(r))}function Wa(r){return r.el===null&&r.patchFlag!==-1||r.memo?r:Eo(r)}function uR(r,o){let c=0;const{shapeFlag:l}=r;if(o==null)o=null;else if(Xt(o))c=16;else if(typeof o=="object")if(l&65){const f=o.default;f&&(f._c&&(f._d=!1),uR(r,f()),f._c&&(f._d=!0));return}else{c=32;const f=o._;!f&&!(am in o)?o._ctx=xi:f===3&&xi&&(xi.slots._===1?o._=1:(o._=2,r.patchFlag|=1024))}else ve(o)?(o={default:o,_ctx:xi},c=32):(o=String(o),l&64?(c=16,o=[lR(o)]):c=8);r.children=o,r.shapeFlag|=c}function Wk(...r){const o={};for(let c=0;c<r.length;c++){const l=r[c];for(const f in l)if(f==="class")o.class!==l.class&&(o.class=Ph([o.class,l.class]));else if(f==="style")o.style=Dh([o.style,l.style]);else if(Oh(f)){const E=o[f],T=l[f];T&&E!==T&&!(Xt(E)&&E.includes(T))&&(o[f]=E?[].concat(E,T):T)}else f!==""&&(o[f]=l[f])}return o}function kr(r,o,c,l=null){is(r,o,7,[c,l])}const uK=wk();let hK=0;function Gk(r,o,c){const l=r.type,f=(o?o.appContext:r.appContext)||uK,E={uid:hK++,vnode:r,type:l,parent:o,appContext:f,root:null,next:null,subTree:null,effect:null,update:null,scope:new jy(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:o?o.provides:Object.create(f.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Ok(l,f),emitsOptions:ak(l,f),emit:null,emitted:null,propsDefaults:In,inheritAttrs:l.inheritAttrs,ctx:In,data:In,props:In,attrs:In,slots:In,refs:In,setupState:In,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:c,suspenseId:c?c.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return E.ctx={_:E},E.root=o?o.root:E,E.emit=z6.bind(null,E),r.ce&&r.ce(E),E}let Ri=null;const ta=()=>Ri||xi;let hR,al,bD="__VUE_INSTANCE_SETTERS__";(al=JT()[bD])||(al=JT()[bD]=[]),al.push(r=>Ri=r),hR=r=>{al.length>1?al.forEach(o=>o(r)):al[0](r)};const tc=r=>{hR(r),r.scope.on()},za=()=>{Ri&&Ri.scope.off(),hR(null)};function Hk(r){return r.vnode.shapeFlag&4}let wl=!1;function Yk(r,o=!1){wl=o;const{props:c,children:l}=r.vnode,f=Hk(r);JY(r,c,f,o),$Y(r,l);const E=f?pK(r,o):void 0;return wl=!1,E}function pK(r,o){const c=r.type;r.accessCache=Object.create(null),r.proxy=qy(new Proxy(r.ctx,ey));const{setup:l}=c;if(l){const f=r.setupContext=l.length>1?qk(r):null;tc(r),Ll();const E=Jo(l,r,0,[r.props,f]);if(Ml(),za(),Fy(E)){if(E.then(za,za),o)return E.then(T=>{ay(r,T,o)}).catch(T=>{sd(T,r,0)});r.asyncDep=E}else ay(r,E,o)}else Kk(r,o)}function ay(r,o,c){ve(o)?r.type.__ssrInlineRender?r.ssrRender=o:r.render=o:bn(o)&&(r.setupState=Xy(o)),Kk(r,c)}let P_,cy;function fK(r){P_=r,cy=o=>{o.render._rc&&(o.withProxy=new Proxy(o.ctx,bY))}}const _K=()=>!P_;function Kk(r,o,c){const l=r.type;if(!r.render){if(!o&&P_&&!l.render){const f=l.template||sR(r).template;if(f){const{isCustomElement:E,compilerOptions:T}=r.appContext.config,{delimiters:w,compilerOptions:N}=l,D=ei(ei({isCustomElement:E,delimiters:w},T),N);l.render=P_(f,D)}}r.render=l.render||Fs,cy&&cy(r)}{tc(r),Ll();try{jY(r)}finally{Ml(),za()}}}function mK(r){return r.attrsProxy||(r.attrsProxy=new Proxy(r.attrs,{get(o,c){return Ur(r,"get","$attrs"),o[c]}}))}function qk(r){const o=c=>{r.exposed=c||{}};return{get attrs(){return mK(r)},slots:r.slots,emit:r.emit,expose:o}}function cm(r){if(r.exposed)return r.exposeProxy||(r.exposeProxy=new Proxy(Xy(qy(r.exposed)),{get(o,c){if(c in o)return o[c];if(c in ah)return ah[c](r)},has(o,c){return c in o||c in ah}}))}function dy(r,o=!0){return ve(r)?r.displayName||r.name:r.name||o&&r.__name}function EK(r){return ve(r)&&"__vccOpts"in r}const ns=(r,o)=>j6(r,o,wl);function dm(r,o,c){const l=arguments.length;return l===2?bn(o)&&!Xt(o)?Za(o)?Hn(r,null,[o]):Hn(r,o):Hn(r,null,o):(l>3?c=Array.prototype.slice.call(arguments,2):l===3&&Za(c)&&(c=[c]),Hn(r,o,c))}const zk=Symbol.for("v-scx"),Jk=()=>rs(zk);function gK(){}function SK(r,o,c,l){const f=c[l];if(f&&Xk(f,r))return f;const E=o();return E.memo=r.slice(),c[l]=E}function Xk(r,o){const c=r.memo;if(c.length!=o.length)return!1;for(let l=0;l<c.length;l++)if(Xa(c[l],o[l]))return!1;return id>0&&Lr&&Lr.push(r),!0}const Qk="3.3.10",TK={createComponentInstance:Gk,setupComponent:Yk,renderComponentRoot:f_,setCurrentRenderingInstance:Th,isVNode:Za,normalizeVNode:ts},yK=TK,RK=null,vK=null,CK="http://www.w3.org/2000/svg",Yc=typeof document<"u"?document:null,wD=Yc&&Yc.createElement("template"),IK={insert:(r,o,c)=>{o.insertBefore(r,c||null)},remove:r=>{const o=r.parentNode;o&&o.removeChild(r)},createElement:(r,o,c,l)=>{const f=o?Yc.createElementNS(CK,r):Yc.createElement(r,c?{is:c}:void 0);return r==="select"&&l&&l.multiple!=null&&f.setAttribute("multiple",l.multiple),f},createText:r=>Yc.createTextNode(r),createComment:r=>Yc.createComment(r),setText:(r,o)=>{r.nodeValue=o},setElementText:(r,o)=>{r.textContent=o},parentNode:r=>r.parentNode,nextSibling:r=>r.nextSibling,querySelector:r=>Yc.querySelector(r),setScopeId(r,o){r.setAttribute(o,"")},insertStaticContent(r,o,c,l,f,E){const T=c?c.previousSibling:o.lastChild;if(f&&(f===E||f.nextSibling))for(;o.insertBefore(f.cloneNode(!0),c),!(f===E||!(f=f.nextSibling)););else{wD.innerHTML=l?`<svg>${r}</svg>`:r;const w=wD.content;if(l){const N=w.firstChild;for(;N.firstChild;)w.appendChild(N.firstChild);w.removeChild(N)}o.insertBefore(w,c)}return[T?T.nextSibling:o.firstChild,c?c.previousSibling:o.lastChild]}},xa="transition",qu="animation",Al=Symbol("_vtc"),pR=(r,{slots:o})=>dm(pk,Zk(r),o);pR.displayName="Transition";const $k={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},bK=pR.props=ei({},rR,$k),Wc=(r,o=[])=>{Xt(r)?r.forEach(c=>c(...o)):r&&r(...o)},AD=r=>r?Xt(r)?r.some(o=>o.length>1):r.length>1:!1;function Zk(r){const o={};for(const Mt in r)Mt in $k||(o[Mt]=r[Mt]);if(r.css===!1)return o;const{name:c="v",type:l,duration:f,enterFromClass:E=`${c}-enter-from`,enterActiveClass:T=`${c}-enter-active`,enterToClass:w=`${c}-enter-to`,appearFromClass:N=E,appearActiveClass:D=T,appearToClass:k=w,leaveFromClass:M=`${c}-leave-from`,leaveActiveClass:j=`${c}-leave-active`,leaveToClass:nt=`${c}-leave-to`}=r,rt=wK(f),at=rt&&rt[0],Ot=rt&&rt[1],{onBeforeEnter:wt,onEnter:dt,onEnterCancelled:it,onLeave:Q,onLeaveCancelled:St,onBeforeAppear:Ft=wt,onAppear:jt=dt,onAppearCancelled:At=it}=o,Wt=(Mt,fe,_n)=>{Ba(Mt,fe?k:w),Ba(Mt,fe?D:T),_n&&_n()},xt=(Mt,fe)=>{Mt._isLeaving=!1,Ba(Mt,M),Ba(Mt,nt),Ba(Mt,j),fe&&fe()},ae=Mt=>(fe,_n)=>{const ln=Mt?jt:dt,Zt=()=>Wt(fe,Mt,_n);Wc(ln,[fe,Zt]),OD(()=>{Ba(fe,Mt?N:E),Wo(fe,Mt?k:w),AD(ln)||ND(fe,l,at,Zt)})};return ei(o,{onBeforeEnter(Mt){Wc(wt,[Mt]),Wo(Mt,E),Wo(Mt,T)},onBeforeAppear(Mt){Wc(Ft,[Mt]),Wo(Mt,N),Wo(Mt,D)},onEnter:ae(!1),onAppear:ae(!0),onLeave(Mt,fe){Mt._isLeaving=!0;const _n=()=>xt(Mt,fe);Wo(Mt,M),eL(),Wo(Mt,j),OD(()=>{Mt._isLeaving&&(Ba(Mt,M),Wo(Mt,nt),AD(Q)||ND(Mt,l,Ot,_n))}),Wc(Q,[Mt,_n])},onEnterCancelled(Mt){Wt(Mt,!1),Wc(it,[Mt])},onAppearCancelled(Mt){Wt(Mt,!0),Wc(At,[Mt])},onLeaveCancelled(Mt){xt(Mt),Wc(St,[Mt])}})}function wK(r){if(r==null)return null;if(bn(r))return[NT(r.enter),NT(r.leave)];{const o=NT(r);return[o,o]}}function NT(r){return b_(r)}function Wo(r,o){o.split(/\s+/).forEach(c=>c&&r.classList.add(c)),(r[Al]||(r[Al]=new Set)).add(o)}function Ba(r,o){o.split(/\s+/).forEach(l=>l&&r.classList.remove(l));const c=r[Al];c&&(c.delete(o),c.size||(r[Al]=void 0))}function OD(r){requestAnimationFrame(()=>{requestAnimationFrame(r)})}let AK=0;function ND(r,o,c,l){const f=r._endId=++AK,E=()=>{f===r._endId&&l()};if(c)return setTimeout(E,c);const{type:T,timeout:w,propCount:N}=tL(r,o);if(!T)return l();const D=T+"end";let k=0;const M=()=>{r.removeEventListener(D,j),E()},j=nt=>{nt.target===r&&++k>=N&&M()};setTimeout(()=>{k<N&&M()},w+1),r.addEventListener(D,j)}function tL(r,o){const c=window.getComputedStyle(r),l=rt=>(c[rt]||"").split(", "),f=l(`${xa}Delay`),E=l(`${xa}Duration`),T=DD(f,E),w=l(`${qu}Delay`),N=l(`${qu}Duration`),D=DD(w,N);let k=null,M=0,j=0;o===xa?T>0&&(k=xa,M=T,j=E.length):o===qu?D>0&&(k=qu,M=D,j=N.length):(M=Math.max(T,D),k=M>0?T>D?xa:qu:null,j=k?k===xa?E.length:N.length:0);const nt=k===xa&&/\b(transform|all)(,|$)/.test(l(`${xa}Property`).toString());return{type:k,timeout:M,propCount:j,hasTransform:nt}}function DD(r,o){for(;r.length<o.length;)r=r.concat(r);return Math.max(...o.map((c,l)=>PD(c)+PD(r[l])))}function PD(r){return r==="auto"?0:Number(r.slice(0,-1).replace(",","."))*1e3}function eL(){return document.body.offsetHeight}function OK(r,o,c){const l=r[Al];l&&(o=(o?[o,...l]:[...l]).join(" ")),o==null?r.removeAttribute("class"):c?r.setAttribute("class",o):r.className=o}const fR=Symbol("_vod"),nL={beforeMount(r,{value:o},{transition:c}){r[fR]=r.style.display==="none"?"":r.style.display,c&&o?c.beforeEnter(r):zu(r,o)},mounted(r,{value:o},{transition:c}){c&&o&&c.enter(r)},updated(r,{value:o,oldValue:c},{transition:l}){!o!=!c&&(l?o?(l.beforeEnter(r),zu(r,!0),l.enter(r)):l.leave(r,()=>{zu(r,!1)}):zu(r,o))},beforeUnmount(r,{value:o}){zu(r,o)}};function zu(r,o){r.style.display=o?r[fR]:"none"}function NK(){nL.getSSRProps=({value:r})=>{if(!r)return{style:{display:"none"}}}}function DK(r,o,c){const l=r.style,f=ni(c);if(c&&!f){if(o&&!ni(o))for(const E in o)c[E]==null&&ly(l,E,"");for(const E in c)ly(l,E,c[E])}else{const E=l.display;f?o!==c&&(l.cssText=c):o&&r.removeAttribute("style"),fR in r&&(l.display=E)}}const kD=/\s*!important$/;function ly(r,o,c){if(Xt(c))c.forEach(l=>ly(r,o,l));else if(c==null&&(c=""),o.startsWith("--"))r.setProperty(o,c);else{const l=PK(r,o);kD.test(c)?r.setProperty(Rs(l),c.replace(kD,""),"important"):r[l]=c}}const LD=["Webkit","Moz","ms"],DT={};function PK(r,o){const c=DT[o];if(c)return c;let l=Mr(o);if(l!=="filter"&&l in r)return DT[o]=l;l=Nh(l);for(let f=0;f<LD.length;f++){const E=LD[f]+l;if(E in r)return DT[o]=E}return o}const MD="http://www.w3.org/1999/xlink";function kK(r,o,c,l,f){if(l&&o.startsWith("xlink:"))c==null?r.removeAttributeNS(MD,o.slice(6,o.length)):r.setAttributeNS(MD,o,c);else{const E=n6(o);c==null||E&&!xP(c)?r.removeAttribute(o):r.setAttribute(o,E?"":c)}}function LK(r,o,c,l,f,E,T){if(o==="innerHTML"||o==="textContent"){l&&T(l,f,E),r[o]=c??"";return}const w=r.tagName;if(o==="value"&&w!=="PROGRESS"&&!w.includes("-")){r._value=c;const D=w==="OPTION"?r.getAttribute("value"):r.value,k=c??"";D!==k&&(r.value=k),c==null&&r.removeAttribute(o);return}let N=!1;if(c===""||c==null){const D=typeof r[o];D==="boolean"?c=xP(c):c==null&&D==="string"?(c="",N=!0):D==="number"&&(c=0,N=!0)}try{r[o]=c}catch{}N&&r.removeAttribute(o)}function Yo(r,o,c,l){r.addEventListener(o,c,l)}function MK(r,o,c,l){r.removeEventListener(o,c,l)}const UD=Symbol("_vei");function UK(r,o,c,l,f=null){const E=r[UD]||(r[UD]={}),T=E[o];if(l&&T)T.value=l;else{const[w,N]=xK(o);if(l){const D=E[o]=BK(l,f);Yo(r,w,D,N)}else T&&(MK(r,w,T,N),E[o]=void 0)}}const xD=/(?:Once|Passive|Capture)$/;function xK(r){let o;if(xD.test(r)){o={};let l;for(;l=r.match(xD);)r=r.slice(0,r.length-l[0].length),o[l[0].toLowerCase()]=!0}return[r[2]===":"?r.slice(3):Rs(r.slice(2)),o]}let PT=0;const VK=Promise.resolve(),FK=()=>PT||(VK.then(()=>PT=0),PT=Date.now());function BK(r,o){const c=l=>{if(!l._vts)l._vts=Date.now();else if(l._vts<=c.attached)return;is(jK(l,c.value),o,5,[l])};return c.value=r,c.attached=FK(),c}function jK(r,o){if(Xt(o)){const c=r.stopImmediatePropagation;return r.stopImmediatePropagation=()=>{c.call(r),r._stopped=!0},o.map(l=>f=>!f._stopped&&l&&l(f))}else return o}const VD=r=>r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&r.charCodeAt(2)>96&&r.charCodeAt(2)<123,WK=(r,o,c,l,f=!1,E,T,w,N)=>{o==="class"?OK(r,l,f):o==="style"?DK(r,c,l):Oh(o)?xy(o)||UK(r,o,c,l,T):(o[0]==="."?(o=o.slice(1),!0):o[0]==="^"?(o=o.slice(1),!1):GK(r,o,l,f))?LK(r,o,l,E,T,w,N):(o==="true-value"?r._trueValue=l:o==="false-value"&&(r._falseValue=l),kK(r,o,l,f))};function GK(r,o,c,l){if(l)return!!(o==="innerHTML"||o==="textContent"||o in r&&VD(o)&&ve(c));if(o==="spellcheck"||o==="draggable"||o==="translate"||o==="form"||o==="list"&&r.tagName==="INPUT"||o==="type"&&r.tagName==="TEXTAREA")return!1;if(o==="width"||o==="height"){const f=r.tagName;return!(f==="IMG"||f==="VIDEO"||f==="CANVAS"||f==="SOURCE")}return VD(o)&&ni(c)?!1:o in r}/*! #__NO_SIDE_EFFECTS__ */function iL(r,o){const c=Lh(r);class l extends lm{constructor(E){super(c,E,o)}}return l.def=c,l}/*! #__NO_SIDE_EFFECTS__ */const HK=r=>iL(r,fL),YK=typeof HTMLElement<"u"?HTMLElement:class{};class lm extends YK{constructor(o,c={},l){super(),this._def=o,this._props=c,this._instance=null,this._connected=!1,this._resolved=!1,this._numberProps=null,this._ob=null,this.shadowRoot&&l?l(this._createVNode(),this.shadowRoot):(this.attachShadow({mode:"open"}),this._def.__asyncLoader||this._resolveProps(this._def))}connectedCallback(){this._connected=!0,this._instance||(this._resolved?this._update():this._resolveDef())}disconnectedCallback(){this._connected=!1,this._ob&&(this._ob.disconnect(),this._ob=null),Q_(()=>{this._connected||(py(null,this.shadowRoot),this._instance=null)})}_resolveDef(){this._resolved=!0;for(let l=0;l<this.attributes.length;l++)this._setAttr(this.attributes[l].name);this._ob=new MutationObserver(l=>{for(const f of l)this._setAttr(f.attributeName)}),this._ob.observe(this,{attributes:!0});const o=(l,f=!1)=>{const{props:E,styles:T}=l;let w;if(E&&!Xt(E))for(const N in E){const D=E[N];(D===Number||D&&D.type===Number)&&(N in this._props&&(this._props[N]=b_(this._props[N])),(w||(w=Object.create(null)))[Mr(N)]=!0)}this._numberProps=w,f&&this._resolveProps(l),this._applyStyles(T),this._update()},c=this._def.__asyncLoader;c?c().then(l=>o(l,!0)):o(this._def)}_resolveProps(o){const{props:c}=o,l=Xt(c)?c:Object.keys(c||{});for(const f of Object.keys(this))f[0]!=="_"&&l.includes(f)&&this._setProp(f,this[f],!0,!1);for(const f of l.map(Mr))Object.defineProperty(this,f,{get(){return this._getProp(f)},set(E){this._setProp(f,E)}})}_setAttr(o){let c=this.getAttribute(o);const l=Mr(o);this._numberProps&&this._numberProps[l]&&(c=b_(c)),this._setProp(l,c,!1)}_getProp(o){return this._props[o]}_setProp(o,c,l=!0,f=!0){c!==this._props[o]&&(this._props[o]=c,f&&this._instance&&this._update(),l&&(c===!0?this.setAttribute(Rs(o),""):typeof c=="string"||typeof c=="number"?this.setAttribute(Rs(o),c+""):c||this.removeAttribute(Rs(o))))}_update(){py(this._createVNode(),this.shadowRoot)}_createVNode(){const o=Hn(this._def,ei({},this._props));return this._instance||(o.ce=c=>{this._instance=c,c.isCE=!0;const l=(E,T)=>{this.dispatchEvent(new CustomEvent(E,{detail:T}))};c.emit=(E,...T)=>{l(E,T),Rs(E)!==E&&l(Rs(E),T)};let f=this;for(;f=f&&(f.parentNode||f.host);)if(f instanceof lm){c.parent=f._instance,c.provides=f._instance.provides;break}}),o}_applyStyles(o){o&&o.forEach(c=>{const l=document.createElement("style");l.textContent=c,this.shadowRoot.appendChild(l)})}}function KK(r="$style"){{const o=ta();if(!o)return In;const c=o.type.__cssModules;if(!c)return In;const l=c[r];return l||In}}function qK(r){const o=ta();if(!o)return;const c=o.ut=(f=r(o.proxy))=>{Array.from(document.querySelectorAll(`[data-v-owner="${o.uid}"]`)).forEach(E=>hy(E,f))},l=()=>{const f=r(o.proxy);uy(o.subTree,f),c(f)};uk(l),Uh(()=>{const f=new MutationObserver(l);f.observe(o.subTree.el.parentNode,{childList:!0}),sm(()=>f.disconnect())})}function uy(r,o){if(r.shapeFlag&128){const c=r.suspense;r=c.activeBranch,c.pendingBranch&&!c.isHydrating&&c.effects.push(()=>{uy(c.activeBranch,o)})}for(;r.component;)r=r.component.subTree;if(r.shapeFlag&1&&r.el)hy(r.el,o);else if(r.type===Gi)r.children.forEach(c=>uy(c,o));else if(r.type===$c){let{el:c,anchor:l}=r;for(;c&&(hy(c,o),c!==l);)c=c.nextSibling}}function hy(r,o){if(r.nodeType===1){const c=r.style;for(const l in o)c.setProperty(`--${l}`,o[l])}}const rL=new WeakMap,sL=new WeakMap,k_=Symbol("_moveCb"),FD=Symbol("_enterCb"),oL={name:"TransitionGroup",props:ei({},bK,{tag:String,moveClass:String}),setup(r,{slots:o}){const c=ta(),l=iR();let f,E;return im(()=>{if(!f.length)return;const T=r.moveClass||`${r.name||"v"}-move`;if(!ZK(f[0].el,c.vnode.el,T))return;f.forEach(XK),f.forEach(QK);const w=f.filter($K);eL(),w.forEach(N=>{const D=N.el,k=D.style;Wo(D,T),k.transform=k.webkitTransform=k.transitionDuration="";const M=D[k_]=j=>{j&&j.target!==D||(!j||/transform$/.test(j.propertyName))&&(D.removeEventListener("transitionend",M),D[k_]=null,Ba(D,T))};D.addEventListener("transitionend",M)})}),()=>{const T=ze(r),w=Zk(T);let N=T.tag||Gi;f=E,E=o.default?em(o.default()):[];for(let D=0;D<E.length;D++){const k=E[D];k.key!=null&&ed(k,bl(k,w,l,c))}if(f)for(let D=0;D<f.length;D++){const k=f[D];ed(k,bl(k,w,l,c)),rL.set(k,k.el.getBoundingClientRect())}return Hn(N,null,E)}}},zK=r=>delete r.mode;oL.props;const JK=oL;function XK(r){const o=r.el;o[k_]&&o[k_](),o[FD]&&o[FD]()}function QK(r){sL.set(r,r.el.getBoundingClientRect())}function $K(r){const o=rL.get(r),c=sL.get(r),l=o.left-c.left,f=o.top-c.top;if(l||f){const E=r.el.style;return E.transform=E.webkitTransform=`translate(${l}px,${f}px)`,E.transitionDuration="0s",r}}function ZK(r,o,c){const l=r.cloneNode(),f=r[Al];f&&f.forEach(w=>{w.split(/\s+/).forEach(N=>N&&l.classList.remove(N))}),c.split(/\s+/).forEach(w=>w&&l.classList.add(w)),l.style.display="none";const E=o.nodeType===1?o:o.parentNode;E.appendChild(l);const{hasTransform:T}=tL(l);return E.removeChild(l),T}const ec=r=>{const o=r.props["onUpdate:modelValue"]||!1;return Xt(o)?c=>gl(o,c):o};function t8(r){r.target.composing=!0}function BD(r){const o=r.target;o.composing&&(o.composing=!1,o.dispatchEvent(new Event("input")))}const vs=Symbol("_assign"),L_={created(r,{modifiers:{lazy:o,trim:c,number:l}},f){r[vs]=ec(f);const E=l||f.props&&f.props.type==="number";Yo(r,o?"change":"input",T=>{if(T.target.composing)return;let w=r.value;c&&(w=w.trim()),E&&(w=I_(w)),r[vs](w)}),c&&Yo(r,"change",()=>{r.value=r.value.trim()}),o||(Yo(r,"compositionstart",t8),Yo(r,"compositionend",BD),Yo(r,"change",BD))},mounted(r,{value:o}){r.value=o??""},beforeUpdate(r,{value:o,modifiers:{lazy:c,trim:l,number:f}},E){if(r[vs]=ec(E),r.composing)return;const T=f||r.type==="number"?I_(r.value):r.value,w=o??"";T!==w&&(document.activeElement===r&&r.type!=="range"&&(c||l&&r.value.trim()===w)||(r.value=w))}},_R={deep:!0,created(r,o,c){r[vs]=ec(c),Yo(r,"change",()=>{const l=r._modelValue,f=Ol(r),E=r.checked,T=r[vs];if(Xt(l)){const w=K_(l,f),N=w!==-1;if(E&&!N)T(l.concat(f));else if(!E&&N){const D=[...l];D.splice(w,1),T(D)}}else if(rd(l)){const w=new Set(l);E?w.add(f):w.delete(f),T(w)}else T(cL(r,E))})},mounted:jD,beforeUpdate(r,o,c){r[vs]=ec(c),jD(r,o,c)}};function jD(r,{value:o,oldValue:c},l){r._modelValue=o,Xt(o)?r.checked=K_(o,l.props.value)>-1:rd(o)?r.checked=o.has(l.props.value):o!==c&&(r.checked=Qa(o,cL(r,!0)))}const mR={created(r,{value:o},c){r.checked=Qa(o,c.props.value),r[vs]=ec(c),Yo(r,"change",()=>{r[vs](Ol(r))})},beforeUpdate(r,{value:o,oldValue:c},l){r[vs]=ec(l),o!==c&&(r.checked=Qa(o,l.props.value))}},aL={deep:!0,created(r,{value:o,modifiers:{number:c}},l){const f=rd(o);Yo(r,"change",()=>{const E=Array.prototype.filter.call(r.options,T=>T.selected).map(T=>c?I_(Ol(T)):Ol(T));r[vs](r.multiple?f?new Set(E):E:E[0])}),r[vs]=ec(l)},mounted(r,{value:o}){WD(r,o)},beforeUpdate(r,o,c){r[vs]=ec(c)},updated(r,{value:o}){WD(r,o)}};function WD(r,o){const c=r.multiple;if(!(c&&!Xt(o)&&!rd(o))){for(let l=0,f=r.options.length;l<f;l++){const E=r.options[l],T=Ol(E);if(c)Xt(o)?E.selected=K_(o,T)>-1:E.selected=o.has(T);else if(Qa(Ol(E),o)){r.selectedIndex!==l&&(r.selectedIndex=l);return}}!c&&r.selectedIndex!==-1&&(r.selectedIndex=-1)}}function Ol(r){return"_value"in r?r._value:r.value}function cL(r,o){const c=o?"_trueValue":"_falseValue";return c in r?r[c]:o}const dL={created(r,o,c){a_(r,o,c,null,"created")},mounted(r,o,c){a_(r,o,c,null,"mounted")},beforeUpdate(r,o,c,l){a_(r,o,c,l,"beforeUpdate")},updated(r,o,c,l){a_(r,o,c,l,"updated")}};function lL(r,o){switch(r){case"SELECT":return aL;case"TEXTAREA":return L_;default:switch(o){case"checkbox":return _R;case"radio":return mR;default:return L_}}}function a_(r,o,c,l,f){const T=lL(r.tagName,c.props&&c.props.type)[f];T&&T(r,o,c,l)}function e8(){L_.getSSRProps=({value:r})=>({value:r}),mR.getSSRProps=({value:r},o)=>{if(o.props&&Qa(o.props.value,r))return{checked:!0}},_R.getSSRProps=({value:r},o)=>{if(Xt(r)){if(o.props&&K_(r,o.props.value)>-1)return{checked:!0}}else if(rd(r)){if(o.props&&r.has(o.props.value))return{checked:!0}}else if(r)return{checked:!0}},dL.getSSRProps=(r,o)=>{if(typeof o.type!="string")return;const c=lL(o.type.toUpperCase(),o.props&&o.props.type);if(c.getSSRProps)return c.getSSRProps(r,o)}}const n8=["ctrl","shift","alt","meta"],i8={stop:r=>r.stopPropagation(),prevent:r=>r.preventDefault(),self:r=>r.target!==r.currentTarget,ctrl:r=>!r.ctrlKey,shift:r=>!r.shiftKey,alt:r=>!r.altKey,meta:r=>!r.metaKey,left:r=>"button"in r&&r.button!==0,middle:r=>"button"in r&&r.button!==1,right:r=>"button"in r&&r.button!==2,exact:(r,o)=>n8.some(c=>r[`${c}Key`]&&!o.includes(c))},r8=(r,o)=>r._withMods||(r._withMods=(c,...l)=>{for(let f=0;f<o.length;f++){const E=i8[o[f]];if(E&&E(c,o))return}return r(c,...l)}),s8={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},o8=(r,o)=>r._withKeys||(r._withKeys=c=>{if(!("key"in c))return;const l=Rs(c.key);if(o.some(f=>f===l||s8[f]===l))return r(c)}),uL=ei({patchProp:WK},IK);let uh,GD=!1;function hL(){return uh||(uh=kk(uL))}function pL(){return uh=GD?uh:Lk(uL),GD=!0,uh}const py=(...r)=>{hL().render(...r)},fL=(...r)=>{pL().hydrate(...r)},a8=(...r)=>{const o=hL().createApp(...r),{mount:c}=o;return o.mount=l=>{const f=_L(l);if(!f)return;const E=o._component;!ve(E)&&!E.render&&!E.template&&(E.template=f.innerHTML),f.innerHTML="";const T=c(f,!1,f instanceof SVGElement);return f instanceof Element&&(f.removeAttribute("v-cloak"),f.setAttribute("data-v-app","")),T},o},c8=(...r)=>{const o=pL().createApp(...r),{mount:c}=o;return o.mount=l=>{const f=_L(l);if(f)return c(f,!0,f instanceof SVGElement)},o};function _L(r){return ni(r)?document.querySelector(r):r}let HD=!1;const d8=()=>{HD||(HD=!0,e8(),NK())},l8=()=>{},XQ=Object.freeze(Object.defineProperty({__proto__:null,BaseTransition:pk,BaseTransitionPropsValidators:rR,Comment:nr,EffectScope:jy,Fragment:Gi,KeepAlive:TY,ReactiveEffect:Il,Static:$c,Suspense:aY,Teleport:sK,Text:nd,Transition:pR,TransitionGroup:JK,VueElement:lm,assertNumber:G6,callWithAsyncErrorHandling:is,callWithErrorHandling:Jo,camelize:Mr,capitalize:Nh,cloneVNode:Eo,compatUtils:vK,compile:l8,computed:ns,createApp:a8,createBlock:cR,createCommentVNode:lK,createElementBlock:oK,createElementVNode:dR,createHydrationRenderer:Lk,createPropsRestProxy:FY,createRenderer:kk,createSSRApp:c8,createSlots:vY,createStaticVNode:dK,createTextVNode:lR,createVNode:Hn,customRef:M6,defineAsyncComponent:gY,defineComponent:Lh,defineCustomElement:iL,defineEmits:AY,defineExpose:OY,defineModel:PY,defineOptions:NY,defineProps:wY,defineSSRCustomElement:HK,defineSlots:DY,get devtools(){return ul},effect:c6,effectScope:FP,getCurrentInstance:ta,getCurrentScope:jP,getTransitionRawChildren:em,guardReactiveProps:jk,h:dm,handleError:sd,hasInjectionContext:zY,hydrate:fL,initCustomFormatter:gK,initDirectivesForSSR:d8,inject:rs,isMemoSame:Xk,isProxy:Ky,isReactive:Jc,isReadonly:td,isRef:Oi,isRuntimeOnly:_K,isShallow:mh,isVNode:Za,markRaw:qy,mergeDefaults:xY,mergeModels:VY,mergeProps:Wk,nextTick:Q_,normalizeClass:Ph,normalizeProps:t6,normalizeStyle:Dh,onActivated:_k,onBeforeMount:gk,onBeforeUnmount:rm,onBeforeUpdate:Sk,onDeactivated:mk,onErrorCaptured:vk,onMounted:Uh,onRenderTracked:Rk,onRenderTriggered:yk,onScopeDispose:s6,onServerPrefetch:Tk,onUnmounted:sm,onUpdated:im,openBlock:om,popScopeId:X6,provide:ch,proxyRefs:Xy,pushScopeId:J6,queuePostFlushCb:A_,reactive:Ul,readonly:Yy,ref:Xc,registerRuntimeCompiler:fK,render:py,renderList:RY,renderSlot:CY,resolveComponent:iY,resolveDirective:sY,resolveDynamicComponent:rY,resolveFilter:RK,resolveTransitionHooks:bl,setBlockTracking:oy,setDevtoolsHook:ok,setTransitionHooks:ed,shallowReactive:Hy,shallowReadonly:O6,shallowRef:tk,ssrContextKey:zk,ssrUtils:yK,stop:d6,toDisplayString:r6,toHandlerKey:oh,toHandlers:IY,toRaw:ze,toRef:F6,toRefs:U6,toValue:P6,transformVNodeArgs:aK,triggerRef:D6,unref:qa,useAttrs:MY,useCssModule:KK,useCssVars:qK,useModel:UY,useSSRContext:Jk,useSlots:LY,useTransitionState:iR,vModelCheckbox:_R,vModelDynamic:dL,vModelRadio:mR,vModelSelect:aL,vModelText:L_,vShow:nL,version:Qk,warn:W6,watch:_o,watchEffect:pY,watchPostEffect:uk,watchSyncEffect:fY,withAsyncContext:BY,withCtx:$y,withDefaults:kY,withDirectives:mY,withKeys:o8,withMemo:SK,withModifiers:r8,withScopeId:Q6},Symbol.toStringTag,{value:"Module"}));function u8(){return mL().__VUE_DEVTOOLS_GLOBAL_HOOK__}function mL(){return typeof navigator<"u"&&typeof window<"u"?window:typeof global<"u"?global:{}}const h8=typeof Proxy=="function",p8="devtools-plugin:setup",f8="plugin:settings:set";let cl,fy;function _8(){var r;return cl!==void 0||(typeof window<"u"&&window.performance?(cl=!0,fy=window.performance):typeof global<"u"&&(!((r=global.perf_hooks)===null||r===void 0)&&r.performance)?(cl=!0,fy=global.perf_hooks.performance):cl=!1),cl}function m8(){return _8()?fy.now():Date.now()}class E8{constructor(o,c){this.target=null,this.targetQueue=[],this.onQueue=[],this.plugin=o,this.hook=c;const l={};if(o.settings)for(const T in o.settings){const w=o.settings[T];l[T]=w.defaultValue}const f=`__vue-devtools-plugin-settings__${o.id}`;let E=Object.assign({},l);try{const T=localStorage.getItem(f),w=JSON.parse(T);Object.assign(E,w)}catch{}this.fallbacks={getSettings(){return E},setSettings(T){try{localStorage.setItem(f,JSON.stringify(T))}catch{}E=T},now(){return m8()}},c&&c.on(f8,(T,w)=>{T===this.plugin.id&&this.fallbacks.setSettings(w)}),this.proxiedOn=new Proxy({},{get:(T,w)=>this.target?this.target.on[w]:(...N)=>{this.onQueue.push({method:w,args:N})}}),this.proxiedTarget=new Proxy({},{get:(T,w)=>this.target?this.target[w]:w==="on"?this.proxiedOn:Object.keys(this.fallbacks).includes(w)?(...N)=>(this.targetQueue.push({method:w,args:N,resolve:()=>{}}),this.fallbacks[w](...N)):(...N)=>new Promise(D=>{this.targetQueue.push({method:w,args:N,resolve:D})})})}async setRealTarget(o){this.target=o;for(const c of this.onQueue)this.target.on[c.method](...c.args);for(const c of this.targetQueue)c.resolve(await this.target[c.method](...c.args))}}function g8(r,o){const c=r,l=mL(),f=u8(),E=h8&&c.enableEarlyProxy;if(f&&(l.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__||!E))f.emit(p8,r,o);else{const T=E?new E8(c,f):null;(l.__VUE_DEVTOOLS_PLUGINS__=l.__VUE_DEVTOOLS_PLUGINS__||[]).push({pluginDescriptor:c,setupFn:o,proxy:T}),T&&o(T.proxiedTarget)}}/*!
 * vuex v4.1.0
 * (c) 2022 Evan You
 * @license MIT
 */var EL="store";function QQ(r){return r===void 0&&(r=null),rs(r!==null?r:EL)}function xl(r,o){Object.keys(r).forEach(function(c){return o(r[c],c)})}function gL(r){return r!==null&&typeof r=="object"}function S8(r){return r&&typeof r.then=="function"}function T8(r,o){return function(){return r(o)}}function SL(r,o,c){return o.indexOf(r)<0&&(c&&c.prepend?o.unshift(r):o.push(r)),function(){var l=o.indexOf(r);l>-1&&o.splice(l,1)}}function TL(r,o){r._actions=Object.create(null),r._mutations=Object.create(null),r._wrappedGetters=Object.create(null),r._modulesNamespaceMap=Object.create(null);var c=r.state;um(r,c,[],r._modules.root,!0),ER(r,c,o)}function ER(r,o,c){var l=r._state,f=r._scope;r.getters={},r._makeLocalGettersCache=Object.create(null);var E=r._wrappedGetters,T={},w={},N=FP(!0);N.run(function(){xl(E,function(D,k){T[k]=T8(D,r),w[k]=ns(function(){return T[k]()}),Object.defineProperty(r.getters,k,{get:function(){return w[k].value},enumerable:!0})})}),r._state=Ul({data:o}),r._scope=N,r.strict&&I8(r),l&&c&&r._withCommit(function(){l.data=null}),f&&f.stop()}function um(r,o,c,l,f){var E=!c.length,T=r._modules.getNamespace(c);if(l.namespaced&&(r._modulesNamespaceMap[T],r._modulesNamespaceMap[T]=l),!E&&!f){var w=gR(o,c.slice(0,-1)),N=c[c.length-1];r._withCommit(function(){w[N]=l.state})}var D=l.context=y8(r,T,c);l.forEachMutation(function(k,M){var j=T+M;R8(r,j,k,D)}),l.forEachAction(function(k,M){var j=k.root?M:T+M,nt=k.handler||k;v8(r,j,nt,D)}),l.forEachGetter(function(k,M){var j=T+M;C8(r,j,k,D)}),l.forEachChild(function(k,M){um(r,o,c.concat(M),k,f)})}function y8(r,o,c){var l=o==="",f={dispatch:l?r.dispatch:function(E,T,w){var N=M_(E,T,w),D=N.payload,k=N.options,M=N.type;return(!k||!k.root)&&(M=o+M),r.dispatch(M,D)},commit:l?r.commit:function(E,T,w){var N=M_(E,T,w),D=N.payload,k=N.options,M=N.type;(!k||!k.root)&&(M=o+M),r.commit(M,D,k)}};return Object.defineProperties(f,{getters:{get:l?function(){return r.getters}:function(){return yL(r,o)}},state:{get:function(){return gR(r.state,c)}}}),f}function yL(r,o){if(!r._makeLocalGettersCache[o]){var c={},l=o.length;Object.keys(r.getters).forEach(function(f){if(f.slice(0,l)===o){var E=f.slice(l);Object.defineProperty(c,E,{get:function(){return r.getters[f]},enumerable:!0})}}),r._makeLocalGettersCache[o]=c}return r._makeLocalGettersCache[o]}function R8(r,o,c,l){var f=r._mutations[o]||(r._mutations[o]=[]);f.push(function(T){c.call(r,l.state,T)})}function v8(r,o,c,l){var f=r._actions[o]||(r._actions[o]=[]);f.push(function(T){var w=c.call(r,{dispatch:l.dispatch,commit:l.commit,getters:l.getters,state:l.state,rootGetters:r.getters,rootState:r.state},T);return S8(w)||(w=Promise.resolve(w)),r._devtoolHook?w.catch(function(N){throw r._devtoolHook.emit("vuex:error",N),N}):w})}function C8(r,o,c,l){r._wrappedGetters[o]||(r._wrappedGetters[o]=function(E){return c(l.state,l.getters,E.state,E.getters)})}function I8(r){_o(function(){return r._state.data},function(){},{deep:!0,flush:"sync"})}function gR(r,o){return o.reduce(function(c,l){return c[l]},r)}function M_(r,o,c){return gL(r)&&r.type&&(c=o,o=r,r=r.type),{type:r,payload:o,options:c}}var b8="vuex bindings",YD="vuex:mutations",kT="vuex:actions",dl="vuex",w8=0;function A8(r,o){g8({id:"org.vuejs.vuex",app:r,label:"Vuex",homepage:"https://next.vuex.vuejs.org/",logo:"https://vuejs.org/images/icons/favicon-96x96.png",packageName:"vuex",componentStateTypes:[b8]},function(c){c.addTimelineLayer({id:YD,label:"Vuex Mutations",color:KD}),c.addTimelineLayer({id:kT,label:"Vuex Actions",color:KD}),c.addInspector({id:dl,label:"Vuex",icon:"storage",treeFilterPlaceholder:"Filter stores..."}),c.on.getInspectorTree(function(l){if(l.app===r&&l.inspectorId===dl)if(l.filter){var f=[];IL(f,o._modules.root,l.filter,""),l.rootNodes=f}else l.rootNodes=[CL(o._modules.root,"")]}),c.on.getInspectorState(function(l){if(l.app===r&&l.inspectorId===dl){var f=l.nodeId;yL(o,f),l.state=D8(k8(o._modules,f),f==="root"?o.getters:o._makeLocalGettersCache,f)}}),c.on.editInspectorState(function(l){if(l.app===r&&l.inspectorId===dl){var f=l.nodeId,E=l.path;f!=="root"&&(E=f.split("/").filter(Boolean).concat(E)),o._withCommit(function(){l.set(o._state.data,E,l.state.value)})}}),o.subscribe(function(l,f){var E={};l.payload&&(E.payload=l.payload),E.state=f,c.notifyComponentUpdate(),c.sendInspectorTree(dl),c.sendInspectorState(dl),c.addTimelineEvent({layerId:YD,event:{time:Date.now(),title:l.type,data:E}})}),o.subscribeAction({before:function(l,f){var E={};l.payload&&(E.payload=l.payload),l._id=w8++,l._time=Date.now(),E.state=f,c.addTimelineEvent({layerId:kT,event:{time:l._time,title:l.type,groupId:l._id,subtitle:"start",data:E}})},after:function(l,f){var E={},T=Date.now()-l._time;E.duration={_custom:{type:"duration",display:T+"ms",tooltip:"Action duration",value:T}},l.payload&&(E.payload=l.payload),E.state=f,c.addTimelineEvent({layerId:kT,event:{time:Date.now(),title:l.type,groupId:l._id,subtitle:"end",data:E}})}})})}var KD=8702998,O8=6710886,N8=16777215,RL={label:"namespaced",textColor:N8,backgroundColor:O8};function vL(r){return r&&r!=="root"?r.split("/").slice(-2,-1)[0]:"Root"}function CL(r,o){return{id:o||"root",label:vL(o),tags:r.namespaced?[RL]:[],children:Object.keys(r._children).map(function(c){return CL(r._children[c],o+c+"/")})}}function IL(r,o,c,l){l.includes(c)&&r.push({id:l||"root",label:l.endsWith("/")?l.slice(0,l.length-1):l||"Root",tags:o.namespaced?[RL]:[]}),Object.keys(o._children).forEach(function(f){IL(r,o._children[f],c,l+f+"/")})}function D8(r,o,c){o=c==="root"?o:o[c];var l=Object.keys(o),f={state:Object.keys(r.state).map(function(T){return{key:T,editable:!0,value:r.state[T]}})};if(l.length){var E=P8(o);f.getters=Object.keys(E).map(function(T){return{key:T.endsWith("/")?vL(T):T,editable:!1,value:_y(function(){return E[T]})}})}return f}function P8(r){var o={};return Object.keys(r).forEach(function(c){var l=c.split("/");if(l.length>1){var f=o,E=l.pop();l.forEach(function(T){f[T]||(f[T]={_custom:{value:{},display:T,tooltip:"Module",abstract:!0}}),f=f[T]._custom.value}),f[E]=_y(function(){return r[c]})}else o[c]=_y(function(){return r[c]})}),o}function k8(r,o){var c=o.split("/").filter(function(l){return l});return c.reduce(function(l,f,E){var T=l[f];if(!T)throw new Error('Missing module "'+f+'" for path "'+o+'".');return E===c.length-1?T:T._children},o==="root"?r:r.root._children)}function _y(r){try{return r()}catch(o){return o}}var Gs=function(o,c){this.runtime=c,this._children=Object.create(null),this._rawModule=o;var l=o.state;this.state=(typeof l=="function"?l():l)||{}},bL={namespaced:{configurable:!0}};bL.namespaced.get=function(){return!!this._rawModule.namespaced};Gs.prototype.addChild=function(o,c){this._children[o]=c};Gs.prototype.removeChild=function(o){delete this._children[o]};Gs.prototype.getChild=function(o){return this._children[o]};Gs.prototype.hasChild=function(o){return o in this._children};Gs.prototype.update=function(o){this._rawModule.namespaced=o.namespaced,o.actions&&(this._rawModule.actions=o.actions),o.mutations&&(this._rawModule.mutations=o.mutations),o.getters&&(this._rawModule.getters=o.getters)};Gs.prototype.forEachChild=function(o){xl(this._children,o)};Gs.prototype.forEachGetter=function(o){this._rawModule.getters&&xl(this._rawModule.getters,o)};Gs.prototype.forEachAction=function(o){this._rawModule.actions&&xl(this._rawModule.actions,o)};Gs.prototype.forEachMutation=function(o){this._rawModule.mutations&&xl(this._rawModule.mutations,o)};Object.defineProperties(Gs.prototype,bL);var od=function(o){this.register([],o,!1)};od.prototype.get=function(o){return o.reduce(function(c,l){return c.getChild(l)},this.root)};od.prototype.getNamespace=function(o){var c=this.root;return o.reduce(function(l,f){return c=c.getChild(f),l+(c.namespaced?f+"/":"")},"")};od.prototype.update=function(o){wL([],this.root,o)};od.prototype.register=function(o,c,l){var f=this;l===void 0&&(l=!0);var E=new Gs(c,l);if(o.length===0)this.root=E;else{var T=this.get(o.slice(0,-1));T.addChild(o[o.length-1],E)}c.modules&&xl(c.modules,function(w,N){f.register(o.concat(N),w,l)})};od.prototype.unregister=function(o){var c=this.get(o.slice(0,-1)),l=o[o.length-1],f=c.getChild(l);f&&f.runtime&&c.removeChild(l)};od.prototype.isRegistered=function(o){var c=this.get(o.slice(0,-1)),l=o[o.length-1];return c?c.hasChild(l):!1};function wL(r,o,c){if(o.update(c),c.modules)for(var l in c.modules){if(!o.getChild(l))return;wL(r.concat(l),o.getChild(l),c.modules[l])}}function $Q(r){return new xr(r)}var xr=function(o){var c=this;o===void 0&&(o={});var l=o.plugins;l===void 0&&(l=[]);var f=o.strict;f===void 0&&(f=!1);var E=o.devtools;this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new od(o),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._makeLocalGettersCache=Object.create(null),this._scope=null,this._devtools=E;var T=this,w=this,N=w.dispatch,D=w.commit;this.dispatch=function(j,nt){return N.call(T,j,nt)},this.commit=function(j,nt,rt){return D.call(T,j,nt,rt)},this.strict=f;var k=this._modules.root.state;um(this,k,[],this._modules.root),ER(this,k),l.forEach(function(M){return M(c)})},SR={state:{configurable:!0}};xr.prototype.install=function(o,c){o.provide(c||EL,this),o.config.globalProperties.$store=this;var l=this._devtools!==void 0?this._devtools:!1;l&&A8(o,this)};SR.state.get=function(){return this._state.data};SR.state.set=function(r){};xr.prototype.commit=function(o,c,l){var f=this,E=M_(o,c,l),T=E.type,w=E.payload,N={type:T,payload:w},D=this._mutations[T];D&&(this._withCommit(function(){D.forEach(function(M){M(w)})}),this._subscribers.slice().forEach(function(k){return k(N,f.state)}))};xr.prototype.dispatch=function(o,c){var l=this,f=M_(o,c),E=f.type,T=f.payload,w={type:E,payload:T},N=this._actions[E];if(N){try{this._actionSubscribers.slice().filter(function(k){return k.before}).forEach(function(k){return k.before(w,l.state)})}catch{}var D=N.length>1?Promise.all(N.map(function(k){return k(T)})):N[0](T);return new Promise(function(k,M){D.then(function(j){try{l._actionSubscribers.filter(function(nt){return nt.after}).forEach(function(nt){return nt.after(w,l.state)})}catch{}k(j)},function(j){try{l._actionSubscribers.filter(function(nt){return nt.error}).forEach(function(nt){return nt.error(w,l.state,j)})}catch{}M(j)})})}};xr.prototype.subscribe=function(o,c){return SL(o,this._subscribers,c)};xr.prototype.subscribeAction=function(o,c){var l=typeof o=="function"?{before:o}:o;return SL(l,this._actionSubscribers,c)};xr.prototype.watch=function(o,c,l){var f=this;return _o(function(){return o(f.state,f.getters)},c,Object.assign({},l))};xr.prototype.replaceState=function(o){var c=this;this._withCommit(function(){c._state.data=o})};xr.prototype.registerModule=function(o,c,l){l===void 0&&(l={}),typeof o=="string"&&(o=[o]),this._modules.register(o,c),um(this,this.state,o,this._modules.get(o),l.preserveState),ER(this,this.state)};xr.prototype.unregisterModule=function(o){var c=this;typeof o=="string"&&(o=[o]),this._modules.unregister(o),this._withCommit(function(){var l=gR(c.state,o.slice(0,-1));delete l[o[o.length-1]]}),TL(this)};xr.prototype.hasModule=function(o){return typeof o=="string"&&(o=[o]),this._modules.isRegistered(o)};xr.prototype.hotUpdate=function(o){this._modules.update(o),TL(this,!0)};xr.prototype._withCommit=function(o){var c=this._committing;this._committing=!0,o(),this._committing=c};Object.defineProperties(xr.prototype,SR);var ZQ=OL(function(r,o){var c={};return AL(o).forEach(function(l){var f=l.key,E=l.val;c[f]=function(){var w=this.$store.state,N=this.$store.getters;if(r){var D=NL(this.$store,"mapState",r);if(!D)return;w=D.context.state,N=D.context.getters}return typeof E=="function"?E.call(this,w,N):w[E]},c[f].vuex=!0}),c}),t$=OL(function(r,o){var c={};return AL(o).forEach(function(l){var f=l.key,E=l.val;c[f]=function(){for(var w=[],N=arguments.length;N--;)w[N]=arguments[N];var D=this.$store.dispatch;if(r){var k=NL(this.$store,"mapActions",r);if(!k)return;D=k.context.dispatch}return typeof E=="function"?E.apply(this,[D].concat(w)):D.apply(this.$store,[E].concat(w))}}),c});function AL(r){return L8(r)?Array.isArray(r)?r.map(function(o){return{key:o,val:o}}):Object.keys(r).map(function(o){return{key:o,val:r[o]}}):[]}function L8(r){return Array.isArray(r)||gL(r)}function OL(r){return function(o,c){return typeof o!="string"?(c=o,o=""):o.charAt(o.length-1)!=="/"&&(o+="/"),r(o,c)}}function NL(r,o,c){var l=r._modulesNamespaceMap[c];return l}/*!
  * vue-router v4.2.5
  * (c) 2023 Eduardo San Martin Morote
  * @license MIT
  */const hl=typeof window<"u";function M8(r){return r.__esModule||r[Symbol.toStringTag]==="Module"}const gn=Object.assign;function LT(r,o){const c={};for(const l in o){const f=o[l];c[l]=Bs(f)?f.map(r):r(f)}return c}const hh=()=>{},Bs=Array.isArray,U8=/\/$/,x8=r=>r.replace(U8,"");function MT(r,o,c="/"){let l,f={},E="",T="";const w=o.indexOf("#");let N=o.indexOf("?");return w<N&&w>=0&&(N=-1),N>-1&&(l=o.slice(0,N),E=o.slice(N+1,w>-1?w:o.length),f=r(E)),w>-1&&(l=l||o.slice(0,w),T=o.slice(w,o.length)),l=j8(l??o,c),{fullPath:l+(E&&"?")+E+T,path:l,query:f,hash:T}}function V8(r,o){const c=o.query?r(o.query):"";return o.path+(c&&"?")+c+(o.hash||"")}function qD(r,o){return!o||!r.toLowerCase().startsWith(o.toLowerCase())?r:r.slice(o.length)||"/"}function F8(r,o,c){const l=o.matched.length-1,f=c.matched.length-1;return l>-1&&l===f&&Nl(o.matched[l],c.matched[f])&&DL(o.params,c.params)&&r(o.query)===r(c.query)&&o.hash===c.hash}function Nl(r,o){return(r.aliasOf||r)===(o.aliasOf||o)}function DL(r,o){if(Object.keys(r).length!==Object.keys(o).length)return!1;for(const c in r)if(!B8(r[c],o[c]))return!1;return!0}function B8(r,o){return Bs(r)?zD(r,o):Bs(o)?zD(o,r):r===o}function zD(r,o){return Bs(o)?r.length===o.length&&r.every((c,l)=>c===o[l]):r.length===1&&r[0]===o}function j8(r,o){if(r.startsWith("/"))return r;if(!r)return o;const c=o.split("/"),l=r.split("/"),f=l[l.length-1];(f===".."||f===".")&&l.push("");let E=c.length-1,T,w;for(T=0;T<l.length;T++)if(w=l[T],w!==".")if(w==="..")E>1&&E--;else break;return c.slice(0,E).join("/")+"/"+l.slice(T-(T===l.length?1:0)).join("/")}var Ch;(function(r){r.pop="pop",r.push="push"})(Ch||(Ch={}));var ph;(function(r){r.back="back",r.forward="forward",r.unknown=""})(ph||(ph={}));function W8(r){if(!r)if(hl){const o=document.querySelector("base");r=o&&o.getAttribute("href")||"/",r=r.replace(/^\w+:\/\/[^\/]+/,"")}else r="/";return r[0]!=="/"&&r[0]!=="#"&&(r="/"+r),x8(r)}const G8=/^[^#]+#/;function H8(r,o){return r.replace(G8,"#")+o}function Y8(r,o){const c=document.documentElement.getBoundingClientRect(),l=r.getBoundingClientRect();return{behavior:o.behavior,left:l.left-c.left-(o.left||0),top:l.top-c.top-(o.top||0)}}const hm=()=>({left:window.pageXOffset,top:window.pageYOffset});function K8(r){let o;if("el"in r){const c=r.el,l=typeof c=="string"&&c.startsWith("#"),f=typeof c=="string"?l?document.getElementById(c.slice(1)):document.querySelector(c):c;if(!f)return;o=Y8(f,r)}else o=r;"scrollBehavior"in document.documentElement.style?window.scrollTo(o):window.scrollTo(o.left!=null?o.left:window.pageXOffset,o.top!=null?o.top:window.pageYOffset)}function JD(r,o){return(history.state?history.state.position-o:-1)+r}const my=new Map;function q8(r,o){my.set(r,o)}function z8(r){const o=my.get(r);return my.delete(r),o}let J8=()=>location.protocol+"//"+location.host;function PL(r,o){const{pathname:c,search:l,hash:f}=o,E=r.indexOf("#");if(E>-1){let w=f.includes(r.slice(E))?r.slice(E).length:1,N=f.slice(w);return N[0]!=="/"&&(N="/"+N),qD(N,"")}return qD(c,r)+l+f}function X8(r,o,c,l){let f=[],E=[],T=null;const w=({state:j})=>{const nt=PL(r,location),rt=c.value,at=o.value;let Ot=0;if(j){if(c.value=nt,o.value=j,T&&T===rt){T=null;return}Ot=at?j.position-at.position:0}else l(nt);f.forEach(wt=>{wt(c.value,rt,{delta:Ot,type:Ch.pop,direction:Ot?Ot>0?ph.forward:ph.back:ph.unknown})})};function N(){T=c.value}function D(j){f.push(j);const nt=()=>{const rt=f.indexOf(j);rt>-1&&f.splice(rt,1)};return E.push(nt),nt}function k(){const{history:j}=window;j.state&&j.replaceState(gn({},j.state,{scroll:hm()}),"")}function M(){for(const j of E)j();E=[],window.removeEventListener("popstate",w),window.removeEventListener("beforeunload",k)}return window.addEventListener("popstate",w),window.addEventListener("beforeunload",k,{passive:!0}),{pauseListeners:N,listen:D,destroy:M}}function XD(r,o,c,l=!1,f=!1){return{back:r,current:o,forward:c,replaced:l,position:window.history.length,scroll:f?hm():null}}function Q8(r){const{history:o,location:c}=window,l={value:PL(r,c)},f={value:o.state};f.value||E(l.value,{back:null,current:l.value,forward:null,position:o.length-1,replaced:!0,scroll:null},!0);function E(N,D,k){const M=r.indexOf("#"),j=M>-1?(c.host&&document.querySelector("base")?r:r.slice(M))+N:J8()+r+N;try{o[k?"replaceState":"pushState"](D,"",j),f.value=D}catch(nt){console.error(nt),c[k?"replace":"assign"](j)}}function T(N,D){const k=gn({},o.state,XD(f.value.back,N,f.value.forward,!0),D,{position:f.value.position});E(N,k,!0),l.value=N}function w(N,D){const k=gn({},f.value,o.state,{forward:N,scroll:hm()});E(k.current,k,!0);const M=gn({},XD(l.value,N,null),{position:k.position+1},D);E(N,M,!1),l.value=N}return{location:l,state:f,push:w,replace:T}}function e$(r){r=W8(r);const o=Q8(r),c=X8(r,o.state,o.location,o.replace);function l(E,T=!0){T||c.pauseListeners(),history.go(E)}const f=gn({location:"",base:r,go:l,createHref:H8.bind(null,r)},o,c);return Object.defineProperty(f,"location",{enumerable:!0,get:()=>o.location.value}),Object.defineProperty(f,"state",{enumerable:!0,get:()=>o.state.value}),f}function $8(r){return typeof r=="string"||r&&typeof r=="object"}function kL(r){return typeof r=="string"||typeof r=="symbol"}const Va={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},LL=Symbol("");var QD;(function(r){r[r.aborted=4]="aborted",r[r.cancelled=8]="cancelled",r[r.duplicated=16]="duplicated"})(QD||(QD={}));function Dl(r,o){return gn(new Error,{type:r,[LL]:!0},o)}function Bo(r,o){return r instanceof Error&&LL in r&&(o==null||!!(r.type&o))}const $D="[^/]+?",Z8={sensitive:!1,strict:!1,start:!0,end:!0},tq=/[.+*?^${}()[\]/\\]/g;function eq(r,o){const c=gn({},Z8,o),l=[];let f=c.start?"^":"";const E=[];for(const D of r){const k=D.length?[]:[90];c.strict&&!D.length&&(f+="/");for(let M=0;M<D.length;M++){const j=D[M];let nt=40+(c.sensitive?.25:0);if(j.type===0)M||(f+="/"),f+=j.value.replace(tq,"\\$&"),nt+=40;else if(j.type===1){const{value:rt,repeatable:at,optional:Ot,regexp:wt}=j;E.push({name:rt,repeatable:at,optional:Ot});const dt=wt||$D;if(dt!==$D){nt+=10;try{new RegExp(`(${dt})`)}catch(Q){throw new Error(`Invalid custom RegExp for param "${rt}" (${dt}): `+Q.message)}}let it=at?`((?:${dt})(?:/(?:${dt}))*)`:`(${dt})`;M||(it=Ot&&D.length<2?`(?:/${it})`:"/"+it),Ot&&(it+="?"),f+=it,nt+=20,Ot&&(nt+=-8),at&&(nt+=-20),dt===".*"&&(nt+=-50)}k.push(nt)}l.push(k)}if(c.strict&&c.end){const D=l.length-1;l[D][l[D].length-1]+=.7000000000000001}c.strict||(f+="/?"),c.end?f+="$":c.strict&&(f+="(?:/|$)");const T=new RegExp(f,c.sensitive?"":"i");function w(D){const k=D.match(T),M={};if(!k)return null;for(let j=1;j<k.length;j++){const nt=k[j]||"",rt=E[j-1];M[rt.name]=nt&&rt.repeatable?nt.split("/"):nt}return M}function N(D){let k="",M=!1;for(const j of r){(!M||!k.endsWith("/"))&&(k+="/"),M=!1;for(const nt of j)if(nt.type===0)k+=nt.value;else if(nt.type===1){const{value:rt,repeatable:at,optional:Ot}=nt,wt=rt in D?D[rt]:"";if(Bs(wt)&&!at)throw new Error(`Provided param "${rt}" is an array but it is not repeatable (* or + modifiers)`);const dt=Bs(wt)?wt.join("/"):wt;if(!dt)if(Ot)j.length<2&&(k.endsWith("/")?k=k.slice(0,-1):M=!0);else throw new Error(`Missing required param "${rt}"`);k+=dt}}return k||"/"}return{re:T,score:l,keys:E,parse:w,stringify:N}}function nq(r,o){let c=0;for(;c<r.length&&c<o.length;){const l=o[c]-r[c];if(l)return l;c++}return r.length<o.length?r.length===1&&r[0]===40+40?-1:1:r.length>o.length?o.length===1&&o[0]===40+40?1:-1:0}function iq(r,o){let c=0;const l=r.score,f=o.score;for(;c<l.length&&c<f.length;){const E=nq(l[c],f[c]);if(E)return E;c++}if(Math.abs(f.length-l.length)===1){if(ZD(l))return 1;if(ZD(f))return-1}return f.length-l.length}function ZD(r){const o=r[r.length-1];return r.length>0&&o[o.length-1]<0}const rq={type:0,value:""},sq=/[a-zA-Z0-9_]/;function oq(r){if(!r)return[[]];if(r==="/")return[[rq]];if(!r.startsWith("/"))throw new Error(`Invalid path "${r}"`);function o(nt){throw new Error(`ERR (${c})/"${D}": ${nt}`)}let c=0,l=c;const f=[];let E;function T(){E&&f.push(E),E=[]}let w=0,N,D="",k="";function M(){D&&(c===0?E.push({type:0,value:D}):c===1||c===2||c===3?(E.length>1&&(N==="*"||N==="+")&&o(`A repeatable param (${D}) must be alone in its segment. eg: '/:ids+.`),E.push({type:1,value:D,regexp:k,repeatable:N==="*"||N==="+",optional:N==="*"||N==="?"})):o("Invalid state to consume buffer"),D="")}function j(){D+=N}for(;w<r.length;){if(N=r[w++],N==="\\"&&c!==2){l=c,c=4;continue}switch(c){case 0:N==="/"?(D&&M(),T()):N===":"?(M(),c=1):j();break;case 4:j(),c=l;break;case 1:N==="("?c=2:sq.test(N)?j():(M(),c=0,N!=="*"&&N!=="?"&&N!=="+"&&w--);break;case 2:N===")"?k[k.length-1]=="\\"?k=k.slice(0,-1)+N:c=3:k+=N;break;case 3:M(),c=0,N!=="*"&&N!=="?"&&N!=="+"&&w--,k="";break;default:o("Unknown state");break}}return c===2&&o(`Unfinished custom RegExp for param "${D}"`),M(),T(),f}function aq(r,o,c){const l=eq(oq(r.path),c),f=gn(l,{record:r,parent:o,children:[],alias:[]});return o&&!f.record.aliasOf==!o.record.aliasOf&&o.children.push(f),f}function cq(r,o){const c=[],l=new Map;o=nP({strict:!1,end:!0,sensitive:!1},o);function f(k){return l.get(k)}function E(k,M,j){const nt=!j,rt=dq(k);rt.aliasOf=j&&j.record;const at=nP(o,k),Ot=[rt];if("alias"in k){const it=typeof k.alias=="string"?[k.alias]:k.alias;for(const Q of it)Ot.push(gn({},rt,{components:j?j.record.components:rt.components,path:Q,aliasOf:j?j.record:rt}))}let wt,dt;for(const it of Ot){const{path:Q}=it;if(M&&Q[0]!=="/"){const St=M.record.path,Ft=St[St.length-1]==="/"?"":"/";it.path=M.record.path+(Q&&Ft+Q)}if(wt=aq(it,M,at),j?j.alias.push(wt):(dt=dt||wt,dt!==wt&&dt.alias.push(wt),nt&&k.name&&!eP(wt)&&T(k.name)),rt.children){const St=rt.children;for(let Ft=0;Ft<St.length;Ft++)E(St[Ft],wt,j&&j.children[Ft])}j=j||wt,(wt.record.components&&Object.keys(wt.record.components).length||wt.record.name||wt.record.redirect)&&N(wt)}return dt?()=>{T(dt)}:hh}function T(k){if(kL(k)){const M=l.get(k);M&&(l.delete(k),c.splice(c.indexOf(M),1),M.children.forEach(T),M.alias.forEach(T))}else{const M=c.indexOf(k);M>-1&&(c.splice(M,1),k.record.name&&l.delete(k.record.name),k.children.forEach(T),k.alias.forEach(T))}}function w(){return c}function N(k){let M=0;for(;M<c.length&&iq(k,c[M])>=0&&(k.record.path!==c[M].record.path||!ML(k,c[M]));)M++;c.splice(M,0,k),k.record.name&&!eP(k)&&l.set(k.record.name,k)}function D(k,M){let j,nt={},rt,at;if("name"in k&&k.name){if(j=l.get(k.name),!j)throw Dl(1,{location:k});at=j.record.name,nt=gn(tP(M.params,j.keys.filter(dt=>!dt.optional).map(dt=>dt.name)),k.params&&tP(k.params,j.keys.map(dt=>dt.name))),rt=j.stringify(nt)}else if("path"in k)rt=k.path,j=c.find(dt=>dt.re.test(rt)),j&&(nt=j.parse(rt),at=j.record.name);else{if(j=M.name?l.get(M.name):c.find(dt=>dt.re.test(M.path)),!j)throw Dl(1,{location:k,currentLocation:M});at=j.record.name,nt=gn({},M.params,k.params),rt=j.stringify(nt)}const Ot=[];let wt=j;for(;wt;)Ot.unshift(wt.record),wt=wt.parent;return{name:at,path:rt,params:nt,matched:Ot,meta:uq(Ot)}}return r.forEach(k=>E(k)),{addRoute:E,resolve:D,removeRoute:T,getRoutes:w,getRecordMatcher:f}}function tP(r,o){const c={};for(const l of o)l in r&&(c[l]=r[l]);return c}function dq(r){return{path:r.path,redirect:r.redirect,name:r.name,meta:r.meta||{},aliasOf:void 0,beforeEnter:r.beforeEnter,props:lq(r),children:r.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in r?r.components||null:r.component&&{default:r.component}}}function lq(r){const o={},c=r.props||!1;if("component"in r)o.default=c;else for(const l in r.components)o[l]=typeof c=="object"?c[l]:c;return o}function eP(r){for(;r;){if(r.record.aliasOf)return!0;r=r.parent}return!1}function uq(r){return r.reduce((o,c)=>gn(o,c.meta),{})}function nP(r,o){const c={};for(const l in r)c[l]=l in o?o[l]:r[l];return c}function ML(r,o){return o.children.some(c=>c===r||ML(r,c))}const UL=/#/g,hq=/&/g,pq=/\//g,fq=/=/g,_q=/\?/g,xL=/\+/g,mq=/%5B/g,Eq=/%5D/g,VL=/%5E/g,gq=/%60/g,FL=/%7B/g,Sq=/%7C/g,BL=/%7D/g,Tq=/%20/g;function TR(r){return encodeURI(""+r).replace(Sq,"|").replace(mq,"[").replace(Eq,"]")}function yq(r){return TR(r).replace(FL,"{").replace(BL,"}").replace(VL,"^")}function Ey(r){return TR(r).replace(xL,"%2B").replace(Tq,"+").replace(UL,"%23").replace(hq,"%26").replace(gq,"`").replace(FL,"{").replace(BL,"}").replace(VL,"^")}function Rq(r){return Ey(r).replace(fq,"%3D")}function vq(r){return TR(r).replace(UL,"%23").replace(_q,"%3F")}function Cq(r){return r==null?"":vq(r).replace(pq,"%2F")}function U_(r){try{return decodeURIComponent(""+r)}catch{}return""+r}function Iq(r){const o={};if(r===""||r==="?")return o;const l=(r[0]==="?"?r.slice(1):r).split("&");for(let f=0;f<l.length;++f){const E=l[f].replace(xL," "),T=E.indexOf("="),w=U_(T<0?E:E.slice(0,T)),N=T<0?null:U_(E.slice(T+1));if(w in o){let D=o[w];Bs(D)||(D=o[w]=[D]),D.push(N)}else o[w]=N}return o}function iP(r){let o="";for(let c in r){const l=r[c];if(c=Rq(c),l==null){l!==void 0&&(o+=(o.length?"&":"")+c);continue}(Bs(l)?l.map(E=>E&&Ey(E)):[l&&Ey(l)]).forEach(E=>{E!==void 0&&(o+=(o.length?"&":"")+c,E!=null&&(o+="="+E))})}return o}function bq(r){const o={};for(const c in r){const l=r[c];l!==void 0&&(o[c]=Bs(l)?l.map(f=>f==null?null:""+f):l==null?l:""+l)}return o}const wq=Symbol(""),rP=Symbol(""),pm=Symbol(""),yR=Symbol(""),gy=Symbol("");function Ju(){let r=[];function o(l){return r.push(l),()=>{const f=r.indexOf(l);f>-1&&r.splice(f,1)}}function c(){r=[]}return{add:o,list:()=>r.slice(),reset:c}}function Ga(r,o,c,l,f){const E=l&&(l.enterCallbacks[f]=l.enterCallbacks[f]||[]);return()=>new Promise((T,w)=>{const N=M=>{M===!1?w(Dl(4,{from:c,to:o})):M instanceof Error?w(M):$8(M)?w(Dl(2,{from:o,to:M})):(E&&l.enterCallbacks[f]===E&&typeof M=="function"&&E.push(M),T())},D=r.call(l&&l.instances[f],o,c,N);let k=Promise.resolve(D);r.length<3&&(k=k.then(N)),k.catch(M=>w(M))})}function UT(r,o,c,l){const f=[];for(const E of r)for(const T in E.components){let w=E.components[T];if(!(o!=="beforeRouteEnter"&&!E.instances[T]))if(Aq(w)){const D=(w.__vccOpts||w)[o];D&&f.push(Ga(D,c,l,E,T))}else{let N=w();f.push(()=>N.then(D=>{if(!D)return Promise.reject(new Error(`Couldn't resolve component "${T}" at "${E.path}"`));const k=M8(D)?D.default:D;E.components[T]=k;const j=(k.__vccOpts||k)[o];return j&&Ga(j,c,l,E,T)()}))}}return f}function Aq(r){return typeof r=="object"||"displayName"in r||"props"in r||"__vccOpts"in r}function sP(r){const o=rs(pm),c=rs(yR),l=ns(()=>o.resolve(qa(r.to))),f=ns(()=>{const{matched:N}=l.value,{length:D}=N,k=N[D-1],M=c.matched;if(!k||!M.length)return-1;const j=M.findIndex(Nl.bind(null,k));if(j>-1)return j;const nt=oP(N[D-2]);return D>1&&oP(k)===nt&&M[M.length-1].path!==nt?M.findIndex(Nl.bind(null,N[D-2])):j}),E=ns(()=>f.value>-1&&Pq(c.params,l.value.params)),T=ns(()=>f.value>-1&&f.value===c.matched.length-1&&DL(c.params,l.value.params));function w(N={}){return Dq(N)?o[qa(r.replace)?"replace":"push"](qa(r.to)).catch(hh):Promise.resolve()}return{route:l,href:ns(()=>l.value.href),isActive:E,isExactActive:T,navigate:w}}const Oq=Lh({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:sP,setup(r,{slots:o}){const c=Ul(sP(r)),{options:l}=rs(pm),f=ns(()=>({[aP(r.activeClass,l.linkActiveClass,"router-link-active")]:c.isActive,[aP(r.exactActiveClass,l.linkExactActiveClass,"router-link-exact-active")]:c.isExactActive}));return()=>{const E=o.default&&o.default(c);return r.custom?E:dm("a",{"aria-current":c.isExactActive?r.ariaCurrentValue:null,href:c.href,onClick:c.navigate,class:f.value},E)}}}),Nq=Oq;function Dq(r){if(!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)&&!r.defaultPrevented&&!(r.button!==void 0&&r.button!==0)){if(r.currentTarget&&r.currentTarget.getAttribute){const o=r.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(o))return}return r.preventDefault&&r.preventDefault(),!0}}function Pq(r,o){for(const c in o){const l=o[c],f=r[c];if(typeof l=="string"){if(l!==f)return!1}else if(!Bs(f)||f.length!==l.length||l.some((E,T)=>E!==f[T]))return!1}return!0}function oP(r){return r?r.aliasOf?r.aliasOf.path:r.path:""}const aP=(r,o,c)=>r??o??c,kq=Lh({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(r,{attrs:o,slots:c}){const l=rs(gy),f=ns(()=>r.route||l.value),E=rs(rP,0),T=ns(()=>{let D=qa(E);const{matched:k}=f.value;let M;for(;(M=k[D])&&!M.components;)D++;return D}),w=ns(()=>f.value.matched[T.value]);ch(rP,ns(()=>T.value+1)),ch(wq,w),ch(gy,f);const N=Xc();return _o(()=>[N.value,w.value,r.name],([D,k,M],[j,nt,rt])=>{k&&(k.instances[M]=D,nt&&nt!==k&&D&&D===j&&(k.leaveGuards.size||(k.leaveGuards=nt.leaveGuards),k.updateGuards.size||(k.updateGuards=nt.updateGuards))),D&&k&&(!nt||!Nl(k,nt)||!j)&&(k.enterCallbacks[M]||[]).forEach(at=>at(D))},{flush:"post"}),()=>{const D=f.value,k=r.name,M=w.value,j=M&&M.components[k];if(!j)return cP(c.default,{Component:j,route:D});const nt=M.props[k],rt=nt?nt===!0?D.params:typeof nt=="function"?nt(D):nt:null,Ot=dm(j,gn({},rt,o,{onVnodeUnmounted:wt=>{wt.component.isUnmounted&&(M.instances[k]=null)},ref:N}));return cP(c.default,{Component:Ot,route:D})||Ot}}});function cP(r,o){if(!r)return null;const c=r(o);return c.length===1?c[0]:c}const Lq=kq;function n$(r){const o=cq(r.routes,r),c=r.parseQuery||Iq,l=r.stringifyQuery||iP,f=r.history,E=Ju(),T=Ju(),w=Ju(),N=tk(Va);let D=Va;hl&&r.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const k=LT.bind(null,_t=>""+_t),M=LT.bind(null,Cq),j=LT.bind(null,U_);function nt(_t,qt){let Vt,re;return kL(_t)?(Vt=o.getRecordMatcher(_t),re=qt):re=_t,o.addRoute(re,Vt)}function rt(_t){const qt=o.getRecordMatcher(_t);qt&&o.removeRoute(qt)}function at(){return o.getRoutes().map(_t=>_t.record)}function Ot(_t){return!!o.getRecordMatcher(_t)}function wt(_t,qt){if(qt=gn({},qt||N.value),typeof _t=="string"){const et=MT(c,_t,qt.path),pt=o.resolve({path:et.path},qt),Tt=f.createHref(et.fullPath);return gn(et,pt,{params:j(pt.params),hash:U_(et.hash),redirectedFrom:void 0,href:Tt})}let Vt;if("path"in _t)Vt=gn({},_t,{path:MT(c,_t.path,qt.path).path});else{const et=gn({},_t.params);for(const pt in et)et[pt]==null&&delete et[pt];Vt=gn({},_t,{params:M(et)}),qt.params=M(qt.params)}const re=o.resolve(Vt,qt),$e=_t.hash||"";re.params=k(j(re.params));const H=V8(l,gn({},_t,{hash:yq($e),path:re.path})),K=f.createHref(H);return gn({fullPath:H,hash:$e,query:l===iP?bq(_t.query):_t.query||{}},re,{redirectedFrom:void 0,href:K})}function dt(_t){return typeof _t=="string"?MT(c,_t,N.value.path):gn({},_t)}function it(_t,qt){if(D!==_t)return Dl(8,{from:qt,to:_t})}function Q(_t){return jt(_t)}function St(_t){return Q(gn(dt(_t),{replace:!0}))}function Ft(_t){const qt=_t.matched[_t.matched.length-1];if(qt&&qt.redirect){const{redirect:Vt}=qt;let re=typeof Vt=="function"?Vt(_t):Vt;return typeof re=="string"&&(re=re.includes("?")||re.includes("#")?re=dt(re):{path:re},re.params={}),gn({query:_t.query,hash:_t.hash,params:"path"in re?{}:_t.params},re)}}function jt(_t,qt){const Vt=D=wt(_t),re=N.value,$e=_t.state,H=_t.force,K=_t.replace===!0,et=Ft(Vt);if(et)return jt(gn(dt(et),{state:typeof et=="object"?gn({},$e,et.state):$e,force:H,replace:K}),qt||Vt);const pt=Vt;pt.redirectedFrom=qt;let Tt;return!H&&F8(l,re,Vt)&&(Tt=Dl(16,{to:pt,from:re}),Vr(re,re,!0,!1)),(Tt?Promise.resolve(Tt):xt(pt,re)).catch(Rt=>Bo(Rt)?Bo(Rt,2)?Rt:ws(Rt):ee(Rt,pt,re)).then(Rt=>{if(Rt){if(Bo(Rt,2))return jt(gn({replace:K},dt(Rt.to),{state:typeof Rt.to=="object"?gn({},$e,Rt.to.state):$e,force:H}),qt||pt)}else Rt=Mt(pt,re,!0,K,$e);return ae(pt,re,Rt),Rt})}function At(_t,qt){const Vt=it(_t,qt);return Vt?Promise.reject(Vt):Promise.resolve()}function Wt(_t){const qt=Co.values().next().value;return qt&&typeof qt.runWithContext=="function"?qt.runWithContext(_t):_t()}function xt(_t,qt){let Vt;const[re,$e,H]=Mq(_t,qt);Vt=UT(re.reverse(),"beforeRouteLeave",_t,qt);for(const et of re)et.leaveGuards.forEach(pt=>{Vt.push(Ga(pt,_t,qt))});const K=At.bind(null,_t,qt);return Vt.push(K),Ii(Vt).then(()=>{Vt=[];for(const et of E.list())Vt.push(Ga(et,_t,qt));return Vt.push(K),Ii(Vt)}).then(()=>{Vt=UT($e,"beforeRouteUpdate",_t,qt);for(const et of $e)et.updateGuards.forEach(pt=>{Vt.push(Ga(pt,_t,qt))});return Vt.push(K),Ii(Vt)}).then(()=>{Vt=[];for(const et of H)if(et.beforeEnter)if(Bs(et.beforeEnter))for(const pt of et.beforeEnter)Vt.push(Ga(pt,_t,qt));else Vt.push(Ga(et.beforeEnter,_t,qt));return Vt.push(K),Ii(Vt)}).then(()=>(_t.matched.forEach(et=>et.enterCallbacks={}),Vt=UT(H,"beforeRouteEnter",_t,qt),Vt.push(K),Ii(Vt))).then(()=>{Vt=[];for(const et of T.list())Vt.push(Ga(et,_t,qt));return Vt.push(K),Ii(Vt)}).catch(et=>Bo(et,8)?et:Promise.reject(et))}function ae(_t,qt,Vt){w.list().forEach(re=>Wt(()=>re(_t,qt,Vt)))}function Mt(_t,qt,Vt,re,$e){const H=it(_t,qt);if(H)return H;const K=qt===Va,et=hl?history.state:{};Vt&&(re||K?f.replace(_t.fullPath,gn({scroll:K&&et&&et.scroll},$e)):f.push(_t.fullPath,$e)),N.value=_t,Vr(_t,qt,Vt,K),ws()}let fe;function _n(){fe||(fe=f.listen((_t,qt,Vt)=>{if(!nc.listening)return;const re=wt(_t),$e=Ft(re);if($e){jt(gn($e,{replace:!0}),re).catch(hh);return}D=re;const H=N.value;hl&&q8(JD(H.fullPath,Vt.delta),hm()),xt(re,H).catch(K=>Bo(K,12)?K:Bo(K,2)?(jt(K.to,re).then(et=>{Bo(et,20)&&!Vt.delta&&Vt.type===Ch.pop&&f.go(-1,!1)}).catch(hh),Promise.reject()):(Vt.delta&&f.go(-Vt.delta,!1),ee(K,re,H))).then(K=>{K=K||Mt(re,H,!1),K&&(Vt.delta&&!Bo(K,8)?f.go(-Vt.delta,!1):Vt.type===Ch.pop&&Bo(K,20)&&f.go(-1,!1)),ae(re,H,K)}).catch(hh)}))}let ln=Ju(),Zt=Ju(),be;function ee(_t,qt,Vt){ws(_t);const re=Zt.list();return re.length?re.forEach($e=>$e(_t,qt,Vt)):console.error(_t),Promise.reject(_t)}function fr(){return be&&N.value!==Va?Promise.resolve():new Promise((_t,qt)=>{ln.add([_t,qt])})}function ws(_t){return be||(be=!_t,_n(),ln.list().forEach(([qt,Vt])=>_t?Vt(_t):qt()),ln.reset()),_t}function Vr(_t,qt,Vt,re){const{scrollBehavior:$e}=r;if(!hl||!$e)return Promise.resolve();const H=!Vt&&z8(JD(_t.fullPath,0))||(re||!Vt)&&history.state&&history.state.scroll||null;return Q_().then(()=>$e(_t,qt,H)).then(K=>K&&K8(K)).catch(K=>ee(K,_t,qt))}const Vi=_t=>f.go(_t);let vo;const Co=new Set,nc={currentRoute:N,listening:!0,addRoute:nt,removeRoute:rt,hasRoute:Ot,getRoutes:at,resolve:wt,options:r,push:Q,replace:St,go:Vi,back:()=>Vi(-1),forward:()=>Vi(1),beforeEach:E.add,beforeResolve:T.add,afterEach:w.add,onError:Zt.add,isReady:fr,install(_t){const qt=this;_t.component("RouterLink",Nq),_t.component("RouterView",Lq),_t.config.globalProperties.$router=qt,Object.defineProperty(_t.config.globalProperties,"$route",{enumerable:!0,get:()=>qa(N)}),hl&&!vo&&N.value===Va&&(vo=!0,Q(f.location).catch($e=>{}));const Vt={};for(const $e in Va)Object.defineProperty(Vt,$e,{get:()=>N.value[$e],enumerable:!0});_t.provide(pm,qt),_t.provide(yR,Hy(Vt)),_t.provide(gy,N);const re=_t.unmount;Co.add(_t),_t.unmount=function(){Co.delete(_t),Co.size<1&&(D=Va,fe&&fe(),fe=null,N.value=Va,vo=!1,be=!1),re()}}};function Ii(_t){return _t.reduce((qt,Vt)=>qt.then(()=>Wt(Vt)),Promise.resolve())}return nc}function Mq(r,o){const c=[],l=[],f=[],E=Math.max(o.matched.length,r.matched.length);for(let T=0;T<E;T++){const w=o.matched[T];w&&(r.matched.find(D=>Nl(D,w))?l.push(w):c.push(w));const N=r.matched[T];N&&(o.matched.find(D=>Nl(D,N))||f.push(N))}return[c,l,f]}function i$(){return rs(pm)}function r$(){return rs(yR)}var xT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Uq(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function s$(r){if(r.__esModule)return r;var o=r.default;if(typeof o=="function"){var c=function l(){return this instanceof l?Reflect.construct(o,arguments,this.constructor):o.apply(this,arguments)};c.prototype=o.prototype}else c={};return Object.defineProperty(c,"__esModule",{value:!0}),Object.keys(r).forEach(function(l){var f=Object.getOwnPropertyDescriptor(r,l);Object.defineProperty(c,l,f.get?f:{enumerable:!0,get:function(){return r[l]}})}),c}var jL={exports:{}};(function(r,o){(function(c,l){r.exports=l()})(xT,function(){function c(n,t){return t.forEach(function(e){e&&typeof e!="string"&&!Array.isArray(e)&&Object.keys(e).forEach(function(i){if(i!=="default"&&!(i in n)){var s=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:function(){return e[i]}})}})}),Object.freeze(n)}let l=!0,f=!0;function E(n,t,e){const i=n.match(t);return i&&i.length>=e&&parseInt(i[e],10)}function T(n,t,e){if(!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype,s=i.addEventListener;i.addEventListener=function(d,u){if(d!==t)return s.apply(this,arguments);const h=p=>{const _=e(p);_&&(u.handleEvent?u.handleEvent(_):u(_))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(u,h),s.apply(this,[d,h])};const a=i.removeEventListener;i.removeEventListener=function(d,u){if(d!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(u))return a.apply(this,arguments);const h=this._eventMap[t].get(u);return this._eventMap[t].delete(u),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,a.apply(this,[d,h])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(d){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),d&&this.addEventListener(t,this["_on"+t]=d)},enumerable:!0,configurable:!0})}function w(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(l=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function N(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(f=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function D(){if(typeof window=="object"){if(l)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function k(n,t){f&&console.warn(n+" is deprecated, please use "+t+" instead.")}function M(n){return Object.prototype.toString.call(n)==="[object Object]"}function j(n){return M(n)?Object.keys(n).reduce(function(t,e){const i=M(n[e]),s=i?j(n[e]):n[e],a=i&&!Object.keys(s).length;return s===void 0||a?t:Object.assign(t,{[e]:s})},{}):n}function nt(n,t,e){t&&!e.has(t.id)&&(e.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?nt(n,n.get(t[i]),e):i.endsWith("Ids")&&t[i].forEach(s=>{nt(n,n.get(s),e)})}))}function rt(n,t,e){const i=e?"outbound-rtp":"inbound-rtp",s=new Map;if(t===null)return s;const a=[];return n.forEach(d=>{d.type==="track"&&d.trackIdentifier===t.id&&a.push(d)}),a.forEach(d=>{n.forEach(u=>{u.type===i&&u.trackId===d.id&&nt(n,u,s)})}),s}const at=D;function Ot(n,t){const e=n&&n.navigator;if(!e.mediaDevices)return;const i=function(d){if(typeof d!="object"||d.mandatory||d.optional)return d;const u={};return Object.keys(d).forEach(h=>{if(h==="require"||h==="advanced"||h==="mediaSource")return;const p=typeof d[h]=="object"?d[h]:{ideal:d[h]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);const _=function(m,S){return m?m+S.charAt(0).toUpperCase()+S.slice(1):S==="deviceId"?"sourceId":S};if(p.ideal!==void 0){u.optional=u.optional||[];let m={};typeof p.ideal=="number"?(m[_("min",h)]=p.ideal,u.optional.push(m),m={},m[_("max",h)]=p.ideal,u.optional.push(m)):(m[_("",h)]=p.ideal,u.optional.push(m))}p.exact!==void 0&&typeof p.exact!="number"?(u.mandatory=u.mandatory||{},u.mandatory[_("",h)]=p.exact):["min","max"].forEach(m=>{p[m]!==void 0&&(u.mandatory=u.mandatory||{},u.mandatory[_(m,h)]=p[m])})}),d.advanced&&(u.optional=(u.optional||[]).concat(d.advanced)),u},s=function(d,u){if(t.version>=61)return u(d);if((d=JSON.parse(JSON.stringify(d)))&&typeof d.audio=="object"){const h=function(p,_,m){_ in p&&!(m in p)&&(p[m]=p[_],delete p[_])};h((d=JSON.parse(JSON.stringify(d))).audio,"autoGainControl","googAutoGainControl"),h(d.audio,"noiseSuppression","googNoiseSuppression"),d.audio=i(d.audio)}if(d&&typeof d.video=="object"){let h=d.video.facingMode;h=h&&(typeof h=="object"?h:{ideal:h});const p=t.version<66;if(h&&(h.exact==="user"||h.exact==="environment"||h.ideal==="user"||h.ideal==="environment")&&(!e.mediaDevices.getSupportedConstraints||!e.mediaDevices.getSupportedConstraints().facingMode||p)){let _;if(delete d.video.facingMode,h.exact==="environment"||h.ideal==="environment"?_=["back","rear"]:h.exact!=="user"&&h.ideal!=="user"||(_=["front"]),_)return e.mediaDevices.enumerateDevices().then(m=>{let S=(m=m.filter(y=>y.kind==="videoinput")).find(y=>_.some(b=>y.label.toLowerCase().includes(b)));return!S&&m.length&&_.includes("back")&&(S=m[m.length-1]),S&&(d.video.deviceId=h.exact?{exact:S.deviceId}:{ideal:S.deviceId}),d.video=i(d.video),at("chrome: "+JSON.stringify(d)),u(d)})}d.video=i(d.video)}return at("chrome: "+JSON.stringify(d)),u(d)},a=function(d){return t.version>=64?d:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[d.name]||d.name,message:d.message,constraint:d.constraint||d.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(e.getUserMedia=(function(d,u,h){s(d,p=>{e.webkitGetUserMedia(p,u,_=>{h&&h(a(_))})})}).bind(e),e.mediaDevices.getUserMedia){const d=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(u){return s(u,h=>d(h).then(p=>{if(h.audio&&!p.getAudioTracks().length||h.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(_=>{_.stop()}),new DOMException("","NotFoundError");return p},p=>Promise.reject(a(p))))}}}function wt(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function dt(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=e=>{e.stream.addEventListener("addtrack",i=>{let s;s=n.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(d=>d.track&&d.track.id===i.track.id):{track:i.track};const a=new Event("track");a.track=i.track,a.receiver=s,a.transceiver={receiver:s},a.streams=[e.stream],this.dispatchEvent(a)}),e.stream.getTracks().forEach(i=>{let s;s=n.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(d=>d.track&&d.track.id===i.id):{track:i};const a=new Event("track");a.track=i,a.receiver=s,a.transceiver={receiver:s},a.streams=[e.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else T(n,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function it(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const t=function(s,a){return{track:a,get dtmf(){return this._dtmf===void 0&&(a.kind==="audio"?this._dtmf=s.createDTMFSender(a):this._dtmf=null),this._dtmf},_pc:s}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(d,u){let h=s.apply(this,arguments);return h||(h=t(this,d),this._senders.push(h)),h};const a=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(d){a.apply(this,arguments);const u=this._senders.indexOf(d);u!==-1&&this._senders.splice(u,1)}}const e=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],e.apply(this,[s]),s.getTracks().forEach(a=>{this._senders.push(t(this,a))})};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(a=>{const d=this._senders.find(u=>u.track===a);d&&this._senders.splice(this._senders.indexOf(d),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(i=>i._pc=this),e},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Q(n){if(!n.RTCPeerConnection)return;const t=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[e,i,s]=arguments;if(arguments.length>0&&typeof e=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof e!="function"))return t.apply(this,[]);const a=function(u){const h={};return u.result().forEach(p=>{const _={id:p.id,timestamp:p.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[p.type]||p.type};p.names().forEach(m=>{_[m]=p.stat(m)}),h[_.id]=_}),h},d=function(u){return new Map(Object.keys(u).map(h=>[h,u[h]]))};if(arguments.length>=2){const u=function(h){i(d(a(h)))};return t.apply(this,[u,e])}return new Promise((u,h)=>{t.apply(this,[function(p){u(d(a(p)))},h])}).then(i,s)}}function St(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(a=>a._pc=this),s});const i=n.RTCPeerConnection.prototype.addTrack;i&&(n.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),n.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(a=>rt(a,s.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i}),T(n,"track",i=>(i.receiver._pc=i.srcElement,i)),n.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>rt(s,i.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype)||!("getStats"in n.RTCRtpReceiver.prototype))return;const t=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const e=arguments[0];let i,s,a;return this.getSenders().forEach(d=>{d.track===e&&(i?a=!0:i=d)}),this.getReceivers().forEach(d=>(d.track===e&&(s?a=!0:s=d),d.track===e)),a||i&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Ft(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const t=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,d){if(!d)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const u=t.apply(this,arguments);return this._shimmedLocalStreams[d.id]?this._shimmedLocalStreams[d.id].indexOf(u)===-1&&this._shimmedLocalStreams[d.id].push(u):this._shimmedLocalStreams[d.id]=[d,u],u};const e=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(h=>{if(this.getSenders().find(p=>p.track===h))throw new DOMException("Track already exists.","InvalidAccessError")});const d=this.getSenders();e.apply(this,arguments);const u=this.getSenders().filter(h=>d.indexOf(h)===-1);this._shimmedLocalStreams[a.id]=[a].concat(u)};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],i.apply(this,arguments)};const s=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(d=>{const u=this._shimmedLocalStreams[d].indexOf(a);u!==-1&&this._shimmedLocalStreams[d].splice(u,1),this._shimmedLocalStreams[d].length===1&&delete this._shimmedLocalStreams[d]}),s.apply(this,arguments)}}function jt(n,t){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Ft(n);const e=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const h=e.apply(this);return this._reverseStreams=this._reverseStreams||{},h.map(p=>this._reverseStreams[p.id])};const i=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(h){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},h.getTracks().forEach(p=>{if(this.getSenders().find(_=>_.track===p))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[h.id]){const p=new n.MediaStream(h.getTracks());this._streams[h.id]=p,this._reverseStreams[p.id]=h,h=p}i.apply(this,[h])};const s=n.RTCPeerConnection.prototype.removeStream;function a(h,p){let _=p.sdp;return Object.keys(h._reverseStreams||[]).forEach(m=>{const S=h._reverseStreams[m],y=h._streams[S.id];_=_.replace(new RegExp(y.id,"g"),S.id)}),new RTCSessionDescription({type:p.type,sdp:_})}n.RTCPeerConnection.prototype.removeStream=function(h){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[h.id]||h]),delete this._reverseStreams[this._streams[h.id]?this._streams[h.id].id:h.id],delete this._streams[h.id]},n.RTCPeerConnection.prototype.addTrack=function(h,p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const _=[].slice.call(arguments,1);if(_.length!==1||!_[0].getTracks().find(S=>S===h))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(S=>S.track===h))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const m=this._streams[p.id];if(m)m.addTrack(h),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const S=new n.MediaStream([h]);this._streams[p.id]=S,this._reverseStreams[S.id]=p,this.addStream(S)}return this.getSenders().find(S=>S.track===h)},["createOffer","createAnswer"].forEach(function(h){const p=n.RTCPeerConnection.prototype[h],_={[h](){const m=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[S=>{const y=a(this,S);m[0].apply(null,[y])},S=>{m[1]&&m[1].apply(null,S)},arguments[2]]):p.apply(this,arguments).then(S=>a(this,S))}};n.RTCPeerConnection.prototype[h]=_[h]});const d=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(h,p){let _=p.sdp;return Object.keys(h._reverseStreams||[]).forEach(m=>{const S=h._reverseStreams[m],y=h._streams[S.id];_=_.replace(new RegExp(S.id,"g"),y.id)}),new RTCSessionDescription({type:p.type,sdp:_})}(this,arguments[0]),d.apply(this,arguments)):d.apply(this,arguments)};const u=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const h=u.get.apply(this);return h.type===""?h:a(this,h)}}),n.RTCPeerConnection.prototype.removeTrack=function(h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!h._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(h._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let p;this._streams=this._streams||{},Object.keys(this._streams).forEach(_=>{this._streams[_].getTracks().find(m=>h.track===m)&&(p=this._streams[_])}),p&&(p.getTracks().length===1?this.removeStream(this._reverseStreams[p.id]):p.removeTrack(h.track),this.dispatchEvent(new Event("negotiationneeded")))}}function At(n,t){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){const i=n.RTCPeerConnection.prototype[e],s={[e](){return arguments[0]=new(e==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};n.RTCPeerConnection.prototype[e]=s[e]})}function Wt(n,t){T(n,"negotiationneeded",e=>{const i=e.target;if(!(t.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return e})}var xt=Object.freeze({__proto__:null,fixNegotiationNeeded:Wt,shimAddTrackRemoveTrack:jt,shimAddTrackRemoveTrackWithNative:Ft,shimGetDisplayMedia:function(n,t){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(typeof t=="function"?n.navigator.mediaDevices.getDisplayMedia=function(e){return t(e).then(i=>{const s=e.video&&e.video.width,a=e.video&&e.video.height,d=e.video&&e.video.frameRate;return e.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:d||3}},s&&(e.video.mandatory.maxWidth=s),a&&(e.video.mandatory.maxHeight=a),n.navigator.mediaDevices.getUserMedia(e)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:it,shimGetStats:Q,shimGetUserMedia:Ot,shimMediaStream:wt,shimOnTrack:dt,shimPeerConnection:At,shimSenderReceiverGetStats:St});function ae(n,t){const e=n&&n.navigator,i=n&&n.MediaStreamTrack;if(e.getUserMedia=function(s,a,d){k("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),e.mediaDevices.getUserMedia(s).then(a,d)},!(t.version>55&&"autoGainControl"in e.mediaDevices.getSupportedConstraints())){const s=function(d,u,h){u in d&&!(h in d)&&(d[h]=d[u],delete d[u])},a=e.mediaDevices.getUserMedia.bind(e.mediaDevices);if(e.mediaDevices.getUserMedia=function(d){return typeof d=="object"&&typeof d.audio=="object"&&(d=JSON.parse(JSON.stringify(d)),s(d.audio,"autoGainControl","mozAutoGainControl"),s(d.audio,"noiseSuppression","mozNoiseSuppression")),a(d)},i&&i.prototype.getSettings){const d=i.prototype.getSettings;i.prototype.getSettings=function(){const u=d.apply(this,arguments);return s(u,"mozAutoGainControl","autoGainControl"),s(u,"mozNoiseSuppression","noiseSuppression"),u}}if(i&&i.prototype.applyConstraints){const d=i.prototype.applyConstraints;i.prototype.applyConstraints=function(u){return this.kind==="audio"&&typeof u=="object"&&(u=JSON.parse(JSON.stringify(u)),s(u,"autoGainControl","mozAutoGainControl"),s(u,"noiseSuppression","mozNoiseSuppression")),d.apply(this,[u])}}}}function Mt(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function fe(n,t){if(typeof n!="object"||!n.RTCPeerConnection&&!n.mozRTCPeerConnection)return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const a=n.RTCPeerConnection.prototype[s],d={[s](){return arguments[0]=new(s==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};n.RTCPeerConnection.prototype[s]=d[s]});const e={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[s,a,d]=arguments;return i.apply(this,[s||null]).then(u=>{if(t.version<53&&!a)try{u.forEach(h=>{h.type=e[h.type]||h.type})}catch(h){if(h.name!=="TypeError")throw h;u.forEach((p,_)=>{u.set(_,Object.assign({},p,{type:e[p.type]||p.type}))})}return u}).then(a,d)}}function _n(n){if(typeof n!="object"||!n.RTCPeerConnection||!n.RTCRtpSender||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(s=>s._pc=this),i});const e=n.RTCPeerConnection.prototype.addTrack;e&&(n.RTCPeerConnection.prototype.addTrack=function(){const i=e.apply(this,arguments);return i._pc=this,i}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function ln(n){if(typeof n!="object"||!n.RTCPeerConnection||!n.RTCRtpSender||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(i=>i._pc=this),e}),T(n,"track",e=>(e.receiver._pc=e.srcElement,e)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Zt(n){n.RTCPeerConnection&&!("removeStream"in n.RTCPeerConnection.prototype)&&(n.RTCPeerConnection.prototype.removeStream=function(t){k("removeStream","removeTrack"),this.getSenders().forEach(e=>{e.track&&t.getTracks().includes(e.track)&&this.removeTrack(e)})})}function be(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function ee(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const t=n.RTCPeerConnection.prototype.addTransceiver;t&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;e===void 0&&(e=[]),e=[...e];const i=e.length>0;i&&e.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=t.apply(this,arguments);if(i){const{sender:a}=s,d=a.getParameters();(!("encodings"in d)||d.encodings.length===1&&Object.keys(d.encodings[0]).length===0)&&(d.encodings=e,a.sendEncodings=e,this.setParametersPromises.push(a.setParameters(d).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return s})}function fr(n){if(typeof n!="object"||!n.RTCRtpSender)return;const t=n.RTCRtpSender.prototype.getParameters;t&&(n.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function ws(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const t=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function Vr(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const t=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var Vi=Object.freeze({__proto__:null,shimAddTransceiver:ee,shimCreateAnswer:Vr,shimCreateOffer:ws,shimGetDisplayMedia:function(n,t){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(e){if(!e||!e.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return e.video===!0?e.video={mediaSource:t}:e.video.mediaSource=t,n.navigator.mediaDevices.getUserMedia(e)})},shimGetParameters:fr,shimGetUserMedia:ae,shimOnTrack:Mt,shimPeerConnection:fe,shimRTCDataChannel:be,shimReceiverGetStats:ln,shimRemoveStream:Zt,shimSenderGetStats:_n});function vo(n){if(typeof n=="object"&&n.RTCPeerConnection){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const t=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(i=>t.call(this,i,e)),e.getVideoTracks().forEach(i=>t.call(this,i,e))},n.RTCPeerConnection.prototype.addTrack=function(e,...i){return i&&i.forEach(s=>{this._localStreams?this._localStreams.includes(s)||this._localStreams.push(s):this._localStreams=[s]}),t.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const e=this._localStreams.indexOf(t);if(e===-1)return;this._localStreams.splice(e,1);const i=t.getTracks();this.getSenders().forEach(s=>{i.includes(s.track)&&this.removeTrack(s)})})}}function Co(n){if(typeof n=="object"&&n.RTCPeerConnection&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const a=new Event("addstream");a.stream=s,this.dispatchEvent(a)})})}});const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(s=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(s)>=0)return;e._remoteStreams.push(s);const a=new Event("addstream");a.stream=s,e.dispatchEvent(a)})}),t.apply(e,arguments)}}}function nc(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const t=n.RTCPeerConnection.prototype,e=t.createOffer,i=t.createAnswer,s=t.setLocalDescription,a=t.setRemoteDescription,d=t.addIceCandidate;t.createOffer=function(h,p){const _=arguments.length>=2?arguments[2]:arguments[0],m=e.apply(this,[_]);return p?(m.then(h,p),Promise.resolve()):m},t.createAnswer=function(h,p){const _=arguments.length>=2?arguments[2]:arguments[0],m=i.apply(this,[_]);return p?(m.then(h,p),Promise.resolve()):m};let u=function(h,p,_){const m=s.apply(this,[h]);return _?(m.then(p,_),Promise.resolve()):m};t.setLocalDescription=u,u=function(h,p,_){const m=a.apply(this,[h]);return _?(m.then(p,_),Promise.resolve()):m},t.setRemoteDescription=u,u=function(h,p,_){const m=d.apply(this,[h]);return _?(m.then(p,_),Promise.resolve()):m},t.addIceCandidate=u}function Ii(n){const t=n&&n.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,i=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=s=>i(_t(s))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(e,i,s){t.mediaDevices.getUserMedia(e).then(i,s)}).bind(t))}function _t(n){return n&&n.video!==void 0?Object.assign({},n,{video:j(n.video)}):n}function qt(n){if(!n.RTCPeerConnection)return;const t=n.RTCPeerConnection;n.RTCPeerConnection=function(e,i){if(e&&e.iceServers){const s=[];for(let a=0;a<e.iceServers.length;a++){let d=e.iceServers[a];!d.hasOwnProperty("urls")&&d.hasOwnProperty("url")?(k("RTCIceServer.url","RTCIceServer.urls"),d=JSON.parse(JSON.stringify(d)),d.urls=d.url,delete d.url,s.push(d)):s.push(e.iceServers[a])}e.iceServers=s}return new t(e,i)},n.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Vt(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function re(n){const t=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(e){if(e){e.offerToReceiveAudio!==void 0&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const i=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");e.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):e.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),e.offerToReceiveVideo!==void 0&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const s=this.getTransceivers().find(a=>a.receiver.track.kind==="video");e.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):e.offerToReceiveVideo!==!0||s||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function $e(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}var H=Object.freeze({__proto__:null,shimAudioContext:$e,shimCallbacksAPI:nc,shimConstraints:_t,shimCreateOfferLegacy:re,shimGetUserMedia:Ii,shimLocalStreamsAPI:vo,shimRTCIceServerUrls:qt,shimRemoteStreamsAPI:Co,shimTrackEventTransceiver:Vt}),K=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof xT<"u"?xT:typeof self<"u"?self:{};function et(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var pt={exports:{}};(function(n){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split(`
`).map(i=>i.trim())},t.splitSections=function(e){return e.split(`
m=`).map((i,s)=>(s>0?"m="+i:i).trim()+`\r
`)},t.getDescription=function(e){const i=t.splitSections(e);return i&&i[0]},t.getMediaSections=function(e){const i=t.splitSections(e);return i.shift(),i},t.matchPrefix=function(e,i){return t.splitLines(e).filter(s=>s.indexOf(i)===0)},t.parseCandidate=function(e){let i;i=e.indexOf("a=candidate:")===0?e.substring(12).split(" "):e.substring(10).split(" ");const s={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let a=8;a<i.length;a+=2)switch(i[a]){case"raddr":s.relatedAddress=i[a+1];break;case"rport":s.relatedPort=parseInt(i[a+1],10);break;case"tcptype":s.tcpType=i[a+1];break;case"ufrag":s.ufrag=i[a+1],s.usernameFragment=i[a+1];break;default:s[i[a]]===void 0&&(s[i[a]]=i[a+1])}return s},t.writeCandidate=function(e){const i=[];i.push(e.foundation);const s=e.component;s==="rtp"?i.push(1):s==="rtcp"?i.push(2):i.push(s),i.push(e.protocol.toUpperCase()),i.push(e.priority),i.push(e.address||e.ip),i.push(e.port);const a=e.type;return i.push("typ"),i.push(a),a!=="host"&&e.relatedAddress&&e.relatedPort&&(i.push("raddr"),i.push(e.relatedAddress),i.push("rport"),i.push(e.relatedPort)),e.tcpType&&e.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(i.push("ufrag"),i.push(e.usernameFragment||e.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let i=e.substring(9).split(" ");const s={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),s.name=i[0],s.clockRate=parseInt(i[1],10),s.channels=i.length===3?parseInt(i[2],10):1,s.numChannels=s.channels,s},t.writeRtpMap=function(e){let i=e.payloadType;e.preferredPayloadType!==void 0&&(i=e.preferredPayloadType);const s=e.channels||e.numChannels||1;return"a=rtpmap:"+i+" "+e.name+"/"+e.clockRate+(s!==1?"/"+s:"")+`\r
`},t.parseExtmap=function(e){const i=e.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&e.direction!=="sendrecv"?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+`\r
`},t.parseFmtp=function(e){const i={};let s;const a=e.substring(e.indexOf(" ")+1).split(";");for(let d=0;d<a.length;d++)s=a[d].trim().split("="),i[s[0].trim()]=s[1];return i},t.writeFmtp=function(e){let i="",s=e.payloadType;if(e.preferredPayloadType!==void 0&&(s=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const a=[];Object.keys(e.parameters).forEach(d=>{e.parameters[d]!==void 0?a.push(d+"="+e.parameters[d]):a.push(d)}),i+="a=fmtp:"+s+" "+a.join(";")+`\r
`}return i},t.parseRtcpFb=function(e){const i=e.substring(e.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(e){let i="",s=e.payloadType;return e.preferredPayloadType!==void 0&&(s=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(a=>{i+="a=rtcp-fb:"+s+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+`\r
`}),i},t.parseSsrcMedia=function(e){const i=e.indexOf(" "),s={ssrc:parseInt(e.substring(7,i),10)},a=e.indexOf(":",i);return a>-1?(s.attribute=e.substring(i+1,a),s.value=e.substring(a+1)):s.attribute=e.substring(i+1),s},t.parseSsrcGroup=function(e){const i=e.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(s=>parseInt(s,10))}},t.getMid=function(e){const i=t.matchPrefix(e,"a=mid:")[0];if(i)return i.substring(6)},t.parseFingerprint=function(e){const i=e.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},t.getDtlsParameters=function(e,i){return{role:"auto",fingerprints:t.matchPrefix(e+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,i){let s="a=setup:"+i+`\r
`;return e.fingerprints.forEach(a=>{s+="a=fingerprint:"+a.algorithm+" "+a.value+`\r
`}),s},t.parseCryptoLine=function(e){const i=e.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+(typeof e.keyParams=="object"?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(e){if(e.indexOf("inline:")!==0)return null;const i=e.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,i){return t.matchPrefix(e+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,i){const s=t.matchPrefix(e+i,"a=ice-ufrag:")[0],a=t.matchPrefix(e+i,"a=ice-pwd:")[0];return s&&a?{usernameFragment:s.substring(12),password:a.substring(10)}:null},t.writeIceParameters=function(e){let i="a=ice-ufrag:"+e.usernameFragment+`\r
a=ice-pwd:`+e.password+`\r
`;return e.iceLite&&(i+=`a=ice-lite\r
`),i},t.parseRtpParameters=function(e){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=t.splitLines(e)[0].split(" ");i.profile=s[2];for(let d=3;d<s.length;d++){const u=s[d],h=t.matchPrefix(e,"a=rtpmap:"+u+" ")[0];if(h){const p=t.parseRtpMap(h),_=t.matchPrefix(e,"a=fmtp:"+u+" ");switch(p.parameters=_.length?t.parseFmtp(_[0]):{},p.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+u+" ").map(t.parseRtcpFb),i.codecs.push(p),p.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(p.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach(d=>{i.headerExtensions.push(t.parseExtmap(d))});const a=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return i.codecs.forEach(d=>{a.forEach(u=>{d.rtcpFeedback.find(h=>h.type===u.type&&h.parameter===u.parameter)||d.rtcpFeedback.push(u)})}),i},t.writeRtpDescription=function(e,i){let s="";s+="m="+e+" ",s+=i.codecs.length>0?"9":"0",s+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=i.codecs.map(d=>d.preferredPayloadType!==void 0?d.preferredPayloadType:d.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(d=>{s+=t.writeRtpMap(d),s+=t.writeFmtp(d),s+=t.writeRtcpFb(d)});let a=0;return i.codecs.forEach(d=>{d.maxptime>a&&(a=d.maxptime)}),a>0&&(s+="a=maxptime:"+a+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(d=>{s+=t.writeExtmap(d)}),s},t.parseRtpEncodingParameters=function(e){const i=[],s=t.parseRtpParameters(e),a=s.fecMechanisms.indexOf("RED")!==-1,d=s.fecMechanisms.indexOf("ULPFEC")!==-1,u=t.matchPrefix(e,"a=ssrc:").map(S=>t.parseSsrcMedia(S)).filter(S=>S.attribute==="cname"),h=u.length>0&&u[0].ssrc;let p;const _=t.matchPrefix(e,"a=ssrc-group:FID").map(S=>S.substring(17).split(" ").map(y=>parseInt(y,10)));_.length>0&&_[0].length>1&&_[0][0]===h&&(p=_[0][1]),s.codecs.forEach(S=>{if(S.name.toUpperCase()==="RTX"&&S.parameters.apt){let y={ssrc:h,codecPayloadType:parseInt(S.parameters.apt,10)};h&&p&&(y.rtx={ssrc:p}),i.push(y),a&&(y=JSON.parse(JSON.stringify(y)),y.fec={ssrc:h,mechanism:d?"red+ulpfec":"red"},i.push(y))}}),i.length===0&&h&&i.push({ssrc:h});let m=t.matchPrefix(e,"b=");return m.length&&(m=m[0].indexOf("b=TIAS:")===0?parseInt(m[0].substring(7),10):m[0].indexOf("b=AS:")===0?1e3*parseInt(m[0].substring(5),10)*.95-16e3:void 0,i.forEach(S=>{S.maxBitrate=m})),i},t.parseRtcpParameters=function(e){const i={},s=t.matchPrefix(e,"a=ssrc:").map(u=>t.parseSsrcMedia(u)).filter(u=>u.attribute==="cname")[0];s&&(i.cname=s.value,i.ssrc=s.ssrc);const a=t.matchPrefix(e,"a=rtcp-rsize");i.reducedSize=a.length>0,i.compound=a.length===0;const d=t.matchPrefix(e,"a=rtcp-mux");return i.mux=d.length>0,i},t.writeRtcpParameters=function(e){let i="";return e.reducedSize&&(i+=`a=rtcp-rsize\r
`),e.mux&&(i+=`a=rtcp-mux\r
`),e.ssrc!==void 0&&e.cname&&(i+="a=ssrc:"+e.ssrc+" cname:"+e.cname+`\r
`),i},t.parseMsid=function(e){let i;const s=t.matchPrefix(e,"a=msid:");if(s.length===1)return i=s[0].substring(7).split(" "),{stream:i[0],track:i[1]};const a=t.matchPrefix(e,"a=ssrc:").map(d=>t.parseSsrcMedia(d)).filter(d=>d.attribute==="msid");return a.length>0?(i=a[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},t.parseSctpDescription=function(e){const i=t.parseMLine(e),s=t.matchPrefix(e,"a=max-message-size:");let a;s.length>0&&(a=parseInt(s[0].substring(19),10)),isNaN(a)&&(a=65536);const d=t.matchPrefix(e,"a=sctp-port:");if(d.length>0)return{port:parseInt(d[0].substring(12),10),protocol:i.fmt,maxMessageSize:a};const u=t.matchPrefix(e,"a=sctpmap:");if(u.length>0){const h=u[0].substring(10).split(" ");return{port:parseInt(h[0],10),protocol:h[1],maxMessageSize:a}}},t.writeSctpDescription=function(e,i){let s=[];return s=e.protocol!=="DTLS/SCTP"?["m="+e.kind+" 9 "+e.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+e.kind+" 9 "+e.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&s.push("a=max-message-size:"+i.maxMessageSize+`\r
`),s.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,i,s){let a;const d=i!==void 0?i:2;return a=e||t.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+a+" "+d+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(e,i){const s=t.splitLines(e);for(let a=0;a<s.length;a++)switch(s[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[a].substring(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return e.split(" ",2)[1]==="0"},t.parseMLine=function(e){const i=t.splitLines(e)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(e){const i=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(e){if(typeof e!="string"||e.length===0)return!1;const i=t.splitLines(e);for(let s=0;s<i.length;s++)if(i[s].length<2||i[s].charAt(1)!=="=")return!1;return!0},n.exports=t})(pt);var Tt=pt.exports,Rt=et(Tt),Gt=c({__proto__:null,default:Rt},[Tt]);function Pt(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const t=n.RTCIceCandidate;n.RTCIceCandidate=function(e){if(typeof e=="object"&&e.candidate&&e.candidate.indexOf("a=")===0&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const i=new t(e),s=Rt.parseCandidate(e.candidate),a=Object.assign(i,s);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new t(e)},n.RTCIceCandidate.prototype=t.prototype,T(n,"icecandidate",e=>(e.candidate&&Object.defineProperty(e,"candidate",{value:new n.RTCIceCandidate(e.candidate),writable:"false"}),e))}function Ut(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||T(n,"icecandidate",t=>{if(t.candidate){const e=Rt.parseCandidate(t.candidate.candidate);e.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[e.priority>>24])}return t})}function Ct(n,t){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const e=function(u){if(!u||!u.sdp)return!1;const h=Rt.splitSections(u.sdp);return h.shift(),h.some(p=>{const _=Rt.parseMLine(p);return _&&_.kind==="application"&&_.protocol.indexOf("SCTP")!==-1})},i=function(u){const h=u.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(h===null||h.length<2)return-1;const p=parseInt(h[1],10);return p!=p?-1:p},s=function(u){let h=65536;return t.browser==="firefox"&&(h=t.version<57?u===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),h},a=function(u,h){let p=65536;t.browser==="firefox"&&t.version===57&&(p=65535);const _=Rt.matchPrefix(u.sdp,"a=max-message-size:");return _.length>0?p=parseInt(_[0].substr(19),10):t.browser==="firefox"&&h!==-1&&(p=2147483637),p},d=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:u}=this.getConfiguration();u==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(e(arguments[0])){const u=i(arguments[0]),h=s(u),p=a(arguments[0],u);let _;_=h===0&&p===0?Number.POSITIVE_INFINITY:h===0||p===0?Math.max(h,p):Math.min(h,p);const m={};Object.defineProperty(m,"maxMessageSize",{get:()=>_}),this._sctp=m}return d.apply(this,arguments)}}function se(n){if(!n.RTCPeerConnection||!("createDataChannel"in n.RTCPeerConnection.prototype))return;function t(i,s){const a=i.send;i.send=function(){const d=arguments[0],u=d.length||d.size||d.byteLength;if(i.readyState==="open"&&s.sctp&&u>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return a.apply(i,arguments)}}const e=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const i=e.apply(this,arguments);return t(i,this),i},T(n,"datachannel",i=>(t(i.channel,i.target),i))}function Qt(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const t=n.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const i=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const a=s.target;if(a._lastConnectionState!==a.connectionState){a._lastConnectionState=a.connectionState;const d=new Event("connectionstatechange",s);a.dispatchEvent(d)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function ce(n,t){if(!n.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=i.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&i instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:i.type,sdp:s}):i.sdp=s}return e.apply(this,arguments)}}function ge(n,t){if(!n.RTCPeerConnection||!n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype.addIceCandidate;e&&e.length!==0&&(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function De(n,t){if(!n.RTCPeerConnection||!n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype.setLocalDescription;e&&e.length!==0&&(n.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return e.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?e.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(s=>e.apply(this,[s]))})}var Sn=Object.freeze({__proto__:null,removeExtmapAllowMixed:ce,shimAddIceCandidateNullOrEmpty:ge,shimConnectionState:Qt,shimMaxMessageSize:Ct,shimParameterlessSetLocalDescription:De,shimRTCIceCandidate:Pt,shimRTCIceCandidateRelayProtocol:Ut,shimSendThrowTypeError:se});(function({window:n}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const e=D,i=function(a){const d={browser:null,version:null};if(a===void 0||!a.navigator)return d.browser="Not a browser.",d;const{navigator:u}=a;if(u.mozGetUserMedia)d.browser="firefox",d.version=E(u.userAgent,/Firefox\/(\d+)\./,1);else if(u.webkitGetUserMedia||a.isSecureContext===!1&&a.webkitRTCPeerConnection)d.browser="chrome",d.version=E(u.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!a.RTCPeerConnection||!u.userAgent.match(/AppleWebKit\/(\d+)\./))return d.browser="Not a supported browser.",d;d.browser="safari",d.version=E(u.userAgent,/AppleWebKit\/(\d+)\./,1),d.supportsUnifiedPlan=a.RTCRtpTransceiver&&"currentDirection"in a.RTCRtpTransceiver.prototype}return d}(n),s={browserDetails:i,commonShim:Sn,extractVersion:E,disableLog:w,disableWarnings:N,sdp:Gt};switch(i.browser){case"chrome":if(!xt||!At||!t.shimChrome)return e("Chrome shim is not included in this adapter release."),s;if(i.version===null)return e("Chrome shim can not determine version, not shimming."),s;e("adapter.js shimming chrome."),s.browserShim=xt,ge(n,i),De(n),Ot(n,i),wt(n),At(n,i),dt(n),jt(n,i),it(n),Q(n),St(n),Wt(n,i),Pt(n),Ut(n),Qt(n),Ct(n,i),se(n),ce(n,i);break;case"firefox":if(!Vi||!fe||!t.shimFirefox)return e("Firefox shim is not included in this adapter release."),s;e("adapter.js shimming firefox."),s.browserShim=Vi,ge(n,i),De(n),ae(n,i),fe(n,i),Mt(n),Zt(n),_n(n),ln(n),be(n),ee(n),fr(n),ws(n),Vr(n),Pt(n),Qt(n),Ct(n,i),se(n);break;case"safari":if(!H||!t.shimSafari)return e("Safari shim is not included in this adapter release."),s;e("adapter.js shimming safari."),s.browserShim=H,ge(n,i),De(n),qt(n),re(n),nc(n),vo(n),Co(n),Vt(n),Ii(n),$e(n),Pt(n),Ut(n),Ct(n,i),se(n),ce(n,i);break;default:e("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var _e=function(n){try{return!!n()}catch{return!0}},xn=!_e(function(){var n=(function(){}).bind();return typeof n!="function"||n.hasOwnProperty("prototype")}),_r=xn,Io=Function.prototype,cd=Io.call,ic=_r&&Io.bind.bind(cd,cd),Pn=_r?ic:function(n){return function(){return cd.apply(n,arguments)}},Vn=Pn({}.isPrototypeOf),or=function(n){return n&&n.Math==Math&&n},oi=or(typeof globalThis=="object"&&globalThis)||or(typeof window=="object"&&window)||or(typeof self=="object"&&self)||or(typeof K=="object"&&K)||function(){return this}()||K||Function("return this")(),f1=xn,tv=Function.prototype,ev=tv.apply,nv=tv.call,Pm=typeof Reflect=="object"&&Reflect.apply||(f1?nv.bind(ev):function(){return nv.apply(ev,arguments)}),iv=Pn,_1=iv({}.toString),m1=iv("".slice),ia=function(n){return m1(_1(n),8,-1)},E1=ia,g1=Pn,km=function(n){if(E1(n)==="Function")return g1(n)},Lm=typeof document=="object"&&document.all,Gh={all:Lm,IS_HTMLDDA:Lm===void 0&&Lm!==void 0},S1=Gh.all,_i=Gh.IS_HTMLDDA?function(n){return typeof n=="function"||n===S1}:function(n){return typeof n=="function"},Wl={},Ys=!_e(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),T1=xn,Hh=Function.prototype.call,Hi=T1?Hh.bind(Hh):function(){return Hh.apply(Hh,arguments)},Mm={},rv={}.propertyIsEnumerable,sv=Object.getOwnPropertyDescriptor,y1=sv&&!rv.call({1:2},1);Mm.f=y1?function(n){var t=sv(this,n);return!!t&&t.enumerable}:rv;var ra,Yh,rc=function(n,t){return{enumerable:!(1&n),configurable:!(2&n),writable:!(4&n),value:t}},R1=_e,v1=ia,Um=Object,C1=Pn("".split),xm=R1(function(){return!Um("z").propertyIsEnumerable(0)})?function(n){return v1(n)=="String"?C1(n,""):Um(n)}:Um,Kh=function(n){return n==null},I1=Kh,b1=TypeError,Gl=function(n){if(I1(n))throw b1("Can't call method on "+n);return n},w1=xm,A1=Gl,sc=function(n){return w1(A1(n))},ov=_i,O1=Gh.all,os=Gh.IS_HTMLDDA?function(n){return typeof n=="object"?n!==null:ov(n)||n===O1}:function(n){return typeof n=="object"?n!==null:ov(n)},oc={},Vm=oc,Fm=oi,N1=_i,av=function(n){return N1(n)?n:void 0},mr=function(n,t){return arguments.length<2?av(Vm[n])||av(Fm[n]):Vm[n]&&Vm[n][t]||Fm[n]&&Fm[n][t]},ac=typeof navigator<"u"&&String(navigator.userAgent)||"",cv=oi,Bm=ac,dv=cv.process,lv=cv.Deno,uv=dv&&dv.versions||lv&&lv.version,hv=uv&&uv.v8;hv&&(Yh=(ra=hv.split("."))[0]>0&&ra[0]<4?1:+(ra[0]+ra[1])),!Yh&&Bm&&(!(ra=Bm.match(/Edge\/(\d+)/))||ra[1]>=74)&&(ra=Bm.match(/Chrome\/(\d+)/))&&(Yh=+ra[1]);var cc=Yh,pv=cc,D1=_e,P1=oi.String,dd=!!Object.getOwnPropertySymbols&&!D1(function(){var n=Symbol();return!P1(n)||!(Object(n)instanceof Symbol)||!Symbol.sham&&pv&&pv<41}),fv=dd&&!Symbol.sham&&typeof Symbol.iterator=="symbol",k1=mr,L1=_i,M1=Vn,U1=Object,Hl=fv?function(n){return typeof n=="symbol"}:function(n){var t=k1("Symbol");return L1(t)&&M1(t.prototype,U1(n))},x1=String,ld=function(n){try{return x1(n)}catch{return"Object"}},V1=_i,F1=ld,B1=TypeError,as=function(n){if(V1(n))return n;throw B1(F1(n)+" is not a function")},j1=as,W1=Kh,jm=function(n,t){var e=n[t];return W1(e)?void 0:j1(e)},Wm=Hi,Gm=_i,Hm=os,G1=TypeError,_v={exports:{}},mv=oi,H1=Object.defineProperty,Y1=function(n,t){try{H1(mv,n,{value:t,configurable:!0,writable:!0})}catch{mv[n]=t}return t},Ev="__core-js_shared__",Ym=oi[Ev]||Y1(Ev,{}),gv=Ym;(_v.exports=function(n,t){return gv[n]||(gv[n]=t!==void 0?t:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var ud=_v.exports,K1=Gl,q1=Object,dc=function(n){return q1(K1(n))},z1=dc,J1=Pn({}.hasOwnProperty),Yi=Object.hasOwn||function(n,t){return J1(z1(n),t)},X1=Pn,Q1=0,$1=Math.random(),Z1=X1(1 .toString),Km=function(n){return"Symbol("+(n===void 0?"":n)+")_"+Z1(++Q1+$1,36)},tU=ud,Sv=Yi,eU=Km,nU=dd,iU=fv,hd=oi.Symbol,qm=tU("wks"),rU=iU?hd.for||hd:hd&&hd.withoutSetter||eU,qn=function(n){return Sv(qm,n)||(qm[n]=nU&&Sv(hd,n)?hd[n]:rU("Symbol."+n)),qm[n]},sU=Hi,Tv=os,yv=Hl,oU=jm,aU=function(n,t){var e,i;if(t==="string"&&Gm(e=n.toString)&&!Hm(i=Wm(e,n))||Gm(e=n.valueOf)&&!Hm(i=Wm(e,n))||t!=="string"&&Gm(e=n.toString)&&!Hm(i=Wm(e,n)))return i;throw G1("Can't convert object to primitive value")},cU=TypeError,dU=qn("toPrimitive"),lU=function(n,t){if(!Tv(n)||yv(n))return n;var e,i=oU(n,dU);if(i){if(t===void 0&&(t="default"),e=sU(i,n,t),!Tv(e)||yv(e))return e;throw cU("Can't convert object to primitive value")}return t===void 0&&(t="number"),aU(n,t)},uU=Hl,qh=function(n){var t=lU(n,"string");return uU(t)?t:t+""},Rv=os,zm=oi.document,hU=Rv(zm)&&Rv(zm.createElement),Jm=function(n){return hU?zm.createElement(n):{}},pU=Jm,vv=!Ys&&!_e(function(){return Object.defineProperty(pU("div"),"a",{get:function(){return 7}}).a!=7}),fU=Ys,_U=Hi,mU=Mm,EU=rc,gU=sc,SU=qh,TU=Yi,yU=vv,Cv=Object.getOwnPropertyDescriptor;Wl.f=fU?Cv:function(n,t){if(n=gU(n),t=SU(t),yU)try{return Cv(n,t)}catch{}if(TU(n,t))return EU(!_U(mU.f,n,t),n[t])};var RU=_e,vU=_i,CU=/#|\.prototype\./,Yl=function(n,t){var e=bU[IU(n)];return e==AU||e!=wU&&(vU(t)?RU(t):!!t)},IU=Yl.normalize=function(n){return String(n).replace(CU,".").toLowerCase()},bU=Yl.data={},wU=Yl.NATIVE="N",AU=Yl.POLYFILL="P",Iv=Yl,OU=as,NU=xn,DU=km(km.bind),Kl=function(n,t){return OU(n),t===void 0?n:NU?DU(n,t):function(){return n.apply(t,arguments)}},cs={},bv=Ys&&_e(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),PU=os,kU=String,LU=TypeError,As=function(n){if(PU(n))return n;throw LU(kU(n)+" is not an object")},MU=Ys,UU=vv,xU=bv,zh=As,wv=qh,VU=TypeError,Xm=Object.defineProperty,FU=Object.getOwnPropertyDescriptor,Qm="enumerable",$m="configurable",Zm="writable";cs.f=MU?xU?function(n,t,e){if(zh(n),t=wv(t),zh(e),typeof n=="function"&&t==="prototype"&&"value"in e&&Zm in e&&!e[Zm]){var i=FU(n,t);i&&i[Zm]&&(n[t]=e.value,e={configurable:$m in e?e[$m]:i[$m],enumerable:Qm in e?e[Qm]:i[Qm],writable:!1})}return Xm(n,t,e)}:Xm:function(n,t,e){if(zh(n),t=wv(t),zh(e),UU)try{return Xm(n,t,e)}catch{}if("get"in e||"set"in e)throw VU("Accessors not supported");return"value"in e&&(n[t]=e.value),n};var BU=cs,jU=rc,sa=Ys?function(n,t,e){return BU.f(n,t,jU(1,e))}:function(n,t,e){return n[t]=e,n},Jh=oi,WU=Pm,GU=km,HU=_i,YU=Wl.f,KU=Iv,pd=oc,qU=Kl,fd=sa,Av=Yi,zU=function(n){var t=function(e,i,s){if(this instanceof t){switch(arguments.length){case 0:return new n;case 1:return new n(e);case 2:return new n(e,i)}return new n(e,i,s)}return WU(n,this,arguments)};return t.prototype=n.prototype,t},mn=function(n,t){var e,i,s,a,d,u,h,p,_,m=n.target,S=n.global,y=n.stat,b=n.proto,I=S?Jh:y?Jh[m]:(Jh[m]||{}).prototype,A=S?pd:pd[m]||fd(pd,m,{})[m],L=A.prototype;for(a in t)i=!(e=KU(S?a:m+(y?".":"#")+a,n.forced))&&I&&Av(I,a),u=A[a],i&&(h=n.dontCallGetSet?(_=YU(I,a))&&_.value:I[a]),d=i&&h?h:t[a],i&&typeof u==typeof d||(p=n.bind&&i?qU(d,Jh):n.wrap&&i?zU(d):b&&HU(d)?GU(d):d,(n.sham||d&&d.sham||u&&u.sham)&&fd(p,"sham",!0),fd(A,a,p),b&&(Av(pd,s=m+"Prototype")||fd(pd,s,{}),fd(pd[s],a,d),n.real&&L&&(e||!L[a])&&fd(L,a,d)))},JU=Math.ceil,XU=Math.floor,QU=Math.trunc||function(n){var t=+n;return(t>0?XU:JU)(t)},tE=function(n){var t=+n;return t!=t||t===0?0:QU(t)},$U=tE,ZU=Math.max,tx=Math.min,Ov=function(n,t){var e=$U(n);return e<0?ZU(e+t,0):tx(e,t)},ex=tE,nx=Math.min,ix=function(n){return n>0?nx(ex(n),9007199254740991):0},lc=function(n){return ix(n.length)},rx=sc,sx=Ov,ox=lc,Nv=function(n){return function(t,e,i){var s,a=rx(t),d=ox(a),u=sx(i,d);if(n&&e!=e){for(;d>u;)if((s=a[u++])!=s)return!0}else for(;d>u;u++)if((n||u in a)&&a[u]===e)return n||u||0;return!n&&-1}},Dv={includes:Nv(!0),indexOf:Nv(!1)},ax=Dv.includes;mn({target:"Array",proto:!0,forced:_e(function(){return!Array(1).includes()})},{includes:function(n){return ax(this,n,arguments.length>1?arguments[1]:void 0)}});var cx=oc,uc=function(n){return cx[n+"Prototype"]},dx=uc("Array").includes,lx=os,ux=ia,hx=qn("match"),px=function(n){var t;return lx(n)&&((t=n[hx])!==void 0?!!t:ux(n)=="RegExp")},fx=TypeError,Pv={};Pv[qn("toStringTag")]="z";var eE=String(Pv)==="[object z]",_x=eE,mx=_i,Xh=ia,Ex=qn("toStringTag"),gx=Object,Sx=Xh(function(){return arguments}())=="Arguments",hc=_x?Xh:function(n){var t,e,i;return n===void 0?"Undefined":n===null?"Null":typeof(e=function(s,a){try{return s[a]}catch{}}(t=gx(n),Ex))=="string"?e:Sx?Xh(t):(i=Xh(t))=="Object"&&mx(t.callee)?"Arguments":i},Tx=hc,yx=String,bo=function(n){if(Tx(n)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return yx(n)},Rx=qn("match"),vx=mn,Cx=function(n){if(px(n))throw fx("The method doesn't accept regular expressions");return n},Ix=Gl,kv=bo,bx=function(n){var t=/./;try{"/./"[n](t)}catch{try{return t[Rx]=!1,"/./"[n](t)}catch{}}return!1},wx=Pn("".indexOf);vx({target:"String",proto:!0,forced:!bx("includes")},{includes:function(n){return!!~wx(kv(Ix(this)),kv(Cx(n)),arguments.length>1?arguments[1]:void 0)}});var Ax=uc("String").includes,Lv=Vn,Ox=dx,Nx=Ax,nE=Array.prototype,iE=String.prototype,It=et(function(n){var t=n.includes;return n===nE||Lv(nE,n)&&t===nE.includes?Ox:typeof n=="string"||n===iE||Lv(iE,n)&&t===iE.includes?Nx:t}),Mv={exports:{}},Dx=mn,Px=Ys,Uv=cs.f;Dx({target:"Object",stat:!0,forced:Object.defineProperty!==Uv,sham:!Px},{defineProperty:Uv});var xv=oc.Object,kx=Mv.exports=function(n,t,e){return xv.defineProperty(n,t,e)};xv.defineProperty.sham&&(kx.sham=!0);var Lx=et(Mv.exports),Mx=ia,rE=Array.isArray||function(n){return Mx(n)=="Array"},Ux=TypeError,xx=qh,Vx=cs,Fx=rc,Vv=function(n,t,e){var i=xx(t);i in n?Vx.f(n,i,Fx(0,e)):n[i]=e},Bx=_i,sE=Ym,jx=Pn(Function.toString);Bx(sE.inspectSource)||(sE.inspectSource=function(n){return jx(n)});var Fv=sE.inspectSource,Wx=Pn,Gx=_e,Bv=_i,Hx=hc,Yx=Fv,jv=function(){},Kx=[],Wv=mr("Reflect","construct"),oE=/^\s*(?:class|function)\b/,qx=Wx(oE.exec),zx=!oE.exec(jv),ql=function(n){if(!Bv(n))return!1;try{return Wv(jv,Kx,n),!0}catch{return!1}},Gv=function(n){if(!Bv(n))return!1;switch(Hx(n)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return zx||!!qx(oE,Yx(n))}catch{return!0}};Gv.sham=!0;var Hv=!Wv||Gx(function(){var n;return ql(ql.call)||!ql(Object)||!ql(function(){n=!0})||n})?Gv:ql,Yv=rE,Jx=Hv,Xx=os,Qx=qn("species"),Kv=Array,$x=function(n){var t;return Yv(n)&&(t=n.constructor,(Jx(t)&&(t===Kv||Yv(t.prototype))||Xx(t)&&(t=t[Qx])===null)&&(t=void 0)),t===void 0?Kv:t},qv=function(n,t){return new($x(n))(t===0?0:t)},Zx=_e,t2=cc,e2=qn("species"),n2=mn,i2=_e,r2=rE,s2=os,o2=dc,a2=lc,zv=function(n){if(n>9007199254740991)throw Ux("Maximum allowed index exceeded");return n},Jv=Vv,c2=qv,d2=function(n){return t2>=51||!Zx(function(){var t=[];return(t.constructor={})[e2]=function(){return{foo:1}},t[n](Boolean).foo!==1})},l2=cc,Xv=qn("isConcatSpreadable"),u2=l2>=51||!i2(function(){var n=[];return n[Xv]=!1,n.concat()[0]!==n}),h2=function(n){if(!s2(n))return!1;var t=n[Xv];return t!==void 0?!!t:r2(n)};n2({target:"Array",proto:!0,arity:1,forced:!u2||!d2("concat")},{concat:function(n){var t,e,i,s,a,d=o2(this),u=c2(d,0),h=0;for(t=-1,i=arguments.length;t<i;t++)if(h2(a=t===-1?d:arguments[t]))for(s=a2(a),zv(h+s),e=0;e<s;e++,h++)e in a&&Jv(u,h,a[e]);else zv(h+1),Jv(u,h++,a);return u.length=h,u}});var aE={},Qh={},cE=Yi,p2=sc,f2=Dv.indexOf,_2=Qh,Qv=Pn([].push),$v=function(n,t){var e,i=p2(n),s=0,a=[];for(e in i)!cE(_2,e)&&cE(i,e)&&Qv(a,e);for(;t.length>s;)cE(i,e=t[s++])&&(~f2(a,e)||Qv(a,e));return a},dE=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],m2=$v,E2=dE,Zv=Object.keys||function(n){return m2(n,E2)},g2=Ys,S2=bv,T2=cs,y2=As,R2=sc,v2=Zv;aE.f=g2&&!S2?Object.defineProperties:function(n,t){y2(n);for(var e,i=R2(t),s=v2(t),a=s.length,d=0;a>d;)T2.f(n,e=s[d++],i[e]);return n};var $h,tC=mr("document","documentElement"),C2=Km,eC=ud("keys"),Zh=function(n){return eC[n]||(eC[n]=C2(n))},I2=As,b2=aE,nC=dE,w2=Qh,A2=tC,O2=Jm,lE="prototype",uE="script",iC=Zh("IE_PROTO"),hE=function(){},rC=function(n){return"<"+uE+">"+n+"</"+uE+">"},sC=function(n){n.write(rC("")),n.close();var t=n.parentWindow.Object;return n=null,t},tp=function(){try{$h=new ActiveXObject("htmlfile")}catch{}var n,t,e;tp=typeof document<"u"?document.domain&&$h?sC($h):(t=O2("iframe"),e="java"+uE+":",t.style.display="none",A2.appendChild(t),t.src=String(e),(n=t.contentWindow.document).open(),n.write(rC("document.F=Object")),n.close(),n.F):sC($h);for(var i=nC.length;i--;)delete tp[lE][nC[i]];return tp()};w2[iC]=!0;var ep=Object.create||function(n,t){var e;return n!==null?(hE[lE]=I2(n),e=new hE,hE[lE]=null,e[iC]=n):e=tp(),t===void 0?e:b2.f(e,t)},np={},N2=$v,D2=dE.concat("length","prototype");np.f=Object.getOwnPropertyNames||function(n){return N2(n,D2)};var oC={},aC=Ov,P2=lc,k2=Vv,L2=Array,M2=Math.max,cC=function(n,t,e){for(var i=P2(n),s=aC(t,i),a=aC(e===void 0?i:e,i),d=L2(M2(a-s,0)),u=0;s<a;s++,u++)k2(d,u,n[s]);return d.length=u,d},U2=ia,x2=sc,dC=np.f,V2=cC,lC=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];oC.f=function(n){return lC&&U2(n)=="Window"?function(t){try{return dC(t)}catch{return V2(lC)}}(n):dC(x2(n))};var ip={};ip.f=Object.getOwnPropertySymbols;var F2=sa,zl=function(n,t,e,i){return i&&i.enumerable?n[t]=e:F2(n,t,e),n},B2=cs,uC=function(n,t,e){return B2.f(n,t,e)},_d={},j2=qn;_d.f=j2;var rp,Jl,sp,hC=oc,W2=Yi,G2=_d,H2=cs.f,ri=function(n){var t=hC.Symbol||(hC.Symbol={});W2(t,n)||H2(t,n,{value:G2.f(n)})},Y2=Hi,K2=mr,q2=qn,z2=zl,pC=function(){var n=K2("Symbol"),t=n&&n.prototype,e=t&&t.valueOf,i=q2("toPrimitive");t&&!t[i]&&z2(t,i,function(s){return Y2(e,this)},{arity:1})},J2=hc,X2=eE?{}.toString:function(){return"[object "+J2(this)+"]"},Q2=eE,$2=cs.f,Z2=sa,tV=Yi,eV=X2,fC=qn("toStringTag"),md=function(n,t,e,i){if(n){var s=e?n:n.prototype;tV(s,fC)||$2(s,fC,{configurable:!0,value:t}),i&&!Q2&&Z2(s,"toString",eV)}},nV=_i,_C=oi.WeakMap,iV=nV(_C)&&/native code/.test(String(_C)),mC=oi,rV=os,sV=sa,pE=Yi,fE=Ym,oV=Zh,aV=Qh,EC="Object already initialized",_E=mC.TypeError,cV=mC.WeakMap;if(iV||fE.state){var Ks=fE.state||(fE.state=new cV);Ks.get=Ks.get,Ks.has=Ks.has,Ks.set=Ks.set,rp=function(n,t){if(Ks.has(n))throw _E(EC);return t.facade=n,Ks.set(n,t),t},Jl=function(n){return Ks.get(n)||{}},sp=function(n){return Ks.has(n)}}else{var Ed=oV("state");aV[Ed]=!0,rp=function(n,t){if(pE(n,Ed))throw _E(EC);return t.facade=n,sV(n,Ed,t),t},Jl=function(n){return pE(n,Ed)?n[Ed]:{}},sp=function(n){return pE(n,Ed)}}var op={set:rp,get:Jl,has:sp,enforce:function(n){return sp(n)?Jl(n):rp(n,{})},getterFor:function(n){return function(t){var e;if(!rV(t)||(e=Jl(t)).type!==n)throw _E("Incompatible receiver, "+n+" required");return e}}},dV=Kl,lV=xm,uV=dc,hV=lc,pV=qv,gC=Pn([].push),oa=function(n){var t=n==1,e=n==2,i=n==3,s=n==4,a=n==6,d=n==7,u=n==5||a;return function(h,p,_,m){for(var S,y,b=uV(h),I=lV(b),A=dV(p,_),L=hV(I),U=0,F=m||pV,$=t?F(h,L):e||d?F(h,0):void 0;L>U;U++)if((u||U in I)&&(y=A(S=I[U],U,b),n))if(t)$[U]=y;else if(y)switch(n){case 3:return!0;case 5:return S;case 6:return U;case 2:gC($,S)}else switch(n){case 4:return!1;case 7:gC($,S)}return a?-1:i||s?s:$}},fV={forEach:oa(0),map:oa(1),filter:oa(2),some:oa(3),every:oa(4),find:oa(5),findIndex:oa(6),filterReject:oa(7)},ap=mn,mE=oi,EE=Hi,_V=Pn,gd=Ys,Sd=dd,mV=_e,Di=Yi,EV=Vn,gE=As,cp=sc,SE=qh,gV=bo,TE=rc,Xl=ep,SC=Zv,SV=np,TC=oC,TV=ip,yC=Wl,RC=cs,yV=aE,vC=Mm,CC=zl,RV=uC,yE=ud,IC=Qh,bC=Km,vV=qn,CV=_d,IV=ri,bV=pC,wV=md,wC=op,dp=fV.forEach,Er=Zh("hidden"),lp="Symbol",Ql="prototype",AV=wC.set,AC=wC.getterFor(lp),Os=Object[Ql],pc=mE.Symbol,up=pc&&pc[Ql],OV=mE.TypeError,RE=mE.QObject,OC=yC.f,fc=RC.f,NC=TC.f,NV=vC.f,DC=_V([].push),wo=yE("symbols"),$l=yE("op-symbols"),DV=yE("wks"),vE=!RE||!RE[Ql]||!RE[Ql].findChild,CE=gd&&mV(function(){return Xl(fc({},"a",{get:function(){return fc(this,"a",{value:7}).a}})).a!=7})?function(n,t,e){var i=OC(Os,t);i&&delete Os[t],fc(n,t,e),i&&n!==Os&&fc(Os,t,i)}:fc,IE=function(n,t){var e=wo[n]=Xl(up);return AV(e,{type:lp,tag:n,description:t}),gd||(e.description=t),e},hp=function(n,t,e){n===Os&&hp($l,t,e),gE(n);var i=SE(t);return gE(e),Di(wo,i)?(e.enumerable?(Di(n,Er)&&n[Er][i]&&(n[Er][i]=!1),e=Xl(e,{enumerable:TE(0,!1)})):(Di(n,Er)||fc(n,Er,TE(1,{})),n[Er][i]=!0),CE(n,i,e)):fc(n,i,e)},bE=function(n,t){gE(n);var e=cp(t),i=SC(e).concat(MC(e));return dp(i,function(s){gd&&!EE(PC,e,s)||hp(n,s,e[s])}),n},PC=function(n){var t=SE(n),e=EE(NV,this,t);return!(this===Os&&Di(wo,t)&&!Di($l,t))&&(!(e||!Di(this,t)||!Di(wo,t)||Di(this,Er)&&this[Er][t])||e)},kC=function(n,t){var e=cp(n),i=SE(t);if(e!==Os||!Di(wo,i)||Di($l,i)){var s=OC(e,i);return!s||!Di(wo,i)||Di(e,Er)&&e[Er][i]||(s.enumerable=!0),s}},LC=function(n){var t=NC(cp(n)),e=[];return dp(t,function(i){Di(wo,i)||Di(IC,i)||DC(e,i)}),e},MC=function(n){var t=n===Os,e=NC(t?$l:cp(n)),i=[];return dp(e,function(s){!Di(wo,s)||t&&!Di(Os,s)||DC(i,wo[s])}),i};Sd||(pc=function(){if(EV(up,this))throw OV("Symbol is not a constructor");var n=arguments.length&&arguments[0]!==void 0?gV(arguments[0]):void 0,t=bC(n),e=function(i){this===Os&&EE(e,$l,i),Di(this,Er)&&Di(this[Er],t)&&(this[Er][t]=!1),CE(this,t,TE(1,i))};return gd&&vE&&CE(Os,t,{configurable:!0,set:e}),IE(t,n)},CC(up=pc[Ql],"toString",function(){return AC(this).tag}),CC(pc,"withoutSetter",function(n){return IE(bC(n),n)}),vC.f=PC,RC.f=hp,yV.f=bE,yC.f=kC,SV.f=TC.f=LC,TV.f=MC,CV.f=function(n){return IE(vV(n),n)},gd&&RV(up,"description",{configurable:!0,get:function(){return AC(this).description}})),ap({global:!0,constructor:!0,wrap:!0,forced:!Sd,sham:!Sd},{Symbol:pc}),dp(SC(DV),function(n){IV(n)}),ap({target:lp,stat:!0,forced:!Sd},{useSetter:function(){vE=!0},useSimple:function(){vE=!1}}),ap({target:"Object",stat:!0,forced:!Sd,sham:!gd},{create:function(n,t){return t===void 0?Xl(n):bE(Xl(n),t)},defineProperty:hp,defineProperties:bE,getOwnPropertyDescriptor:kC}),ap({target:"Object",stat:!0,forced:!Sd},{getOwnPropertyNames:LC}),bV(),wV(pc,lp),IC[Er]=!0;var UC=dd&&!!Symbol.for&&!!Symbol.keyFor,PV=mn,kV=mr,LV=Yi,MV=bo,xC=ud,UV=UC,wE=xC("string-to-symbol-registry"),xV=xC("symbol-to-string-registry");PV({target:"Symbol",stat:!0,forced:!UV},{for:function(n){var t=MV(n);if(LV(wE,t))return wE[t];var e=kV("Symbol")(t);return wE[t]=e,xV[e]=t,e}});var VV=mn,FV=Yi,BV=Hl,jV=ld,WV=UC,VC=ud("symbol-to-string-registry");VV({target:"Symbol",stat:!0,forced:!WV},{keyFor:function(n){if(!BV(n))throw TypeError(jV(n)+" is not a symbol");if(FV(VC,n))return VC[n]}});var FC=Pn([].slice),BC=rE,GV=_i,jC=ia,HV=bo,WC=Pn([].push),YV=mn,GC=mr,HC=Pm,KV=Hi,Zl=Pn,YC=_e,KC=_i,qC=Hl,zC=FC,qV=function(n){if(GV(n))return n;if(BC(n)){for(var t=n.length,e=[],i=0;i<t;i++){var s=n[i];typeof s=="string"?WC(e,s):typeof s!="number"&&jC(s)!="Number"&&jC(s)!="String"||WC(e,HV(s))}var a=e.length,d=!0;return function(u,h){if(d)return d=!1,h;if(BC(this))return h;for(var p=0;p<a;p++)if(e[p]===u)return h}}},zV=dd,JV=String,aa=GC("JSON","stringify"),pp=Zl(/./.exec),JC=Zl("".charAt),XV=Zl("".charCodeAt),QV=Zl("".replace),$V=Zl(1 .toString),ZV=/[\uD800-\uDFFF]/g,XC=/^[\uD800-\uDBFF]$/,QC=/^[\uDC00-\uDFFF]$/,$C=!zV||YC(function(){var n=GC("Symbol")();return aa([n])!="[null]"||aa({a:n})!="{}"||aa(Object(n))!="{}"}),ZC=YC(function(){return aa("\uDF06\uD834")!=='"\\udf06\\ud834"'||aa("\uDEAD")!=='"\\udead"'}),tF=function(n,t){var e=zC(arguments),i=qV(t);if(KC(i)||n!==void 0&&!qC(n))return e[1]=function(s,a){if(KC(i)&&(a=KV(i,this,JV(s),a)),!qC(a))return a},HC(aa,null,e)},eF=function(n,t,e){var i=JC(e,t-1),s=JC(e,t+1);return pp(XC,n)&&!pp(QC,s)||pp(QC,n)&&!pp(XC,i)?"\\u"+$V(XV(n,0),16):n};aa&&YV({target:"JSON",stat:!0,arity:3,forced:$C||ZC},{stringify:function(n,t,e){var i=zC(arguments),s=HC($C?tF:aa,null,i);return ZC&&typeof s=="string"?QV(s,ZV,eF):s}});var tI=ip,nF=dc;mn({target:"Object",stat:!0,forced:!dd||_e(function(){tI.f(1)})},{getOwnPropertySymbols:function(n){var t=tI.f;return t?t(nF(n)):[]}}),ri("asyncIterator"),ri("hasInstance"),ri("isConcatSpreadable"),ri("iterator"),ri("match"),ri("matchAll"),ri("replace"),ri("search"),ri("species"),ri("split");var iF=pC;ri("toPrimitive"),iF();var rF=mr,sF=md;ri("toStringTag"),sF(rF("Symbol"),"Symbol"),ri("unscopables"),md(oi.JSON,"JSON",!0);var _c,eI,nI,oF=oc.Symbol,Td={},AE=Ys,aF=Yi,iI=Function.prototype,cF=AE&&Object.getOwnPropertyDescriptor,OE=aF(iI,"name"),rI={EXISTS:OE,PROPER:OE&&(function(){}).name==="something",CONFIGURABLE:OE&&(!AE||AE&&cF(iI,"name").configurable)},dF=!_e(function(){function n(){}return n.prototype.constructor=null,Object.getPrototypeOf(new n)!==n.prototype}),lF=Yi,uF=_i,hF=dc,pF=dF,sI=Zh("IE_PROTO"),NE=Object,fF=NE.prototype,DE=pF?NE.getPrototypeOf:function(n){var t=hF(n);if(lF(t,sI))return t[sI];var e=t.constructor;return uF(e)&&t instanceof e?e.prototype:t instanceof NE?fF:null},_F=_e,mF=_i,EF=os,gF=ep,oI=DE,SF=zl,PE=qn("iterator"),aI=!1;[].keys&&("next"in(nI=[].keys())?(eI=oI(oI(nI)))!==Object.prototype&&(_c=eI):aI=!0);var TF=!EF(_c)||_F(function(){var n={};return _c[PE].call(n)!==n});mF((_c=TF?{}:gF(_c))[PE])||SF(_c,PE,function(){return this});var cI={IteratorPrototype:_c,BUGGY_SAFARI_ITERATORS:aI},yF=cI.IteratorPrototype,RF=ep,vF=rc,CF=md,IF=Td,bF=function(){return this},wF=Pn,AF=as,OF=_i,NF=String,DF=TypeError,PF=function(n,t,e){try{return wF(AF(Object.getOwnPropertyDescriptor(n,t)[e]))}catch{}},kF=As,LF=function(n){if(typeof n=="object"||OF(n))return n;throw DF("Can't set "+NF(n)+" as a prototype")},MF=Object.setPrototypeOf||("__proto__"in{}?function(){var n,t=!1,e={};try{(n=PF(Object.prototype,"__proto__","set"))(e,[]),t=e instanceof Array}catch{}return function(i,s){return kF(i),LF(s),t?n(i,s):i.__proto__=s,i}}():void 0),UF=mn,xF=Hi,VF=rI,FF=function(n,t,e,i){var s=t+" Iterator";return n.prototype=RF(yF,{next:vF(+!i,e)}),CF(n,s,!1,!0),IF[s]=bF,n},BF=DE,jF=md,dI=zl,lI=Td,WF=cI,GF=VF.PROPER,fp=WF.BUGGY_SAFARI_ITERATORS,kE=qn("iterator"),uI="keys",_p="values",hI="entries",HF=function(){return this},pI=function(n,t,e,i,s,a,d){FF(e,t,i);var u,h,p,_=function(L){if(L===s&&I)return I;if(!fp&&L in y)return y[L];switch(L){case uI:case _p:case hI:return function(){return new e(this,L)}}return function(){return new e(this)}},m=t+" Iterator",S=!1,y=n.prototype,b=y[kE]||y["@@iterator"]||s&&y[s],I=!fp&&b||_(s),A=t=="Array"&&y.entries||b;if(A&&(u=BF(A.call(new n)))!==Object.prototype&&u.next&&(jF(u,m,!0,!0),lI[m]=HF),GF&&s==_p&&b&&b.name!==_p&&(S=!0,I=function(){return xF(b,this)}),s)if(h={values:_(_p),keys:a?I:_(uI),entries:_(hI)},d)for(p in h)(fp||S||!(p in y))&&dI(y,p,h[p]);else UF({target:t,proto:!0,forced:fp||S},h);return d&&y[kE]!==I&&dI(y,kE,I,{name:s}),lI[t]=I,h},fI=function(n,t){return{value:n,done:t}},YF=sc,_I=Td,mI=op;cs.f;var KF=pI,EI=fI,gI="Array Iterator",qF=mI.set,zF=mI.getterFor(gI);KF(Array,"Array",function(n,t){qF(this,{type:gI,target:YF(n),index:0,kind:t})},function(){var n=zF(this),t=n.target,e=n.kind,i=n.index++;return!t||i>=t.length?(n.target=void 0,EI(void 0,!0)):EI(e=="keys"?i:e=="values"?t[i]:[i,t[i]],!1)},"values"),_I.Arguments=_I.Array;var JF={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},XF=oi,QF=hc,$F=sa,SI=Td,TI=qn("toStringTag");for(var LE in JF){var yI=XF[LE],ME=yI&&yI.prototype;ME&&QF(ME)!==TI&&$F(ME,TI,LE),SI[LE]=SI.Array}var ZF=oF,tB=qn,eB=cs.f,RI=tB("metadata"),vI=Function.prototype;vI[RI]===void 0&&eB(vI,RI,{value:null}),ri("dispose"),ri("metadata");var nB=ZF;ri("asyncDispose");var iB=Pn,UE=mr("Symbol"),rB=UE.keyFor,sB=iB(UE.prototype.valueOf),CI=UE.isRegisteredSymbol||function(n){try{return rB(sB(n))!==void 0}catch{return!1}};mn({target:"Symbol",stat:!0},{isRegisteredSymbol:CI});for(var oB=ud,II=mr,aB=Pn,cB=Hl,dB=qn,mp=II("Symbol"),bI=mp.isWellKnownSymbol,wI=II("Object","getOwnPropertyNames"),lB=aB(mp.prototype.valueOf),AI=oB("wks"),xE=0,OI=wI(mp),uB=OI.length;xE<uB;xE++)try{var NI=OI[xE];cB(mp[NI])&&dB(NI)}catch{}var DI=function(n){if(bI&&bI(n))return!0;try{for(var t=lB(n),e=0,i=wI(AI),s=i.length;e<s;e++)if(AI[i[e]]==t)return!0}catch{}return!1};mn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:DI}),ri("matcher"),ri("observable"),mn({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:CI}),mn({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:DI}),ri("metadataKey"),ri("patternMatch"),ri("replaceAll");var yd=et(nB),VE=Pn,hB=tE,pB=bo,fB=Gl,_B=VE("".charAt),PI=VE("".charCodeAt),mB=VE("".slice),kI=function(n){return function(t,e){var i,s,a=pB(fB(t)),d=hB(e),u=a.length;return d<0||d>=u?n?"":void 0:(i=PI(a,d))<55296||i>56319||d+1===u||(s=PI(a,d+1))<56320||s>57343?n?_B(a,d):i:n?mB(a,d,d+2):s-56320+(i-55296<<10)+65536}},EB={codeAt:kI(!1),charAt:kI(!0)}.charAt,gB=bo,LI=op,SB=pI,MI=fI,UI="String Iterator",TB=LI.set,yB=LI.getterFor(UI);SB(String,"String",function(n){TB(this,{type:UI,string:gB(n),index:0})},function(){var n,t=yB(this),e=t.string,i=t.index;return i>=e.length?MI(void 0,!0):(n=EB(e,i),t.index+=n.length,MI(n,!1))});var xI=et(_d.f("iterator"));function tu(n){return tu=typeof yd=="function"&&typeof xI=="symbol"?function(t){return typeof t}:function(t){return t&&typeof yd=="function"&&t.constructor===yd&&t!==yd.prototype?"symbol":typeof t},tu(n)}var RB=et(_d.f("toPrimitive"));function vB(n){var t=function(e,i){if(tu(e)!=="object"||e===null)return e;var s=e[RB];if(s!==void 0){var a=s.call(e,i||"default");if(tu(a)!=="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}(n,"string");return tu(t)==="symbol"?t:String(t)}function g(n,t,e){return(t=vB(t))in n?Lx(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}var CB=uc("Array").keys,IB=hc,bB=Yi,wB=Vn,AB=CB,FE=Array.prototype,OB={DOMTokenList:!0,NodeList:!0},gr=et(function(n){var t=n.keys;return n===FE||wB(FE,n)&&t===FE.keys||bB(OB,IB(n))?AB:t}),VI=ld,NB=TypeError,FI=cC,DB=Math.floor,BE=function(n,t){var e=n.length,i=DB(e/2);return e<8?PB(n,t):kB(n,BE(FI(n,0,i),t),BE(FI(n,i),t),t)},PB=function(n,t){for(var e,i,s=n.length,a=1;a<s;){for(i=a,e=n[a];i&&t(n[i-1],e)>0;)n[i]=n[--i];i!==a++&&(n[i]=e)}return n},kB=function(n,t,e,i){for(var s=t.length,a=e.length,d=0,u=0;d<s||u<a;)n[d+u]=d<s&&u<a?i(t[d],e[u])<=0?t[d++]:e[u++]:d<s?t[d++]:e[u++];return n},LB=BE,MB=_e,BI=function(n,t){var e=[][n];return!!e&&MB(function(){e.call(null,t||function(){return 1},1)})},jI=ac.match(/firefox\/(\d+)/i),UB=!!jI&&+jI[1],xB=/MSIE|Trident/.test(ac),WI=ac.match(/AppleWebKit\/(\d+)\./),VB=!!WI&&+WI[1],FB=mn,GI=Pn,BB=as,jB=dc,HI=lc,WB=function(n,t){if(!delete n[t])throw NB("Cannot delete property "+VI(t)+" of "+VI(n))},YI=bo,jE=_e,GB=LB,HB=BI,KI=UB,YB=xB,qI=cc,zI=VB,ca=[],JI=GI(ca.sort),KB=GI(ca.push),qB=jE(function(){ca.sort(void 0)}),zB=jE(function(){ca.sort(null)}),JB=HB("sort"),XI=!jE(function(){if(qI)return qI<70;if(!(KI&&KI>3)){if(YB)return!0;if(zI)return zI<603;var n,t,e,i,s="";for(n=65;n<76;n++){switch(t=String.fromCharCode(n),n){case 66:case 69:case 70:case 72:e=3;break;case 68:case 71:e=4;break;default:e=2}for(i=0;i<47;i++)ca.push({k:t+i,v:e})}for(ca.sort(function(a,d){return d.v-a.v}),i=0;i<ca.length;i++)t=ca[i].k.charAt(0),s.charAt(s.length-1)!==t&&(s+=t);return s!=="DGBEFHACIJK"}});FB({target:"Array",proto:!0,forced:qB||!zB||!JB||!XI},{sort:function(n){n!==void 0&&BB(n);var t=jB(this);if(XI)return n===void 0?JI(t):JI(t,n);var e,i,s=[],a=HI(t);for(i=0;i<a;i++)i in t&&KB(s,t[i]);for(GB(s,function(d){return function(u,h){return h===void 0?-1:u===void 0?1:d!==void 0?+d(u,h)||0:YI(u)>YI(h)?1:-1}}(n)),e=HI(s),i=0;i<e;)t[i]=s[i++];for(;i<a;)WB(t,i++);return t}});var XB=uc("Array").sort,QB=Vn,$B=XB,WE=Array.prototype,eu=et(function(n){var t=n.sort;return n===WE||QB(WE,n)&&t===WE.sort?$B:t}),ZB=mr,tj=np,ej=ip,nj=As,ij=Pn([].concat),rj=ZB("Reflect","ownKeys")||function(n){var t=tj.f(nj(n)),e=ej.f;return e?ij(t,e(n)):t},QI=Yi,sj=rj,oj=Wl,aj=cs,cj=os,dj=sa,$I=Error,lj=Pn("".replace),uj=String($I("zxcasd").stack),ZI=/\n\s*at [^:]*:[^\n]*/,hj=ZI.test(uj),pj=rc,fj=!_e(function(){var n=Error("a");return!("stack"in n)||(Object.defineProperty(n,"stack",pj(1,7)),n.stack!==7)}),_j=sa,mj=function(n,t){if(hj&&typeof n=="string"&&!$I.prepareStackTrace)for(;t--;)n=lj(n,ZI,"");return n},Ej=fj,tb=Error.captureStackTrace,gj=Td,Sj=qn("iterator"),Tj=Array.prototype,yj=hc,eb=jm,Rj=Kh,vj=Td,Cj=qn("iterator"),nb=function(n){if(!Rj(n))return eb(n,Cj)||eb(n,"@@iterator")||vj[yj(n)]},Ij=Hi,bj=as,wj=As,Aj=ld,Oj=nb,Nj=TypeError,Dj=Hi,ib=As,Pj=jm,kj=Kl,Lj=Hi,Mj=As,Uj=ld,xj=function(n){return n!==void 0&&(gj.Array===n||Tj[Sj]===n)},Vj=lc,rb=Vn,Fj=function(n,t){var e=arguments.length<2?Oj(n):t;if(bj(e))return wj(Ij(e,n));throw Nj(Aj(n)+" is not iterable")},Bj=nb,sb=function(n,t,e){var i,s;ib(n);try{if(!(i=Pj(n,"return"))){if(t==="throw")throw e;return e}i=Dj(i,n)}catch(a){s=!0,i=a}if(t==="throw")throw e;if(s)throw i;return ib(i),e},jj=TypeError,Ep=function(n,t){this.stopped=n,this.result=t},ob=Ep.prototype,nu=function(n,t,e){var i,s,a,d,u,h,p,_=e&&e.that,m=!(!e||!e.AS_ENTRIES),S=!(!e||!e.IS_RECORD),y=!(!e||!e.IS_ITERATOR),b=!(!e||!e.INTERRUPTED),I=kj(t,_),A=function(U){return i&&sb(i,"normal",U),new Ep(!0,U)},L=function(U){return m?(Mj(U),b?I(U[0],U[1],A):I(U[0],U[1])):b?I(U,A):I(U)};if(S)i=n.iterator;else if(y)i=n;else{if(!(s=Bj(n)))throw jj(Uj(n)+" is not iterable");if(xj(s)){for(a=0,d=Vj(n);d>a;a++)if((u=L(n[a]))&&rb(ob,u))return u;return new Ep(!1)}i=Fj(n,s)}for(h=S?n.next:i.next;!(p=Lj(h,i)).done;){try{u=L(p.value)}catch(U){sb(i,"throw",U)}if(typeof u=="object"&&u&&rb(ob,u))return u}return new Ep(!1)},Wj=bo,Gj=mn,Hj=Vn,Yj=DE,gp=MF,Kj=function(n,t,e){for(var i=sj(t),s=aj.f,a=oj.f,d=0;d<i.length;d++){var u=i[d];QI(n,u)||e&&QI(e,u)||s(n,u,a(t,u))}},ab=ep,GE=sa,HE=rc,qj=function(n,t){cj(t)&&"cause"in t&&dj(n,"cause",t.cause)},zj=function(n,t,e,i){Ej&&(tb?tb(n,t):_j(n,"stack",mj(e,i)))},Jj=nu,Xj=function(n,t){return n===void 0?arguments.length<2?"":t:Wj(n)},Qj=qn("toStringTag"),Sp=Error,$j=[].push,Rd=function(n,t){var e,i=Hj(YE,this);gp?e=gp(Sp(),i?Yj(this):YE):(e=i?this:ab(YE),GE(e,Qj,"Error")),t!==void 0&&GE(e,"message",Xj(t)),zj(e,Rd,e.stack,1),arguments.length>2&&qj(e,arguments[2]);var s=[];return Jj(n,$j,{that:s}),GE(e,"errors",s),e};gp?gp(Rd,Sp):Kj(Rd,Sp,{name:!0});var YE=Rd.prototype=ab(Sp.prototype,{constructor:HE(1,Rd),message:HE(1,""),name:HE(1,"AggregateError")});Gj({global:!0,constructor:!0,arity:2},{AggregateError:Rd});var iu,vd,cb,KE,ru=typeof process<"u"&&ia(process)=="process",Zj=mr,tW=uC,eW=Ys,db=qn("species"),nW=Vn,iW=TypeError,rW=Hv,sW=ld,oW=TypeError,lb=As,aW=function(n){if(rW(n))return n;throw oW(sW(n)+" is not a constructor")},cW=Kh,dW=qn("species"),ub=function(n,t){var e,i=lb(n).constructor;return i===void 0||cW(e=lb(i)[dW])?t:aW(e)},lW=TypeError,hb=/(?:ipad|iphone|ipod).*applewebkit/i.test(ac),Fr=oi,uW=Pm,hW=Kl,pb=_i,pW=Yi,fb=_e,_b=tC,fW=FC,mb=Jm,_W=function(n,t){if(n<t)throw lW("Not enough arguments");return n},mW=hb,EW=ru,qE=Fr.setImmediate,zE=Fr.clearImmediate,gW=Fr.process,JE=Fr.Dispatch,SW=Fr.Function,Eb=Fr.MessageChannel,TW=Fr.String,XE=0,su={},gb="onreadystatechange";fb(function(){iu=Fr.location});var QE=function(n){if(pW(su,n)){var t=su[n];delete su[n],t()}},$E=function(n){return function(){QE(n)}},Sb=function(n){QE(n.data)},Tb=function(n){Fr.postMessage(TW(n),iu.protocol+"//"+iu.host)};qE&&zE||(qE=function(n){_W(arguments.length,1);var t=pb(n)?n:SW(n),e=fW(arguments,1);return su[++XE]=function(){uW(t,void 0,e)},vd(XE),XE},zE=function(n){delete su[n]},EW?vd=function(n){gW.nextTick($E(n))}:JE&&JE.now?vd=function(n){JE.now($E(n))}:Eb&&!mW?(KE=(cb=new Eb).port2,cb.port1.onmessage=Sb,vd=hW(KE.postMessage,KE)):Fr.addEventListener&&pb(Fr.postMessage)&&!Fr.importScripts&&iu&&iu.protocol!=="file:"&&!fb(Tb)?(vd=Tb,Fr.addEventListener("message",Sb,!1)):vd=gb in mb("script")?function(n){_b.appendChild(mb("script"))[gb]=function(){_b.removeChild(this),QE(n)}}:function(n){setTimeout($E(n),0)});var yb={set:qE,clear:zE},Rb=function(){this.head=null,this.tail=null};Rb.prototype={add:function(n){var t={item:n,next:null},e=this.tail;e?e.next=t:this.head=t,this.tail=t},get:function(){var n=this.head;if(n)return(this.head=n.next)===null&&(this.tail=null),n.item}};var Cd,ZE,tg,eg,vb,Cb=Rb,yW=/ipad|iphone|ipod/i.test(ac)&&typeof Pebble<"u",RW=/web0s(?!.*chrome)/i.test(ac),mc=oi,Ib=Kl,vW=Wl.f,ng=yb.set,CW=Cb,IW=hb,bW=yW,wW=RW,ig=ru,bb=mc.MutationObserver||mc.WebKitMutationObserver,wb=mc.document,Ab=mc.process,Tp=mc.Promise,Ob=vW(mc,"queueMicrotask"),rg=Ob&&Ob.value;if(!rg){var yp=new CW,Rp=function(){var n,t;for(ig&&(n=Ab.domain)&&n.exit();t=yp.get();)try{t()}catch(e){throw yp.head&&Cd(),e}n&&n.enter()};IW||ig||wW||!bb||!wb?!bW&&Tp&&Tp.resolve?((eg=Tp.resolve(void 0)).constructor=Tp,vb=Ib(eg.then,eg),Cd=function(){vb(Rp)}):ig?Cd=function(){Ab.nextTick(Rp)}:(ng=Ib(ng,mc),Cd=function(){ng(Rp)}):(ZE=!0,tg=wb.createTextNode(""),new bb(Rp).observe(tg,{characterData:!0}),Cd=function(){tg.data=ZE=!ZE}),rg=function(n){yp.head||Cd(),yp.add(n)}}var AW=rg,Id=function(n){try{return{error:!1,value:n()}}catch(t){return{error:!0,value:t}}},Ec=oi.Promise,Nb=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",OW=!Nb&&!ru&&typeof window=="object"&&typeof document=="object",NW=oi,ou=Ec,DW=_i,PW=Iv,kW=Fv,LW=qn,MW=OW,UW=Nb,sg=cc,Db=ou&&ou.prototype,xW=LW("species"),Pb=!1,kb=DW(NW.PromiseRejectionEvent),VW=PW("Promise",function(){var n=kW(ou),t=n!==String(ou);if(!t&&sg===66||!Db.catch||!Db.finally)return!0;if(!sg||sg<51||!/native code/.test(n)){var e=new ou(function(s){s(1)}),i=function(s){s(function(){},function(){})};if((e.constructor={})[xW]=i,!(Pb=e.then(function(){})instanceof i))return!0}return!t&&(MW||UW)&&!kb}),au={CONSTRUCTOR:VW,REJECTION_EVENT:kb,SUBCLASSING:Pb},qs={},Lb=as,FW=TypeError,BW=function(n){var t,e;this.promise=new n(function(i,s){if(t!==void 0||e!==void 0)throw FW("Bad Promise constructor");t=i,e=s}),this.resolve=Lb(t),this.reject=Lb(e)};qs.f=function(n){return new BW(n)};var og,Mb,jW=mn,vp=ru,da=oi,cu=Hi,WW=zl,GW=md,HW=function(n){var t=Zj(n);eW&&t&&!t[db]&&tW(t,db,{configurable:!0,get:function(){return this}})},YW=as,ag=_i,KW=os,qW=function(n,t){if(nW(t,n))return n;throw iW("Incorrect invocation")},zW=ub,Ub=yb.set,cg=AW,JW=function(n,t){try{arguments.length==1?console.error(n):console.error(n,t)}catch{}},XW=Id,QW=Cb,xb=op,dg=Ec,Vb=au,Fb=qs,Cp="Promise",Bb=Vb.CONSTRUCTOR,$W=Vb.REJECTION_EVENT,lg=xb.getterFor(Cp),ZW=xb.set,tG=dg&&dg.prototype,du=dg,ug=tG,jb=da.TypeError,hg=da.document,pg=da.process,fg=Fb.f,eG=fg,nG=!!(hg&&hg.createEvent&&da.dispatchEvent),Wb="unhandledrejection",Gb=function(n){var t;return!(!KW(n)||!ag(t=n.then))&&t},Hb=function(n,t){var e,i,s,a=t.value,d=t.state==1,u=d?n.ok:n.fail,h=n.resolve,p=n.reject,_=n.domain;try{u?(d||(t.rejection===2&&rG(t),t.rejection=1),u===!0?e=a:(_&&_.enter(),e=u(a),_&&(_.exit(),s=!0)),e===n.promise?p(jb("Promise-chain cycle")):(i=Gb(e))?cu(i,e,h,p):h(e)):p(a)}catch(m){_&&!s&&_.exit(),p(m)}},Yb=function(n,t){n.notified||(n.notified=!0,cg(function(){for(var e,i=n.reactions;e=i.get();)Hb(e,n);n.notified=!1,t&&!n.rejection&&iG(n)}))},Kb=function(n,t,e){var i,s;nG?((i=hg.createEvent("Event")).promise=t,i.reason=e,i.initEvent(n,!1,!0),da.dispatchEvent(i)):i={promise:t,reason:e},!$W&&(s=da["on"+n])?s(i):n===Wb&&JW("Unhandled promise rejection",e)},iG=function(n){cu(Ub,da,function(){var t,e=n.facade,i=n.value;if(qb(n)&&(t=XW(function(){vp?pg.emit("unhandledRejection",i,e):Kb(Wb,e,i)}),n.rejection=vp||qb(n)?2:1,t.error))throw t.value})},qb=function(n){return n.rejection!==1&&!n.parent},rG=function(n){cu(Ub,da,function(){var t=n.facade;vp?pg.emit("rejectionHandled",t):Kb("rejectionhandled",t,n.value)})},bd=function(n,t,e){return function(i){n(t,i,e)}},wd=function(n,t,e){n.done||(n.done=!0,e&&(n=e),n.value=t,n.state=2,Yb(n,!0))},_g=function(n,t,e){if(!n.done){n.done=!0,e&&(n=e);try{if(n.facade===t)throw jb("Promise can't be resolved itself");var i=Gb(t);i?cg(function(){var s={done:!1};try{cu(i,t,bd(_g,s,n),bd(wd,s,n))}catch(a){wd(s,a,n)}}):(n.value=t,n.state=1,Yb(n,!1))}catch(s){wd({done:!1},s,n)}}};Bb&&(ug=(du=function(n){qW(this,ug),YW(n),cu(og,this);var t=lg(this);try{n(bd(_g,t),bd(wd,t))}catch(e){wd(t,e)}}).prototype,(og=function(n){ZW(this,{type:Cp,done:!1,notified:!1,parent:!1,reactions:new QW,rejection:!1,state:0,value:void 0})}).prototype=WW(ug,"then",function(n,t){var e=lg(this),i=fg(zW(this,du));return e.parent=!0,i.ok=!ag(n)||n,i.fail=ag(t)&&t,i.domain=vp?pg.domain:void 0,e.state==0?e.reactions.add(i):cg(function(){Hb(i,e)}),i.promise}),Mb=function(){var n=new og,t=lg(n);this.promise=n,this.resolve=bd(_g,t),this.reject=bd(wd,t)},Fb.f=fg=function(n){return n===du||n===void 0?new Mb(n):eG(n)}),jW({global:!0,constructor:!0,wrap:!0,forced:Bb},{Promise:du}),GW(du,Cp,!1,!0),HW(Cp);var zb=qn("iterator"),Jb=!1;try{var sG=0,Xb={next:function(){return{done:!!sG++}},return:function(){Jb=!0}};Xb[zb]=function(){return this},Array.from(Xb,function(){throw 2})}catch{}var oG=Ec,aG=function(n,t){if(!t&&!Jb)return!1;var e=!1;try{var i={};i[zb]=function(){return{next:function(){return{done:e=!0}}}},n(i)}catch{}return e},Ip=au.CONSTRUCTOR||!aG(function(n){oG.all(n).then(void 0,function(){})}),cG=Hi,dG=as,lG=qs,uG=Id,hG=nu;mn({target:"Promise",stat:!0,forced:Ip},{all:function(n){var t=this,e=lG.f(t),i=e.resolve,s=e.reject,a=uG(function(){var d=dG(t.resolve),u=[],h=0,p=1;hG(n,function(_){var m=h++,S=!1;p++,cG(d,t,_).then(function(y){S||(S=!0,u[m]=y,--p||i(u))},s)}),--p||i(u)});return a.error&&s(a.value),e.promise}});var pG=mn,fG=au.CONSTRUCTOR;Ec&&Ec.prototype,pG({target:"Promise",proto:!0,forced:fG,real:!0},{catch:function(n){return this.then(void 0,n)}});var _G=Hi,mG=as,EG=qs,gG=Id,SG=nu;mn({target:"Promise",stat:!0,forced:Ip},{race:function(n){var t=this,e=EG.f(t),i=e.reject,s=gG(function(){var a=mG(t.resolve);SG(n,function(d){_G(a,t,d).then(e.resolve,i)})});return s.error&&i(s.value),e.promise}});var TG=Hi,yG=qs;mn({target:"Promise",stat:!0,forced:au.CONSTRUCTOR},{reject:function(n){var t=yG.f(this);return TG(t.reject,void 0,n),t.promise}});var RG=As,vG=os,CG=qs,Qb=function(n,t){if(RG(n),vG(t)&&t.constructor===n)return t;var e=CG.f(n);return(0,e.resolve)(t),e.promise},IG=mn,bG=Ec,wG=au.CONSTRUCTOR,AG=Qb,OG=mr("Promise"),NG=!wG;IG({target:"Promise",stat:!0,forced:!0},{resolve:function(n){return AG(NG&&this===OG?bG:this,n)}});var DG=Hi,PG=as,kG=qs,LG=Id,MG=nu;mn({target:"Promise",stat:!0,forced:Ip},{allSettled:function(n){var t=this,e=kG.f(t),i=e.resolve,s=e.reject,a=LG(function(){var d=PG(t.resolve),u=[],h=0,p=1;MG(n,function(_){var m=h++,S=!1;p++,DG(d,t,_).then(function(y){S||(S=!0,u[m]={status:"fulfilled",value:y},--p||i(u))},function(y){S||(S=!0,u[m]={status:"rejected",reason:y},--p||i(u))})}),--p||i(u)});return a.error&&s(a.value),e.promise}});var UG=Hi,xG=as,VG=mr,FG=qs,BG=Id,jG=nu,$b="No one promise resolved";mn({target:"Promise",stat:!0,forced:Ip},{any:function(n){var t=this,e=VG("AggregateError"),i=FG.f(t),s=i.resolve,a=i.reject,d=BG(function(){var u=xG(t.resolve),h=[],p=0,_=1,m=!1;jG(n,function(S){var y=p++,b=!1;_++,UG(u,t,S).then(function(I){b||m||(m=!0,s(I))},function(I){b||m||(b=!0,h[y]=I,--_||a(new e(h,$b)))})}),--_||a(new e(h,$b))});return d.error&&a(d.value),i.promise}});var WG=mn,mg=Ec,GG=_e,HG=mr,YG=_i,KG=ub,Zb=Qb,qG=mg&&mg.prototype;WG({target:"Promise",proto:!0,real:!0,forced:!!mg&&GG(function(){qG.finally.call({then:function(){}},function(){})})},{finally:function(n){var t=KG(this,HG("Promise")),e=YG(n);return this.then(e?function(i){return Zb(t,n()).then(function(){return i})}:n,e?function(i){return Zb(t,n()).then(function(){throw i})}:n)}});var tw=oc.Promise,W=et(tw);const zG=()=>{};function lu(){const n={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:zG};return n.promise=new W((t,e)=>{n.resolve=i=>{n.isFinished||(n.isResolved=!0,n.isFinished=!0,t(i),n.value=i)},n.reject=i=>{n.isFinished||(n.isRejected=!0,n.isFinished=!0,e(i))}}),n}const bp=new Map,wp=new Map,zs=new Map;var Fn,Ce;(function(n){n.WIN_10="Windows 10",n.WIN_81="Windows 8.1",n.WIN_8="Windows 8",n.WIN_7="Windows 7",n.WIN_VISTA="Windows Vista",n.WIN_SERVER_2003="Windows Server 2003",n.WIN_XP="Windows XP",n.WIN_2000="Windows 2000",n.ANDROID="Android",n.HARMONY_OS="HarmonyOS",n.OPEN_BSD="Open BSD",n.SUN_OS="Sun OS",n.LINUX="Linux",n.IOS="iOS",n.MAC_OS="Mac OS",n.QNX="QNX",n.UNIX="UNIX",n.BEOS="BeOS",n.OS_2="OS/2",n.SEARCH_BOT="Search Bot"})(Fn||(Fn={})),function(n){n.CHROME="Chrome",n.SAFARI="Safari",n.EDGE="Edge",n.FIREFOX="Firefox",n.OPERA="OPR",n.QQ="QQBrowser",n.WECHAT="MicroMessenger"}(Ce||(Ce={}));var Eg={exports:{}};(function(n,t){(function(e,i){var s="function",a="undefined",d="object",u="string",h="major",p="model",_="name",m="type",S="vendor",y="version",b="architecture",I="console",A="mobile",L="tablet",U="smarttv",F="wearable",$="embedded",z="Amazon",G="Apple",Y="ASUS",q="BlackBerry",ut="Browser",ct="Chrome",$t="Firefox",pe="Google",sn="Huawei",Nn="LG",Ge="Microsoft",lr="Motorola",tt="Opera",ot="Samsung",gt="Sharp",Ht="Sony",ye="Xiaomi",lt="Zebra",v="Facebook",P="Chromium OS",V="Mac OS",st=function(pn){for(var Dn={},He=0;He<pn.length;He++)Dn[pn[He].toUpperCase()]=pn[He];return Dn},Jt=function(pn,Dn){return typeof pn===u&&je(Dn).indexOf(je(pn))!==-1},je=function(pn){return pn.toLowerCase()},pi=function(pn,Dn){if(typeof pn===u)return pn=pn.replace(/^\s\s*/,""),typeof Dn===a?pn:pn.substring(0,350)},ur=function(pn,Dn){for(var He,hr,lo,fn,Re,tr,La=0;La<Dn.length&&!Re;){var Ls=Dn[La],iD=Dn[La+1];for(He=hr=0;He<Ls.length&&!Re&&Ls[He];)if(Re=Ls[He++].exec(pn))for(lo=0;lo<iD.length;lo++)tr=Re[++hr],typeof(fn=iD[lo])===d&&fn.length>0?fn.length===2?typeof fn[1]==s?this[fn[0]]=fn[1].call(this,tr):this[fn[0]]=fn[1]:fn.length===3?typeof fn[1]!==s||fn[1].exec&&fn[1].test?this[fn[0]]=tr?tr.replace(fn[1],fn[2]):i:this[fn[0]]=tr?fn[1].call(this,tr,fn[2]):i:fn.length===4&&(this[fn[0]]=tr?fn[3].call(this,tr.replace(fn[1],fn[2])):i):this[fn]=tr||i;La+=2}},Fo=function(pn,Dn){for(var He in Dn)if(typeof Dn[He]===d&&Dn[He].length>0){for(var hr=0;hr<Dn[He].length;hr++)if(Jt(Dn[He][hr],pn))return He==="?"?i:He}else if(Jt(Dn[He],pn))return He==="?"?i:He;return pn},zf={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Jf={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[y,[_,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[y,[_,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[_,y],[/opios[\/ ]+([\w\.]+)/i],[y,[_,tt+" Mini"]],[/\bopr\/([\w\.]+)/i],[y,[_,tt]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[_,y],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[y,[_,"UC"+ut]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[y,[_,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[y,[_,"WeChat"]],[/konqueror\/([\w\.]+)/i],[y,[_,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[y,[_,"IE"]],[/yabrowser\/([\w\.]+)/i],[y,[_,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[_,/(.+)/,"$1 Secure "+ut],y],[/\bfocus\/([\w\.]+)/i],[y,[_,$t+" Focus"]],[/\bopt\/([\w\.]+)/i],[y,[_,tt+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[y,[_,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[y,[_,"Dolphin"]],[/coast\/([\w\.]+)/i],[y,[_,tt+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[y,[_,"MIUI "+ut]],[/fxios\/([-\w\.]+)/i],[y,[_,$t]],[/\bqihu|(qi?ho?o?|360)browser/i],[[_,"360 "+ut]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[_,/(.+)/,"$1 "+ut],y],[/(comodo_dragon)\/([\w\.]+)/i],[[_,/_/g," "],y],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[_,y],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[_],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[_,v],y],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[_,y],[/\bgsa\/([\w\.]+) .*safari\//i],[y,[_,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[y,[_,ct+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[_,ct+" WebView"],y],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[y,[_,"Android "+ut]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[_,y],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[y,[_,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[y,_],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[_,[y,Fo,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[_,y],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[_,"Netscape"],y],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[y,[_,$t+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[_,y],[/(cobalt)\/([\w\.]+)/i],[_,[y,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[b,"amd64"]],[/(ia32(?=;))/i],[[b,je]],[/((?:i[346]|x)86)[;\)]/i],[[b,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[b,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[b,"armhf"]],[/windows (ce|mobile); ppc;/i],[[b,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[b,/ower/,"",je]],[/(sun4\w)[;\)]/i],[[b,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[b,je]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[p,[S,ot],[m,L]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[p,[S,ot],[m,A]],[/\((ip(?:hone|od)[\w ]*);/i],[p,[S,G],[m,A]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[p,[S,G],[m,L]],[/(macintosh);/i],[p,[S,G]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[p,[S,gt],[m,A]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[p,[S,sn],[m,L]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[p,[S,sn],[m,A]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[p,/_/g," "],[S,ye],[m,A]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[p,/_/g," "],[S,ye],[m,L]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[p,[S,"OPPO"],[m,A]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[p,[S,"Vivo"],[m,A]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[p,[S,"Realme"],[m,A]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[p,[S,lr],[m,A]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[p,[S,lr],[m,L]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[p,[S,Nn],[m,L]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[p,[S,Nn],[m,A]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[p,[S,"Lenovo"],[m,L]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[p,/_/g," "],[S,"Nokia"],[m,A]],[/(pixel c)\b/i],[p,[S,pe],[m,L]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[p,[S,pe],[m,A]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[p,[S,Ht],[m,A]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[p,"Xperia Tablet"],[S,Ht],[m,L]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[p,[S,"OnePlus"],[m,A]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[p,[S,z],[m,L]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[p,/(.+)/g,"Fire Phone $1"],[S,z],[m,A]],[/(playbook);[-\w\),; ]+(rim)/i],[p,S,[m,L]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[p,[S,q],[m,A]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[p,[S,Y],[m,L]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[p,[S,Y],[m,A]],[/(nexus 9)/i],[p,[S,"HTC"],[m,L]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[S,[p,/_/g," "],[m,A]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[p,[S,"Acer"],[m,L]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[p,[S,"Meizu"],[m,A]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[S,p,[m,A]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[S,p,[m,L]],[/(surface duo)/i],[p,[S,Ge],[m,L]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[p,[S,"Fairphone"],[m,A]],[/(u304aa)/i],[p,[S,"AT&T"],[m,A]],[/\bsie-(\w*)/i],[p,[S,"Siemens"],[m,A]],[/\b(rct\w+) b/i],[p,[S,"RCA"],[m,L]],[/\b(venue[\d ]{2,7}) b/i],[p,[S,"Dell"],[m,L]],[/\b(q(?:mv|ta)\w+) b/i],[p,[S,"Verizon"],[m,L]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[p,[S,"Barnes & Noble"],[m,L]],[/\b(tm\d{3}\w+) b/i],[p,[S,"NuVision"],[m,L]],[/\b(k88) b/i],[p,[S,"ZTE"],[m,L]],[/\b(nx\d{3}j) b/i],[p,[S,"ZTE"],[m,A]],[/\b(gen\d{3}) b.+49h/i],[p,[S,"Swiss"],[m,A]],[/\b(zur\d{3}) b/i],[p,[S,"Swiss"],[m,L]],[/\b((zeki)?tb.*\b) b/i],[p,[S,"Zeki"],[m,L]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[S,"Dragon Touch"],p,[m,L]],[/\b(ns-?\w{0,9}) b/i],[p,[S,"Insignia"],[m,L]],[/\b((nxa|next)-?\w{0,9}) b/i],[p,[S,"NextBook"],[m,L]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[S,"Voice"],p,[m,A]],[/\b(lvtel\-)?(v1[12]) b/i],[[S,"LvTel"],p,[m,A]],[/\b(ph-1) /i],[p,[S,"Essential"],[m,A]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[p,[S,"Envizen"],[m,L]],[/\b(trio[-\w\. ]+) b/i],[p,[S,"MachSpeed"],[m,L]],[/\btu_(1491) b/i],[p,[S,"Rotor"],[m,L]],[/(shield[\w ]+) b/i],[p,[S,"Nvidia"],[m,L]],[/(sprint) (\w+)/i],[S,p,[m,A]],[/(kin\.[onetw]{3})/i],[[p,/\./g," "],[S,Ge],[m,A]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[p,[S,lt],[m,L]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[p,[S,lt],[m,A]],[/smart-tv.+(samsung)/i],[S,[m,U]],[/hbbtv.+maple;(\d+)/i],[[p,/^/,"SmartTV"],[S,ot],[m,U]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[S,Nn],[m,U]],[/(apple) ?tv/i],[S,[p,G+" TV"],[m,U]],[/crkey/i],[[p,ct+"cast"],[S,pe],[m,U]],[/droid.+aft(\w)( bui|\))/i],[p,[S,z],[m,U]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[p,[S,gt],[m,U]],[/(bravia[\w ]+)( bui|\))/i],[p,[S,Ht],[m,U]],[/(mitv-\w{5}) bui/i],[p,[S,ye],[m,U]],[/Hbbtv.*(technisat) (.*);/i],[S,p,[m,U]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[S,pi],[p,pi],[m,U]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[m,U]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[S,p,[m,I]],[/droid.+; (shield) bui/i],[p,[S,"Nvidia"],[m,I]],[/(playstation [345portablevi]+)/i],[p,[S,Ht],[m,I]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[p,[S,Ge],[m,I]],[/((pebble))app/i],[S,p,[m,F]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[p,[S,G],[m,F]],[/droid.+; (glass) \d/i],[p,[S,pe],[m,F]],[/droid.+; (wt63?0{2,3})\)/i],[p,[S,lt],[m,F]],[/(quest( 2| pro)?)/i],[p,[S,v],[m,F]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[S,[m,$]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[p,[m,A]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[p,[m,L]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[m,L]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[m,A]],[/(android[-\w\. ]{0,9});.+buil/i],[p,[S,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[y,[_,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[y,[_,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[_,y],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[y,_]],os:[[/microsoft (windows) (vista|xp)/i],[_,y],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[_,[y,Fo,zf]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[_,"Windows"],[y,Fo,zf]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[y,/_/g,"."],[_,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[_,V],[y,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[y,_],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[_,y],[/\(bb(10);/i],[y,[_,q]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[y,[_,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[y,[_,$t+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[y,[_,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[y,[_,"watchOS"]],[/crkey\/([\d\.]+)/i],[y,[_,ct+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[_,P],y],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[_,y],[/(sunos) ?([\w\.\d]*)/i],[[_,"Solaris"],y],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[_,y]]},$r=function(pn,Dn){if(typeof pn===d&&(Dn=pn,pn=i),!(this instanceof $r))return new $r(pn,Dn).getResult();var He=typeof e!==a&&e.navigator?e.navigator:i,hr=pn||(He&&He.userAgent?He.userAgent:""),lo=He&&He.userAgentData?He.userAgentData:i,fn=Dn?function(Re,tr){var La={};for(var Ls in Re)tr[Ls]&&tr[Ls].length%2==0?La[Ls]=tr[Ls].concat(Re[Ls]):La[Ls]=Re[Ls];return La}(Jf,Dn):Jf;return this.getBrowser=function(){var Re={};return Re[_]=i,Re[y]=i,ur.call(Re,hr,fn.browser),Re[h]=function(tr){return typeof tr===u?tr.replace(/[^\d\.]/g,"").split(".")[0]:i}(Re[y]),He&&He.brave&&typeof He.brave.isBrave==s&&(Re[_]="Brave"),Re},this.getCPU=function(){var Re={};return Re[b]=i,ur.call(Re,hr,fn.cpu),Re},this.getDevice=function(){var Re={};return Re[S]=i,Re[p]=i,Re[m]=i,ur.call(Re,hr,fn.device),!Re[m]&&lo&&lo.mobile&&(Re[m]=A),Re[p]=="Macintosh"&&He&&typeof He.standalone!==a&&He.maxTouchPoints&&He.maxTouchPoints>2&&(Re[p]="iPad",Re[m]=L),Re},this.getEngine=function(){var Re={};return Re[_]=i,Re[y]=i,ur.call(Re,hr,fn.engine),Re},this.getOS=function(){var Re={};return Re[_]=i,Re[y]=i,ur.call(Re,hr,fn.os),!Re[_]&&lo&&lo.platform!="Unknown"&&(Re[_]=lo.platform.replace(/chrome os/i,P).replace(/macos/i,V)),Re},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return hr},this.setUA=function(Re){return hr=typeof Re===u&&Re.length>350?pi(Re,350):Re,this},this.setUA(hr),this};$r.VERSION="0.7.34",$r.BROWSER=st([_,y,h]),$r.CPU=st([b]),$r.DEVICE=st([p,S,m,I,A,U,L,F,$]),$r.ENGINE=$r.OS=st([_,y]),n.exports&&(t=n.exports=$r),t.UAParser=$r;var ka=typeof e!==a&&(e.jQuery||e.Zepto);if(ka&&!ka.ua){var ol=new $r;ka.ua=ol.getResult(),ka.ua.get=function(){return ol.getUA()},ka.ua.set=function(pn){ol.setUA(pn);var Dn=ol.getResult();for(var He in Dn)ka.ua[He]=Dn[He]}}})(typeof window=="object"?window:K)})(Eg,Eg.exports);const gg=new(et(Eg.exports));let Ao=gg.getResult(),Sg=null;function Se(n){if(!Sg){n&&gg.setUA(n),Ao=gg.getResult();const t=function(a){if(a.engine.name==="Blink"&&a.browser.name!=="WeChat")return Ce.CHROME;switch(a.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Ce.CHROME;case"Safari":case"Mobile Safari":return Ce.SAFARI;case"Edge":return Ce.EDGE;case"Firefox":return Ce.FIREFOX;case"QQBrowser":return Ce.QQ;case"Opera":return Ce.OPERA;case"WeChat":return Ce.WECHAT;default:return a.browser.name||""}}(Ao),e=function(a){let d;return d=a.engine.name==="Blink"?a.engine.version||"":a.browser.version||"",d.split(".")[0]}(Ao),i=function(a){return a.os.name==="Windows"?a.os.version?a.os.name+" "+a.os.version:a.os.name:a.os.name||""}(Ao),s=Ao.os.version;if(!(t&&e&&i&&s))return{name:t,version:e,os:i,osVersion:s};Sg={name:t,version:e,os:i,osVersion:s}}return Sg}function Ap(){return Se().os}function ew(){const n=Se();return"".concat(n.os," ").concat(n.osVersion)}function Op(){const n=Se();return!!(Ao.engine.name==="WebKit"&&n.os===Fn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&n.name!==Ce.SAFARI||wi()&&n.name!==Ce.SAFARI)}function JG(){const n=Se();if(Op()){if(n.os===Fn.MAC_OS)return!0;if(n.os===Fn.IOS){const t=Ao.os.version&&Ao.os.version.split(".");if(t&&Number(t[0])===14&&t[1]&&Number(t[1])>=3||t&&Number(t[0])>14)return!0}}return!1}function XG(){return Ao.engine.name==="WebKit"}function Tg(){return Se().name===Ce.CHROME}function bi(){return Se().name===Ce.SAFARI}function We(){return Se().name===Ce.FIREFOX}function wi(){return Se().os===Fn.IOS}function yg(n){const t=Se();return!(t.name!==Ce.CHROME||!t.osVersion)&&Number(t.version)>=n}function nw(n){const t=Se();return!(t.name!==Ce.EDGE||!t.osVersion)&&Number(t.version)>=n}function iw(n){const t=Se();return!(t.name!==Ce.OPERA||!t.osVersion)&&Number(t.version)>=n}function rw(){const n=Se();return!(n.name!==Ce.CHROME||!n.osVersion)&&Number(n.version)<=90}function sw(){const n=Se();if(n.os!==Fn.IOS||!n.osVersion)return!1;const t=n.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function Ad(){const n=Se();if(n.os!==Fn.IOS||!n.osVersion)return!1;const t=n.osVersion.split(".");return Number(t[0])===15}function Rg(){const n=Se();if(n.os!==Fn.IOS||!n.osVersion)return!1;const t=n.osVersion.split(".");return Number(t[0])===16}function ow(){const n=Se();if(n.os!==Fn.IOS||!n.osVersion)return!1;const t=n.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Js(){return bi()&&navigator.maxTouchPoints>0}function aw(){return Se().name===Ce.WECHAT}function cw(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function la(){const n=Se();return n.name===Ce.EDGE||n.name===Ce.SAFARI?!1:!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Np(){return Ap()===Fn.ANDROID}function uu(){const n=Se();return Np()&&(n.name===Ce.CHROME||n.name===Ce.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}var O;(function(n){n.UNEXPECTED_ERROR="UNEXPECTED_ERROR",n.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",n.TIMEOUT="TIMEOUT",n.INVALID_PARAMS="INVALID_PARAMS",n.NOT_READABLE="NOT_READABLE",n.NOT_SUPPORTED="NOT_SUPPORTED",n.INVALID_OPERATION="INVALID_OPERATION",n.OPERATION_ABORTED="OPERATION_ABORTED",n.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",n.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",n.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",n.DATACHANNEL_FAILED="DATACHANNEL_FAILED",n.NETWORK_ERROR="NETWORK_ERROR",n.NETWORK_TIMEOUT="NETWORK_TIMEOUT",n.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",n.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",n.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",n.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",n.ELECTRON_IS_NULL="ELECTRON_IS_NULL",n.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",n.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",n.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",n.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",n.PERMISSION_DENIED="PERMISSION_DENIED",n.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",n.TRACK_IS_DISABLED="TRACK_IS_DISABLED",n.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",n.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",n.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",n.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",n.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",n.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",n.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",n.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",n.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",n.UID_CONFLICT="UID_CONFLICT",n.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",n.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",n.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",n.INVALID_TRACK="INVALID_TRACK",n.SENDER_NOT_FOUND="SENDER_NOT_FOUND",n.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",n.SET_ANSWER_FAILED="SET_ANSWER_FAILED",n.ICE_FAILED="ICE_FAILED",n.PC_CLOSED="PC_CLOSED",n.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",n.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",n.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",n.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",n.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",n.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",n.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",n.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",n.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",n.INVALID_REMOTE_USER="INVALID_REMOTE_USER",n.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",n.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",n.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",n.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",n.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",n.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",n.WS_ABORT="WS_ABORT",n.WS_DISCONNECT="WS_DISCONNECT",n.WS_ERR="WS_ERR",n.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",n.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",n.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",n.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",n.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",n.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",n.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",n.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",n.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",n.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",n.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",n.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",n.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",n.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",n.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",n.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",n.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",n.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",n.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",n.INVALID_PLUGIN="INVALID_PLUGIN",n.DISCONNECT_P2P="DISCONNECT_P2P",n.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",n.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",n.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",n.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",n.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",n.PROHIBITED_OPERATION="PROHIBITED_OPERATION",n.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED"})(O||(O={}));let J=class extends Error{constructor(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",e=arguments.length>2?arguments[2]:void 0;super(t),g(this,"code",void 0),g(this,"message",void 0),g(this,"data",void 0),g(this,"name","AgoraRTCException"),this.code=n,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=e}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return n==="error"&&(t||console).error(this.toString()),n==="warning"&&(t||console).warn(this.toString()),this}throw(n){throw this.print("error",n),this}};function gc(n,t){if(typeof n!="boolean")throw new J(O.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Bn(n,t,e){if(!It(e).call(e,n))throw new J(O.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(e)))}function Pe(n,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(n<e||n>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(s){return typeof s=="number"&&s%1==0}(n))throw new J(O.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(e,", ").concat(i,"]. integer only"))}function vg(n,t){if(typeof n!="number"){if(!(n.min||n.max||n.ideal||n.exact))throw new J(O.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));n.min!==void 0&&Pe(n.min,"".concat(t,".min"),0,1/0),n.max!==void 0&&Pe(n.max,"".concat(t,".max"),1,1/0),n.exact!==void 0&&Pe(n.exact,"".concat(t,".exact"),1,1/0),n.ideal!==void 0&&Pe(n.ideal,"".concat(t,".ideal"),1,1/0)}else Pe(n,t,1,1/0)}function ai(n,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,s=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(n==null)throw new J(O.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!dw(n,e,i,s))throw new J(O.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(e,",").concat(i,"].").concat(s?" ASCII characters only.":""))}function Oo(n,t){if(!Array.isArray(n))throw new J(O.INVALID_PARAMS,"".concat(t," should be an array"))}function Ze(n){return n==null}function dw(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof n=="string"&&n.length<=e&&n.length>=t&&(!i||function(s){if(typeof s!="string")return!1;for(let a=0;a<s.length;a+=1){const d=s.charCodeAt(a);if(d<0||d>255)return!1}return!0}(n))}function lw(n,t,e){if("getBigUint64"in DataView.prototype)return n.getBigUint64(t,e);const i=n.getUint32(t,e),s=n.getUint32(t+4,e),a=+!!e,d=+!e;return BigInt(i*d+s*a)<<BigInt(32)|BigInt(i*a+s*d)}function uw(n,t,e,i){if("setBigUint64"in DataView.prototype)return n.setBigUint64(t,e,i);const s=Number(e>>BigInt(32)),a=Number(e&BigInt(4294967295));i?(n.setUint32(t+4,s,i),n.setUint32(t,a,i)):(n.setUint32(t,s,i),n.setUint32(t+4,a,i))}var Od,Dp;(function(n){n.COVERED="COVERED",n.POSITION="POSITION",n.SIZE="SIZE",n.STYLE="STYLE"})(Od||(Od={})),function(n){n.UNMOUNTED="UNMOUNTED",n.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(Dp||(Dp={}));const hw=new class{constructor(){g(this,"_clientSize",null),g(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),g(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),g(this,"getStyle",n=>window.getComputedStyle(n,null)),g(this,"checkCssVisibleProperty",n=>{var t;let e=!0;const i=this.getStyle(n),{display:s,visibility:a,opacity:d,filter:u}=i;return(s==="none"||It(t=["hidden","collapse"]).call(t,a)||Number(d)<.1)&&(e=!1),e?(u&&u.split(" ").filter(h=>{var p;const _=h.split("(")[0];return It(p=["brightness","blur","opacity"]).call(p,_)}).map(h=>{const[p,_]=h.split(/\(|\)/);return[p,Number(_.match(/^[0-9\.]+/))]}).forEach(h=>{const[p,_]=h;switch(p){case"brightness":(_<.1||_>3)&&(e=!1);break;case"blur":_>3&&(e=!1);break;case"opacity":_<.1&&(e=!1)}}),e):!1}),g(this,"checkPropertyUpToAllParentNodes",(n,t)=>{let e=!0,i=!0;const s=d=>t(d);let a=n;for(;a&&i;)s(a)||(e=!1,i=!1),a=a.parentElement,a||(i=!1);return e}),g(this,"checkActualCssVisibleIncludeInherit",n=>this.checkPropertyUpToAllParentNodes(n,this.checkCssVisibleProperty)),g(this,"getSizeAboutClient",n=>{const{width:t,height:e,left:i,right:s,top:a,bottom:d}=n.getBoundingClientRect(),u=this.getClientWidth(),h=this.getClientHeight();return{width:t,height:e,left:i,right:s,top:a,bottom:d,clientWidth:u,clientHeight:h,clientMin:Math.min(u,h)}}),g(this,"checkActualSize",()=>{const{width:n,height:t,clientMin:e}=this._clientSize;return this.checkSizeIsVisible(n,t,e)}),g(this,"elementFromPoint",(n,t)=>document.elementFromPoint?document.elementFromPoint(n,t):null),g(this,"checkCoverForAPoint",(n,t,e)=>{const i=this.elementFromPoint(n,t);return i!==null&&i!==e}),g(this,"getPointPositionList",()=>{const{width:n,height:t,left:e,top:i}=this._clientSize,s=n/6,a=t/6,d=[],u=10**6;for(let h=0;h<5;h++)for(let p=0;p<5;p++){const _=(e*u+(h===0?.1:h===4?(s*h*u-1e5)/u:s*h)*u)/u,m=(i*u+(p===0?.1:p===4?(a*p*u-1e5)/u:a*p)*u)/u;d.push({x:_,y:m})}return[...d]}),g(this,"checkElementCover",n=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,n)).filter(t=>!!t).length>6),g(this,"checkSizeIsVisible",(n,t,e)=>(n>50||e/n<=10)&&(t>50||e/t<=10)),g(this,"checkSizeOfPartInClient",()=>{const{left:n,right:t,top:e,bottom:i,clientHeight:s,clientWidth:a,clientMin:d}=this._clientSize;let u,h,p,_;if(n<0)u=0;else{if(!(n<a))return!1;u=n}if(t<0)return!1;if(h=t<a?t:a,e<0)p=0;else{if(!(e<s))return!1;p=e}if(i<0)return!1;_=i<s?i:s;const m=h-u,S=_-p;return this.checkSizeIsVisible(m,S,d)}),g(this,"returnHiddenResult",n=>(this._clientSize=null,{visible:!1,reason:n})),g(this,"checkOneElementVisible",n=>{if(n instanceof HTMLElement){if(this.checkElementIsMountedOnDom(n)){if(this.checkActualCssVisibleIncludeInherit(n)){if(this._clientSize=this.getSizeAboutClient(n),this.checkElementCover(n))return this.returnHiddenResult(Od.COVERED);{const t=this.checkActualSize(),e=this.checkSizeOfPartInClient();return t&&!e?this.returnHiddenResult(Od.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Od.SIZE)}}return this.returnHiddenResult(Od.STYLE)}return this.returnHiddenResult(Dp.UNMOUNTED)}return this.returnHiddenResult(Dp.INVALID_HTML_ELEMENT)}),g(this,"checkElementIsMountedOnDom",n=>this.checkPropertyUpToAllParentNodes(n,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function Cg(n){return new TextEncoder().encode(n)}const pw=function(n,t){const e=new Uint8Array(n.byteLength+t.byteLength);return e.set(new Uint8Array(n),0),e.set(new Uint8Array(t),n.byteLength),e},QG=async n=>{const t=function(a){const d=window.atob(a),u=new Uint8Array(new ArrayBuffer(d.length));for(let h=0;h<d.length;h+=1)u[h]=d.charCodeAt(h);return u}(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),e=await window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),i=Cg(n),s=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},e,i);return function(a){let d="";for(let u=0;u<a.length;u+=1)d+=String.fromCharCode(a[u]);return window.btoa(d)}(new Uint8Array(s))},$G=async n=>function(t,e){let i="";return new Uint8Array(t).forEach(s=>{i+=s.toString(e).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",Cg(n)),16);class Ye{constructor(){g(this,"_events",{}),g(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(e=>e.listener):[]}on(t,e){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,e)===-1&&i.push({listener:e,once:!1})}once(t,e){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,e)===-1&&i.push({listener:e,once:!0})}off(t,e){if(!this._events[t])return;const i=this._events[t],s=this._indexOfListener(i,e);s!==-1&&i.splice(s,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const e=this._events[t].map(d=>d);for(var i=arguments.length,s=new Array(i>1?i-1:0),a=1;a<i;a++)s[a-1]=arguments[a];for(let d=0;d<e.length;d+=1){const u=e[d];u.once&&this.off(t,u.listener),u.listener.apply(this,s||[])}}safeEmit(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),s=1;s<e;s++)i[s-1]=arguments[s];[...this._events[t]||[]].forEach(a=>{a.once&&this.off(t,a.listener);try{a.listener.apply(this,i)}catch(d){console.error("safeEmit event:".concat(t," error ").concat(d==null?void 0:d.toString()))}})}_indexOfListener(t,e){let i=t.length;for(;i--;)if(t[i].listener===e)return i;return-1}}let hu=null;function fw(){if(hu)return hu;if(window.electron)return hu=window.electron;if(!window.require)return null;try{return hu=window.require("electron"),hu}catch{return null}}var An,Je,Ig,oe,de,jn,Ai,No;function _w(n){return Pe(n.timeout,"config.timeout",0,1e5),Pe(n.timeoutFactor,"config.timeoutFactor",0,100,!1),Pe(n.maxRetryCount,"config.maxRetryConfig",0,1/0),Pe(n.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function Nd(n){if(!Array.isArray(n)||n.length<1)return!1;try{n.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function mw(n){return ai(n.turnServerURL,"turnServerURL"),ai(n.username,"username"),ai(n.password,"password"),n.udpport&&Pe(n.udpport,"udpport",1,99999,!0),n.forceturn&&gc(n.forceturn,"forceturn"),n.security&&gc(n.security,"security"),n.tcpport&&Pe(n.tcpport,"tcpport",1,99999,!0),!0}function Ew(n){return n.level!==void 0&&Bn(n.level,"level",[1,2,3]),n.delay!==void 0&&Pe(n.delay,"delay",0,3e3,!0),!0}function tn(n,t){for(var e=arguments.length,i=new Array(e>2?e-2:0),s=2;s<e;s++)i[s-2]=arguments[s];return n.getListeners(t).length===0?W.reject(new J(O.UNEXPECTED_ERROR,"can not emit promise")):new W((a,d)=>{n.emit(t,...i,a,d)})}function ke(n,t){if(n.getListeners(t).length===0)return W.resolve();for(var e=arguments.length,i=new Array(e>2?e-2:0),s=2;s<e;s++)i[s-2]=arguments[s];return tn(n,t,...i)}function Ki(n,t){if(n.getListeners(t).length===0)return null;for(var e=arguments.length,i=new Array(e>2?e-2:0),s=2;s<e;s++)i[s-2]=arguments[s];return Do(n,t,...i)}function Do(n,t){let e=null,i=null;for(var s=arguments.length,a=new Array(s>2?s-2:0),d=2;d<s;d++)a[d-2]=arguments[d];if(n.emit(t,...a,u=>{e=u},u=>{i=u}),i!==null)throw i;if(e===null)throw new J(O.UNEXPECTED_ERROR,"handler is not sync");return e}(function(n){n.CREATE_CLIENT="createClient",n.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",n.SET_AREA="setArea",n.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",n.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",n.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",n.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",n.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",n.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",n.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",n.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",n.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",n.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",n.START_PROXY_SERVER="Client.startProxyServer",n.STOP_PROXY_SERVER="Client.stopProxyServer",n.SET_PROXY_SERVER="Client.setProxyServer",n.SET_TURN_SERVER="Client.setTurnServer",n.SET_CLIENT_ROLE="Client.setClientRole",n.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",n.ENABLE_DUAL_STREAM="Client.enableDualStream",n.DISABLE_DUAL_STREAM="Client.disableDualStream",n.JOIN="Client.join",n.LEAVE="Client.leave",n.PUBLISH="Client.publish",n.UNPUBLISH="Client.unpublish",n.SUBSCRIBE="Client.subscribe",n.MASS_SUBSCRIBE="Client.massSubscribe",n.MASS_UNSUBSCRIBE="Client.massUnsubscribe",n.UNSUBSCRIBE="Client.unsubscribe",n.RENEW_TOKEN="Client.renewToken",n.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",n.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",n.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",n.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",n.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",n.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",n.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",n.DATACHANNEL_FAILBACK="Client._datachannelFailback",n.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",n.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",n.START_LIVE_STREAMING="Client.startLiveStreaming",n.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",n.STOP_LIVE_STREAMING="Client.stopLiveStreaming",n.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",n.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",n.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",n.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",n.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",n.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",n.SET_CONFIG_DISTRIBUTE="_configDistribute",n.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",n.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",n.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",n.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",n.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",n.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",n.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",n.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",n.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",n.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",n.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",n.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",n.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",n.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",n.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",n.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",n.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",n.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",n.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",n.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",n.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",n.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",n.STREAM_TYPE_CHANGE="streamTypeChange",n.CONNECTION_STATE_CHANGE="connectionStateChange",n.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",n.IMAGE_MODERATION_UPLOAD="imageModerationUpload"})(An||(An={})),function(n){n.TRACER="tracer"}(Je||(Je={})),function(n){n[n.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",n[n.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",n[n.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(Ig||(Ig={})),function(n){n.LEAVE="LEAVE",n.NETWORK_ERROR="NETWORK_ERROR",n.SERVER_ERROR="SERVER_ERROR",n.UID_BANNED="UID_BANNED",n.IP_BANNED="IP_BANNED",n.CHANNEL_BANNED="CHANNEL_BANNED",n.FALLBACK="FALLBACK",n.LICENSE_MISSING="LICENSE_MISSING",n.LICENSE_EXPIRED="LICENSE_EXPIRED",n.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",n.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",n.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",n.LICENSE_ILLEGAL="LICENSE_ILLEGAL",n.TOKEN_EXPIRE="TOKEN_EXPIRE"}(oe||(oe={})),function(n){n.CONNECTION_STATE_CHANGE="connection-state-change",n.MEDIA_RECONNECT_START="media-reconnect-start",n.MEDIA_RECONNECT_END="media-reconnect-end",n.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",n.USER_JOINED="user-joined",n.USER_LEAVED="user-left",n.USER_PUBLISHED="user-published",n.USER_UNPUBLISHED="user-unpublished",n.USER_INFO_UPDATED="user-info-updated",n.CLIENT_BANNED="client-banned",n.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",n.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",n.VOLUME_INDICATOR="volume-indicator",n.CRYPT_ERROR="crypt-error",n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",n.NETWORK_QUALITY="network-quality",n.STREAM_TYPE_CHANGED="stream-type-changed",n.STREAM_FALLBACK="stream-fallback",n.RECEIVE_METADATA="receive-metadata",n.STREAM_MESSAGE="stream-message",n.LIVE_STREAMING_ERROR="live-streaming-error",n.LIVE_STREAMING_WARNING="live-streaming-warning",n.INJECT_STREAM_STATUS="stream-inject-status",n.EXCEPTION="exception",n.ERROR="error",n.P2P_LOST="p2p_lost",n.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",n.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",n.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",n.PUBLISHED_USER_LIST="published-user-list",n.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",n.CONTENT_INSPECT_ERROR="content-inspect-error",n.CONTENT_INSPECT_RESULT="content-inspect-result",n.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change"}(de||(de={})),function(n){n.NETWORK_ERROR="NETWORK_ERROR",n.SERVER_ERROR="SERVER_ERROR",n.MULTI_IP="MULTI_IP",n.TIMEOUT="TIMEOUT",n.OFFLINE="OFFLINE",n.LEAVE="LEAVE",n.P2P_FAILED="P2P_FAILED",n.FALLBACK="FALLBACK"}(jn||(jn={})),function(n){n.ONLINE="ONLINE",n.OFFLINE="OFFLINE"}(Ai||(Ai={})),function(n){n.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",n.ONLINE="ONLINE",n.OFFLINE="OFFLINE"}(No||(No={}));const Tn=new class extends Ye{set networkState(n){this.emit(No.NETWORK_STATE_CHANGE,n,this._networkState),n===Ai.ONLINE?this.emit(No.ONLINE):n===Ai.OFFLINE&&(this.onlineWaiter=new W(t=>{this.once(No.ONLINE,()=>{this.onlineWaiter=void 0,t(Ai.ONLINE)})}),this.emit(No.OFFLINE)),this._networkState=n}get networkState(){return this._networkState}get isOnline(){return this._networkState===Ai.ONLINE}constructor(){super(),g(this,"_moduleName","network-indicator"),g(this,"_networkState",Ai.ONLINE),g(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Ai.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Ai.OFFLINE})}};function gw(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Sc(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?gw(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):gw(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}function bg(n,t){const e=n.indexOf(t);e!==-1&&n.splice(e,1)}function Dd(n){const t=[];return n.forEach(e=>{t.indexOf(e)===-1&&t.push(e)}),t}function ds(n){W!==void 0?W.resolve().then(n):setTimeout(n,0)}function yn(n){return JSON.parse(JSON.stringify(n))}function Tc(n){try{return yn(n)}catch{return n}}const Sw={};function pu(n,t){Sw[t]||(Sw[t]=!0,n())}function Pp(n){const t=window.atob(n),e=new Uint8Array(new ArrayBuffer(t.length));for(let i=0;i<t.length;i+=1)e[i]=t.charCodeAt(i);return e}function kp(n){let t="";for(let e=0;e<n.length;e+=1)t+=String.fromCharCode(n[e]);return window.btoa(t)}function Xs(n){return window.TextEncoder?new TextEncoder().encode(n).length:n.length}function Tw(n){let t=0;return/DingTalk/i.test(navigator.userAgent)&&n.realFormData&&(n=n.realFormData),n.forEach(e=>{t+=typeof e=="string"?Xs(e):e.size}),t+138}function ZG(n){const t=new J(O.TIMEOUT,"timeout");return new W((e,i)=>{window.setTimeout(()=>i(t),n)})}function si(n){return new W(t=>{window.setTimeout(t,n)})}function Le(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const e=Math.random().toString(16).substr(2,n).toLowerCase();return e.length===n?"".concat(t).concat(e):"".concat(t).concat(e)+Le(n-e.length,"")}function wg(){return Le(32,"").toUpperCase()}const Lp=()=>{},yw=new class{constructor(){g(this,"fnMap",new Map)}throttleByKey(n,t,e,i){for(var s=arguments.length,a=new Array(s>4?s-4:0),d=4;d<s;d++)a[d-4]=arguments[d];if(this.fnMap.has(t)){const u=this.fnMap.get(t);if(u.threshold!==e){u.fn(...u.args),clearTimeout(u.timer);const h=window.setTimeout(()=>{const p=this.fnMap.get(t);p&&p.fn(...p.args),this.fnMap.delete(t)},e);this.fnMap.set(t,{fn:n,threshold:e,timer:h,args:a,skipFn:i})}else u.skipFn&&u.skipFn(...u.args),this.fnMap.set(t,Sc(Sc({},u),{},{fn:n,args:a,skipFn:i}))}else{const u=window.setTimeout(()=>{const h=this.fnMap.get(t);h&&h.fn(...h.args),this.fnMap.delete(t)},e);this.fnMap.set(t,{fn:n,threshold:e,timer:u,args:a,skipFn:i})}}},Rw=yw.throttleByKey.bind(yw);function vw(n){return typeof n=="object"&&n!==null&&!(n instanceof RegExp)}function Ag(n,t){if(!vw(n)||!vw(t)||Array.isArray(n)&&!Array.isArray(t)||!Array.isArray(n)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(n)){const e=[...n];for(let i=0;i<t.length;i++)e[i]=Ag(n[i],t[i]);return e}{const e=Sc({},n);for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(Object.prototype.hasOwnProperty.call(n,i)?e[i]=Ag(n[i],t[i]):e[i]=t[i]);return e}}let t3=1,Mp=console;class zn{static setLogger(t){Mp=t}constructor(t){g(this,"lockingPromise",W.resolve()),g(this,"locks",0),g(this,"name",""),g(this,"lockId",void 0),this.lockId=t3++,t&&(this.name=t),Mp.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(t){let e;this.locks+=1,Mp.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof t=="string"?t:""));const i=new W(a=>{e=()=>{this.locks-=1,Mp.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof t=="string"?t:"")),a()}}),s=this.lockingPromise.then(()=>e);return this.lockingPromise=this.lockingPromise.then(()=>i),s}}function Pd(n,t){return function(e,i,s){const a=s.value;if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const d=this[t];if(!d)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(n));const u=await d.lock("From ".concat(n,".").concat(i));try{for(var h=arguments.length,p=new Array(h),_=0;_<h;_++)p[_]=arguments[_];return await a.apply(this,p)}finally{u()}},s}}const Rn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Up(n,t){const e=Math.floor(t.timeout*Math.pow(t.timeoutFactor,n));return Math.min(t.maxRetryTimeout,e)}function Ns(n,t,e,i){const s=Object.assign({},Rn,i);let a=s.timeout;const d=async()=>{await function(p){return new W(_=>{window.setTimeout(_,p)})}(a),a*=s.timeoutFactor,a=Math.min(s.maxRetryTimeout,a)};let u=!1;const h=new W(async(p,_)=>{t=t||(()=>!1),e=e||(()=>!0);for(let m=0;m<s.maxRetryCount;m+=1){if(u)return _(new J(O.OPERATION_ABORTED));try{const S=await n();if(!t(S,m)||m+1===s.maxRetryCount)return p(S);await d()}catch(S){if(!e(S,m)||m+1===s.maxRetryCount)return _(S);await d()}}});return h.cancel=()=>u=!0,h}var e3=as,n3=dc,i3=xm,r3=lc,s3=TypeError,Cw=function(n){return function(t,e,i,s){e3(e);var a=n3(t),d=i3(a),u=r3(a),h=n?u-1:0,p=n?-1:1;if(i<2)for(;;){if(h in d){s=d[h],h+=p;break}if(h+=p,n?h<0:u<=h)throw s3("Reduce of empty array with no initial value")}for(;n?h>=0:u>h;h+=p)h in d&&(s=e(s,d[h],h,a));return s}},o3={left:Cw(!1),right:Cw(!0)}.left;mn({target:"Array",proto:!0,forced:!ru&&cc>79&&cc<83||!BI("reduce")},{reduce:function(n){var t=arguments.length;return o3(this,n,t,t>1?arguments[1]:void 0)}});var a3=uc("Array").reduce,c3=Vn,d3=a3,Og=Array.prototype,yc=et(function(n){var t=n.reduce;return n===Og||c3(Og,n)&&t===Og.reduce?d3:t});let Ng=class{constructor(n){g(this,"input",[]),g(this,"size",void 0),this.size=n}add(n){this.input.push(n),this.input.length>this.size&&this.input.splice(0,1)}mean(){var n;return this.input.length===0?0:yc(n=this.input).call(n,(t,e)=>t+e)/this.input.length}};var Dg,Pg={exports:{}},Iw=function(n,t){return function(){for(var e=new Array(arguments.length),i=0;i<e.length;i++)e[i]=arguments[i];return n.apply(t,e)}},l3=Iw,kg=Object.prototype.toString,Lg=(Dg=Object.create(null),function(n){var t=kg.call(n);return Dg[t]||(Dg[t]=t.slice(8,-1).toLowerCase())});function Rc(n){return n=n.toLowerCase(),function(t){return Lg(t)===n}}function Mg(n){return Array.isArray(n)}function xp(n){return n===void 0}var bw=Rc("ArrayBuffer");function ww(n){return n!==null&&typeof n=="object"}function Vp(n){if(Lg(n)!=="object")return!1;var t=Object.getPrototypeOf(n);return t===null||t===Object.prototype}var u3=Rc("Date"),h3=Rc("File"),p3=Rc("Blob"),f3=Rc("FileList");function Ug(n){return kg.call(n)==="[object Function]"}var _3=Rc("URLSearchParams");function xg(n,t){if(n!=null)if(typeof n!="object"&&(n=[n]),Mg(n))for(var e=0,i=n.length;e<i;e++)t.call(null,n[e],e,n);else for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&t.call(null,n[s],s,n)}var Vg,m3=(Vg=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(n){return Vg&&n instanceof Vg}),Fi={isArray:Mg,isArrayBuffer:bw,isBuffer:function(n){return n!==null&&!xp(n)&&n.constructor!==null&&!xp(n.constructor)&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)},isFormData:function(n){var t="[object FormData]";return n&&(typeof FormData=="function"&&n instanceof FormData||kg.call(n)===t||Ug(n.toString)&&n.toString()===t)},isArrayBufferView:function(n){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(n):n&&n.buffer&&bw(n.buffer)},isString:function(n){return typeof n=="string"},isNumber:function(n){return typeof n=="number"},isObject:ww,isPlainObject:Vp,isUndefined:xp,isDate:u3,isFile:h3,isBlob:p3,isFunction:Ug,isStream:function(n){return ww(n)&&Ug(n.pipe)},isURLSearchParams:_3,isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:xg,merge:function n(){var t={};function e(a,d){Vp(t[d])&&Vp(a)?t[d]=n(t[d],a):Vp(a)?t[d]=n({},a):Mg(a)?t[d]=a.slice():t[d]=a}for(var i=0,s=arguments.length;i<s;i++)xg(arguments[i],e);return t},extend:function(n,t,e){return xg(t,function(i,s){n[s]=e&&typeof i=="function"?l3(i,e):i}),n},trim:function(n){return n.trim?n.trim():n.replace(/^\s+|\s+$/g,"")},stripBOM:function(n){return n.charCodeAt(0)===65279&&(n=n.slice(1)),n},inherits:function(n,t,e,i){n.prototype=Object.create(t.prototype,i),n.prototype.constructor=n,e&&Object.assign(n.prototype,e)},toFlatObject:function(n,t,e){var i,s,a,d={};t=t||{};do{for(s=(i=Object.getOwnPropertyNames(n)).length;s-- >0;)d[a=i[s]]||(t[a]=n[a],d[a]=!0);n=Object.getPrototypeOf(n)}while(n&&(!e||e(n,t))&&n!==Object.prototype);return t},kindOf:Lg,kindOfTest:Rc,endsWith:function(n,t,e){n=String(n),(e===void 0||e>n.length)&&(e=n.length),e-=t.length;var i=n.indexOf(t,e);return i!==-1&&i===e},toArray:function(n){if(!n)return null;var t=n.length;if(xp(t))return null;for(var e=new Array(t);t-- >0;)e[t]=n[t];return e},isTypedArray:m3,isFileList:f3},kd=Fi;function Aw(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Ow=function(n,t,e){if(!t)return n;var i;if(e)i=e(t);else if(kd.isURLSearchParams(t))i=t.toString();else{var s=[];kd.forEach(t,function(d,u){d!=null&&(kd.isArray(d)?u+="[]":d=[d],kd.forEach(d,function(h){kd.isDate(h)?h=h.toISOString():kd.isObject(h)&&(h=JSON.stringify(h)),s.push(Aw(u)+"="+Aw(h))}))}),i=s.join("&")}if(i){var a=n.indexOf("#");a!==-1&&(n=n.slice(0,a)),n+=(n.indexOf("?")===-1?"?":"&")+i}return n},E3=Fi;function Fp(){this.handlers=[]}Fp.prototype.use=function(n,t,e){return this.handlers.push({fulfilled:n,rejected:t,synchronous:!!e&&e.synchronous,runWhen:e?e.runWhen:null}),this.handlers.length-1},Fp.prototype.eject=function(n){this.handlers[n]&&(this.handlers[n]=null)},Fp.prototype.forEach=function(n){E3.forEach(this.handlers,function(t){t!==null&&n(t)})};var Nw,Dw,g3=Fp,S3=Fi;function Ld(){if(Dw)return Nw;Dw=1;var n=Fi;function t(s,a,d,u,h){Error.call(this),this.message=s,this.name="AxiosError",a&&(this.code=a),d&&(this.config=d),u&&(this.request=u),h&&(this.response=h)}n.inherits(t,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var e=t.prototype,i={};return["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(s){i[s]={value:s}}),Object.defineProperties(t,i),Object.defineProperty(e,"isAxiosError",{value:!0}),t.from=function(s,a,d,u,h,p){var _=Object.create(e);return n.toFlatObject(s,_,function(m){return m!==Error.prototype}),t.call(_,s.message,a,d,u,h),_.name=s.name,p&&Object.assign(_,p),_},Nw=t}var Fg,Pw,kw,Lw,Bg,Mw,Uw={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};function xw(){if(Pw)return Fg;Pw=1;var n=Fi;return Fg=function(t,e){e=e||new FormData;var i=[];function s(a){return a===null?"":n.isDate(a)?a.toISOString():n.isArrayBuffer(a)||n.isTypedArray(a)?typeof Blob=="function"?new Blob([a]):Buffer.from(a):a}return function a(d,u){if(n.isPlainObject(d)||n.isArray(d)){if(i.indexOf(d)!==-1)throw Error("Circular reference detected in "+u);i.push(d),n.forEach(d,function(h,p){if(!n.isUndefined(h)){var _,m=u?u+"."+p:p;if(h&&!u&&typeof h=="object"){if(n.endsWith(p,"{}"))h=JSON.stringify(h);else if(n.endsWith(p,"[]")&&(_=n.toArray(h)))return void _.forEach(function(S){!n.isUndefined(S)&&e.append(m,s(S))})}a(h,m)}}),i.pop()}else e.append(u,s(d))}(t),e},Fg}function T3(){if(Lw)return kw;Lw=1;var n=Ld();return kw=function(t,e,i){var s=i.config.validateStatus;i.status&&s&&!s(i.status)?e(new n("Request failed with status code "+i.status,[n.ERR_BAD_REQUEST,n.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):t(i)}}function y3(){if(Mw)return Bg;Mw=1;var n=Fi;return Bg=n.isStandardBrowserEnv()?{write:function(t,e,i,s,a,d){var u=[];u.push(t+"="+encodeURIComponent(e)),n.isNumber(i)&&u.push("expires="+new Date(i).toGMTString()),n.isString(s)&&u.push("path="+s),n.isString(a)&&u.push("domain="+a),d===!0&&u.push("secure"),document.cookie=u.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},Bg}var jg,Vw,Fw,Bw,jw,Ww,Gw,Hw,Wg,Yw,Kw,qw,R3=function(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)},v3=function(n,t){return t?n.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):n},zw=function(n,t){return n&&!R3(t)?v3(n,t):t};function C3(){if(Vw)return jg;Vw=1;var n=Fi,t=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return jg=function(e){var i,s,a,d={};return e&&n.forEach(e.split(`
`),function(u){if(a=u.indexOf(":"),i=n.trim(u.substr(0,a)).toLowerCase(),s=n.trim(u.substr(a+1)),i){if(d[i]&&t.indexOf(i)>=0)return;d[i]=i==="set-cookie"?(d[i]?d[i]:[]).concat([s]):d[i]?d[i]+", "+s:s}}),d},jg}function I3(){if(Bw)return Fw;Bw=1;var n=Fi;return Fw=n.isStandardBrowserEnv()?function(){var t,e=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");function s(a){var d=a;return e&&(i.setAttribute("href",d),d=i.href),i.setAttribute("href",d),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:i.pathname.charAt(0)==="/"?i.pathname:"/"+i.pathname}}return t=s(window.location.href),function(a){var d=n.isString(a)?s(a):a;return d.protocol===t.protocol&&d.host===t.host}}():function(){return!0}}function Bp(){if(Ww)return jw;Ww=1;var n=Ld();function t(e){n.call(this,e??"canceled",n.ERR_CANCELED),this.name="CanceledError"}return Fi.inherits(t,n,{__CANCEL__:!0}),jw=t}function b3(){return Hw||(Hw=1,Gw=function(n){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return t&&t[1]||""}),Gw}function w3(){if(Yw)return Wg;Yw=1;var n=Fi,t=T3(),e=y3(),i=Ow,s=zw,a=C3(),d=I3(),u=Uw,h=Ld(),p=Bp(),_=b3();return Wg=function(m){return new Promise(function(S,y){var b,I=m.data,A=m.headers,L=m.responseType;function U(){m.cancelToken&&m.cancelToken.unsubscribe(b),m.signal&&m.signal.removeEventListener("abort",b)}n.isFormData(I)&&n.isStandardBrowserEnv()&&delete A["Content-Type"];var F=new XMLHttpRequest;if(m.auth){var $=m.auth.username||"",z=m.auth.password?unescape(encodeURIComponent(m.auth.password)):"";A.Authorization="Basic "+btoa($+":"+z)}var G=s(m.baseURL,m.url);function Y(){if(F){var ct="getAllResponseHeaders"in F?a(F.getAllResponseHeaders()):null,$t={data:L&&L!=="text"&&L!=="json"?F.response:F.responseText,status:F.status,statusText:F.statusText,headers:ct,config:m,request:F};t(function(pe){S(pe),U()},function(pe){y(pe),U()},$t),F=null}}if(F.open(m.method.toUpperCase(),i(G,m.params,m.paramsSerializer),!0),F.timeout=m.timeout,"onloadend"in F?F.onloadend=Y:F.onreadystatechange=function(){F&&F.readyState===4&&(F.status!==0||F.responseURL&&F.responseURL.indexOf("file:")===0)&&setTimeout(Y)},F.onabort=function(){F&&(y(new h("Request aborted",h.ECONNABORTED,m,F)),F=null)},F.onerror=function(){y(new h("Network Error",h.ERR_NETWORK,m,F,F)),F=null},F.ontimeout=function(){var ct=m.timeout?"timeout of "+m.timeout+"ms exceeded":"timeout exceeded",$t=m.transitional||u;m.timeoutErrorMessage&&(ct=m.timeoutErrorMessage),y(new h(ct,$t.clarifyTimeoutError?h.ETIMEDOUT:h.ECONNABORTED,m,F)),F=null},n.isStandardBrowserEnv()){var q=(m.withCredentials||d(G))&&m.xsrfCookieName?e.read(m.xsrfCookieName):void 0;q&&(A[m.xsrfHeaderName]=q)}"setRequestHeader"in F&&n.forEach(A,function(ct,$t){I===void 0&&$t.toLowerCase()==="content-type"?delete A[$t]:F.setRequestHeader($t,ct)}),n.isUndefined(m.withCredentials)||(F.withCredentials=!!m.withCredentials),L&&L!=="json"&&(F.responseType=m.responseType),typeof m.onDownloadProgress=="function"&&F.addEventListener("progress",m.onDownloadProgress),typeof m.onUploadProgress=="function"&&F.upload&&F.upload.addEventListener("progress",m.onUploadProgress),(m.cancelToken||m.signal)&&(b=function(ct){F&&(y(!ct||ct&&ct.type?new p:ct),F.abort(),F=null)},m.cancelToken&&m.cancelToken.subscribe(b),m.signal&&(m.signal.aborted?b():m.signal.addEventListener("abort",b))),I||(I=null);var ut=_(G);ut&&["http","https","file"].indexOf(ut)===-1?y(new h("Unsupported protocol "+ut+":",h.ERR_BAD_REQUEST,m)):F.send(I)})},Wg}var Pi=Fi,Jw=function(n,t){S3.forEach(n,function(e,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(n[t]=e,delete n[i])})},Xw=Ld(),A3=Uw,O3=xw(),N3={"Content-Type":"application/x-www-form-urlencoded"};function Qw(n,t){!Pi.isUndefined(n)&&Pi.isUndefined(n["Content-Type"])&&(n["Content-Type"]=t)}var $w,jp={transitional:A3,adapter:((typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&($w=w3()),$w),transformRequest:[function(n,t){if(Jw(t,"Accept"),Jw(t,"Content-Type"),Pi.isFormData(n)||Pi.isArrayBuffer(n)||Pi.isBuffer(n)||Pi.isStream(n)||Pi.isFile(n)||Pi.isBlob(n))return n;if(Pi.isArrayBufferView(n))return n.buffer;if(Pi.isURLSearchParams(n))return Qw(t,"application/x-www-form-urlencoded;charset=utf-8"),n.toString();var e,i=Pi.isObject(n),s=t&&t["Content-Type"];if((e=Pi.isFileList(n))||i&&s==="multipart/form-data"){var a=this.env&&this.env.FormData;return O3(e?{"files[]":n}:n,a&&new a)}return i||s==="application/json"?(Qw(t,"application/json"),function(d,u,h){if(Pi.isString(d))try{return(u||JSON.parse)(d),Pi.trim(d)}catch(p){if(p.name!=="SyntaxError")throw p}return(h||JSON.stringify)(d)}(n)):n}],transformResponse:[function(n){var t=this.transitional||jp.transitional,e=t&&t.silentJSONParsing,i=t&&t.forcedJSONParsing,s=!e&&this.responseType==="json";if(s||i&&Pi.isString(n)&&n.length)try{return JSON.parse(n)}catch(a){if(s)throw a.name==="SyntaxError"?Xw.from(a,Xw.ERR_BAD_RESPONSE,this,null,this.response):a}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:qw?Kw:(qw=1,Kw=null)},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Pi.forEach(["delete","get","head"],function(n){jp.headers[n]={}}),Pi.forEach(["post","put","patch"],function(n){jp.headers[n]=Pi.merge(N3)});var Zw,tA,Gg=jp,D3=Fi,P3=Gg;function eA(){return tA?Zw:(tA=1,Zw=function(n){return!(!n||!n.__CANCEL__)})}var nA=Fi,Hg=function(n,t,e){var i=this||P3;return D3.forEach(e,function(s){n=s.call(i,n,t)}),n},k3=eA(),L3=Gg,M3=Bp();function Yg(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new M3}var iA,rA,Br=Fi,sA=function(n,t){t=t||{};var e={};function i(p,_){return Br.isPlainObject(p)&&Br.isPlainObject(_)?Br.merge(p,_):Br.isPlainObject(_)?Br.merge({},_):Br.isArray(_)?_.slice():_}function s(p){return Br.isUndefined(t[p])?Br.isUndefined(n[p])?void 0:i(void 0,n[p]):i(n[p],t[p])}function a(p){if(!Br.isUndefined(t[p]))return i(void 0,t[p])}function d(p){return Br.isUndefined(t[p])?Br.isUndefined(n[p])?void 0:i(void 0,n[p]):i(void 0,t[p])}function u(p){return p in t?i(n[p],t[p]):p in n?i(void 0,n[p]):void 0}var h={url:a,method:a,data:a,baseURL:d,transformRequest:d,transformResponse:d,paramsSerializer:d,timeout:d,timeoutMessage:d,withCredentials:d,adapter:d,responseType:d,xsrfCookieName:d,xsrfHeaderName:d,onUploadProgress:d,onDownloadProgress:d,decompress:d,maxContentLength:d,maxBodyLength:d,beforeRedirect:d,transport:d,httpAgent:d,httpsAgent:d,cancelToken:d,socketPath:d,responseEncoding:d,validateStatus:u};return Br.forEach(Object.keys(n).concat(Object.keys(t)),function(p){var _=h[p]||s,m=_(p);Br.isUndefined(m)&&_!==u||(e[p]=m)}),e};function oA(){return rA?iA:(rA=1,iA={version:"0.27.2"})}var U3=oA().version,ua=Ld(),Kg={};["object","boolean","number","function","string","symbol"].forEach(function(n,t){Kg[n]=function(e){return typeof e===n||"a"+(t<1?"n ":" ")+n}});var aA={};Kg.transitional=function(n,t,e){function i(s,a){return"[Axios v"+U3+"] Transitional option '"+s+"'"+a+(e?". "+e:"")}return function(s,a,d){if(n===!1)throw new ua(i(a," has been removed"+(t?" in "+t:"")),ua.ERR_DEPRECATED);return t&&!aA[a]&&(aA[a]=!0,console.warn(i(a," has been deprecated since v"+t+" and will be removed in the near future"))),!n||n(s,a,d)}};var cA,dA,lA,uA,hA,pA,x3={assertOptions:function(n,t,e){if(typeof n!="object")throw new ua("options must be an object",ua.ERR_BAD_OPTION_VALUE);for(var i=Object.keys(n),s=i.length;s-- >0;){var a=i[s],d=t[a];if(d){var u=n[a],h=u===void 0||d(u,a,n);if(h!==!0)throw new ua("option "+a+" must be "+h,ua.ERR_BAD_OPTION_VALUE)}else if(e!==!0)throw new ua("Unknown option "+a,ua.ERR_BAD_OPTION)}},validators:Kg},fA=Fi,V3=Ow,_A=g3,mA=function(n){return Yg(n),n.headers=n.headers||{},n.data=Hg.call(n,n.data,n.headers,n.transformRequest),n.headers=nA.merge(n.headers.common||{},n.headers[n.method]||{},n.headers),nA.forEach(["delete","get","head","post","put","patch","common"],function(t){delete n.headers[t]}),(n.adapter||L3.adapter)(n).then(function(t){return Yg(n),t.data=Hg.call(n,t.data,t.headers,n.transformResponse),t},function(t){return k3(t)||(Yg(n),t&&t.response&&(t.response.data=Hg.call(n,t.response.data,t.response.headers,n.transformResponse))),Promise.reject(t)})},Wp=sA,F3=zw,EA=x3,Md=EA.validators;function Ud(n){this.defaults=n,this.interceptors={request:new _A,response:new _A}}Ud.prototype.request=function(n,t){typeof n=="string"?(t=t||{}).url=n:t=n||{},(t=Wp(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var e=t.transitional;e!==void 0&&EA.assertOptions(e,{silentJSONParsing:Md.transitional(Md.boolean),forcedJSONParsing:Md.transitional(Md.boolean),clarifyTimeoutError:Md.transitional(Md.boolean)},!1);var i=[],s=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(t)===!1||(s=s&&m.synchronous,i.unshift(m.fulfilled,m.rejected))});var a,d=[];if(this.interceptors.response.forEach(function(m){d.push(m.fulfilled,m.rejected)}),!s){var u=[mA,void 0];for(Array.prototype.unshift.apply(u,i),u=u.concat(d),a=Promise.resolve(t);u.length;)a=a.then(u.shift(),u.shift());return a}for(var h=t;i.length;){var p=i.shift(),_=i.shift();try{h=p(h)}catch(m){_(m);break}}try{a=mA(h)}catch(m){return Promise.reject(m)}for(;d.length;)a=a.then(d.shift(),d.shift());return a},Ud.prototype.getUri=function(n){n=Wp(this.defaults,n);var t=F3(n.baseURL,n.url);return V3(t,n.params,n.paramsSerializer)},fA.forEach(["delete","get","head","options"],function(n){Ud.prototype[n]=function(t,e){return this.request(Wp(e||{},{method:n,url:t,data:(e||{}).data}))}}),fA.forEach(["post","put","patch"],function(n){function t(e){return function(i,s,a){return this.request(Wp(a||{},{method:n,headers:e?{"Content-Type":"multipart/form-data"}:{},url:i,data:s}))}}Ud.prototype[n]=t(),Ud.prototype[n+"Form"]=t(!0)});var gA=Fi,B3=Iw,Gp=Ud,j3=sA,Sr=function n(t){var e=new Gp(t),i=B3(Gp.prototype.request,e);return gA.extend(i,Gp.prototype,e),gA.extend(i,e),i.create=function(s){return n(j3(t,s))},i}(Gg);Sr.Axios=Gp,Sr.CanceledError=Bp(),Sr.CancelToken=function(){if(dA)return cA;dA=1;var n=Bp();function t(e){if(typeof e!="function")throw new TypeError("executor must be a function.");var i;this.promise=new Promise(function(a){i=a});var s=this;this.promise.then(function(a){if(s._listeners){var d,u=s._listeners.length;for(d=0;d<u;d++)s._listeners[d](a);s._listeners=null}}),this.promise.then=function(a){var d,u=new Promise(function(h){s.subscribe(h),d=h}).then(a);return u.cancel=function(){s.unsubscribe(d)},u},e(function(a){s.reason||(s.reason=new n(a),i(s.reason))})}return t.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},t.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},t.prototype.unsubscribe=function(e){if(this._listeners){var i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}},t.source=function(){var e;return{token:new t(function(i){e=i}),cancel:e}},cA=t}(),Sr.isCancel=eA(),Sr.VERSION=oA().version,Sr.toFormData=xw(),Sr.AxiosError=Ld(),Sr.Cancel=Sr.CanceledError,Sr.all=function(n){return Promise.all(n)},Sr.spread=uA?lA:(uA=1,lA=function(n){return function(t){return n.apply(null,t)}}),Sr.isAxiosError=function(){if(pA)return hA;pA=1;var n=Fi;return hA=function(t){return n.isObject(t)&&t.isAxiosError===!0}}(),Pg.exports=Sr,Pg.exports.default=Sr;var qi=et(Pg.exports);function SA(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function TA(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?SA(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):SA(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}let Hp,Yp=0,qg=0;function zg(n,t,e,i){return new W((s,a)=>{t.responseType=t.responseType||"json",t.data&&!e?(t.data=JSON.stringify(t.data),Yp+=Xs(t.data)):e&&(t.data.size?Yp+=t.data.size:t.data instanceof FormData?Yp+=Tw(t.data):Yp+=Xs(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=n,qi.request(t).then(d=>{typeof d.data=="string"?qg+=Xs(d.data):d.data instanceof ArrayBuffer||d.data instanceof Uint8Array?qg+=d.data.byteLength:qg+=Xs(JSON.stringify(d.data)),i&&s({data:d.data,headers:d.headers}),s(d.data)}).catch(d=>{qi.isCancel(d)?a(new J(O.OPERATION_ABORTED,"cancel token canceled")):d.code==="ECONNABORTED"?a(new J(O.NETWORK_TIMEOUT,d.message)):d.response?a(new J(O.NETWORK_RESPONSE_ERROR,d.response.status)):a(new J(O.NETWORK_ERROR,d.message))})})}async function W3(n,t){const e=new Blob([t.data],{type:"buffer"});return await zg(n,TA(TA({},t),{},{data:e,headers:{"Content-Type":"application/octet-stream"}}),!0)}const G3=()=>(Hp||Hp||(Hp=(window.location.protocol.split(":")[0]||"").toUpperCase(),Hp))==="HTTPS",yA=()=>window.isSecureContext!==void 0;function RA(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function bt(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?RA(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):RA(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}var le;(function(n){n.SET_SESSION_ID="SET_SESSION_ID",n.SET_P2P_ID="SET_P2P_id",n.SET_DC_ID="SET_DC_id",n.SET_UID="SET_UID",n.SET_PUB_ID="SET_PUB_ID",n.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",n.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",n.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",n.AVOID_JOIN_START="AVOID_JOIN_START",n.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",n.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",n.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",n.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",n.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",n.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",n.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",n.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",n.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",n.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",n.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",n.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",n.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",n.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",n.RESET_KEY_METRICS="RESET_KEY_METRICS",n.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",n.SET_USE_P2P="SET_USE_P2P"})(le||(le={}));class H3{constructor(t,e,i,s){g(this,"state",void 0),this.state={codec:t,audioCodec:e,mode:i,clientId:s,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1}}dispatch(t){this.state=function(e,i){switch(i.type){case le.SET_SESSION_ID:return bt(bt({},e),{},{sessionId:i.sessionId});case le.SET_P2P_ID:return bt(bt({},e),{},{p2pId:i.p2pId});case le.SET_UID:return bt(bt({},e),{},{uid:i.uid});case le.SET_PUB_ID:return bt(bt({},e),{},{pubId:i.pubId});case le.KEY_METRIC_CLIENT_CREATED:return bt(bt({},e),{},{keyMetrics:bt(bt({},e.keyMetrics),{},{clientCreated:i.metric})});case le.KEY_METRIC_JOIN_START:return bt(bt({},e),{},{keyMetrics:bt(bt({},e.keyMetrics),{},{joinStart:i.metric})});case le.AVOID_JOIN_START:return bt(bt({},e),{},{avoidJoinStart:i.avoidJoinStart});case le.KEY_METRIC_JOIN_END:return bt(bt({},e),{},{keyMetrics:bt(bt({},e.keyMetrics),{},{joinEnd:i.metric})});case le.KEY_METRIC_REQUEST_AP_START:return bt(bt({},e),{},{keyMetrics:bt(bt({},e.keyMetrics),{},{requestAPStart:i.metric})});case le.KEY_METRIC_REQUEST_AP_END:return bt(bt({},e),{},{keyMetrics:bt(bt({},e.keyMetrics),{},{requestAPEnd:i.metric})});case le.KEY_METRIC_JOIN_GATEWAY_START:return bt(bt({},e),{},{keyMetrics:bt(bt({},e.keyMetrics),{},{joinGatewayStart:i.metric})});case le.KEY_METRIC_JOIN_GATEWAY_END:return bt(bt({},e),{},{keyMetrics:bt(bt({},e.keyMetrics),{},{joinGatewayEnd:i.metric})});case le.KEY_METRIC_PEER_CONNECTION_START:return bt(bt({},e),{},{keyMetrics:bt(bt({},e.keyMetrics),{},{peerConnectionStart:i.metric})});case le.KEY_METRIC_PEER_CONNECTION_END:return bt(bt({},e),{},{keyMetrics:bt(bt({},e.keyMetrics),{},{peerConnectionEnd:i.metric})});case le.KEY_METRIC_DESCRIPTION_START:return bt(bt({},e),{},{keyMetrics:bt(bt({},e.keyMetrics),{},{descriptionStart:i.metric})});case le.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return bt(bt({},e),{},{keyMetrics:bt(bt({},e.keyMetrics),{},{signalChannelOpen:i.metric})});case le.KEY_METRIC_ICE_CONNECTION_END:return bt(bt({},e),{},{keyMetrics:bt(bt({},e.keyMetrics),{},{iceConnectionEnd:i.metric})});case le.KEY_METRIC_PUBLISH:{const s=e.keyMetrics.publish,a=s.findIndex(d=>d.trackId===i.metric.trackId);return a!==-1?(s[a]=bt(bt({},s[a]),i.metric),bt(bt({},e),{},{keyMetrics:bt(bt({},e.keyMetrics),{},{publish:[...s]})})):bt(bt({},e),{},{keyMetrics:bt(bt({},e.keyMetrics),{},{publish:[...e.keyMetrics.publish,i.metric]})})}case le.KEY_METRIC_SUBSCRIBE:{const s=e.keyMetrics.subscribe,a=s.findIndex(d=>d.userId===i.metric.userId&&d.type===i.metric.type);return a!==-1?(s[a]=bt(bt({},s[a]),i.metric),bt(bt({},e),{},{keyMetrics:bt(bt({},e.keyMetrics),{},{subscribe:[...s]})})):bt(bt({},e),{},{keyMetrics:bt(bt({},e.keyMetrics),{},{subscribe:[...e.keyMetrics.subscribe,i.metric]})})}case le.SET_CLOUD_PROXY_SERVER_MODE:return e.cloudProxyServerMode=i.mode,e;case le.RECORD_JOIN_CHANNEL_SERVICE:return typeof i.index!="number"?e.joinChannelServiceRecords=[...e.joinChannelServiceRecords,i.record]:(e.joinChannelServiceRecords[i.index]=bt(bt({},e.joinChannelServiceRecords[i.index]),i.record),e.joinChannelServiceRecords=[...e.joinChannelServiceRecords]),e;case le.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return e.joinChannelServiceRecords=[],e;case le.RESET_KEY_METRICS:return e.keyMetrics={publish:[],subscribe:[]},e;case le.SET_USE_DATACHANNEL:return bt(bt({},e),{},{useDataChannel:i.val});case le.SET_USE_P2P:return bt(bt({},e),{},{useP2P:i.val});default:return e}}(this.state,t)}set sessionId(t){this.dispatch({type:le.SET_SESSION_ID,sessionId:t})}get sessionId(){return this.state.sessionId}set codec(t){this.state.codec=t}get codec(){return this.state.codec}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(t){this.dispatch({type:le.SET_P2P_ID,p2pId:t})}get p2pId(){return this.state.p2pId}set dcId(t){this.dispatch({type:le.SET_DC_ID,dcId:t})}get dcId(){return this.state.dcId}set uid(t){this.dispatch({type:le.SET_UID,uid:t})}get uid(){return this.state.uid}set pubId(t){this.dispatch({type:le.SET_PUB_ID,pubId:t})}get pubId(){return this.state.pubId}set cloudProxyServerMode(t){this.dispatch({type:le.SET_CLOUD_PROXY_SERVER_MODE,mode:t})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(t){this.dispatch({type:le.SET_USE_DATACHANNEL,val:t})}get useDataChannel(){return this.state.useDataChannel}set useP2P(t){this.dispatch({type:le.SET_USE_P2P,val:t})}get useP2P(){return this.state.useP2P}clientCreated(){this.dispatch({type:le.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:le.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:le.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:le.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:le.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:le.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:le.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:le.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:le.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:le.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:le.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:le.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(t,e,i,s){this.dispatch({type:le.KEY_METRIC_PUBLISH,metric:bt(bt({trackId:t,type:e},i&&{publishStart:i}),s&&{publishEnd:s})})}subscribe(t,e,i,s,a,d,u){this.dispatch({type:le.KEY_METRIC_SUBSCRIBE,metric:bt(bt(bt(bt(bt({userId:t,type:e},i&&{subscribeStart:i}),s&&{subscribeEnd:s}),a&&{firstFrame:a}),d&&{streamAdded:d}),u&&{firstDecoded:u})})}massSubscribe(t,e,i,s){t.forEach(a=>{this.dispatch({type:le.KEY_METRIC_SUBSCRIBE,metric:bt(bt(bt({userId:a.userId,type:a.type},e&&{subscribeStart:e}),i&&{subscribeEnd:i}),s&&{firstFrame:s})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(t,e){t.service==="gateway"&&Array.isArray(t.urls)&&(t.urls=t.urls.map(i=>i.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof e!="number"?(this.dispatch({type:le.RECORD_JOIN_CHANNEL_SERVICE,record:bt(bt({},t),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(e<0||e>=this.state.joinChannelServiceRecords.length||this.dispatch({type:le.RECORD_JOIN_CHANNEL_SERVICE,record:t,index:e}),e)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:le.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:le.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(t){this.dispatch({type:le.AVOID_JOIN_START,avoidJoinStart:t})}}const jr=function(n){if(n.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return n;const t=n.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){const i=t[1],s=t[2];return"".concat(i,".").concat(s)}const e=n.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(e&&e[1]&&e[2]){const i=e[1],s=e[2];return"".concat(i,".").concat(100*(Number(s)+1))}return"4.0.0.999"}("4.19.3"),Jg=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),Xg="v4.19.3-0-gb2ca8ca7(11/2/2023, 2:57:33 PM)",ki={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:100,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,RTM2_FLAG:void 0,AP_RTM:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,USE_XR:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:1e4,P2P:!1,SHOW_P2P_LOG:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[]};function Ne(n,t,e){var i,s;It(i=Object.keys(ki)).call(i,n)&&(!e&&It(s=Object.keys(ha)).call(s,n)||(ki[n]=t))}function x(n){return ki[n]}const ha={};var vc,vA;(function(n){n.h264="h264",n.h265="h265",n.vp8="vp8",n.vp9="vp9",n.av1="av1"})(vc||(vc={})),function(n){n.opus="opus",n.pcma="pcma",n.pcmu="pcmu",n.g722="g722"}(vA||(vA={}));const Kp=new class extends Ye{reportLogUploadError(n){this.emit("REPORT_LOG_UPLOAD",n)}};class Y3{constructor(t){g(this,"logger",void 0),g(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.logger.debug(...this.prefixLists,...e)}info(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.logger.info(...this.prefixLists,...e)}warning(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.logger.warning(...this.prefixLists,...e)}error(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.logger.error(...this.prefixLists,...e)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function Qg(){const n=new Date;return n.toTimeString().split(" ")[0]+":"+n.getMilliseconds()}function CA(){const n=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+n.getUTCMilliseconds():n.toTimeString().split(" ")[0]+":"+n.getMilliseconds()}const Wr={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},qp=Date.now(),fu=n=>{for(const t in Wr)if(Object.prototype.hasOwnProperty.call(Wr,t)&&Wr[t]===n)return t;return"DEFAULT"},R=new class{constructor(){g(this,"proxyServerURL",void 0),g(this,"logLevel",Wr.DEBUG),g(this,"uploadState","collecting"),g(this,"uploadLogWaitingList",[]),g(this,"uploadLogUploadingList",[]),g(this,"uploadErrorCount",0),g(this,"currentLogID",0),g(this,"url",void 0),g(this,"extLog",(n,t)=>{this.appendLogToWaitingList(n,...t)})}debug(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];const i=[Wr.DEBUG].concat(t);this.log.apply(this,i)}info(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];const i=[Wr.INFO].concat(t);this.log.apply(this,i)}warning(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];const i=[Wr.WARNING].concat(t);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];const i=[Wr.ERROR].concat(t);this.log.apply(this,i)}upload(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];const i=[Wr.DEBUG].concat(t);this.uploadLog.apply(this,i)}setLogLevel(n){n=Math.min(Math.max(0,n),4),this.logLevel=n}enableLogUpload(){Ne("UPLOAD_LOG",!0)}disableLogUpload(){Ne("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(n){this.proxyServerURL=n}prefix(n){return new Y3(this).prefix(n)}log(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];if(Date.now()-qp<100)return void setTimeout(()=>{this.log(...t)},Date.now()-qp);const i=Math.max(0,Math.min(4,t[0]));if(t[0]=Qg()+" Agora-SDK [".concat(fu(i),"]:"),this.appendLogToWaitingList(i,...t),i<this.logLevel)return;const s=Qg()+" %cAgora-SDK [".concat(fu(i),"]:");let a=[];if(!x("USE_NEW_LOG"))switch(i){case Wr.DEBUG:a=[s,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,a);break;case Wr.INFO:a=[s,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,a);break;case Wr.WARNING:a=[s,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,a);break;case Wr.ERROR:a=[s,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,a)}}uploadLog(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];if(Date.now()-qp<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-qp);const i=Math.max(0,Math.min(4,t[0]));t[0]=Qg()+" Agora-SDK [".concat(fu(i),"]:"),this.appendLogToWaitingList(i,...t)}appendLogToWaitingList(n){if(!x("UPLOAD_LOG"))return;for(var t=arguments.length,e=new Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];Array.isArray(e[0])?e[0][0]=CA()+" Agora-SDK [".concat(fu(n),"]:"):e[0]=CA()+" Agora-SDK [".concat(fu(n),"]:");let s="";e.forEach(a=>{typeof a=="object"&&(a=JSON.stringify(a)),s+="".concat(a," ")}),this.uploadLogWaitingList.push({payload_str:s,log_level:n,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const n=this.uploadLogUploadingList,t={sdk_version:jr,process_id:x("PROCESS_ID"),payload:JSON.stringify(n)};return Ns(async()=>{const e=await qi.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(x("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(x("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(e.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=e,i}},()=>(this.uploadLogUploadingList=[],!1),e=>(e.response?Kp.reportLogUploadError({status:e.response.status,data:e.response.data,headers:e.response.headers,message:e.message}):e.request?Kp.reportLogUploadError({status:e.request.status,message:e.message}):Kp.reportLogUploadError({status:-1,message:e.message}),!0),{timeout:x("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:x("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,x("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),x("UPLOAD_LOG_INTERVAL"))}).catch(n=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),x("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),x("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var IA,bA;function K3(n){return ai(n.reportId,"params.reportId",0,100,!1),ai(n.category,"params.category",0,100,!1),ai(n.event,"params.event",0,100,!1),ai(n.label,"params.label",0,100,!1),Pe(n.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(function(n){n.FREE="free",n.UPLOADING="uploading"})(IA||(IA={})),function(n){n[n.MISC=0]="MISC",n[n.INTERNAL_EVENT=1]="INTERNAL_EVENT",n[n.PUBLIC_EVENT=2]="PUBLIC_EVENT",n[n.WEB_EVENT=3]="WEB_EVENT",n[n.INTERNAL_API=4]="INTERNAL_API",n[n.WEB_API=5]="WEB_API",n[n.PUBLIC_API=6]="PUBLIC_API"}(bA||(bA={}));const q3={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var Wn,Ke,wA,AA;function OA(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function ne(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?OA(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):OA(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}(function(n){n.PUBLISH="publish",n.SUBSCRIBE="subscribe",n.WS_COMPRESSOR_INIT="ws_compressor_init",n.SESSION_INIT="session_init",n.JOIN_CHOOSE_SERVER="join_choose_server",n.REQ_USER_ACCOUNT="req_user_account",n.JOIN_GATEWAY="join_gateway",n.REJOIN_GATEWAY="rejoin_gateway",n.STREAM_SWITCH="stream_switch",n.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",n.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",n.FIRST_VIDEO_RECEIVED="first_video_received",n.FIRST_AUDIO_RECEIVED="first_audio_received",n.FIRST_VIDEO_DECODE="first_video_decode",n.FIRST_AUDIO_DECODE="first_audio_decode",n.ON_ADD_AUDIO_STREAM="on_add_audio_stream",n.ON_ADD_VIDEO_STREAM="on_add_video_stream",n.ON_UPDATE_STREAM="on_update_stream",n.ON_REMOVE_STREAM="on_remove_stream",n.USER_ANALYTICS="req_user_analytics",n.PC_STATS="pc_stats"})(Wn||(Wn={})),function(n){n.SESSION="io.agora.pb.Wrtc.Session",n.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",n.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",n.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",n.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",n.PUBLISH="io.agora.pb.Wrtc.Publish",n.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",n.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",n.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",n.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",n.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",n.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",n.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",n.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",n.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",n.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",n.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",n.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",n.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",n.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",n.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",n.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",n.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",n.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",n.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",n.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",n.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",n.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",n.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",n.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",n.PC_STATS="io.agora.pb.Wrtc.PCStats"}(Ke||(Ke={})),function(n){n[n.WORKER_EVENT=156]="WORKER_EVENT",n[n.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(wA||(wA={})),function(n){n[n.SESSION=26]="SESSION",n[n.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",n[n.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",n[n.JOIN_GATEWAY=28]="JOIN_GATEWAY",n[n.PUBLISH=30]="PUBLISH",n[n.SUBSCRIBE=29]="SUBSCRIBE",n[n.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",n[n.STREAM_SWITCH=32]="STREAM_SWITCH",n[n.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",n[n.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",n[n.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",n[n.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",n[n.API_INVOKE=41]="API_INVOKE",n[n.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",n[n.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",n[n.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",n[n.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",n[n.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",n[n.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",n[n.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",n[n.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",n[n.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",n[n.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",n[n.WORKER_EVENT=156]="WORKER_EVENT",n[n.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",n[n.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",n[n.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",n[n.USER_ANALYTICS=1e4]="USER_ANALYTICS",n[n.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(AA||(AA={}));class _u{constructor(){g(this,"baseInfoMap",new Map),g(this,"proxyServer",void 0),g(this,"eventUploadTimer",void 0),g(this,"setSessionIdTimer",void 0),g(this,"url",void 0),g(this,"backupUrl",void 0),g(this,"_appId",void 0),g(this,"keyEventUploadPendingItems",[]),g(this,"normalEventUploadPendingItems",[]),g(this,"apiInvokeUploadPendingItems",[]),g(this,"apiInvokeCount",0),g(this,"ltsList",[]),g(this,"lastSendNormalEventTime",Date.now()),g(this,"customReportCounterTimer",void 0),g(this,"customReportCount",0),g(this,"extApiInvoke",async t=>{for(const e of t){const i=ne(ne({},e),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Je.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),x("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),x("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}adjustSessionStartTime(t){if(!this.baseInfoMap.has(t)&&!this.baseInfoMap.get(t))return void R.error("adjust session ".concat(t," start time, sid is not exist or info is undefined"));const e=this.baseInfoMap.get(t),i=Date.now(),s=e.startTime;e.startTime=i,R.debug("rewrite session ".concat(t," startTime: ").concat(i," , ").concat(i-s,"ms")),this.baseInfoMap.set(t,e)}setAppId(t){this._appId=t}reportApiInvoke(t,e,i){e.timeout=e.timeout||6e4,e.reportResult=e.reportResult===void 0||e.reportResult;const s=Date.now();this.apiInvokeCount+=1;const a=this.apiInvokeCount,d=()=>({tag:e.tag,invokeId:a,sid:t,name:e.name,apiInvokeTime:s,options:e.options,states:e.states||null}),u=!!x("SHOW_REPORT_INVOKER_LOG");u&&R.info("".concat(e.name," start"),e.options);let h=!1;si(e.timeout).then(()=>{h||(this.sendApiInvoke(ne(ne({},d()),{},{error:O.API_INVOKE_TIMEOUT,success:!1})),R.debug("".concat(e.name," timeout")))});const p=new J(O.UNEXPECTED_ERROR,"".concat(e.name,": this api invoke is end"));return{onSuccess:_=>{const m=()=>{if(h)throw p;return h=!0,this.sendApiInvoke(ne(ne({},d()),{},{success:!0},e.reportResult&&{result:_})),u&&R.info("".concat(e.name," onSuccess")),_};return i?Rw(m,e.name+"Success",i,()=>h=!0):m()},onError:_=>{const m=()=>{if(h)throw _;h=!0,this.sendApiInvoke(ne(ne({},d()),{},{success:!1,error:_})),u&&R.info("".concat(e.name," onFailure"),_.toString())};return i?Rw(m,e.name+"Error",i,()=>h=!0):m()}}}sessionInit(t,e){if(this.baseInfoMap.has(t))return;const i=Date.now(),s=this.createBaseInfo(t,i);s.cname=e.cname;const a=Object.assign({},{willUploadConsoleLog:x("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Jg?"global":"oversea",areas:x("AREAS")&&x("AREAS").join(",")},e.extend),d=Date.now(),u=ne(ne({},s),{},{eventType:Wn.SESSION_INIT,appid:e.appid,browser:navigator.userAgent,build:Xg,lts:d,elapse:d-i,extend:JSON.stringify(a),mode:e.mode,process:x("PROCESS_ID"),appType:x("APP_TYPE"),success:!0,version:jr});this.send({type:Ke.SESSION,data:u},!0)}joinChooseServer(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,a=Date.now(),d=ne(ne({},s),{},{eventType:Wn.JOIN_CHOOSE_SERVER,lts:a,eventElapse:a-e.lts,chooseServerAddr:e.csAddr,errorCode:e.ec,elapse:a-i.startTime,success:e.succ,chooseServerAddrList:JSON.stringify(e.serverList),uid:e.uid?parseInt(e.uid):null,cid:e.cid?parseInt(e.cid):null,chooseServerIp:e.csIp||"",opid:e.opid,unilbsServerIds:e.unilbsServerIds,extend:e.extend||void 0,isHttp3:e.isHttp3});this.send({type:Ke.JOIN_CHOOSE_SERVER,data:d},!0)}reqUserAccount(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,a=Date.now(),d=ne(ne({},s),{},{eventType:Wn.REQ_USER_ACCOUNT,lts:a,success:e.success,serverAddress:e.serverAddr,stringUid:e.stringUid,uid:e.uid,errorCode:e.errorCode,elapse:a-i.startTime,eventElapse:a-e.lts,extend:JSON.stringify(e.extend)});this.send({type:Ke.REQ_USER_ACCOUNT,data:d},!0)}joinGateway(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info;e.vid&&(s.vid=e.vid),s.uid=e.uid,s.cid=e.cid;const a=Date.now(),{firstSuccess:d,avoidJoinStartTime:u,isProxy:h,addr:p}=e,_=a-(d&&u?u:i.startTime),m=ne(ne({},s),{},{eventType:Wn.JOIN_GATEWAY,lts:a,gatewayAddr:e.addr,success:e.succ,errorCode:e.ec,elapse:_,eventElapse:a-e.lts,firstSuccess:d,signalChannel:e.signalChannel}),S=m.success?1:0;if(e.succ&&(i.lastJoinSuccessTime=a),d)this.send({type:Ke.JOIN_GATEWAY,data:m},!0);else{let y;if(p)if(h){const I=p.match(/h=(\d{1,3}-){3}\d{1,3}/g),A=p.match(/p=[0-9]{1,6}/g);y={isSuccess:S,gatewayIp:I&&I.length?I[0].split("=")[1].replace(/-/g,"."):"",port:A&&A.length?A[0].split("=")[1]:"",isProxy:h?1:0}}else{const I=p.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),A=p.match(/(:|p=)[0-9]{1,6}/g);y={isSuccess:S,gatewayIp:I&&I.length?I[0].split("//")[1].replace(/-/g,"."):"",port:A&&A.length?A[0].split(/:|p=/g)[1]:"",isProxy:h?1:0}}else y={isSuccess:S,gatewayIp:"",port:"",isProxy:h?1:0};delete m.success,delete m.eventType,delete m.firstSuccess,m.vid=Number(m.vid);const b=Object.assign({},m,y,{eventType:Wn.REJOIN_GATEWAY});this.send({type:Ke.RE_JOIN_GATEWAY,data:b},!0)}}joinChannelTimeout(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=Date.now(),a=ne(ne({},i.info),{},{lts:s,timeout:e,elapse:s-i.startTime});this.send({type:Ke.JOIN_CHANNEL_TIMEOUT,data:a},!0)}publish(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,a=Date.now(),d=ne(ne({},s),{},{eventType:Wn.PUBLISH,lts:a,eventElapse:e.eventElapse,elapse:a-i.startTime,success:e.succ,errorCode:e.ec,videoName:e.videoName,audioName:e.audioName,screenName:e.screenName,screenshare:e.screenshare,audio:e.audio,video:e.video,p2pid:e.p2pid,publishRequestid:e.publishRequestid});this.send({type:Ke.PUBLISH,data:d},!0)}subscribe(t,e,i){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,d=Date.now(),u=ne(ne({},a),{},{eventType:Wn.SUBSCRIBE,lts:d,eventElapse:e.eventElapse,elapse:d-s.startTime,success:e.succ,errorCode:e.ec,video:e.video,audio:e.audio,subscribeRequestid:e.subscribeRequestid,p2pid:e.p2pid},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof e.peerid=="string"?u.peerSuid=e.peerid:u.peer=e.peerid,this.send({type:Ke.SUBSCRIBE,data:u},!0)}wsCompressorInit(t){var e;const i=[...gr(e=this.baseInfoMap).call(e)],s=i.length?i[0]:"UnableToGetSid",a=this.baseInfoMap.get(s);if(!a)return;const d=a.info,u=Date.now(),h=ne(ne({},d),{},{eventType:Wn.WS_COMPRESSOR_INIT,lts:u,eventElapse:t.eventElapse,elapse:u-a.startTime,status:t.status?1:2});this.send({type:Ke.WS_COMPRESSOR_INIT,data:h},!0)}firstRemoteVideoDecode(t,e,i,s){const a=this.baseInfoMap.get(t);if(!a)return;const d=a.info,u=Date.now(),h=ne(ne(ne({},d),s),{},{elapse:u-a.startTime,eventType:e,lts:u,firstDecodeFrame:Math.max(u-a.startTime,0),apEnd:Math.max(s.apEnd-a.startTime,0),apStart:Math.max(s.apStart-a.startTime,0),joinGwEnd:Math.max(s.joinGwEnd-a.startTime,0),joinGwStart:Math.max(s.joinGwStart-a.startTime,0),pcEnd:Math.max(s.pcEnd-a.startTime,0),pcStart:Math.max(s.pcStart-a.startTime,0),subscriberEnd:Math.max(s.subscriberEnd-a.startTime,0),subscriberStart:Math.max(s.subscriberStart-a.startTime,0),videoAddNotify:Math.max(s.videoAddNotify-a.startTime,0)});this.send({type:i,data:h},!0)}firstRemoteFrame(t,e,i,s){const a=this.baseInfoMap.get(t);if(!a)return;const d=a.info,u=Date.now(),h=ne(ne(ne({},d),s),{},{elapse:u-a.startTime,eventType:e,lts:u});this.send({type:i,data:h},!0)}pcStats(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,a=Date.now(),d=ne(ne(ne({},s),e),{},{vid:s.vid===void 0?0:Number(s.vid),elapse:a-i.startTime,eventType:Wn.PC_STATS,lts:a});this.send({type:Ke.PC_STATS,data:d},!0)}updateRemoteRTPCapabilities(t,e){this.reportApiInvoke(t,{name:"Client.updateRemoteRTPCapabilities",options:e,tag:Je.TRACER}).onSuccess()}onGatewayStream(t,e,i,s){const a=this.baseInfoMap.get(t);if(!a)return;const d=a.info,u=Date.now(),h=ne(ne(ne({},d),s),{},{eventType:e,lts:u});this.send({type:i,data:h},!0)}streamSwitch(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,a=Date.now(),d=ne(ne({},s),{},{eventType:Wn.STREAM_SWITCH,lts:a,isDual:e.isdual,elapse:a-i.startTime,success:e.succ});this.send({type:Ke.STREAM_SWITCH,data:d},!0)}requestProxyAppCenter(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,a=Date.now(),d=ne(ne({},s),{},{eventType:Wn.REQUEST_PROXY_APPCENTER,lts:a,eventElapse:a-e.lts,elapse:a-i.startTime,APAddr:e.APAddr,workerManagerList:e.workerManagerList,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:Ke.REQUEST_PROXY_APPCENTER,data:d},!0)}requestProxyWorkerManager(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,a=Date.now(),d=ne(ne({},s),{},{eventType:Wn.REQUEST_PROXY_WORKER_MANAGER,lts:a,eventElapse:a-e.lts,elapse:a-i.startTime,workerManagerAddr:e.workerManagerAddr,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:Ke.REQUEST_PROXY_WORKER_MANAGER,data:d},!0)}setProxyServer(t){this.proxyServer=t,t?R.debug("reportProxyServerurl: ".concat(t)):R.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,a=Date.now(),d=ne(ne({},s),{},{subscribeElapse:e.subscribeElapse,peer:e.peer,peerPublishDuration:Math.max(e.audioPublishDuration,e.videoPublishDuration),audiotag:e.audioPublishDuration>0?1:-1,videotag:e.videoPublishDuration>0?1:-1,lts:a,elapse:a-i.startTime,joinChannelSuccessElapse:a-(i.lastJoinSuccessTime||a),peerPublishDurationVideo:e.videoPublishDuration,peerPublishDurationAudio:e.audioPublishDuration});this.send({type:Ke.PEER_PUBLISH_STATUS,data:d},!0)}workerEvent(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,a=Date.now();(function(u,h,p){const _=u[h];if(!_||typeof _!="string")return[u];u[h]="";const m=Xs(JSON.stringify(u));let S=0;const y=[];let b=0;for(let I=0;I<_.length;I++)b+=_.charCodeAt(I)<=127?1:3,b<=p-m||(y[y.length]=Sc(Sc({},u),{},{[h]:_.substring(S,I)}),S=I,b=_.charCodeAt(I)<=127?1:3);return S!==_.length-1&&(y[y.length]=Sc(Sc({},u),{},{[h]:_.substring(S)})),y})(ne(ne(ne({},s),e),{},{elapse:a-i.startTime,lts:a,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:Ke.WORKER_EVENT,data:u},!0))}apworkerEvent(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,a=Date.now(),d=ne(ne(ne({},s),e),{},{elapse:a-i.startTime,lts:a});this.send({type:Ke.AP_WORKER_EVENT,data:d},!0)}joinWebProxyAP(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,a=Date.now(),d=ne(ne(ne({},s),e),{},{elapse:a-i.startTime,lts:a,extend:e.extend||void 0});this.send({type:Ke.JOIN_WEB_PROXY_AP,data:d},!0)}WebSocketQuit(t,e){const i=this.baseInfoMap.get(t);if(!i)return;const s=i.info,a=Date.now(),d=ne(ne(ne({},s),e),{},{elapse:a-i.startTime,lts:a});this.send({type:Ke.WEBSOCKET_QUIT,data:d},!0)}async sendCustomReportMessage(t,e){if(this.customReportCount+=e.length,this.customReportCount>x("CUSTOM_REPORT_LIMIT"))throw new J(O.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const i=Date.now(),s=e.map(a=>({type:Ke.USER_ANALYTICS,data:ne(ne({sid:t},a),{},{lts:i})}));try{x("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(s):await this.postDataToStatsCollector(s)}catch(a){throw R.error("send custom report message failed",a.toString()),new J(O.CUSTOM_REPORT_SEND_FAILED,a.message)}}sendApiInvoke(t){const e=x("NOT_REPORT_EVENT");if(t.tag&&It(e)&&It(e).call(e,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const i=this.baseInfoMap.get(t.sid);if(!i)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:s,uid:a,cid:d}=i.info;let u;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof J){const{code:p,message:_}=t.error;u=p||_||t.error.toString()}else u=t.error.toString();const h={invokeId:t.invokeId,sid:t.sid,cname:s,cid:d,uid:a,lts:t.lts,success:t.success,elapse:t.lts-i.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?u:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:Ke.API_INVOKE,data:h},!1),!0}appendSessionId(){_u.__CLIENT_LIST__.forEach(t=>{if(t._sessionId){const e=this.apiInvokeUploadPendingItems.length;for(let i=0;i<e;i++){const s=this.apiInvokeUploadPendingItems.shift();s&&(s.sid=t._sessionId,this.sendApiInvoke(Object.assign({},s)))}}})}send(t,e){if(e)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>x("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,e){const i=[],s=[];for(;t.length;){const d=t.shift();i.length<20?i.push(d):s.push(d)}t.push(...s);for(const d of[...i]){var a;this.ltsList.indexOf(d.data.lts)!==-1?(d.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(d.data.lts)):(this.ltsList.push(d.data.lts),eu(a=this.ltsList).call(a,(u,h)=>u-h))}return e||(this.lastSendNormalEventTime=Date.now()),x("ENABLE_EVENT_REPORT")&&i.length&&(x("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((d=>u=>{x("EVENT_REPORT_RETRY")&&(e?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(d):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(d),this.normalEventUploadPendingItems.length>x("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-x("NORMAL_EVENT_QUEUE_CAPACITY")),R.warning("report: drop normal events"))))})(i)),t}async postDataToStatsCollector2(t){Tn.networkState===Ai.OFFLINE&&await W.race([Tn.onlineWaiter,si(2*Rn.maxRetryTimeout)]);const e=a=>{let d=new Uint8Array;return a.forEach(u=>{const h=Cg(JSON.stringify(u.data)),p=new ArrayBuffer(5),_=(S=>{let y=0;return Object.entries(Ke).forEach(b=>{let[I,A]=b;A===S.type&&(y=EventNameToID[I])}),y})(u),m=new DataView(p);m.setUint16(0,h.byteLength,!0),m.setUint8(2,255&_),m.setUint8(3,_>>>8&255),m.setUint8(4,_>>>16&255),d=pw(d,new Uint8Array(p)),d=pw(d,h)}),d},i="event";let s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(x("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(x("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let a=0;a<2;a+=1){a===1&&(s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(x("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(x("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await zg(s,{timeout:1e4,data:e(t),headers:ne(ne({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(d){if(a===1)throw d;continue}return}}async postDataToStatsCollector(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(d=>JSON.stringify(d)),vid:(d=>{const u=d&&d.data.sid&&this.baseInfoMap.get(d.data.sid);return u&&u.info.vid&&+u.info.vid||0})(t[0])};Tn.networkState===Ai.OFFLINE&&await W.race([Tn.onlineWaiter,si(2*Rn.maxRetryTimeout)]);const s=e?"/events/proto-raws":"/events/messages";let a=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(x("EVENT_REPORT_DOMAIN"),"&p=").concat(x("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(x("EVENT_REPORT_DOMAIN"),":").concat(x("STATS_COLLECTOR_PORT")).concat(s));for(let d=0;d<2;d+=1){d===1&&(a=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(x("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(x("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(x("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(x("STATS_COLLECTOR_PORT")).concat(s)));try{e?await W3(a,{timeout:1e4,data:i}):await zg(a,{timeout:1e4,data:i})}catch(u){if(d===1)throw u;continue}return}}createBaseInfo(t,e){const i=Object.assign({},q3);return i.sid=t,this.baseInfoMap.set(t,{info:i,startTime:e}),i}reportResourceTiming(t,e){const i=performance.getEntriesByName(t),s=i[i.length-1];s&&this.reportApiInvoke(e,{name:"Client.resourceTiming",options:s,tag:Je.TRACER}).onSuccess()}}function Lt(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,e,i){const s=i.value;if(typeof s=="function"){const a=n.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);i.value=function(){for(var d=arguments.length,u=new Array(d),h=0;h<d;h++)u[h]=arguments[h];let p=u;if(n.argsMap)try{p=n.argsMap(this,...u)}catch(m){R.warning(m),p=[]}try{JSON.stringify(p)}catch{R.warning("arguments for method ".concat(a,".").concat(String(e)," not serializable for apiInvoke.")),p=[]}const _=(n.report||vt).reportApiInvoke(this._sessionId||null,{name:"".concat(a,".").concat(String(e)),options:p,tag:Je.TRACER,reportResult:n.reportResult},n.throttleTime);try{const m=s.apply(this,u);return m instanceof W?m.then(S=>(_.onSuccess(n.reportResult&&S),S)).catch(S=>{throw _.onError(S),S}):(_.onSuccess(n.reportResult&&m),m)}catch(m){throw _.onError(m),m}}}return i}}g(_u,"__CLIENT_LIST__",[]);const vt=new _u;Kp.on("REPORT_LOG_UPLOAD",n=>{n.networkState=Tn.networkState,vt.reportApiInvoke(null,{name:"logUploadError",options:n,tag:Je.TRACER})});const z3=["CHINA","GLOBAL"],Tr=function(){const n="us".concat("erna","me"),t="pa".concat("sswo","rd"),e=["t","s","t"];e.splice(1,0,"e");const i=e.join(""),s=[];for(let u=0;u<6;u++)s.push("1");const a=s.join(""),d={};return d[n]=i,d[t]=a,Object.assign(d,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Tr,Jg||(ki.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],ki.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],ki.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],ki.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ki.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],ki.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],ki.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",ki.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",ki.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",ki.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",ki.AREAS=["NORTH_AMERICA","OVERSEA"]);const NA=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],pa=[];function Cc(n,t){return!!t&&pa.some(e=>e.uid===n&&e.channelName===t)}_u.__CLIENT_LIST__=pa;var $g,zi,xd,mu,yr,mi,Dt,ie,ht,yt,Ji,Kt,DA,Vd,Bt,kn,fa,J3=uc("Array").values,X3=hc,Q3=Yi,$3=Vn,Z3=J3,Zg=Array.prototype,tH={DOMTokenList:!0,NodeList:!0},Qs=et(function(n){var t=n.values;return n===Zg||$3(Zg,n)&&t===Zg.values||Q3(tH,X3(n))?Z3:t});function X(n,t,e,i){var s,a=arguments.length,d=a<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(n,t,e,i);else for(var u=n.length-1;u>=0;u--)(s=n[u])&&(d=(a<3?s(d):a>3?s(t,e,d):s(t,e))||d);return a>3&&d&&Object.defineProperty(t,e,d),d}function C(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)}(function(n){n.L1T1="L1T1",n.L1T2="L1T2",n.L1T3="L1T3",n.L2T1_KEY="L2T1_KEY",n.L2T2_KEY="L2T2_KEY",n.L2T3_KEY="L2T3_KEY",n.L3T1_KEY="L3T1_KEY",n.L3T2_KEY="L3T2_KEY",n.L3T3_KEY="L3T3_KEY"})($g||($g={})),function(n){n.CERTIFICATE="certificate",n.CODEC="codec",n.CANDIDATE_PAIR="candidate-pair",n.LOCAL_CANDIDATE="local-candidate",n.REMOTE_CANDIDATE="remote-candidate",n.INBOUND="inbound-rtp",n.TRACK="track",n.OUTBOUND="outbound-rtp",n.PC="peer-connection",n.REMOTE_INBOUND="remote-inbound-rtp",n.REMOTE_OUTBOUND="remote-outbound-rtp",n.TRANSPORT="transport",n.CSRC="csrc",n.DATA_CHANNEL="data-channel",n.STREAM="stream",n.SENDER="sender",n.RECEIVER="receiver"}(zi||(zi={})),function(n){n[n.ACCESS_POINT=101]="ACCESS_POINT",n[n.UNILBS=201]="UNILBS",n[n.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(xd||(xd={})),function(n){n[n.IIIEGAL_APPID=1]="IIIEGAL_APPID",n[n.IIIEGAL_UID=2]="IIIEGAL_UID",n[n.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(mu||(mu={})),function(n){n[n.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",n[n.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",n[n.INTERNAL_ERROR=8]="INTERNAL_ERROR",n[n.NO_AUTHORIZED=9]="NO_AUTHORIZED",n[n.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",n[n.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",n[n.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",n[n.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",n[n.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",n[n.USER_OVERLOAD=16]="USER_OVERLOAD",n[n.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",n[n.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(yr||(yr={})),function(n){n[n.NO_FLAG_SET=100]="NO_FLAG_SET",n[n.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",n[n.INVALID_FALG_SET=102]="INVALID_FALG_SET",n[n.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",n[n.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",n[n.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",n[n.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",n[n.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",n[n.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",n[n.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",n[n.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",n[n.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",n[n.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",n[n.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",n[n.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",n[n.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",n[n.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",n[n.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",n[n.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(mi||(mi={})),function(n){n[n.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",n[n.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",n[n.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",n[n.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",n[n.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",n[n.K_TICKET_INVALID=7]="K_TICKET_INVALID",n[n.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",n[n.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",n[n.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",n[n.K_UID_BANNED=14]="K_UID_BANNED",n[n.K_IP_BANNED=15]="K_IP_BANNED",n[n.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",n[n.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",n[n.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",n[n.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",n[n.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",n[n.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",n[n.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",n[n.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",n[n.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",n[n.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",n[n.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",n[n.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",n[n.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",n[n.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",n[n.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",n[n.ERR_INVALID_UID=117]="ERR_INVALID_UID",n[n.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",n[n.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",n[n.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",n[n.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",n[n.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",n[n.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",n[n.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",n[n.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",n[n.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",n[n.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",n[n.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",n[n.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",n[n.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",n[n.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",n[n.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",n[n.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",n[n.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",n[n.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",n[n.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",n[n.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",n[n.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",n[n.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",n[n.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",n[n.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",n[n.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",n[n.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",n[n.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",n[n.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",n[n.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",n[n.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",n[n.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",n[n.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",n[n.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",n[n.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",n[n.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",n[n.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",n[n.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(Dt||(Dt={})),function(n){n.CONNECTING="connecting",n.CONNECTED="connected",n.RECONNECTING="reconnecting",n.CLOSED="closed"}(ie||(ie={})),function(n){n.WS_CONNECTED="ws_connected",n.WS_RECONNECTING="ws_reconnecting",n.WS_CLOSED="ws_closed",n.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",n.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",n.ON_BINARY_DATA="on_binary_data",n.REQUEST_RECOVER="request_recover",n.REQUEST_JOIN_INFO="request_join_info",n.REQUEST_REJOIN_INFO="req_rejoin_info",n.IS_P2P_DISCONNECTED="is_p2p_dis",n.DISCONNECT_P2P="dis_p2p",n.ABORT_P2P_EXECUTION="abort_p2p_execution",n.NEED_RENEW_SESSION="need-sid",n.REPORT_JOIN_GATEWAY="report_join_gateway",n.REQUEST_TIMEOUT="request_timeout",n.REQUEST_SUCCESS="request_success",n.JOIN_RESPONSE="join_response",n.DATACHANNEL_PRECONNECT="datachannel_preconnect",n.DATACHANNEL_CONNECTING="datachannel_connecting",n.DATACHANNEL_FAILBACK="datachannel_failback",n.P2P_START="p2p_start",n.P2P_CONNECTION="p2p_connection",n.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",n.P2P_SUBSCRIBE="p2p_subscribe",n.P2P_UNSUBSCRIBE="p2p_unsubscribe",n.P2P_EXCHANGE_SDP="p2p_exchange_sdp",n.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",n.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream"}(ht||(ht={})),function(n){n.PING="ping",n.PING_BACK="ping_back",n.JOIN="join_v3",n.REJOIN="rejoin_v3",n.LEAVE="leave",n.SET_CLIENT_ROLE="set_client_role",n.PUBLISH="publish",n.PUBLISH_DATASTREAM="publish_datastream",n.UNPUBLISH="unpublish",n.UNPUBLISH_DATASTREAM="unpublish_datastream",n.SUBSCRIBE="subscribe",n.SUBSCRIBE_DATASTREAM="subscribe_datastream",n.SUBSCRIBE_STREAMS="subscribe_streams",n.UNSUBSCRIBE="unsubscribe",n.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",n.UNSUBSCRIBE_STREAMS="unsubscribe_streams",n.SUBSCRIBE_CHANGE="subscribe_change",n.TRAFFIC_STATS="traffic_stats",n.RENEW_TOKEN="renew_token",n.SWITCH_VIDEO_STREAM="switch_video_stream",n.DEFAULT_VIDEO_STREAM="default_video_stream",n.SET_FALLBACK_OPTION="set_fallback_option",n.GATEWAY_INFO="gateway_info",n.CONTROL="control",n.SEND_METADATA="send_metadata",n.DATA_STREAM="data_stream",n.PICK_SVC_LAYER="pick_svc_layer",n.RESTART_ICE="restart_ice",n.CONNECT_PC="connect_pc",n.SET_VIDEO_PROFILE="set_video_profile",n.SET_PARAMETER="set_parameter",n.SET_RTM2_FLAG="set_rtm2_flag"}(yt||(yt={})),function(n){n.PUBLISH_STATS="publish_stats",n.PUBLISH_RELATED_STATS="publish_related_stats",n.SUBSCRIBE_STATS="subscribe_stats",n.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",n.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",n.DENOISER_STATS="denoiser_stats",n.TRANSPORT_STATS="transport_stats",n.EXTENSION_USAGE_STATS="extension_usage_stats"}(Ji||(Ji={})),function(n){n.ON_USER_ONLINE="on_user_online",n.ON_USER_OFFLINE="on_user_offline",n.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",n.ON_PUBLISH_STREAM="on_publish_stream",n.ON_UPLINK_STATS="on_uplink_stats",n.ON_P2P_LOST="on_p2p_lost",n.ON_REMOVE_STREAM="on_remove_stream",n.ON_ADD_AUDIO_STREAM="on_add_audio_stream",n.ON_ADD_VIDEO_STREAM="on_add_video_stream",n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",n.ON_USER_BANNED="on_user_banned",n.ON_USER_LICENSE_BANNED="on_user_license_banned",n.ON_NOTIFICATION="on_notification",n.ON_CRYPT_ERROR="on_crypt_error",n.MUTE_AUDIO="mute_audio",n.MUTE_VIDEO="mute_video",n.UNMUTE_AUDIO="unmute_audio",n.UNMUTE_VIDEO="unmute_video",n.ON_P2P_OK="on_p2p_ok",n.RECEIVE_METADATA="receive_metadata",n.ON_DATA_STREAM="on_data_stream",n.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",n.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",n.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",n.ENABLE_LOCAL_VIDEO="enable_local_video",n.DISABLE_LOCAL_VIDEO="disable_local_video",n.ENABLE_LOCAL_AUDIO="enable_local_audio",n.DISABLE_LOCAL_AUDIO="disable_local_audio",n.ON_PUBLISHED_USER_LIST="on_published_user_list"}(Kt||(Kt={})),function(n){n.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",n.NEED_ANSWER="NEED_ANSWER",n.NEED_RENEGOTIATE="NEED_RENEGOTIATE",n.P2P_LOST="P2P_LOST",n.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",n.NEED_UNPUB="NEED_UNPUB",n.NEED_UNSUB="NEED_UNSUB",n.NEED_UPLOAD="NEED_UPLOAD",n.NEED_CONTROL="NEED_CONTROL",n.START_RECONNECT="START_RECONNECT",n.END_RECONNECT="END_RECONNECT",n.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(DA||(DA={})),function(n){n.SEND_ONLY="SEND_ONLY",n.RECEIVE_ONLY="RECEIVE_ONLY"}(Vd||(Vd={})),function(n){n.CONNECTED="websocket:connected",n.RECONNECTING="websocket:reconnecting",n.WILL_RECONNECT="websocket:will_reconnect",n.CLOSED="websocket:closed",n.FAILED="websocket:failed",n.ON_MESSAGE="websocket:on_message",n.REQUEST_NEW_URLS="websocket:request_new_urls",n.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",n.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"}(Bt||(Bt={}));class B extends J{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),g(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,R)}throw(){super.throw(R)}}function tS(n){if(typeof n!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(n))throw R.error("Invalid Channel Name ".concat(n)),new B(O.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function eS(n){if(t=n,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||dw(n,1,255)))throw new B(O.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof n=="string"&&R.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}(function(n){n.TRANSCODE="mix_streaming",n.RAW="raw_streaming",n.INJECT="inject_streaming"})(kn||(kn={})),function(n){n[n.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",n[n.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",n[n.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",n[n.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",n[n.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",n[n.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",n[n.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",n[n.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",n[n.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",n[n.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",n[n.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(fa||(fa={}));const eH={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},nS={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function iS(n,t){ai(n.url,"".concat(t,".url"),1,1e3,!1),Ze(n.x)||Pe(n.x,"".concat(t,".x"),0,1e4),Ze(n.y)||Pe(n.y,"".concat(t,".y"),0,1e4),Ze(n.width)||Pe(n.width,"".concat(t,".width"),0,1e4),Ze(n.height)||Pe(n.height,"".concat(t,".height"),0,1e4),Ze(n.zOrder)||Pe(n.zOrder,"".concat(t,".zOrder"),0,255),Ze(n.alpha)||Pe(n.alpha,"".concat(t,".alpha"),0,1,!1)}const nH={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},iH={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};var ls,Fd,En,PA,Ei,Ds,Li,_a,Ae,nn,Ic,On,zp,me;function kA(n){if(!n.channelName)throw new B(O.INVALID_PARAMS,"invalid channelName in info");if(typeof n.uid!="number")throw new B(O.INVALID_PARAMS,"invalid uid in info, uid must be a number");return n.token&&ai(n.token,"info.token",1,2047),eS(n.uid),tS(n.channelName),!0}(function(n){n.WARNING="@live_uap-warning",n.ERROR="@line_uap-error",n.PUBLISH_STREAM_STATUS="@live_uap-publish-status",n.INJECT_STREAM_STATUS="@live_uap-inject-status",n.WORKER_STATUS="@live_uap-worker-status",n.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(ls||(ls={})),function(n){n.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(Fd||(Fd={})),function(n){n[n.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",n[n.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",n[n.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",n[n.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",n[n.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",n[n.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",n[n.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",n[n.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",n[n.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",n[n.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",n[n.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",n[n.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",n[n.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",n[n.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",n[n.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",n[n.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",n[n.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",n[n.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",n[n.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(En||(En={})),function(n){n.CONNECT_FAILED="connect failed",n.CONNECT_TIMEOUT="connect timeout",n.WS_DISCONNECTED="websocket disconnected",n.REQUEST_TIMEOUT="request timeout",n.REQUEST_FAILED="request failed",n.WAIT_STATUS_TIMEOUT="wait status timeout",n.WAIT_STATUS_ERROR="wait status error",n.BAD_STATE="bad state",n.WS_ABORT="ws abort",n.AP_REQUEST_TIMEOUT="AP request timeout",n.AP_JSON_PARSE_ERROR="AP json parse error",n.AP_REQUEST_ERROR="AP request error",n.AP_REQUEST_ABORT="AP request abort"}(PA||(PA={})),function(n){n[n.SetSdkProfile=0]="SetSdkProfile",n[n.SetSourceChannel=1]="SetSourceChannel",n[n.SetSourceUserId=2]="SetSourceUserId",n[n.SetDestChannel=3]="SetDestChannel",n[n.StartPacketTransfer=4]="StartPacketTransfer",n[n.StopPacketTransfer=5]="StopPacketTransfer",n[n.UpdateDestChannel=6]="UpdateDestChannel",n[n.Reconnect=7]="Reconnect",n[n.SetVideoProfile=8]="SetVideoProfile"}(Ei||(Ei={})),function(n){n.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",n.NETWORK_CONNECTED="NETWORK_CONNECTED",n.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",n.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",n.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",n.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",n.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",n.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",n.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",n.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(Ds||(Ds={})),function(n){n.RELAY_STATE_IDLE="RELAY_STATE_IDLE",n.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",n.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",n.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(Li||(Li={})),function(n){n.RELAY_OK="RELAY_OK",n.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",n.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",n.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(_a||(_a={})),function(n){n.High="high",n.Low="low",n.Audio="audio",n.Screen="screen",n.ScreenLow="screen_low"}(Ae||(Ae={})),function(n){n.DISCONNECT="disconnect",n.CONNECTION_STATE_CHANGE="connection-state-change",n.NETWORK_QUALITY="network-quality",n.STREAM_TYPE_CHANGE="stream-type-change",n.IS_P2P_DISCONNECTED="is-p2p-dis",n.DISCONNECT_P2P="dis-p2p",n.REQUEST_NEW_GATEWAY_LIST="req-gate-url",n.NEED_RENEW_SESSION="need-sid",n.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",n.JOIN_RESPONSE="join-response",n.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",n.RESET_CONNECTION_EVENTS="reset-connection-events",n.DATACHANNEL_PRECONNECT="datachannel_preconnect",n.DATACHANNEL_FAILBACK="datachannel_failback",n.RESET_SIGNAL="reset-signal"}(nn||(nn={})),function(n){n.P2P_DISCONNECTED="P2P_DISCONNECTED",n.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",n.TIMEOUT="TIMEOUT",n.UNKNOWN_REASON="UNKNOWN_REASON"}(Ic||(Ic={})),function(n){n[n.Nothing=0]="Nothing",n[n.Audio=1]="Audio",n[n.LwoVideo=2]="LwoVideo",n[n.Video=4]="Video",n[n.Data=8]="Data",n[n.DataStream0=256]="DataStream0",n[n.DataStream1=512]="DataStream1",n[n.DataStream2=1024]="DataStream2",n[n.DataStream3=2048]="DataStream3",n[n.DataStream4=4096]="DataStream4",n[n.DataStream5=8192]="DataStream5",n[n.DataStream6=16384]="DataStream6",n[n.DataStream7=32768]="DataStream7"}(On||(On={})),function(n){n[n.websocket=0]="websocket",n[n.datachannel=1]="datachannel"}(zp||(zp={})),function(n){n.CHINA="CHINA",n.ASIA="ASIA",n.NORTH_AMERICA="NORTH_AMERICA",n.EUROPE="EUROPE",n.JAPAN="JAPAN",n.INDIA="INDIA",n.KOREA="KOREA",n.HKMC="HKMC",n.US="US",n.OCEANIA="OCEANIA",n.SOUTH_AMERICA="SOUTH_AMERICA",n.AFRICA="AFRICA",n.OVERSEA="OVERSEA",n.GLOBAL="GLOBAL",n.EXTENSIONS="EXTENSIONS"}(me||(me={}));const LA=[me.AFRICA,me.ASIA,me.CHINA,me.EUROPE,me.GLOBAL,me.INDIA,me.JAPAN,me.NORTH_AMERICA,me.OCEANIA,me.OVERSEA,me.SOUTH_AMERICA];var ii;(function(n){n.CHINA="CN",n.ASIA="AS",n.NORTH_AMERICA="NA",n.EUROPE="EU",n.JAPAN="JP",n.INDIA="IN",n.KOREA="KR",n.HKMC="HK",n.US="US",n.OCEANIA="OC",n.SOUTH_AMERICA="SA",n.AFRICA="AF",n.OVERSEA="OVERSEA",n.GLOBAL="GLOBAL",n.EXTENSIONS="GLOBAL"})(ii||(ii={}));const Jp={CHINA:{},ASIA:{CODE:ii.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:ii.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:ii.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:ii.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","	uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:ii.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:ii.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:ii.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:ii.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:ii.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:ii.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:ii.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:ii.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:ii.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};var Eu,MA,mt,ci,Ps,Z,Ee,kt,UA,Rr,vr,Ln,$s,un,ks,xA,ar,Gr,ma,Ve,Zs,VA;Jg&&(Jp.CHINA={CODE:ii.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(n){n.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(Eu||(Eu={}));class FA extends Ye{constructor(t,e){super(),g(this,"onICEConnectionStateChange",void 0),g(this,"onConnectionStateChange",void 0),g(this,"onDTLSTransportStateChange",void 0),g(this,"onDTLSTransportError",void 0),g(this,"onICETransportStateChange",void 0),g(this,"onFirstAudioReceived",void 0),g(this,"onFirstVideoReceived",void 0),g(this,"onFirstAudioDecoded",void 0),g(this,"onFirstVideoDecoded",void 0),g(this,"onFirstVideoDecodedTimeout",void 0),g(this,"onSelectedLocalCandidateChanged",void 0),g(this,"onSelectedRemoteCandidateChanged",void 0)}}class Xp extends FA{constructor(t,e){super(t,e)}}(function(n){n.SEND="sendonly",n.RECV="recvonly",n.SENDRECV="sendrecv",n.INACTIVE="inactive"})(MA||(MA={})),function(n){n.VIDEO="video",n.AUDIO="audio"}(mt||(mt={})),function(n){n[n.UDP=0]="UDP",n[n.TCP=1]="TCP",n[n.RELAY=2]="RELAY"}(ci||(ci={})),function(n){n[n.FIRST_CONNECTION=0]="FIRST_CONNECTION",n[n.TCP_RESTART=1]="TCP_RESTART",n[n.RELAY_RESTART=2]="RELAY_RESTART",n[n.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",n[n.OLD_RESTART=11]="OLD_RESTART",n[n.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(Ps||(Ps={})),function(n){n.LocalVideoTrack="videoTrack",n.LocalAudioTrack="audioTrack",n.LocalVideoLowTrack="videoLowTrack"}(Z||(Z={})),function(n){n.New="new",n.Connected="connected",n.Reconnecting="reconnecting",n.Disconnected="disconnected"}(Ee||(Ee={})),function(n){n.StateChange="stateChange",n.IceConnectionStateChange="iceConnectionStateChange",n.RequestMuteLocal="requestMuteLocal",n.RequestUnmuteLocal="requestUnmuteLocal",n.RequestRePublish="requestRePublish",n.RequestRePublishDataChannel="requestRePublishDataChannel",n.RequestReSubscribe="requestReSubscribe",n.RequestUploadStats="requestUploadStats",n.MediaReconnectStart="MediaReconnectStart",n.MediaReconnectEnd="MediaReconnectEnd",n.NeedSignalRTT="NeedSignalRTT",n.RequestRestartICE="RequestRestartIce",n.PeerConnectionStateChange="PeerConnectionStateChange",n.RequestReconnect="RequestReconnect",n.RequestReconnectPC="RequestReconnectPC",n.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",n.P2PLost="P2PLost",n.UpdateVideoEncoder="UpdateVideoEncoder",n.ConnectionTypeChange="ConnectionTypeChange",n.RequestLowStreamParameter="RequestLowStreamParameter",n.QueryClientConnectionState="QueryClientConnectionState",n.LocalCandidate="LocalCandidate",n.RequestP2PMuteLocal="requestP2PMuteLocal",n.RequestP2PPublish="RequestP2PPublish",n.RequestP2PUnPublish="RequestP2PUnPublish",n.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",n.RequestP2PMuteRemote="RequestP2PMuteRemote",n.RequestP2PRestartICE="RequestP2PRestartICE"}(kt||(kt={})),function(n){n.MUTE_LOCAL_VIDEO="mute_local_video",n.MUTE_LOCAL_AUDIO="mute_local_audio",n.UNMUTE_LOCAL_VIDEO="unmute_local_video",n.UNMUTE_LOCAL_AUDIO="unmute_local_audio",n.MUTE_REMOTE_VIDEO="mute_remote_video",n.MUTE_REMOTE_AUDIO="mute_remote_audio",n.UNMUTE_REMOTE_VIDEO="unmute_remote_video",n.UNMUTE_REMOTE_AUDIO="unmute_remote_audio"}(UA||(UA={})),function(n){n.CONNECTING="CONNECTING",n.RECONNECTING="RECONNECTING",n.CONNECTED="CONNECTED",n.CLOSED="CLOSED"}(Rr||(Rr={})),function(n){n[n.CONNECT_AP=0]="CONNECT_AP",n[n.AP_CONNECTED=1]="AP_CONNECTED",n[n.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",n[n.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",n[n.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",n[n.CONNECT_WORKER=5]="CONNECT_WORKER",n[n.WORKER_CONNECTED=6]="WORKER_CONNECTED",n[n.CLOSED=7]="CLOSED"}(vr||(vr={})),function(n){n.CONNECTION_STATE_CHANGE="connection-state-change",n.STATE_CHANGE="state-change",n.INSPECT_RESULT="inspect-result",n.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",n.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(Ln||(Ln={})),function(n){n.NETWORK_ERROR="NETWORK_ERROR",n.SERVER_ERROR="SERVER_ERROR",n.MULTI_IP="MULTI_IP",n.TIMEOUT="TIMEOUT",n.OFFLINE="OFFLINE",n.LEAVE="LEAVE",n.P2P_FAILED="P2P_FAILED",n.FALLBACK="FALLBACK"}($s||($s={})),function(n){n.CONNECTED="transmitter:connected",n.RECONNECTING="transmitter:reconnecting",n.WILL_RECONNECT="transmitter:will_reconnect",n.CLOSED="transmitter:closed",n.FAILED="transmitter:failed",n.ON_MESSAGE="transmitter:on_message",n.REQUEST_NEW_URLS="transmitter:request_new_urls",n.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",n.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",n.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",n.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",n.FAILBACK="transmitter:failback"}(un||(un={})),function(n){n.CAMERA_CHANGED="camera-changed",n.MICROPHONE_CHANGED="microphone-changed",n.PLAYBACK_DEVICE_CHANGED="playback-device-changed",n.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",n.AUTOPLAY_FAILED="autoplay-failed",n.SECURITY_POLICY_VIOLATION="security-policy-violation"}(ks||(ks={})),function(n){n[n.APP_TYPE_INVALID_VALUE=-1]="APP_TYPE_INVALID_VALUE",n[n.APP_TYPE_NATIVE=0]="APP_TYPE_NATIVE",n[n.APP_TYPE_NATIVE_COCOS=1]="APP_TYPE_NATIVE_COCOS",n[n.APP_TYPE_NATIVE_UNITY=2]="APP_TYPE_NATIVE_UNITY",n[n.APP_TYPE_NATIVE_ELECTRON=3]="APP_TYPE_NATIVE_ELECTRON",n[n.APP_TYPE_NATIVE_FLUTTER=4]="APP_TYPE_NATIVE_FLUTTER",n[n.APP_TYPE_NATIVE_UNREAL=5]="APP_TYPE_NATIVE_UNREAL",n[n.APP_TYPE_NATIVE_XAMARIN=6]="APP_TYPE_NATIVE_XAMARIN",n[n.APP_TYPE_NATIVE_API_CLOUD=7]="APP_TYPE_NATIVE_API_CLOUD",n[n.APP_TYPE_NATIVE_REACT_NATIVE=8]="APP_TYPE_NATIVE_REACT_NATIVE",n[n.APP_TYPE_NATIVE_PYTHON=9]="APP_TYPE_NATIVE_PYTHON",n[n.APP_TYPE_NATIVE_COCOS_CREATOR=10]="APP_TYPE_NATIVE_COCOS_CREATOR",n[n.APP_TYPE_NATIVE_RUST=11]="APP_TYPE_NATIVE_RUST",n[n.APP_TYPE_NATIVE_C_SHARP=12]="APP_TYPE_NATIVE_C_SHARP",n[n.APP_TYPE_NATIVE_CEF=13]="APP_TYPE_NATIVE_CEF",n[n.APP_TYPE_NATIVE_UNI_APP=14]="APP_TYPE_NATIVE_UNI_APP",n[n.APP_TYPE_WEBRTC=1e3]="APP_TYPE_WEBRTC",n[n.APP_TYPE_WEBRTC_REACT=1001]="APP_TYPE_WEBRTC_REACT",n[n.APP_TYPE_WEBRTC_VUE=1002]="APP_TYPE_WEBRTC_VUE",n[n.APP_TYPE_WEBRTC_ANGULAR=1003]="APP_TYPE_WEBRTC_ANGULAR"}(xA||(xA={})),function(n){n.CONNECTING="CONNECTING",n.RECONNECTING="RECONNECTING",n.CONNECTED="CONNECTED",n.CLOSED="CLOSED"}(ar||(ar={})),function(n){n.CONNECTION_STATE_CHANGE="connection-state-change",n.STATE_CHANGE="state-change",n.INSPECT_RESULT="inspect-result",n.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",n.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(Gr||(Gr={})),function(n){n[n.CONNECT_AP=0]="CONNECT_AP",n[n.AP_CONNECTED=1]="AP_CONNECTED",n[n.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",n[n.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",n[n.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",n[n.CONNECT_WORKER=5]="CONNECT_WORKER",n[n.WORKER_CONNECTED=6]="WORKER_CONNECTED",n[n.CLOSED=7]="CLOSED"}(ma||(ma={})),function(n){n.CALL="call",n.CANDIDATE="candidate",n.PUBLISH="publish",n.UNPUBLISH="unpublish",n.SUBSCRIBE="subscribe",n.UNSUBSCRIBE="unsubscribe",n.CONTROL="control",n.RESTART_ICE="restart_ice",n.ACK="ack",n.JOIN="join",n.EXCHANGE_SDP="exchange_sdp",n.DO_SUBSCRIBE="do_subscribe",n.DO_UNSUBSCRIBE="do_unsubscribe"}(Ve||(Ve={})),function(n){n.MUTE_LOCAL_AUDIO="mute_local_audio",n.MUTE_LOCAL_VIDEO="mute_local_video",n.UNMUTE_LOCAL_AUDIO="unmute_local_audio",n.UNMUTE_LOCAL_VIDEO="unmute_local_video"}(Zs||(Zs={})),function(n){n[n.SUCCESS=1]="SUCCESS",n[n.FAILED=0]="FAILED"}(VA||(VA={}));const rH={[xd.ACCESS_POINT]:{[mi.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[mi.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[mi.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[mi.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[mi.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[mi.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[mi.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[mi.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[mi.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[mi.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[mi.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[mi.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[mi.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[mi.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[mi.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[mi.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[mi.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[mi.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[xd.UNILBS]:{[yr.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[yr.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[yr.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[yr.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[yr.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[yr.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[yr.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[yr.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[yr.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[yr.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[yr.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[yr.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[xd.STRING_UID_ALLOCATOR]:{[mu.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[mu.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[mu.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Qp(n){const t=rH[Math.floor(n/1e4)];if(!t)return{desc:"unkonw error",retry:!1};const e=t[n%1e4];if(!e){if(Math.floor(n/1e4)===xd.ACCESS_POINT){const i=n%1e4;if(i.toString()[0]==="1")return{desc:n.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:n.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return e}const sH={[Dt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Dt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Dt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Dt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Dt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Dt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Dt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Dt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Dt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Dt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Dt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Dt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Dt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Dt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Dt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Dt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Dt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Dt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Dt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Dt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Dt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Dt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Dt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Dt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Dt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Dt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Dt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Dt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Dt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Dt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Dt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Dt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Dt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Dt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Dt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Dt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Dt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Dt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Dt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Dt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Dt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Dt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Dt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Dt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Dt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Dt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Dt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Dt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Dt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Dt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Dt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Dt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Dt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Dt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Dt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Dt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Dt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Dt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Dt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Dt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Dt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Dt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Dt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function bc(n){return sH[n]||{desc:"UNKNOW_ERROR_".concat(n),action:"failed"}}function BA(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function rS(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?BA(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):BA(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}function jA(n){return n.every(t=>t.readyState===WebSocket.CLOSED||t.readyState===WebSocket.CLOSING)}function WA(n,t){if(typeof n=="string")return n;const{proxy:e,host:i,port:s}=n;if(t){const a=x("JOIN_GATEWAY_FALLBACK_PORT")||443;return a===443?"wss://".concat(i,"/ws/?p=").concat(Number(s)+150):"wss://".concat(i,":").concat(a,"/ws/?p=").concat(Number(s)+150)}return e?"wss://".concat(e,"/ws/?h=").concat(i,"&p=").concat(s):"wss://".concat(i,":").concat(s)}const oH=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,aH=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,cH=/wss:\/\/(.+):([0-9]+)\/?/,dH=/wss:\/\/(.[^\/]+)\/?/;let lH=0;class uH{constructor(t,e){g(this,"id",0),g(this,"store",void 0),g(this,"recordIndex",void 0),g(this,"websockets",[]),g(this,"try443PortDuration",2e3),g(this,"forceCloseWSDuration",5e3),g(this,"try443PortTimeout",null),g(this,"forceCloseTimeout",null),g(this,"isTry443PortFailed",!1),g(this,"isNormalPortFailed",!1),g(this,"useDoubleDomain",!1),g(this,"useProxy",!1),g(this,"startTime",Date.now()),this.id=++lH,this.try443PortDuration=x("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=e}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var t;const e=Date.now()-this.startTime;for(var i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];R.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(e,"ms:"),...s)}createWebSocket(t,e,i){this.logger("createWebSocket:",t,{isTry443Port:e,hasTimeoutDetection:i});const s=x("GATEWAY_DOMAINS"),a=Date.now(),d=[],u=s.find(_=>{var m;return It(m=t.host).call(m,_)});u||(this.useDoubleDomain=!1);const h=[];if(this.useDoubleDomain)s.forEach(_=>{h.push(WA(rS(rS({},t),{},{host:t.host.replace(u,_)}),e))});else{const _=rS({},t);if(e&&u){const m=s.find(S=>S!==u);m&&(_.host=_.host.replace(u,m))}h.push(WA(_,e))}try{h.forEach(_=>{const m=new WebSocket(_);m.binaryType="arraybuffer",d.push(m),this.logger("ws is connecting:",m.url)})}catch(_){if(this.logger("ws create failed"),d.forEach(m=>m.close()),d.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,e,i);if(!e&&Number(t.port)!==443)return this.createWebSocket(t,!0,i);throw new B(O.WS_ERR,"init websocket failed! Error: ".concat(_.toString()))}const p=lu();return this.store&&this.store.recordJoinChannelService({urls:d.map(_=>_.url),service:"gateway"},this.recordIndex),d.forEach(_=>{_.onopen=()=>{this.logger("onopen: ws ".concat(_.url," open cost ").concat(Date.now()-a,"ms")),this.websockets.forEach(m=>{m!==_&&(m.onopen=null,m.onclose=null,m.onmessage=null,m.close(),this.logger("close backup websocket: ".concat(m.url)))}),this.websockets.length=0,p.resolve(_)},_.onclose=m=>{this.logger("onclose: ws ".concat(_.url," closed cost ").concat(Date.now()-a,"ms state: ").concat(_.readyState)),e?this.isTry443PortFailed=jA(d):this.isNormalPortFailed=jA(d),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(e&&this.isTry443PortFailed||!e&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(m.reason)),p.reject({code:m.code,reason:Ic.A_ROUND_WS_FAILED}))},_.onmessage=m=>this.logger("".concat(_.url," onmessage: ").concat(m.data))}),this.websockets.push(...d),i||(()=>{const _=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",p.isResolved),this.websockets.forEach(m=>m.readyState!==WebSocket.OPEN&&m.close())};if(e||this.useProxy)return this.logger("add 5s timeout at ".concat(e?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(_,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",p.isResolved),p.isResolved)return _();Se().os===Fn.MAC_OS&&We()&&_(),this.createWebSocket(t,!0,!0).then(m=>p.resolve(m)).catch(m=>{this.isNormalPortFailed&&p.reject(m),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(_,this.forceCloseWSDuration)},this.try443PortDuration)})(),p.promise}chooseBestWebsocket(t,e,i,s){return this.useDoubleDomain=!!e,typeof t=="string"&&(t=function(a){let d,u,h;return[,d,u,h]=a.match(oH)||[],d||([,u,h]=a.match(aH)||[]),u&&h||([,u,h]=a.match(cH)||[]),u&&h||([,u]=a.match(dH)||[]),u||R.warning("un-destructible url: ",a),{proxy:d,host:u,port:h||"443"}}(t)),this.recordIndex=s,this.useProxy=!!t.proxy,i&&this.useProxy&&(R.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(t,!!i,!1).finally(()=>this.clearTimeout())}}function GA(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}class HA extends Ye{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var e;It(e=["tryNext","recover"]).call(e,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Bt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Bt.CONNECTED):this._state==="closed"?this.emit(Bt.CLOSED):this._state==="failed"&&this.emit(Bt.FAILED))}resetReconnectCount(t){R.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,e){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],s=arguments.length>3&&arguments[3]!==void 0&&arguments[3],a=arguments.length>4&&arguments[4]!==void 0&&arguments[4],d=arguments.length>5?arguments[5]:void 0;super(),g(this,"connectionID",0),g(this,"currentURLIndex",0),g(this,"urls",[]),g(this,"_reconnectMode","tryNext"),g(this,"reconnectReason",void 0),g(this,"_initMutex",new zn("websocket")),g(this,"name",void 0),g(this,"_state","closed"),g(this,"reconnectInterrupter",void 0),g(this,"websocket",void 0),g(this,"retryConfig",void 0),g(this,"reconnectCount",0),g(this,"forceCloseTimeout",5e3),g(this,"onlineReconnectListener",void 0),g(this,"useCompress",void 0),g(this,"tryDoubleDomain",!1),g(this,"use443PortOnly",!1),g(this,"wsInflateLength",0),g(this,"wsDeflateLength",0),g(this,"closeEstablishingWs",()=>{}),g(this,"store",void 0),g(this,"joinGatewayRecordIndex",void 0),this.store=d,this.name=t,this.retryConfig=function(m){for(var S=1;S<arguments.length;S++){var y=arguments[S]!=null?arguments[S]:{};S%2?GA(Object(y),!0).forEach(function(b){g(m,b,y[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(y)):GA(Object(y)).forEach(function(b){Object.defineProperty(m,b,Object.getOwnPropertyDescriptor(y,b))})}return m}({},e),this.useCompress=i,this.tryDoubleDomain=s,this.use443PortOnly=a;const{timeout:u,timeoutFactor:h}=e,p=Math.max(300,Math.floor(3*u/5)),_=Math.max(1.2,Math.floor(8*h)/10);Ai.ONLINE&&(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=_),Tn.on(No.NETWORK_STATE_CHANGE,(m,S)=>{m!==S&&(this.resetReconnectCount("network state change: ".concat(S," -> ").concat(m)),m===Ai.ONLINE?(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=_):(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=h))})}getConnection(){return this.websocket||void 0}async init(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=await this._initMutex.lock();this.forceCloseTimeout=e,this.urls=t,this.state="connecting";try{const s=lu(),a=this.urls[this.currentURLIndex];this.createWebSocketConnection(a).then(s.resolve).catch(s.reject),this.once(Bt.CLOSED,()=>{s.reject(new J(O.WS_DISCONNECT))}),this.once(Bt.CONNECTED,s.resolve),await s.promise}catch{}finally{i()}}close(t,e){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;e?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,e){if(!this.websocket)return void R.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),R.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(e)]},this.joinGatewayRecordIndex);const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:e})}sendMessage(t){let e=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new J(O.WS_ABORT,"websocket is not ready");try{e||(t=JSON.stringify(t)),this.websocket.send(t)}catch(i){throw new J(O.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,e=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:e}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var e;const i=lu();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const s=_=>{var m;(m=this.store)===null||m===void 0||m.signalChannelOpen(),R.debug("[".concat(this.name,"] websocket opened:"),_),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},a=async _=>{var m;if(R.debug("[".concat(this.name,"] websocket close ").concat((m=this.websocket)===null||m===void 0?void 0:m.url,", code: ").concat(_.code,", reason: ").concat(_.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new J(O.WS_DISCONNECT,"websocket close: ".concat(_.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=_.reason,this.state="reconnecting");const S=Ki(this,Bt.WILL_RECONNECT,this.reconnectMode,_.reason)||this.reconnectMode,y=await this.reconnectWithAction(S);if(this.state==="closed")return void R.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!y)return i.reject(new J(O.WS_DISCONNECT,"websocket reconnect failed: ".concat(_.code))),this.close(!0);i.resolve()}},d=_=>{this.emit(Bt.ON_MESSAGE,_)},u=_=>{R.warn("[".concat(this.connectionID,"] ws open error ").concat(_))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),x("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=x("GATEWAY_WSS_ADDRESS")),R.debug("[".concat(this.name,"] start connect, url:"),t);const h=(e=this.store)===null||e===void 0?void 0:e.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var p;const _=await this.chooseBestWebsocketConnection(t);this.websocket=_,s&&s(this.websocket.url),this.websocket.onclose=a,this.websocket.onmessage=d,this.websocket.onerror=u,(p=this.store)===null||p===void 0||p.recordJoinChannelService({endTs:Date.now(),status:"success"},h),this.joinGatewayRecordIndex=h}catch(_){const m=this.state==="closed",S=_ instanceof J,y=S&&_.code===O.WS_ABORT,b=S&&_.code===O.WS_ERR,I=S?_.message:_&&(_.reason||_.toString());R.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(I)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:y?"aborted":"error",errors:[_]},h),m||b?(i.reject(m?new J(O.WS_DISCONNECT,"websocket is closed: ".concat(I)):new J(O.WS_ERR,"init websocket failed: ".concat(I))),b&&R.error("[".concat(this.name,"] init websocket failed: ").concat(I))):a&&a(_)}return i.promise}async reconnectWithAction(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;R.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Tn.isOnline||!Tn.onlineWaiter||(this.onlineReconnectListener=Tn.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,e){const d=Up(this.reconnectCount,this.retryConfig);R.debug("[".concat(this.name,"] wait ").concat(d,"ms to reconnect websocket, mode: ").concat(t)),await W.race([si(d),this.onlineReconnectListener||new W(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;const s=async(d,u)=>{this.emit(Bt.RECONNECT_CREATE_CONNECTION,u),await this.createWebSocketConnection(d)};try{if(t==="retry")this.emit(Bt.RECONNECT_WAITTING_FINISH,t),await s(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);R.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(Bt.RECONNECT_WAITTING_FINISH,t),await s(this.urls[this.currentURLIndex],t)}else t==="recover"&&(R.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(Bt.RECONNECT_WAITTING_FINISH,t),this.urls=await tn(this,Bt.REQUEST_NEW_URLS),this.currentURLIndex=0,await s(this.urls[this.currentURLIndex],t))}catch(d){var a;R.error("[".concat(this.name,"] reconnect failed ").concat(d&&d.toString()));const u=d==null||(a=d.data)===null||a===void 0?void 0:a.desc;return Array.isArray(u)&&It(u).call(u,"dynamic key expired")?(this.emit(Bt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,e)}return!0}}class gu extends HA{constructor(t,e){super(t,e,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,e){const i=lu(),s=function(d,u){return new uH(d,u)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),s.closeAllWebsockets(),i.reject(new J(O.WS_ABORT,"choose best websocket aborted"))};const a=x("GATEWAY_DOMAINS");return R.debug("[choose-best-ws] currentDomain: ",t,", domains: ",a,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),s.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,e).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Su extends HA{constructor(t,e){super(t,e,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,e){return new W((i,s)=>{let a=!1;const d=[];this.closeEstablishingWs=()=>{R.debug("[choose-best-ws] close establishing websockets"),d.forEach(b=>{b.onclose=null,b.onopen=null,b.onmessage=null,b.close()}),s(new J(O.WS_ABORT,"choose best websocket aborted"))};const u=x("GATEWAY_DOMAINS");let h;const p=t.indexOf("?h="),_=u.find(b=>p!==-1?It(t).call(t,b,p):It(t).call(t,b));R.debug("[choose-best-ws] currentDomain: ",_,", domains: ",u);let m=!this.tryDoubleDomain||!_;if(!m&&_){var S;const b=Date.now();try{u.forEach(I=>{const A=p===-1?t.replace(_,I):t.substr(0,p)+t.substr(p).replace(_,I),L=new WebSocket(A);L.binaryType="arraybuffer",d.push(L),R.debug("[choose-best-ws] ws is connecting:",L.url)})}catch{for(R.debug("[choose-best-ws] ws create failed, fallback to single url"),d.forEach(A=>A.close());d.length;)d.pop();m=!0}(S=this.store)===null||S===void 0||S.recordJoinChannelService({urls:d.map(I=>I.url),service:"gateway"},e),d.forEach(I=>{I.onopen=()=>{if(a)return;const A=Date.now()-b;R.debug("[choose-best-ws] ws open cost ".concat(A,"ms")),d.filter(L=>L!==I).forEach(L=>{R.debug("[choose-best-ws]close backup websocket: ".concat(L.url)),L.close()}),a=!0,i(I)},I.onclose=A=>{h=A,!a&&(d.find(L=>!(L.readyState===WebSocket.CLOSED||L.readyState===WebSocket.CLOSING))||(R.debug("[choose-best-ws] all websocket is closed"),a=!0,s(h)))},I.onmessage=A=>{R.debug("[choose-best-ws]".concat(I.url," onmessage: ").concat(A.data))}}),si(this.forceCloseTimeout).then(()=>{d.forEach(I=>{I.readyState!==WebSocket.OPEN&&I.close()})})}if(m){var y;let b;R.debug("[choose-best-ws] use single url: ",t),(y=this.store)===null||y===void 0||y.recordJoinChannelService({urls:[t],service:"gateway"},e);try{b=new WebSocket(t),d.push(b),b.binaryType="arraybuffer"}catch(I){const A=new J(O.WS_ERR,"init websocket failed! Error: ".concat(I.toString()));return R.error("[".concat(this.name,"]").concat(A)),void s(A)}b.onopen=()=>{i(b)},b.onclose=I=>{s(I)},b.onmessage=I=>{R.debug("[choose-best-ws]".concat(b.url," onmessage: ").concat(I.data))},si(this.forceCloseTimeout).then(()=>{b&&b.readyState!==WebSocket.OPEN&&b.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class YA extends Ye{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===ie.CONNECTED?this.emit(ht.WS_CONNECTED):t===ie.RECONNECTING?this.emit(ht.WS_RECONNECTING,this._websocketReconnectReason):t===ie.CLOSED&&this.emit(ht.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,e){super(),g(this,"_disconnectedReason",void 0),g(this,"_websocketReconnectReason",void 0),g(this,"_connectionState",ie.CLOSED),g(this,"reconnectToken",void 0),g(this,"websocket",void 0),g(this,"openConnectionTime",void 0),g(this,"clientId",void 0),g(this,"lastMsgTime",Date.now()),g(this,"uploadCache",[]),g(this,"uploadCacheInterval",void 0),g(this,"rttRolling",new Ng(5)),g(this,"pingpongTimer",void 0),g(this,"wsInflateDataTimer",void 0),g(this,"pingpongTimeoutCount",0),g(this,"joinResponse",void 0),g(this,"multiIpOption",void 0),g(this,"initError",void 0),g(this,"spec",void 0),g(this,"store",void 0),g(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(ht.ON_BINARY_DATA,i.data);const s=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){const a="res-@".concat(s._id);this.emit(a,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")){if(this.emit(s._type,s._message),s._type===Kt.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===Kt.ON_USER_BANNED)switch(s._message.error_code){case 14:this.close(oe.UID_BANNED);break;case 15:this.close(oe.IP_BANNED);break;case 16:this.close(oe.CHANNEL_BANNED)}if(s._type===Kt.ON_USER_LICENSE_BANNED)switch(s._message.error_code){case Dt.ERR_LICENSE_MISSING:this.close(oe.LICENSE_MISSING);break;case Dt.ERR_LICENSE_EXPIRED:this.close(oe.LICENSE_EXPIRED);break;case Dt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(oe.LICENSE_MINUTES_EXCEEDED);break;case Dt.ERR_LICENSE_PERIOD_INVALID:this.close(oe.LICENSE_PERIOD_INVALID);break;case Dt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(oe.LICENSE_MULTIPLE_SDK_SERVICE);break;case Dt.ERR_LICENSE_ILLEGAL:this.close(oe.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=e,this.websocket=new gu("gateway-".concat(this.clientId),this.spec.retryConfig,!0,x("JOIN_GATEWAY_USE_DUAL_DOMAIN"),x("JOIN_GATEWAY_USE_443PORT_ONLY"),e),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===ie.CONNECTED&&this.reconnect("retry",jn.OFFLINE)})}async request(t,e,i,s){const a=Le(6,""),d={_id:a,_type:t,_message:e},u=this.websocket.connectionID,h=()=>new W((b,I)=>{if(this.connectionState===ie.CONNECTED)return b();const A=()=>{this.off(ht.WS_CLOSED,L),b()},L=()=>{this.off(ht.WS_CONNECTED,A),I(new B(O.WS_ABORT))};this.once(ht.WS_CONNECTED,A),this.once(ht.WS_CLOSED,L),t!==yt.PUBLISH&&t!==yt.SUBSCRIBE&&t!==yt.UNSUBSCRIBE&&t!==yt.UNPUBLISH&&t!==yt.CONTROL&&t!==yt.RESTART_ICE||this.once(ht.DISCONNECT_P2P,()=>{I(new B(O.DISCONNECT_P2P))}),t!==yt.PUBLISH&&t!==yt.RESTART_ICE||this.once(ht.ABORT_P2P_EXECUTION,()=>{I(new B(O.DISCONNECT_P2P))})});if(this.connectionState!==ie.CONNECTING&&this.connectionState!==ie.RECONNECTING||t===yt.JOIN||t===yt.REJOIN||await h(),this.websocket.sendMessage(d,!0),s)return;const p=new W((b,I)=>{let A=!1;const L=(F,$)=>{A=!0,b({isSuccess:F==="success",message:$||{}}),this.off(ht.WS_CLOSED,U),this.off(ht.WS_RECONNECTING,U),this.emit(ht.REQUEST_SUCCESS,t,e)};this.once("res-@".concat(a),L);const U=()=>{I(new B(O.WS_ABORT,"type: ".concat(t))),this.off(ht.WS_CLOSED,U),this.off(ht.WS_RECONNECTING,U),this.off("res-@".concat(a),L)};this.once(ht.WS_CLOSED,U),this.once(ht.WS_RECONNECTING,U),si(x("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||A||(R.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(ht.REQUEST_TIMEOUT,t,e))})});let _=null;try{_=await p}catch(b){if(this.connectionState===ie.CLOSED||t===yt.LEAVE)throw new B(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?b.throw():t===yt.JOIN||t===yt.REJOIN?null:(await h(),await this.request(t,e))}if(_.isSuccess)return _.message;const m=Number(_.message.error_code||_.message.code),S=bc(m),y=new B(O.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(_.message.error_str),{code:m,data:_.message});return S.action==="success"?_.message:(R.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(m,", message: ").concat(S.desc,", action: ").concat(S.action)),m===Dt.ERR_TOO_MANY_BROADCASTERS?((t===yt.JOIN||t===yt.REJOIN)&&(this.initError=y,this.close()),y.throw()):S.action==="failed"?y.throw():S.action==="quit"?(this.initError=y,this.close(),y.throw()):(m===Dt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",jn.MULTI_IP)):this.reconnect(S.action,jn.SERVER_ERROR),t===yt.JOIN||t===yt.REJOIN?null:await this.request(t,e)))}waitMessage(t,e){return new W(i=>{const s=a=>{(!e||e(a))&&(this.off(t,s),i(a))};this.on(t,s)})}upload(t,e){const i={_type:t,_message:e};try{this.websocket.sendMessage(i)}catch{const a=x("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==ie.CONNECTED)return;const d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},x("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,e){const i={_type:t,_message:e};this.websocket.sendMessage(i)}init(t,e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new W((i,s)=>{this.once(ht.WS_CONNECTED,()=>i(this.joinResponse)),this.once(ht.WS_CLOSED,()=>s(this.initError||new B(O.WS_ABORT))),this.connectionState=ie.CONNECTING,this.websocket.init(t).catch(s),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||oe.LEAVE,this.connectionState=ie.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),t===oe.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new gu("gateway-".concat(this.clientId),this.spec.retryConfig,!0,x("JOIN_GATEWAY_USE_DUAL_DOMAIN"),x("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(ht.ABORT_P2P_EXECUTION);const t=await tn(this,ht.REQUEST_JOIN_INFO),e=await this.request(yt.JOIN,t);if(!e)return this.emit(ht.REPORT_JOIN_GATEWAY,Ic.TIMEOUT,this.url||""),!1;this.joinResponse=e,this.emit(ht.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=ie.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new B(O.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=Do(this,ht.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const e=await this.request(yt.REJOIN,t);return!!e&&(this.connectionState=ie.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),e.peers&&e.peers.forEach(i=>{this.emit(Kt.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(Kt.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(Kt.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(Kt.MUTE_AUDIO,{uid:i.uid}):this.emit(Kt.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(Kt.MUTE_VIDEO,{uid:i.uid}):this.emit(Kt.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(Kt.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(Kt.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(Kt.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(Kt.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(Kt.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,e)}handleNotification(t){R.debug("[".concat(this.clientId,"] receive notification: "),t);const e=bc(t.code);if(e.action!=="success"){if(e.action!=="failed")return e.action==="quit"?(e.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(oe.UID_BANNED),void this.close()):void this.reconnect(e.action,jn.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),e.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=x("PING_PONG_TIME_OUT"),e=Date.now();this.pingpongTimeoutCount>=t&&(R.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(e-this.lastMsgTime,"ms")),e-this.lastMsgTime>x("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",jn.TIMEOUT):this.request(yt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-e;this.rttRolling.add(i),x("REPORT_STATS")&&this.send(yt.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:e}=this.websocket.getWsInflateData();t!==0&&e!==0&&this.upload(Ji.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:e,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Bt.RECONNECT_WAITTING_FINISH,t=>{this.emit(ht.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(Bt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(ht.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Bt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Bt.CLOSED,()=>{this.connectionState=ie.CLOSED}),this.websocket.on(Bt.FAILED,()=>{this._disconnectedReason=oe.NETWORK_ERROR,this.connectionState=ie.CLOSED}),this.websocket.on(Bt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===ie.CONNECTED?this.connectionState=ie.RECONNECTING:this.connectionState=ie.CONNECTING}),this.websocket.on(Bt.WILL_RECONNECT,(t,e,i)=>{const s=Do(this,ht.IS_P2P_DISCONNECTED),a=s||t!=="retry";s&&t==="retry"&&(R.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",e=Ic.P2P_DISCONNECTED),a&&(R.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(ht.REPORT_JOIN_GATEWAY,e||Ic.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(ht.NEED_RENEW_SESSION),this.emit(ht.DISCONNECT_P2P)),i(t)}),this.websocket.on(Bt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{R.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",jn.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(ht.REPORT_JOIN_GATEWAY,t.message||t.code||Ic.UNKNOWN_REASON,this.url||""),t instanceof B&&t.code===O.UNEXPECTED_RESPONSE&&t.data.code===Dt.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",jn.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",jn.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Bt.REQUEST_NEW_URLS,(t,e)=>{tn(this,ht.REQUEST_RECOVER,this.multiIpOption).then(t).catch(e)}),this.websocket.on(Bt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Kt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}var KA=`	
\v\f\r                　\u2028\u2029\uFEFF`,hH=Gl,pH=bo,sS=KA,qA=Pn("".replace),fH=RegExp("^["+sS+"]+"),_H=RegExp("(^|[^"+sS+"])["+sS+"]+$"),oS=function(n){return function(t){var e=pH(hH(t));return 1&n&&(e=qA(e,fH,"")),2&n&&(e=qA(e,_H,"$1")),e}},mH={start:oS(1),end:oS(2),trim:oS(3)},EH=rI.PROPER,gH=_e,zA=KA,SH=mH.trim;mn({target:"String",proto:!0,forced:function(n){return gH(function(){return!!zA[n]()||"​᠎"[n]()!=="​᠎"||EH&&zA[n].name!==n})}("trim")},{trim:function(){return SH(this)}});var Jn,Xn,TH=uc("String").trim,yH=Vn,RH=TH,aS=String.prototype,cS=et(function(n){var t=n.trim;return typeof n=="string"||n===aS||yH(aS,n)&&t===aS.trim?RH:t});function Bd(n,t,e){return{sampleRate:n,stereo:t,bitrate:e}}function he(n,t,e,i,s){return{width:n,height:t,frameRate:e,bitrateMin:i,bitrateMax:s}}function us(n,t,e,i,s){return{width:{max:n},height:{max:t},frameRate:e,bitrateMin:i,bitrateMax:s}}function dS(n,t){return{numSpatialLayers:n,numTemporalLayers:t}}(function(n){n[n.CHOOSE_SERVER=11]="CHOOSE_SERVER",n[n.CLOUD_PROXY=18]="CLOUD_PROXY",n[n.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",n[n.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"})(Jn||(Jn={})),function(n){n.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",n.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",n.IOS_INTERRUPTION_START="ios-interruption-start",n.IOS_INTERRUPTION_END="ios-interruption-end",n.STATE_CHANGE="state-change"}(Xn||(Xn={}));const vH={"90p":he(160,90),"90p_1":he(160,90),"120p":he(160,120,15,30,65),"120p_1":he(160,120,15,30,65),"120p_3":he(120,120,15,30,50),"120p_4":he(212,120),"180p":he(320,180,15,30,140),"180p_1":he(320,180,15,30,140),"180p_3":he(180,180,15,30,100),"180p_4":he(240,180,15,30,120),"240p":he(320,240,15,40,200),"240p_1":he(320,240,15,40,200),"240p_3":he(240,240,15,40,140),"240p_4":he(424,240,15,40,220),"360p":he(640,360,15,80,400),"360p_1":he(640,360,15,80,400),"360p_3":he(360,360,15,80,260),"360p_4":he(640,360,30,80,600),"360p_6":he(360,360,30,80,400),"360p_7":he(480,360,15,80,320),"360p_8":he(480,360,30,80,490),"360p_9":he(640,360,15,80,800),"360p_10":he(640,360,24,80,800),"360p_11":he(640,360,24,80,1e3),"480p":he(640,480,15,100,500),"480p_1":he(640,480,15,100,500),"480p_2":he(640,480,30,100,1e3),"480p_3":he(480,480,15,100,400),"480p_4":he(640,480,30,100,750),"480p_6":he(480,480,30,100,600),"480p_8":he(848,480,15,100,610),"480p_9":he(848,480,30,100,930),"480p_10":he(640,480,10,100,400),"720p":he(1280,720,15,120,1130),"720p_auto":he(1280,720,30,900,3e3),"720p_1":he(1280,720,15,120,1130),"720p_2":he(1280,720,30,120,2e3),"720p_3":he(1280,720,30,120,1710),"720p_5":he(960,720,15,120,910),"720p_6":he(960,720,30,120,1380),"1080p":he(1920,1080,15,120,2080),"1080p_1":he(1920,1080,15,120,2080),"1080p_2":he(1920,1080,30,120,3e3),"1080p_3":he(1920,1080,30,120,3150),"1080p_5":he(1920,1080,60,120,4780),"1440p":he(2560,1440,30,120,4850),"1440p_1":he(2560,1440,30,120,4850),"1440p_2":he(2560,1440,60,120,7350),"4k":he(3840,2160,30,120,8910),"4k_1":he(3840,2160,30,120,8910),"4k_3":he(3840,2160,60,120,13500)},$p=[{scaleResolutionDownBy:2,width:1280,height:720,frameRate:30,bitrateMin:300,bitrateMax:900},{scaleResolutionDownBy:1.333333,width:1280,height:720,frameRate:30,bitrateMin:600,bitrateMax:2e3},{scaleResolutionDownBy:1,width:1280,height:720,frameRate:30,bitrateMin:900,bitrateMax:3e3}],CH={"480p":us(640,480,5),"480p_1":us(640,480,5),"480p_2":us(640,480,30),"480p_3":us(640,480,15),"720p":us(1280,720,5),"720p_auto":he(1280,720,30,900,3e3),"720p_1":us(1280,720,5),"720p_2":us(1280,720,30),"720p_3":us(1280,720,15),"1080p":us(1920,1080,5),"1080p_1":us(1920,1080,5),"1080p_2":us(1920,1080,30),"1080p_3":us(1920,1080,15)},IH={"1SL1TL":dS(1,1),"3SL3TL":dS(3,3),"2SL3TL":dS(2,3)};function to(n){return n||(n="480p_1"),typeof n=="string"?Object.assign({},vH[n]):n}function lS(n){return typeof n=="string"?Object.assign({},CH[n]):n}function Zp(n){return typeof n=="string"?Object.assign({},IH[n]):n}const bH={speech_low_quality:Bd(16e3,!1),speech_standard:Bd(32e3,!1,18),music_standard:Bd(48e3,!1),standard_stereo:Bd(48e3,!0,56),high_quality:Bd(48e3,!1,128),high_quality_stereo:Bd(48e3,!0,192)};function tf(n){return typeof n=="string"?Object.assign({},bH[n]):n}const jd=[];function JA(n){return Bn(n,"mediaSource",["screen","window","application"]),!0}var ft,Fe,Ea,ef,uS,Wd,ga,wc,Xi,nf;(function(n){n.NEED_RENEGOTIATE="@need_renegotiate",n.NEED_REPLACE_TRACK="@need_replace_track",n.NEED_CLOSE="@need_close",n.NEED_ENABLE_TRACK="@need_enable_track",n.NEED_DISABLE_TRACK="@need_disable_track",n.NEED_SESSION_ID="@need_sid",n.SET_OPTIMIZATION_MODE="@set_optimization_mode",n.GET_STATS="@get_stats",n.GET_RTC_STATS="@get_rtc_stats",n.GET_LOW_VIDEO_TRACK="@get_low_video_track",n.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",n.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",n.NEED_MUTE_TRACK="@need_mute_track",n.NEED_UNMUTE_TRACK="@need_unmute_track"})(ft||(ft={})),function(n){n.SCREEN_TRACK="screen_track",n.CUSTOM_TRACK="custome_track",n.LOW_STREAM="low_stream"}(Fe||(Fe={})),function(n){n[n.HIGH_STREAM=0]="HIGH_STREAM",n[n.LOW_STREAM=1]="LOW_STREAM"}(Ea||(Ea={})),function(n){n[n.HIGH_STREAM=0]="HIGH_STREAM",n[n.LOW_STREAM=1]="LOW_STREAM"}(ef||(ef={})),function(n){n[n.DISABLE=0]="DISABLE",n[n.LOW_STREAM=1]="LOW_STREAM",n[n.AUDIO_ONLY=2]="AUDIO_ONLY"}(uS||(uS={})),function(n){n.TRANSCEIVER_UPDATED="transceiver-updated"}(Wd||(Wd={})),function(n){n.SOURCE_STATE_CHANGE="source-state-change",n.TRACK_ENDED="track-ended",n.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",n.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",n.CLOSED="closed"}(ga||(ga={})),function(n){n.FIRST_FRAME_DECODED="first-frame-decoded",n.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(wc||(wc={})),function(n){n.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",n.RECEIVE_TRACK_BUFFER="receive_track_buffer",n.ON_AUDIO_BUFFER="on_audio_buffer",n.UPDATE_SOURCE="update_source"}(Xi||(Xi={})),function(n){n.UPDATE_TRACK_SOURCE="update-track-source"}(nf||(nf={}));const hS={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},pS={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},XA={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},wH={uplinkNetworkQuality:0,downlinkNetworkQuality:0},QA={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};var gi,Qi,Ac,Po,Si;(function(n){n.ON_TRACK="on_track",n.ON_NODE="on_node"})(gi||(gi={})),function(n){n.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",n.REQUEST_CONSTRAINTS="request_constraints"}(Qi||(Qi={})),function(n){n.IDLE="IDLE",n.INITING="INITING",n.INITEND="INITEND"}(Ac||(Ac={})),function(n){n.STATE_CHANGE="state_change",n.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",n.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",n.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(Po||(Po={})),function(n){n.NONE="none",n.INIT="init",n.CANPLAY="canplay",n.PLAYING="playing",n.PAUSED="paused",n.SUSPEND="suspend",n.STALLED="stalled",n.WAITING="waiting",n.ERROR="error",n.DESTROYED="destroyed",n.ABORT="abort",n.ENDED="ended",n.EMPTIED="emptied",n.LOADEDDATA="loadeddata"}(Si||(Si={}));const fS={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};var Gd;(function(n){n.OPEN="open",n.MESSAGE="message",n.CLOSE="close",n.CLOSING="closing",n.ERROR="error"})(Gd||(Gd={}));class $A extends Ye{constructor(t,e){super(),g(this,"_ID",void 0),g(this,"_rtpTransceiver",void 0),g(this,"_lowRtpTransceiver",void 0),g(this,"_hints",[]),g(this,"_isClosed",!1),g(this,"_originMediaStreamTrack",void 0),g(this,"_mediaStreamTrack",void 0),g(this,"_external",{}),this._ID=e||Le(8,"track-"),this._originMediaStreamTrack=t,this._mediaStreamTrack=t,function(i){It(jd).call(jd,i)||jd.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){if(!t){const e=vt.reportApiInvoke(null,{name:An.GET_MEDIA_STREAM_TRACK,options:[],tag:Je.TRACER});this._mediaStreamTrack&&typeof this._mediaStreamTrack.label=="string"?e.onSuccess(this._mediaStreamTrack.label):e.onSuccess("")}return this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===Ea.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const e=jd.indexOf(t);e!==-1&&jd.splice(e,1)}(this),this.emit(ga.CLOSED)}_updateRtpTransceiver(t,e){if(e===Ea.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Wd.TRANSCEIVER_UPDATED,t,e)}}class di extends $A{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}constructor(t,e){super(t,e),g(this,"_enabled",!0),g(this,"_muted",!1),g(this,"_isExternalTrack",!1),g(this,"_isClosed",!1),g(this,"_enabledMutex",void 0),g(this,"processor",void 0),g(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new zn("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,e;return(t=(e=this._originMediaStreamTrack)===null||e===void 0?void 0:e.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,R.debug("[".concat(this.getTrackId(),"] close")),this.emit(ft.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,e){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ke(this,ft.NEED_REPLACE_TRACK,this),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(ga.TRACK_ENDED)}stateCheck(t,e){if(R.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(e,"]")),gc(e,t),this._enabled&&this._muted&&t==="enabled"&&e===!1)throw new J(O.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",R);if(!this._enabled&&!this._muted&&t==="muted"&&e===!0)throw new J(O.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",R)}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function ZA(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}const tO=window.AudioContext||window.webkitAudioContext;let Cr=null;const Oe=new class extends Ye{constructor(){super(...arguments),g(this,"prevState",void 0),g(this,"curState",void 0),g(this,"currentTime",void 0),g(this,"currentTimeStuckAt",void 0),g(this,"interruptDetectorTrack",void 0),g(this,"onLocalAudioTrackMute",()=>{R.info("ios15-interruption-start"),this.emit(Xn.IOS_15_16_INTERRUPTION_START)}),g(this,"onLocalAudioTrackUnmute",async()=>{R.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?R.info("ios15-interruption-end-canceled"):(Cr&&await Cr.suspend(),this.emit(Xn.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(n){R.debug("webaudio bindInterruptDetectorTrack ".concat(n.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=n,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(n){R.debug("webaudio unbindInterruptDetectorTrack ".concat(n.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===n&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function AH(){if(!tO)return void R.error("your browser is not support web audio");R.info("create audio context");const n=function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?ZA(Object(i),!0).forEach(function(s){g(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ZA(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}({},x("WEBAUDIO_INIT_OPTIONS"));R.debug("audio context init option:",JSON.stringify(n)),Cr=new tO(n),Oe.curState=Cr.state,Cr.onstatechange=()=>{Oe.prevState=Oe.curState,Oe.curState=Cr?Cr.state:void 0;const{prevState:t,curState:e}=Oe,i=e==="running",s=e==="interrupted",a=t==="running",d=t==="suspended",u=t==="interrupted",h=Se().osVersion;(wi()||Js())&&a&&s&&(R.info("ios".concat(h,"-interruption-start")),Oe.emit(Xn.IOS_INTERRUPTION_START)),(wi()||Js())&&(d||u)&&i&&(R.info("ios".concat(h,"-interruption-end")),Oe.emit(Xn.IOS_INTERRUPTION_END)),t!==e&&(R.debug("AudioContext State Change","".concat(t,"=>").concat(e)),Oe.emit(Xn.STATE_CHANGE))},setInterval(()=>{var t;const e=(t=Cr)===null||t===void 0?void 0:t.currentTime;Oe.currentTime!==e?(Oe.currentTimeStuckAt&&(R.debug("AudioContext current time resume at ".concat(e)),Oe.currentTimeStuckAt=void 0),Oe.currentTime=e):(e!==Oe.currentTimeStuckAt&&(vt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:e},tag:Je.TRACER}).onSuccess(),R.warning("AudioContext current time stuck at ".concat(e))),Oe.currentTimeStuckAt=e)},5e3),async function(t){const e=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,s=!1,a=!1,d=!1;function u(A){t.state==="running"?h(!1):wi()||Js()?t.state==="suspended"&&(h(!0),A&&t.resume().then(_,_)):t.state!=="closed"&&(h(!0),A&&t.resume().then(_,_))}function h(A){if(s!==A){s=A;for(let L=0,U=e;L<U.length;L+=1){const F=U[L];A?window.addEventListener(F,m,{capture:!0,passive:!0}):window.removeEventListener(F,m,{capture:!0,passive:!0})}}}function p(){u(!0)}function _(){u(!1)}function m(){u(!0)}function S(A){if(!d)if(i.paused)if(A){let L;y(!1),d=!0;try{L=i.play(),L?L.then(b,b):(i.addEventListener("playing",b),i.addEventListener("abort",b),i.addEventListener("error",b))}catch{b()}}else y(!0);else y(!1)}function y(A){if(a!==A){a=A;for(let L=0,U=e;L<U.length;L++){const F=U[L];A?window.addEventListener(F,I,{capture:!0,passive:!0}):window.removeEventListener(F,I,{capture:!0,passive:!0})}}}function b(){i.removeEventListener("playing",b),i.removeEventListener("abort",b),i.removeEventListener("error",b),d=!1,S(!1)}function I(){S(!0)}if(wi()){const A=t.createMediaStreamDestination(),L=document.createElement("div");L.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=L.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=A.stream,S(!0)}Oe.on(Xn.STATE_CHANGE,p),u(!1)}(Cr)}function Hd(){if(!Cr){if(AH(),!Cr)throw new J(O.NOT_SUPPORTED,"can not create audio context");return Cr}return Cr}function eO(){return!!Cr}function Oc(n){if(function(){if(_S!==null)return _S;const i=Hd(),s=i.createBufferSource(),a=i.createGain(),d=i.createGain();s.connect(a),s.connect(d),s.disconnect(a);let u=!1;try{s.disconnect(a)}catch{u=!0}return s.disconnect(),_S=u,u}())return;const t=n.connect,e=n.disconnect;n.connect=(i,s,a)=>{var d;return n._inputNodes||(n._inputNodes=[]),It(d=n._inputNodes).call(d,i)||(i instanceof AudioNode?(n._inputNodes.push(i),t.call(n,i,s,a)):t.call(n,i,s)),n},n.disconnect=(i,s,a)=>{e.call(n),i?bg(n._inputNodes,i):n._inputNodes=[];for(const d of n._inputNodes)t.call(n,d)}}let _S=null;function mS(n,t){let e=!1;const i=1/t;if(x("DISABLE_WEBAUDIO")){const s=window.setInterval(()=>{e?window.clearInterval(s):n(performance.now()/1e3)},1e3*i)}else{const s=Hd();let a=s.createGain();a.gain.value=0,a.connect(s.destination);const d=()=>{if(e)return void(a=null);const u=s.createOscillator();u.onended=d,u.connect(a),u.start(0),u.stop(s.currentTime+i),n(s.currentTime)};d()}return()=>{e=!0}}const Ti={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1};function xe(){return Ti}class nO{constructor(){g(this,"context",void 0),g(this,"analyserNode",void 0),g(this,"sourceNode",void 0),this.context=Hd(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||wi()||Js()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let s=0;s<t.length;++s)t[s]=i[s]/128-1}const e=yc(t).call(t,(i,s)=>i+s*s,0)/t.length;return Math.max(10*Math.log10(e)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,e;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(e=this.sourceNode)===null||e===void 0||e.connect(this.analyserNode)}catch{R.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class iO extends Ye{get processSourceNode(){return this.sourceNode}set processedNode(t){var e;if(!this.isDestroyed&&this._processedNode!==t){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(e=this._processedNode)===null||e===void 0||e.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),g(this,"outputNode",void 0),g(this,"outputTrack",void 0),g(this,"isPlayed",!1),g(this,"context",void 0),g(this,"audioBufferNode",void 0),g(this,"destNode",void 0),g(this,"audioOutputLevel",0),g(this,"volumeLevelAnalyser",void 0),g(this,"_processedNode",void 0),g(this,"playNode",void 0),g(this,"isDestroyed",!1),g(this,"onNoAudioInput",void 0),g(this,"isNoAudioInput",!1),g(this,"_noAudioInputCount",0),this.context=Hd(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Oc(this.outputNode),this.volumeLevelAnalyser=new nO}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=e=>{this.emit(Xi.ON_AUDIO_BUFFER,function(i){for(let s=0;s<i.outputBuffer.numberOfChannels;s+=1){const a=i.outputBuffer.getChannelData(s);for(let d=0;d<a.length;d+=1)a[d]=0}return i.inputBuffer}(e))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!xe().webAudioMediaStreamDest)throw new J(O.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&ds(()=>{Oe.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;wi()||Js()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const e=this.volumeLevelAnalyser.getAnalyserNode();let i;e.getFloatTimeDomainData?(i=new Float32Array(e.fftSize),e.getFloatTimeDomainData(i)):(i=new Uint8Array(e.fftSize),e.getByteTimeDomainData(i));let s=!1;for(let a=0;a<i.length;a++)i[a]!==0&&(s=!0);return s?(this.isNoAudioInput=!1,!0):(await si(200),await this.checkHasAudioInput(t?t+1:1)&&s)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,e;(t=this.processedNode)===null||t===void 0||t.disconnect(),(e=this.sourceNode)===null||e===void 0||e.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class ES extends iO{get isFreeze(){return!1}constructor(t,e,i){var s;if(super(),g(this,"sourceNode",void 0),g(this,"track",void 0),g(this,"clonedTrack",void 0),g(this,"audioElement",void 0),g(this,"isCurrentTrackCloned",!1),g(this,"isRemoteTrack",!1),g(this,"originVolumeLevelAnalyser",void 0),g(this,"rebuildWebAudio",async()=>{if(R.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void R.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>R.info("resume success")),R.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const u=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?u.stop():this.isCurrentTrackCloned=!0;const h=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(h),Oc(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const p=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(p,this.context.currentTime),Oc(this.outputNode),this.emit(Xi.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=h,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new J(O.UNEXPECTED_ERROR);this.track=t;const a=new MediaStream([this.track]);if(this.isRemoteTrack=!!e,this.sourceNode=this.context.createMediaStreamSource(a),Oc(this.sourceNode),i){const u=i.clone();u.enabled=!0,this.clonedTrack=u,R.debug("create an unmuted track ".concat(u.id," from the original track ").concat(i.id," to get the volume"));const h=this.context.createMediaStreamSource(new MediaStream([u]));Oc(h),this.originVolumeLevelAnalyser=new nO,this.originVolumeLevelAnalyser.updateSource(h)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=a;const d=Se();e&&d.os===Fn.IOS&&Number((s=d.osVersion)===null||s===void 0?void 0:s.split(".")[0])<15&&(Oe.on(Xn.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(u=>{u||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const e=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(e),Oc(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Xi.UPDATE_SOURCE),this.audioElement.srcObject=e}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),Oe.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const e=t.clone();e.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=e),R.debug("create an unmuted track ".concat(e.id," from the original track ").concat(t.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([e]));Oc(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function rO(n,t,e){const i=(a,d)=>a?typeof a!="number"?a.max||a.exact||a.ideal||a.min||d:a:d,s={audio:!!e&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxHeight:i(t.height,1080),maxWidth:i(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(s.video.mandatory.maxFrameRate=t.frameRate.max,s.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(s.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(s)}async function OH(n,t){const e=await sO(n.mediaSource),{sourceId:i,audio:s}=await function(a){let d=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new W((u,h)=>{const p=document.createElement("div");p.innerText="share screen",p.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const _=document.createElement("div");_.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const m=document.createElement("div");m.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",m.setAttribute("style","height: 12%;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const y=document.createElement("div");y.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const b=document.createElement("button");b.innerHTML="cancel",b.setAttribute("style","width: 85px;"),b.onclick=()=>{document.body.removeChild(L);const U=new Error("NotAllowedError");U.name="NotAllowedError",h(U)};let I=d;const A=document.createElement("div");if(d){const U=document.createElement("input");U.setAttribute("type","checkbox");const F=document.createElement("span");U.setAttribute("style","margin-right: 6px;"),F.innerText="Share audio",U.checked=I,U.onchange=()=>{I=U.checked},A.appendChild(U),A.appendChild(F)}y.appendChild(A),y.appendChild(b),_.appendChild(m),_.appendChild(S),_.appendChild(y);const L=document.createElement("div");L.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),L.appendChild(p),L.appendChild(_),document.body.appendChild(L),a.map(U=>{if(U.id){const F=document.createElement("div");F.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let $=U.thumbnail;try{const{width:z}=$.getSize();z>1920&&($=$.resize({width:1920}))}catch(z){throw z&&z.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),z}F.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+$.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+U.name.replace(/[\u00A0-\u9999<>\&]/g,function(z){return"&#"+z.charCodeAt(0)+";"})+"</span>",F.onclick=()=>{document.body.removeChild(L),u({sourceId:U.id,audio:I})},S.appendChild(F)}})})}(e,t);return await rO(i,n,s)}async function sO(n){let t=["window","screen"];n!=="application"&&n!=="window"||(t=["window"]),n==="screen"&&(t=["screen"]);const e=fw();if(!e)throw console.error("failed to fetch electron, please mount it to window"),new J(O.ELECTRON_IS_NULL);let i=null;try{var s;i=((s=e.desktopCapturer)===null||s===void 0?void 0:s.getSources({types:t}))||e.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{i=null}i&&i.then||(i=new W((a,d)=>{e.desktopCapturer.getSources({types:t},(u,h)=>{u?d(u):a(h)})}));try{return await i}catch(a){throw new J(O.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,a.toString())}}function oO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}const gS=new zn("safari");let aO=!1,cO=!1;async function Ir(n,t){let e=0,i=null;for(;e<2;)try{i=await NH(n,t,e>0);break}catch(s){if(s instanceof J)throw R.error("[".concat(t,"] ").concat(s.toString())),s;const a=rf(s.name||s.code||s,s.message);if(a.code===O.MEDIA_OPTION_INVALID){R.debug("[".concat(t,"] detect media option invalid, retry")),e+=1,await si(500);continue}throw R.error("[".concat(t,"] ").concat(a.toString())),a}if(!i)throw new J(O.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function NH(n,t,e){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new J(O.NOT_SUPPORTED,"can not find getUserMedia");e&&(n.video&&(delete n.video.width,delete n.video.height),n.screen&&(delete n.screen.width,delete n.screen.height));const i=xe(),s=new MediaStream;if(n.audioSource&&s.addTrack(n.audioSource),n.videoSource&&s.addTrack(n.videoSource),!n.audio&&!n.video&&!n.screen)return R.debug("Using Video Source/ Audio Source"),s;if(n.screen)if(fw())n.screen.sourceId?Yd(s,await rO(n.screen.sourceId,n.screen,n.screenAudio)):Yd(s,await OH(n.screen,n.screenAudio));else if(Tg()&&n.screen.extensionId&&n.screen.mandatory){if(!i.getStreamFromExtension)throw new J(O.NOT_SUPPORTED,"This browser does not support screen sharing");R.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const S=await(d=n.screen.extensionId,u=t,new W((y,b)=>{try{chrome.runtime.sendMessage(d,{getStream:!0},I=>{if(!I||!I.streamId)return R.error("[".concat(u,"] No response from Chrome Plugin. Plugin not installed properly"),I),void b(new J(O.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));y(I.streamId)})}catch(I){R.error("[".concat(u,"] AgoraRTC screensharing plugin is not accessible(").concat(d,")"),I.toString()),b(new J(O.CHROME_PLUGIN_NOT_INSTALL))}}));n.screen.mandatory.chromeMediaSourceId=S,Yd(s,await navigator.mediaDevices.getUserMedia({video:{mandatory:n.screen.mandatory}}))}else if(i.getDisplayMedia){var a;n.screen.mediaSource&&JA(n.screen.mediaSource);const S={width:n.screen.width,height:n.screen.height,frameRate:n.screen.frameRate,displaySurface:(a=n.screen.displaySurface)!==null&&a!==void 0?a:n.screen.mediaSource==="screen"?"monitor":n.screen.mediaSource},{selfBrowserSurface:y,surfaceSwitching:b,systemAudio:I}=n.screen,A={selfBrowserSurface:y,surfaceSwitching:b,systemAudio:I};!y&&delete A.selfBrowserSurface,!b&&delete A.surfaceSwitching,!I&&delete A.systemAudio,R.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:S,audio:!!n.screenAudio,controls:A}));const L=await navigator.mediaDevices.getDisplayMedia(function(U){for(var F=1;F<arguments.length;F++){var $=arguments[F]!=null?arguments[F]:{};F%2?oO(Object($),!0).forEach(function(z){g(U,z,$[z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(U,Object.getOwnPropertyDescriptors($)):oO(Object($)).forEach(function(z){Object.defineProperty(U,z,Object.getOwnPropertyDescriptor($,z))})}return U}({video:S,audio:!!n.screenAudio},A));Yd(s,L)}else{if(!We())throw R.error("[".concat(t,"] This browser does not support screenSharing")),new J(O.NOT_SUPPORTED,"This browser does not support screen sharing");{n.screen.mediaSource&&JA(n.screen.mediaSource);const S={video:{mediaSource:n.screen.mediaSource,width:n.screen.width,height:n.screen.height,frameRate:n.screen.frameRate}};R.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(S))),Yd(s,await navigator.mediaDevices.getUserMedia(S))}}var d,u;if(!n.video&&!n.audio)return s;let h={video:n.video,audio:n.audio},p=x("MEDIA_DEVICE_CONSTRAINTS");if(p)try{typeof p=="string"&&(p=JSON.parse(p)),h=Ag(h,p)}catch{}R.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(h)),Se();let _,m=null;(bi()||wi()||Op())&&(m=await gS.lock());try{_=await navigator.mediaDevices.getUserMedia(h)}catch(S){throw m&&m(),S}return h.audio&&(aO=!0),h.video&&(cO=!0),Yd(s,_),m&&m(),s}function rf(n,t){switch(n){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new J(O.MEDIA_OPTION_INVALID,"".concat(n,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new J(O.DEVICE_NOT_FOUND,"".concat(n,": ").concat(t));case"NotSupportedError":return new J(O.NOT_SUPPORTED,"".concat(n,": ").concat(t));case"NotReadableError":return new J(O.NOT_READABLE,"".concat(n,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new J(O.PERMISSION_DENIED,"".concat(n,": ").concat(t));case"ConstraintNotSatisfiedError":return new J(O.CONSTRAINT_NOT_SATISFIED,"".concat(n,": ").concat(t));default:return R.error("getUserMedia unexpected error",n),new J(O.UNEXPECTED_ERROR,"".concat(n,": ").concat(t))}}function Yd(n,t){const e=n.getVideoTracks()[0],i=n.getAudioTracks()[0],s=t.getVideoTracks()[0],a=t.getAudioTracks()[0];a&&(i&&n.removeTrack(i),n.addTrack(a)),s&&(e&&n.removeTrack(e),n.addTrack(s))}const br=new class extends Ye{get state(){return this._state}set state(n){n!==this._state&&(this.emit(Po.STATE_CHANGE,n),this._state=n)}constructor(){super(),g(this,"_state",Ac.IDLE),g(this,"isAccessMicrophonePermission",!1),g(this,"isAccessCameraPermission",!1),g(this,"lastAccessMicrophonePermission",!1),g(this,"lastAccessCameraPermission",!1),g(this,"checkdeviceMatched",!1),g(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(x("ENUMERATE_DEVICES_INTERVAL")||(Np()||Ap()===Fn.HARMONY_OS)&&la())&&this.updateDevicesInfo()},x("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(n=>R.error(n.toString()))}async enumerateDevices(n,t){let e=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new J(O.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),s=this.checkMediaDeviceInfoIsOk(i);let a=!this.isAccessMicrophonePermission&&n,d=!this.isAccessCameraPermission&&t;s.audio&&(a=!1),s.video&&(d=!1);let u=null,h=null,p=null;if(!e&&(a||d)){if(gS.isLocked&&(R.debug("[device manager] wait GUM lock"),(await gS.lock())(),R.debug("[device manager] GUM unlock")),aO&&(a=!1,this.isAccessMicrophonePermission=!0),cO&&(d=!1,this.isAccessCameraPermission=!0),R.debug("[device manager] check media device permissions",n,t,a,d),a&&d){try{p=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(_){const m=rf(_.name||_.code||_,_.message);if(m.code===O.PERMISSION_DENIED)throw m;R.warning("getUserMedia failed in getDevices",m)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(a){try{u=await navigator.mediaDevices.getUserMedia({audio:n})}catch(_){const m=rf(_.name||_.code||_,_.message);if(m.code===O.PERMISSION_DENIED)throw m;R.warning("getUserMedia failed in getDevices",m)}this.isAccessMicrophonePermission=!0}else if(d){try{h=await navigator.mediaDevices.getUserMedia({video:t})}catch(_){const m=rf(_.name||_.code||_,_.message);if(m.code===O.PERMISSION_DENIED)throw m;R.warning("getUserMedia failed in getDevices",m)}this.isAccessCameraPermission=!0}R.debug("[device manager] mic permission",n,"cam permission",t)}try{const _=await navigator.mediaDevices.enumerateDevices();return u&&u.getTracks().forEach(m=>m.stop()),h&&h.getTracks().forEach(m=>m.stop()),p&&p.getTracks().forEach(m=>m.stop()),u=null,h=null,p=null,_}catch(_){return u&&u.getTracks().forEach(m=>m.stop()),h&&h.getTracks().forEach(m=>m.stop()),p&&p.getTracks().forEach(m=>m.stop()),u=null,h=null,p=null,new J(O.ENUMERATE_DEVICES_FAILED,_.toString()).throw()}}async getRecordingDevices(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,n)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,n)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,n)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(n){let t=null;return this.deviceInfoMap.forEach(e=>{e.device.label===n&&(t=e.device.deviceId)}),t}async getDeviceById(n){const t=(await this.enumerateDevices(!0,!0,!0)).find(e=>e.deviceId===n);if(!t)throw new J(O.DEVICE_NOT_FOUND,"deviceId: ".concat(n));return t}async init(){this.state=Ac.INITING;try{await this.updateDevicesInfo(),this.state=Ac.INITEND}catch(n){throw R.warning("Device Detection functionality cannot start properly.",n.toString()),this.state=Ac.IDLE,!(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")&&new J(O.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),n}}async updateDevicesInfo(){const n=await this.enumerateDevices(!0,!0,!0),t=Date.now(),e=[];if(n[0]&&n[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const s=n.find(d=>d.kind==="audioinput"&&d.deviceId==="default"),a=n.find(d=>d.kind==="audiooutput"&&d.deviceId==="default");s&&a?a.groupId===s.groupId?R.debug("[device-check] default input ".concat(s.label," and output ").concat(a.label," is the same group")):R.warning("[device-check] default input ".concat(s.label," and output ").concat(a.label," is not the same group")):R.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(n);if(n.forEach(s=>{if(!s.deviceId)return;const a=this.deviceInfoMap.get("".concat(s.kind,"_").concat(s.deviceId));if((a?a.state:"INACTIVE")!=="ACTIVE"){const d={initAt:t,updateAt:t,device:s,state:"ACTIVE"};this.deviceInfoMap.set("".concat(s.kind,"_").concat(s.deviceId),d),e.push(d)}a&&(a.updateAt=t)}),this.deviceInfoMap.forEach((s,a)=>{s.state==="ACTIVE"&&s.updateAt!==t&&(s.state="INACTIVE",e.push(s))}),this.state!==Ac.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));e.forEach(s=>{switch(s.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Po.RECORDING_DEVICE_CHANGED,s);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Po.CAMERA_DEVICE_CHANGED,s);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Po.PLAYOUT_DEVICE_CHANGED,s)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(n){const t=n.filter(s=>s.kind==="audioinput"),e=n.filter(s=>s.kind==="videoinput"),i={audio:!1,video:!1};for(const s of t)if(s.label&&s.deviceId){i.audio=!0;break}for(const s of e)if(s.label&&s.deviceId){i.video=!0;break}return i}};let SS=!1;const wr=new class extends Ye{constructor(){super(...arguments),g(this,"onAutoplayFailed",void 0),g(this,"onAudioAutoplayFailed",void 0)}};function dO(){if(Se(),!SS){const n=t=>{t.preventDefault(),SS=!1,uu()?document.body.removeEventListener("click",n,!0):(document.body.removeEventListener("touchstart",n,!0),document.body.removeEventListener("mousedown",n,!0))};SS=!0,uu()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0)),R.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),wr.onAutoplayFailed?wr.onAutoplayFailed():wr.onAudioAutoplayFailed?R.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):R.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),wr.emit("autoplay-failed")}}function lO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function uO(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?lO(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):lO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}function hO(n,t,e,i){if(!n)return;const s=vt.getBaseInfoBySessionId(n);if(!s)return;const a=s.info,d=Date.now(),u=uO(uO({},a),{},{vid:a.vid===void 0?0:Number(a.vid),lts:d,elapse:d-s.startTime,cbRegistered:wr.onAutoplayFailed||wr.onAudioAutoplayFailed?1:-1,errorMsg:e,mediaType:t,trackId:i,extend:void 0});vt.send({type:Ke.AUTOPLAY_FAILED,data:u},!0)}const DH=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],cr=new class{constructor(){g(this,"onAutoplayFailed",void 0),g(this,"elementMap",new Map),g(this,"elementStateMap",new Map),g(this,"elementsNeedToResume",[]),g(this,"sinkIdMap",new Map),g(this,"autoResumeAfterInterruption",()=>{Array.from(this.elementMap.entries()).forEach(n=>{let[t,e]=n;const i=this.elementStateMap.get(t),s=e.srcObject.getAudioTracks()[0];Ad()?s&&s.readyState==="live"&&Oe.curState==="running"&&(R.debug("auto resume after interruption for iOS 15"),e.pause(),e.play()):i&&i==="paused"&&s&&s.readyState==="live"&&Oe.curState==="running"&&(R.debug("auto resume after interruption for iOS"),e.play())})}),g(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(n=>{let[t,e]=n;const i=e.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(R.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),e.pause(),e.play())})}),this.autoResumeAudioElement(),Oe.on(Xn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Oe.on(Xn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Oe.on(Xn.STATE_CHANGE,()=>{wi()&&Oe.prevState==="suspended"&&Oe.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(n,t){const e=this.elementMap.get(n);if(this.sinkIdMap.set(n,t),e)try{await e.setSinkId(t)}catch(i){throw new J(O.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(n,t,e,i){if(this.elementMap.has(t))return;const s=document.createElement("audio");s.autoplay=!0,s.srcObject=new MediaStream([n]),this.bindAudioElementEvents(t,s),this.elementMap.set(t,s),this.elementStateMap.set(t,Si.INIT),this.setVolume(t,e);const a=this.sinkIdMap.get(t);if(a)try{s.setSinkId(a).catch(u=>{R.warning("[".concat(t,"] set sink id failed"),u.toString())})}catch(u){R.warning("[".concat(t,"] set sink id failed"),u.toString())}const d=s.play();d&&d.then&&d.catch(u=>{i&&hO(i,"audio",u.message,t),R.warning("audio element play warning",u.toString()),this.elementMap.has(t)&&u.name==="NotAllowedError"&&(R.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(s),ds(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),dO()}))})}updateTrack(n,t){const e=this.elementMap.get(n);e&&(e.srcObject=new MediaStream([t]))}isPlaying(n){return this.elementMap.has(n)&&this.elementStateMap.get(n)==="playing"}setVolume(n,t){const e=this.elementMap.get(n);e&&(t=Math.max(0,Math.min(100,t)),e.volume=t/100)}stop(n){const t=this.elementMap.get(n);if(this.sinkIdMap.delete(n),!t)return;const e=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(e,1),t.srcObject=null,t.remove(),this.elementMap.delete(n),this.elementStateMap.delete(n)}bindAudioElementEvents(n,t){DH.forEach(e=>{t.addEventListener(e,i=>{const s=this.elementStateMap.get(n),a=i.type==="pause"?"paused":i.type;if(R.debug("[".concat(n,"] audio-element-status change ").concat(s," => ").concat(a)),i.type==="error"){const d=t==null?void 0:t.error;d&&R.error("[".concat(n,"] media error, code: ").concat(d.code,", message: ").concat(d.message))}this.elementStateMap.set(n,a)})})}getPlayerState(n){return this.elementStateMap.get(n)||"uninit"}autoResumeAudioElement(){const n=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(e=>{R.debug("Auto resume audio element success")}).catch(e=>{R.warning("Auto resume audio element failed!",e)})}),this.elementsNeedToResume=[]};new W(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{uu()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0))})}};function hn(){return function(n,t,e){const i=e.value;return typeof i=="function"&&(e.value=function(){this._isClosed&&new J(O.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",R);for(var s=arguments.length,a=new Array(s),d=0;d<s;d++)a[d]=arguments[d];const u=i.apply(this,a);return u instanceof W?new W((h,p)=>{u.then(h).catch(p)}):u}),e}}function pO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function sf(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?pO(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):pO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class fO extends Ye{constructor(t){super(),g(this,"name","VideoProcessorDestination"),g(this,"ID","0"),g(this,"_source",void 0),g(this,"videoContext",void 0),g(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new J(O.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new J(O.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(gi.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(gi.ON_TRACK,void 0)}}class _O extends Ye{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,e){super(),g(this,"constraintsMap",new Map),g(this,"statsRegistry",[]),g(this,"usageRegistry",[]),g(this,"trackId",void 0),g(this,"direction",void 0),g(this,"_chained",!1),this.trackId=t,this.direction=e}async getConstraints(){return await tn(this,Qi.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,e){var i;return R.info("processor ".concat(e.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(e,t),ke(this,Qi.REQUEST_UPDATE_CONSTRAINTS,Array.from(Qs(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var e;if(this.constraintsMap.has(t))return R.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),ke(this,Qi.REQUEST_UPDATE_CONSTRAINTS,Array.from(Qs(e=this.constraintsMap).call(e)))}registerStats(t,e,i){this.statsRegistry.find(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===e)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:e,cb:i})}unregisterStats(t,e){const i=this.statsRegistry.findIndex(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===e);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:e,processorName:i,type:s,cb:a}of this.statsRegistry)try{const d=a();t.push({processorID:e,processorName:i,type:s,stats:d})}catch(d){R.error(new J(O.UNEXPECTED_ERROR,d.message))}return t}registerUsage(t,e){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:e})}unregisterUsage(t){const e=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);e!==-1&&this.usageRegistry.splice(e,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:e}of this.usageRegistry)try{let i=e();i instanceof W&&(i=await i),t.push(sf(sf({},i),{},{direction:this.direction}))}catch(i){R.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class of extends Ye{constructor(t){super(),g(this,"name","AudioProcessorDestination"),g(this,"ID","0"),g(this,"inputTrack",void 0),g(this,"inputNode",void 0),g(this,"audioProcessorContext",void 0),g(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new J(O.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new J(O.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(gi.ON_TRACK,void 0),this.emit(gi.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(gi.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(gi.ON_NODE,this.inputNode))}}class af extends Ye{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,e,i){super(),g(this,"constraintsMap",new Map),g(this,"statsRegistry",[]),g(this,"audioContext",void 0),g(this,"trackId",void 0),g(this,"direction",void 0),g(this,"usageRegistry",[]),g(this,"_chained",!1),this.audioContext=t,this.trackId=e,this.direction=i}async getConstraints(){return tn(this,Qi.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,e){var i;return R.info("processor ".concat(e.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(e,t),ke(this,Qi.REQUEST_UPDATE_CONSTRAINTS,Array.from(Qs(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var e;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),ke(this,Qi.REQUEST_UPDATE_CONSTRAINTS,Array.from(Qs(e=this.constraintsMap).call(e)))}registerStats(t,e,i){this.statsRegistry.find(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===e)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:e,cb:i})}unregisterStats(t,e){const i=this.statsRegistry.findIndex(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===e);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:e,processorName:i,type:s,cb:a}of this.statsRegistry)try{const d=a();t.push({processorID:e,processorName:i,type:s,stats:d})}catch(d){R.error(new J(O.UNEXPECTED_ERROR,d.message))}return t}registerUsage(t,e){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:e})}unregisterUsage(t){const e=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);e!==-1&&this.usageRegistry.splice(e,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:e}of this.usageRegistry)try{let i=e();i instanceof W&&(i=await i),t.push(sf(sf({},i),{},{direction:this.direction}))}catch(i){R.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class TS extends Ye{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),g(this,"context",void 0),g(this,"processSourceNode",void 0),g(this,"outputTrack",void 0),g(this,"processedNode",void 0),g(this,"clonedTrack",void 0),g(this,"outputNode",void 0),this.outputNode=new PH}setVolume(){}createOutputTrack(){throw new J(O.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class PH{disconnect(){}connect(){}}let Kd=null;class kH{constructor(){g(this,"state","open"),g(this,"trigger",void 0),g(this,"tasks",[]),R.debug("[macro-task-queue] is created."),this.trigger=window.setTimeout(()=>{this.state="closed",R.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(this.tasks.map(t=>t.key),"]")),this.trigger=void 0,this.tasks.forEach(t=>{let{func:e}=t;return e()}),this.tasks.length=0,R.debug("[macro-task-queue] is closed.")})}enqueue(t,e){this.state!=="closed"&&(this.tasks.push({key:t,func:e}),R.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat(typeof t=="string"?t:"")))}runTask(t){if(this.state==="closed")return;const e=this.tasks.findIndex(i=>i.key===t);if(e!==-1){const i=this.tasks.splice(e,1);R.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat(typeof t=="string"?t:"")),i[0].func()}}release(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,R.debug("[macro-task-queue] is closed."))}}function yS(n){return function(t,e,i){var s;const a=(s=i.value)!==null&&s!==void 0?s:i.get,d=function(){Kd&&Kd.state==="open"&&Kd.runTask(n);for(var u=arguments.length,h=new Array(u),p=0;p<u;p++)h[p]=arguments[p];return a==null?void 0:a.apply(this,...h)};return i.value?i.value=d:i.get=d,i}}function mO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function RS(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?mO(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):mO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class Ie extends di{get _source(){return this._trackSource}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get processorDestination(){return this._processorDestination}set processorDestination(t){this._processorDestination=t}get isPlaying(){return this._useAudioElement?cr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,e,i,s,a){super(t,i),g(this,"trackMediaType","audio"),g(this,"_encoderConfig",void 0),g(this,"_trackSource",void 0),g(this,"_enabled",!0),g(this,"_volume",100),g(this,"_useAudioElement",!1),g(this,"_bypassWebAudio",!1),g(this,"processor",void 0),g(this,"_processorContext",void 0),g(this,"_processorDestination",void 0),g(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=e,this._getOriginVolumeLevel=!!s;const d=()=>{this.processorContext=new af(this._source.context,this.getTrackId(),"local"),this.processorDestination=new of(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Xi.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})},u=a&&bi()&&!eO();x("DISABLE_WEBAUDIO")?(this._source=new TS,this._useAudioElement=!0,this._bypassWebAudio=!0):u?this._source=new TS:(this._source=new ES(t,!1,this._getOriginVolumeLevel?t:void 0),x("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),d(),!x("DISABLE_WEBAUDIO")&&u&&(Kd||(Kd=new kH),Kd).enqueue("INIT_WEBAUDIO",()=>{this._source=new ES(t,!1,this._getOriginVolumeLevel?t:void 0),x("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0),d(),this.emit(nf.UPDATE_TRACK_SOURCE)})}setVolume(t){Pe(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&cr.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void R.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,ke(this,ft.NEED_REPLACE_TRACK,this).then(()=>{R.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{R.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement)throw new J(O.NOT_SUPPORTED,"your browser does not support setting the audio output device");await cr.setSinkID(this.getTrackId(),t)}async setEnabled(t,e,i){return this._setEnabled(t,e,i)}async _setEnabled(t,e,i){if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await ke(this,ft.NEED_ENABLE_TRACK,this),R.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(s){throw i||(this._enabled=!1),R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),s.toString()),s}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await ke(this,ft.NEED_DISABLE_TRACK,this)}catch(s){throw i||(this._enabled=!0),R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,R.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await ke(this,ft.NEED_MUTE_TRACK,this):await ke(this,ft.NEED_UNMUTE_TRACK,this))}getStats(){return pu(()=>{R.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Ki(this,ft.GET_STATS)||RS({},hS)}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Xi.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(Xi.ON_AUDIO_BUFFER),this._source.on(Xi.ON_AUDIO_BUFFER,i=>t(i))}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] start audio playback in element")),cr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?cr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&cr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,e){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this.processor.updateInput({track:t,context:this.processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ke(this,ft.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return W.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new J(O.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new J(O.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(gi.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await ke(this,ft.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ke(this,ft.NEED_REPLACE_TRACK,this))}),this.processorDestination.on(gi.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(gi.ON_TRACK),this.processorDestination.removeAllListeners(gi.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Qi.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Qi.REQUEST_CONSTRAINTS)}}X([yS("INIT_WEBAUDIO"),C("design:type",Object),C("design:paramtypes",[Object])],Ie.prototype,"_source",null),X([yS("INIT_WEBAUDIO"),C("design:type",af),C("design:paramtypes",[af])],Ie.prototype,"processorContext",null),X([yS("INIT_WEBAUDIO"),C("design:type",of),C("design:paramtypes",[of])],Ie.prototype,"processorDestination",null),X([Lt({argsMap:(n,t)=>[n.getTrackId(),t],throttleTime:300}),C("design:type",Function),C("design:paramtypes",[Number]),C("design:returntype",void 0)],Ie.prototype,"setVolume",null),X([Lt({argsMap:(n,t)=>[n.getTrackId(),t]}),hn(),C("design:type",Function),C("design:paramtypes",[String]),C("design:returntype",W)],Ie.prototype,"setPlaybackDevice",null),X([Pd("LocalAudioTrack","_enabledMutex"),Lt({argsMap:(n,t)=>[n.getTrackId(),t]}),hn(),C("design:type",Function),C("design:paramtypes",[Boolean,Object,Boolean]),C("design:returntype",W)],Ie.prototype,"setEnabled",null),X([Pd("LocalAudioTrack","_enabledMutex"),Lt({argsMap:(n,t)=>[n.getTrackId(),t]}),hn(),C("design:type",Function),C("design:paramtypes",[Boolean]),C("design:returntype",W)],Ie.prototype,"setMuted",null),X([hn(),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",Object)],Ie.prototype,"getStats",null),X([hn(),C("design:type",Function),C("design:paramtypes",[Object,Number]),C("design:returntype",void 0)],Ie.prototype,"setAudioFrameCallback",null),X([Lt({argsMap:n=>[n.getTrackId()]}),hn(),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],Ie.prototype,"play",null),X([Lt({argsMap:n=>[n.getTrackId()]}),hn(),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],Ie.prototype,"stop",null),X([Lt({argsMap:n=>[n.getTrackId()]}),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],Ie.prototype,"close",null),X([Lt({argsMap:(n,t)=>[n.getTrackId(),t.name]}),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",Object)],Ie.prototype,"pipe",null),X([Lt({argsMap:n=>[n.getTrackId()]}),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],Ie.prototype,"unpipe",null);class Sa extends Ie{get __className__(){return"MicrophoneAudioTrack"}constructor(t,e,i,s){super(t,e.encoderConfig?tf(e.encoderConfig):{},s,x("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),g(this,"_config",void 0),g(this,"_deviceName","default"),g(this,"_constraints",void 0),g(this,"_originalConstraints",void 0),g(this,"_enabled",!0),this._config=e,this._constraints=i,this._originalConstraints=i,this._deviceName=t.label,typeof e.bypassWebAudio=="boolean"&&(this._bypassWebAudio=e.bypassWebAudio),(Ad()||Rg())&&Oe.bindInterruptDetectorTrack(this),this.on(nf.UPDATE_TRACK_SOURCE,()=>{this.bindProcessorContextEvents()}),eO()&&this.bindProcessorContextEvents()}async setDevice(t){if(R.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const e=await br.getDeviceById(t),i={};i.audio=RS({},this._constraints),i.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let s=null;try{s=await Ir(i,this.getTrackId())}catch(a){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),a.toString()),s=await Ir({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const e=await br.getDeviceById(t);this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}R.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,e,i){if(e)return R.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){var s;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(s=this._source.clonedTrack)===null||s===void 0||s.stop(),i||(this._enabled=!1);try{await ke(this,ft.NEED_DISABLE_TRACK,this)}catch(u){throw R.error("[".concat(this.getTrackId(),"] setEnabled false failed"),u.toString()),u}return}const a=RS({},this._constraints),d=br.searchDeviceIdByName(this._deviceName);d&&!a.deviceId&&(a.deviceId=d);try{i||(this._enabled=!0);const u=await Ir({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(u.getAudioTracks()[0],!1),await ke(this,ft.NEED_ENABLE_TRACK,this)}catch(u){throw i||(this._enabled=!1),R.error("[".concat(this.getTrackId(),"] setEnabled true failed"),u.toString()),u}R.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Ad()||Rg())&&Oe.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((wi()||Js())&&this._enabled&&!this._isClosed&&Oe.duringInterruption){const t=async()=>{Oe.off(Xn.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Oe.on(Xn.IOS_INTERRUPTION_END,t)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(ga.TRACK_ENDED)}async renewMediaStreamTrack(t){const e=t||this._constraints,i=br.searchDeviceIdByName(this._deviceName);if(i&&!e.deviceId&&(e.deviceId=i),this._constraints=e,this._enabled){this._originMediaStreamTrack.stop();const s=await Ir({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!0)}}bindProcessorContextEvents(){this.processorContext.on(Qi.REQUEST_UPDATE_CONSTRAINTS,async(t,e,i)=>{try{const s=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(s),e()}catch(s){i(s)}}),this.processorContext.on(Qi.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}}X([Lt({argsMap:(n,t)=>[n.getTrackId(),t]}),hn(),C("design:type",Function),C("design:paramtypes",[String]),C("design:returntype",W)],Sa.prototype,"setDevice",null),X([Pd("MicrophoneAudioTrack","_enabledMutex"),Lt({argsMap:(n,t,e)=>[n.getTrackId(),t,e]}),hn(),C("design:type",Function),C("design:paramtypes",[Boolean,Boolean,Boolean]),C("design:returntype",W)],Sa.prototype,"setEnabled",null),X([Lt({argsMap:n=>[n.getTrackId()]}),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],Sa.prototype,"close",null);class Ta extends Ie{get __className__(){return"BufferSourceAudioTrack"}constructor(t,e,i,s){super(e.createOutputTrack(),i,s),g(this,"source",void 0),g(this,"_bufferSource",void 0),this.source=t,this._bufferSource=e,this._bufferSource.on(Xi.AUDIO_SOURCE_STATE_CHANGE,a=>{this.safeEmit(ga.SOURCE_STATE_CHANGE,a)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){Pe(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}X([Lt({argsMap:(n,t)=>[n.getTrackId(),t,n.duration]}),hn(),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",void 0)],Ta.prototype,"startProcessAudioBuffer",null),X([Lt({argsMap:n=>[n.getTrackId()]}),hn(),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],Ta.prototype,"pauseProcessAudioBuffer",null),X([Lt({argsMap:n=>[n.getTrackId()]}),hn(),C("design:type",Function),C("design:paramtypes",[Number]),C("design:returntype",void 0)],Ta.prototype,"seekAudioBuffer",null),X([Lt({argsMap:n=>[n.getTrackId()]}),hn(),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],Ta.prototype,"resumeProcessAudioBuffer",null),X([Lt({argsMap:n=>[n.getTrackId()]}),hn(),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],Ta.prototype,"stopProcessAudioBuffer",null),X([Lt({argsMap:n=>[n.getTrackId()]}),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],Ta.prototype,"close",null),X([Lt({argsMap:n=>[n.getTrackId()]}),hn(),C("design:type",Function),C("design:paramtypes",[Number]),C("design:returntype",void 0)],Ta.prototype,"setAudioBufferPlaybackSpeed",null);class vn extends Ie{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=Hd().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,Le(8,"track-mix-")),g(this,"trackList",void 0),g(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(R.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):R.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){R.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}bg(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(e=>{e._encoderConfig&&((e._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=e._encoderConfig.bitrate),(e._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=e._encoderConfig.sampleRate),(e._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=e._encoderConfig.sampleSize),e._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(e=>{e instanceof vn?e.emit(Wd.TRANSCEIVER_UPDATED,t):e._updateRtpTransceiver(t)}))}}function cf(n){const t={};n.facingMode&&(t.facingMode=n.facingMode),n.cameraId&&(t.deviceId={exact:n.cameraId});const e=to(n.encoderConfig);return e.width!=null&&(t.width=e.width),e.height!=null&&(t.height=e.height),!cw()&&e.frameRate&&(t.frameRate=e.frameRate),Se().name===Ce.EDGE&&typeof t.frameRate=="object"&&(t.frameRate.max=60),We()&&(t.frameRate={ideal:30,max:30}),t}function EO(n){const t={};if(cw()||(n.AGC!==void 0&&(t.autoGainControl=n.AGC),n.AEC!==void 0&&(t.echoCancellation=n.AEC),n.ANS!==void 0&&(t.noiseSuppression=n.ANS,Tg()&&n.ANS&&(t.googHighpassFilter=n.ANS))),n.encoderConfig){const e=tf(n.encoderConfig);t.channelCount=e.stereo?2:1,t.sampleRate=e.sampleRate,t.sampleSize=e.sampleSize}return n.microphoneId&&(t.deviceId={exact:n.microphoneId}),Np()&&(t.sampleRate=void 0),t}class LH extends iO{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(Xi.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),g(this,"audioBuffer",void 0),g(this,"sourceNode",void 0),g(this,"startPlayTime",0),g(this,"startPlayOffset",0),g(this,"pausePlayTime",0),g(this,"options",void 0),g(this,"currentLoopCount",0),g(this,"currentPlaybackSpeed",100),g(this,"_currentState","stopped"),this.audioBuffer=t,this.options=e,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):R.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const gO=new Map;async function MH(n,t){let e=null;if(typeof n=="string"){const s=gO.get(n);if(s)return R.debug("use cached audio resource: ",n),s;try{e=(await Ns(()=>qi.get(n,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(a){throw new J(O.FETCH_AUDIO_FILE_FAILED,a.toString())}}else e=await new W((a,d)=>{const u=new FileReader;u.onload=h=>{h.target?a(h.target.result):d(new J(O.READ_LOCAL_AUDIO_FILE_ERROR))},u.onerror=()=>{d(new J(O.READ_LOCAL_AUDIO_FILE_ERROR))},u.readAsArrayBuffer(n)});const i=await function(s){const a=Hd();return new W((d,u)=>{a.decodeAudioData(s,h=>{d(h)},h=>{u(new J(O.DECODE_AUDIO_FILE_FAILED,h.toString()))})})}(e);return typeof n=="string"&&t&&gO.set(n,i),i}const vS=n=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new W((e,i)=>{t.toBlob(async s=>{if(t.remove(),s){const a=await SO(s);e({buffer:a,width:t.width,height:t.height})}else i(new J(O.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},n,1)})},SO=async n=>{const t=await n.arrayBuffer();return new Uint8Array(t)},ko=new class extends Ye{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),g(this,"_lastHiddenTime",0),g(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),R.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};function TO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function yO(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?TO(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):TO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class CS{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(R.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}constructor(t){g(this,"trackId",void 0),g(this,"config",void 0),g(this,"onFirstVideoFrameDecoded",void 0),g(this,"freezeTimeCounterList",[]),g(this,"renderFreezeAccTime",0),g(this,"isKeepLastFrame",!1),g(this,"timeUpdatedCount",0),g(this,"freezeTime",0),g(this,"playbackTime",0),g(this,"lastTimeUpdatedTime",0),g(this,"autoplayFailed",!1),g(this,"videoTrack",void 0),g(this,"videoElement",void 0),g(this,"cacheVideoElement",void 0),g(this,"videoElementCheckInterval",void 0),g(this,"_videoElementStatus",Si.NONE),g(this,"isGettingVideoDimensions",!1),g(this,"startGetVideoDimensions",()=>{const e=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return R.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(e,500)};!this.isGettingVideoDimensions&&e()}),g(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Oe.curState==="running"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(ew())),ow()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),g(this,"handleVideoEvents",e=>{switch(e.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Si.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Si.CANPLAY;break;case"stalled":this.videoElementStatus=Si.STALLED;break;case"suspend":this.videoElementStatus=Si.SUSPEND;break;case"pause":this.videoElementStatus=Si.PAUSED,wi()||Js()||bi()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Si.WAITING;break;case"abort":this.videoElementStatus=Si.ABORT;break;case"ended":this.videoElementStatus=Si.ENDED;break;case"emptied":this.videoElementStatus=Si.EMPTIED;break;case"error":{this.videoElementStatus=Si.ERROR;const i=this.videoElement.error;i&&R.error("[".concat(this.trackId,"] media error, code: ").concat(i.code,", message: ").concat(i.message));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const s=i-this.lastTimeUpdatedTime,a=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,ko.lastVisibleTime<ko.lastHiddenTime||a<ko.lastHiddenTime||a<ko.lastVisibleTime)return;for(s>x("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=s),this.playbackTime+=s;this.playbackTime>=6e3;){this.playbackTime-=6e3;const d=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(d),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),g(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(R.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(ew())),ow()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Oe.on(Xn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Oe.on(Xn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const e=this.videoElement.play();e&&e.catch&&e.catch(s=>{t&&hO(t,"video",s.message,this.trackId),s.name==="NotAllowedError"?(R.warning("detected video element autoplay failed",s),this.autoplayFailed=!0,this.handleAutoPlayFailed()):R.warning("[".concat(this.trackId,"] play warning: "),s)});const i=Se();if((i.name==="Safari"&&Number(i.version)===15||Ad())&&e&&e.then){const s=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};e.then(s).catch(s)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const e=t.getContext("2d");if(!e)return R.error("create canvas context failed!"),new ImageData(2,2);e.drawImage(this.videoElement,0,0,t.width,t.height);const i=e.getImageData(0,0,t.width,t.height);return t.remove(),i}async getCurrentFrameToUint8Array(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const s=i.getContext("2d");return s?(s.drawImage(this.videoElement,0,0,i.width,i.height),new W((a,d)=>{i.toBlob(async u=>{if(i.remove(),u){const h=await SO(u);a({buffer:h,width:i.width,height:i.height})}else d(new J(O.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,e<0?.1:e>1?1:e)})):await vS(t)}destroy(){Oe.off(Xn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Oe.off(Xn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}initVideoElement(){if(this.videoElementStatus=Si.INIT,!this.videoElementCheckInterval&&(RO.forEach(a=>{this.videoElement.addEventListener(a,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(a){return a!==document.body&&document.body.contains(a)})(this.videoElement)||(this.videoElementStatus=Si.DESTROYED)},1e3),x("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,e;let a;const d=(u,h)=>{if(this.videoElementStatus===Si.PLAYING){if(a){const m=h.presentationTime-a.presentationTime;m>x("VIDEO_FREEZE_DURATION")&&ko.lastVisibleTime>=ko.lastHiddenTime&&a.timestamp>ko.lastVisibleTime&&a.timestamp>ko.lastHiddenTime&&(this.renderFreezeAccTime+=m)}a=yO(yO({},h),{},{timestamp:u})}var p,_;x("ENABLE_VIDEO_FRAME_CALLBACK")&&((p=(_=this.videoElement).requestVideoFrameCallback)===null||p===void 0||p.call(_,d))};(t=(e=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(e,d)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Np()&&(this.videoElement.poster="noposter");const i=Se();i.name==="Safari"&&Number(i.version)===15||Ad()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,We()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,We()&&this.videoElement.load());const s=this.videoElement.play();s!==void 0&&s.catch(a=>{R.debug("[".concat(this.trackId,"] playback interrupted"),a.toString())})}resetVideoElement(){RO.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Si.NONE}handleAutoPlayFailed(){const t=e=>{e.preventDefault(),this.videoElement.play().then(()=>{R.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{R.error(i)}),this.autoplayFailed=!1,uu()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};uu()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),dO()}}const RO=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class vO extends CS{constructor(t){super(t),g(this,"container",void 0),g(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const e=t.element;e!==this.slot&&(this.destroy(),this.slot=e),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var e;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,i):await vS(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",x("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function CO(n){return new W((t,e)=>{let i=!1;const s=document.createElement("video");s.setAttribute("autoplay",""),s.setAttribute("muted",""),s.muted=!0,s.autoplay=!0,s.setAttribute("playsinline",""),s.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(s);const a=wi()?"canplay":"playing";s.addEventListener(a,()=>{const d=s.videoWidth,u=s.videoHeight;!d&&We()||(i=!0,s.srcObject=null,s.remove(),t([d,u]))}),s.srcObject=new MediaStream([n]),s.play().catch(Lp),setTimeout(()=>{i||(s.srcObject=null,s.remove(),t([s.videoWidth,s.videoHeight]))},4e3)})}const UH=async(n,t,e)=>{const i=function(d){const u=[];for(let h=0;h<d.length;h+=2)u.push(parseInt(d.slice(h,h+2),16));return Uint8Array.from(u)}(function(d){const u="0123456789abcdef";function h(ut){let ct,$t="";for(ct=0;ct<=3;ct++)$t+=u.charAt(ut>>8*ct+4&15)+u.charAt(ut>>8*ct&15);return $t}function p(ut,ct){const $t=(65535&ut)+(65535&ct);return(ut>>16)+(ct>>16)+($t>>16)<<16|65535&$t}function _(ut,ct,$t,pe,sn,Nn){return p(function(Ge,lr){return Ge<<lr|Ge>>>32-lr}(p(p(ct,ut),p(pe,Nn)),sn),$t)}function m(ut,ct,$t,pe,sn,Nn,Ge){return _(ct&$t|~ct&pe,ut,ct,sn,Nn,Ge)}function S(ut,ct,$t,pe,sn,Nn,Ge){return _(ct&pe|$t&~pe,ut,ct,sn,Nn,Ge)}function y(ut,ct,$t,pe,sn,Nn,Ge){return _(ct^$t^pe,ut,ct,sn,Nn,Ge)}function b(ut,ct,$t,pe,sn,Nn,Ge){return _($t^(ct|~pe),ut,ct,sn,Nn,Ge)}const I=function(ut){let ct;const $t=1+(ut.length+8>>6),pe=new Array(16*$t);for(ct=0;ct<16*$t;ct++)pe[ct]=0;for(ct=0;ct<ut.length;ct++)pe[ct>>2]|=ut.charCodeAt(ct)<<ct%4*8;return pe[ct>>2]|=128<<ct%4*8,pe[16*$t-2]=8*ut.length,pe}(d);let A,L,U,F,$,z=1732584193,G=-271733879,Y=-1732584194,q=271733878;for(A=0;A<I.length;A+=16)L=z,U=G,F=Y,$=q,z=m(z,G,Y,q,I[A+0],7,-680876936),q=m(q,z,G,Y,I[A+1],12,-389564586),Y=m(Y,q,z,G,I[A+2],17,606105819),G=m(G,Y,q,z,I[A+3],22,-1044525330),z=m(z,G,Y,q,I[A+4],7,-176418897),q=m(q,z,G,Y,I[A+5],12,1200080426),Y=m(Y,q,z,G,I[A+6],17,-1473231341),G=m(G,Y,q,z,I[A+7],22,-45705983),z=m(z,G,Y,q,I[A+8],7,1770035416),q=m(q,z,G,Y,I[A+9],12,-1958414417),Y=m(Y,q,z,G,I[A+10],17,-42063),G=m(G,Y,q,z,I[A+11],22,-1990404162),z=m(z,G,Y,q,I[A+12],7,1804603682),q=m(q,z,G,Y,I[A+13],12,-40341101),Y=m(Y,q,z,G,I[A+14],17,-1502002290),G=m(G,Y,q,z,I[A+15],22,1236535329),z=S(z,G,Y,q,I[A+1],5,-165796510),q=S(q,z,G,Y,I[A+6],9,-1069501632),Y=S(Y,q,z,G,I[A+11],14,643717713),G=S(G,Y,q,z,I[A+0],20,-373897302),z=S(z,G,Y,q,I[A+5],5,-701558691),q=S(q,z,G,Y,I[A+10],9,38016083),Y=S(Y,q,z,G,I[A+15],14,-660478335),G=S(G,Y,q,z,I[A+4],20,-405537848),z=S(z,G,Y,q,I[A+9],5,568446438),q=S(q,z,G,Y,I[A+14],9,-1019803690),Y=S(Y,q,z,G,I[A+3],14,-187363961),G=S(G,Y,q,z,I[A+8],20,1163531501),z=S(z,G,Y,q,I[A+13],5,-1444681467),q=S(q,z,G,Y,I[A+2],9,-51403784),Y=S(Y,q,z,G,I[A+7],14,1735328473),G=S(G,Y,q,z,I[A+12],20,-1926607734),z=y(z,G,Y,q,I[A+5],4,-378558),q=y(q,z,G,Y,I[A+8],11,-2022574463),Y=y(Y,q,z,G,I[A+11],16,1839030562),G=y(G,Y,q,z,I[A+14],23,-35309556),z=y(z,G,Y,q,I[A+1],4,-1530992060),q=y(q,z,G,Y,I[A+4],11,1272893353),Y=y(Y,q,z,G,I[A+7],16,-155497632),G=y(G,Y,q,z,I[A+10],23,-1094730640),z=y(z,G,Y,q,I[A+13],4,681279174),q=y(q,z,G,Y,I[A+0],11,-358537222),Y=y(Y,q,z,G,I[A+3],16,-722521979),G=y(G,Y,q,z,I[A+6],23,76029189),z=y(z,G,Y,q,I[A+9],4,-640364487),q=y(q,z,G,Y,I[A+12],11,-421815835),Y=y(Y,q,z,G,I[A+15],16,530742520),G=y(G,Y,q,z,I[A+2],23,-995338651),z=b(z,G,Y,q,I[A+0],6,-198630844),q=b(q,z,G,Y,I[A+7],10,1126891415),Y=b(Y,q,z,G,I[A+14],15,-1416354905),G=b(G,Y,q,z,I[A+5],21,-57434055),z=b(z,G,Y,q,I[A+12],6,1700485571),q=b(q,z,G,Y,I[A+3],10,-1894986606),Y=b(Y,q,z,G,I[A+10],15,-1051523),G=b(G,Y,q,z,I[A+1],21,-2054922799),z=b(z,G,Y,q,I[A+8],6,1873313359),q=b(q,z,G,Y,I[A+15],10,-30611744),Y=b(Y,q,z,G,I[A+6],15,-1560198380),G=b(G,Y,q,z,I[A+13],21,1309151649),z=b(z,G,Y,q,I[A+4],6,-145523070),q=b(q,z,G,Y,I[A+11],10,-1120210379),Y=b(Y,q,z,G,I[A+2],15,718787259),G=b(G,Y,q,z,I[A+9],21,-343485551),z=p(z,L),G=p(G,U),Y=p(Y,F),q=p(q,$);return h(z)+h(G)+h(Y)+h(q)}(""+t+e)).slice(0,16),s=i.slice(0,12),a=await window.crypto.subtle.importKey("raw",i,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:s},a,n))},IO=async(n,t,e)=>await UH(n.buffer,t,e);function bO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Ar(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?bO(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):bO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class te extends di{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Si.PLAYING)}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,e,i,s,a,d){if(super(t,a),g(this,"trackMediaType","video"),g(this,"_player",void 0),g(this,"isUseScaleResolutionDownBy",!1),g(this,"_videoVisibleTimer",null),g(this,"_statsTimer",null),g(this,"_previousVideoVisibleStatus",void 0),g(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),g(this,"_encoderConfig",void 0),g(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),g(this,"_optimizationMode",void 0),g(this,"_videoHeight",void 0),g(this,"_videoWidth",void 0),g(this,"_forceBitrateLimit",void 0),g(this,"_enabled",!0),g(this,"processorDestination",void 0),g(this,"_processorContext",void 0),bi()){const{width:u,height:h}=t.getSettings();this._videoWidth=u,this._videoHeight=h}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=e,this._scalabilityMode=i,this._optimizationMode=s,this._hints=d||[],this._hints.indexOf(Fe.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(u,h,p){const _=Se();return!(_.name!==u||!_.osVersion)&&(p?Number(_.version)>=h&&Number(_.version)<=p:Number(_.version)===h)}(Ce.CHROME,115)&&Ap().indexOf("Windows")!==-1){const u=function(h,p){if("VideoFrame"in window&&"TransformStream"in window&&xe().supportWebRTCInsertableStream){const _=new MediaStreamTrackProcessor(h),m=new MediaStreamTrackGenerator({kind:"video"});let S,y,b=Date.now();const I=()=>{A&&(clearInterval(A),A=void 0),S&&(S.close(),S=void 0),h.stop(),y=void 0,m.removeEventListener("ended",I)};let A=window.setInterval(()=>{if(y&&S&&Date.now()-b>(p??1e3))try{m.readyState==="live"?y.enqueue(S.clone()):I()}catch{I()}},p??1e3);const L=new TransformStream({transform:(U,F)=>{m.readyState==="live"?(y=F,b=Date.now(),S===void 0?(S=U,F.enqueue(U.clone())):(F.enqueue(S),S=U)):U.close()}});return m.addEventListener("ended",I),_.readable.pipeThrough(L).pipeTo(m.writable),m}}(t);u&&(R.info("local screen video track begin to inject frame"),this._mediaStreamTrack=u)}e&&this._hints.indexOf(Fe.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(e),this.processorContext=new _O(this.getTrackId(),"local"),this.processorDestination=new fO(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const s=document.getElementById(t);s?t=s:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));const i=Ar(Ar(Ar({},this._getDefaultPlayerConfig()),e),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(i):(t instanceof HTMLVideoElement?this._player=new CS(i):this._player=new vO(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const s=this.getVideoElementVisibleStatus();this.safeEmit(ga.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}},x("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._statsTimer&&(this.isUseScaleResolutionDownBy=!1,window.clearInterval(this._statsTimer),this._statsTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,e){if(!e){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await ke(this,ft.NEED_DISABLE_TRACK,this)}catch(i){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return e||(this._enabled=!1),void R.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await ke(this,ft.NEED_ENABLE_TRACK,this)}catch(i){throw R.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),e||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,R.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await ke(this,ft.NEED_MUTE_TRACK,this):await ke(this,ft.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(t,e){if(!this._enabled)throw new J(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t==="720p_auto"?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),t=to(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const i=cf({encoderConfig:t});(bi()||wi()||Js())&&(i.deviceId=void 0),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(s){const a=new J(O.UNEXPECTED_ERROR,s.toString());throw R.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a}}this._encoderConfig=t,this._hints.indexOf(Fe.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ke(this,ft.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(R)}}getStats(){return pu(()=>{R.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Ki(this,ft.GET_STATS)||Ar({},pS)}async setBeautyEffect(t){R.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,e):await vS(t)}async setBitrateLimit(t){if(R.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t){this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate);try{await ke(this,ft.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(R)}}}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void R.error(O.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const e=this._optimizationMode;try{this._optimizationMode=t,await ke(this,ft.SET_OPTIMIZATION_MODE,this)}catch(i){throw this._optimizationMode=e,R.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}R.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return R.error(O.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,R.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){CO(this._originMediaStreamTrack).then(t=>{let[e,i]=t;this._videoHeight=i,this._videoWidth=e}).catch(Lp)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new J(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");R.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=to(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(Fe.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ke(this,ft.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(R)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:e,frameRate:i}=this.getMediaStreamTrackSettings();if(!t||!e||!i)return;const[s,a]=function(d,u,h,p){let _;const m=200*Math.pow(h/15,.6)*Math.pow(d*u/640/360,.75),S=m;if(p==="STANDARD_BITRATE")_=4*m;else{if(p!=="COMPATIABLE_BITRATE")return;_=2*m}return[Math.floor(_),Math.floor(S)]}(t,e,i,x("BITRATE_ADAPTER_TYPE"))||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=a,this._encoderConfig.bitrateMax=s,R.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(e,", fps: ").concat(i,"] => [brMax: ").concat(s,", brMin: ").concat(a,"]")))}getVideoElementVisibleStatus(){try{var t,e;const i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),s={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:a,slot:d}=s;if(this.isPlaying&&a instanceof HTMLVideoElement&&d instanceof HTMLElement){const u=hw.checkOneElementVisible(a),h=Object.assign({},u);if(h.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=h.visible;const p=vt.reportApiInvoke(null,{tag:Je.TRACER,name:An.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});h.visible?p.onSuccess("Video is visible"):p.onSuccess("Invisible because of ".concat(h.reason))}return h}return}catch(i){throw new J(O.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new J(O.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=Ar(Ar({},i),to(t))),i=Tc(i);const s=Le(8,"track-video-cloned-"),a=new te(e?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,Tc(this._scalabilityMode),this._optimizationMode,s,Tc(this._hints));return t&&i&&a.setEncoderConfiguration(i),R.debug("clone video track from ".concat(this.getTrackId()," to ").concat(s,", clone ").concat(e)),a}async replaceTrack(t,e){if(!(t instanceof MediaStreamTrack))throw new J(O.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new J(O.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,e,!0),this.updateMediaStreamTrackResolution()}startMonitorStats(){if(!bi()&&!wi())return;this._statsTimer&&window.clearInterval(this._statsTimer);let t=2,e=$p[t],i=-1,s=Date.now();const a=d=>{d>2||d<0||(s=Date.now(),e=$p[d],this.setSenderConfiguration(e))};this.isUseScaleResolutionDownBy=!0,this._statsTimer=window.setInterval(()=>{const d=this.getStats(),u=Ki(this,ft.GET_RTC_STATS);if(d.sendPackets>0&&u){i===-1&&(i=Date.now());const h=Date.now();if(h-i<1e3||h-s<x("PROFILE_SWITCH_INTERVAL"))return;const p=d.sendFrameRate,_=.6*e.frameRate,m=.9*e.frameRate;typeof p=="number"&&p>0&&p<_?t>0&&(t--,a(t),R.debug("[".concat(this.getTrackId(),"] step down for fps ").concat(p,", switchProfile to ").concat(t))):u.OutgoingAvailableBandwidth<e.bitrateMin?t>0&&(t--,a(t),R.debug("[".concat(this.getTrackId(),"] step down for OutgoingAvailableBandwidth ").concat(u.OutgoingAvailableBandwidth,", bitrateMin ").concat(e.bitrateMin,", switchProfile to ").concat(t))):typeof p=="number"&&p>m&&t<$p.length-1&&u.OutgoingAvailableBandwidth>1.2*$p[t+1].bitrateMin&&(t++,a(t),R.debug("[".concat(this.getTrackId(),"] step up for fps ").concat(p,", OutgoingAvailableBandwidth ").concat(u.OutgoingAvailableBandwidth,", switchProfile to ").concat(t)))}},x("CHECK_LOCAL_STATS_INTERVAL"))}bindProcessorDestinationEvents(){this.processorDestination.on(gi.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await ke(this,ft.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ke(this,ft.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(gi.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Qi.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Qi.REQUEST_CONSTRAINTS)}}X([Lt({argsMap:(n,t,e)=>[n.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",e]}),hn(),C("design:type",Function),C("design:paramtypes",[Object,Object]),C("design:returntype",void 0)],te.prototype,"play",null),X([Lt({argsMap:n=>[n.getTrackId()]}),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],te.prototype,"stop",null),X([Pd("LocalVideoTrack","_enabledMutex"),Lt({argsMap:(n,t)=>[n.getTrackId(),t]}),hn(),C("design:type",Function),C("design:paramtypes",[Boolean,Boolean]),C("design:returntype",W)],te.prototype,"setEnabled",null),X([Pd("LocalVideoTrack","_enabledMutex"),Lt({argsMap:(n,t)=>[n.getTrackId(),t]}),hn(),C("design:type",Function),C("design:paramtypes",[Boolean]),C("design:returntype",W)],te.prototype,"setMuted",null),X([Lt({argsMap:(n,t)=>[n.getTrackId(),t]}),hn(),C("design:type",Function),C("design:paramtypes",[Object,Boolean]),C("design:returntype",W)],te.prototype,"setEncoderConfiguration",null),X([hn(),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",Object)],te.prototype,"getStats",null),X([Lt({argsMap:(n,t,e)=>[n.getTrackId(),t,e]}),hn(),C("design:type",Function),C("design:paramtypes",[Boolean,Object]),C("design:returntype",W)],te.prototype,"setBeautyEffect",null),X([hn(),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",ImageData)],te.prototype,"getCurrentFrameData",null),X([hn(),C("design:type",Function),C("design:paramtypes",[String,Number]),C("design:returntype",W)],te.prototype,"getCurrentFrameImage",null),X([hn(),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",W)],te.prototype,"setBitrateLimit",null),X([hn(),C("design:type",Function),C("design:paramtypes",[String]),C("design:returntype",W)],te.prototype,"setOptimizationMode",null),X([hn(),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",void 0)],te.prototype,"setScalabiltyMode",null),X([hn(),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],te.prototype,"updateMediaStreamTrackResolution",null),X([Lt({argsMap:(n,t)=>[n.getTrackId(),t.name]}),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",Object)],te.prototype,"pipe",null),X([Lt({argsMap:n=>[n.getTrackId()]}),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],te.prototype,"unpipe",null),X([Lt({argsMap:n=>[n.getTrackId()]}),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],te.prototype,"close",null),X([Lt({argsMap:(n,t,e)=>[n.getTrackId(),t.label,e]}),C("design:type",Function),C("design:paramtypes",[MediaStreamTrack,Boolean]),C("design:returntype",W)],te.prototype,"replaceTrack",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],te.prototype,"startMonitorStats",null);class ya extends te{get __className__(){return"CameraVideoTrack"}constructor(t,e,i,s,a,d){super(t,to(e.encoderConfig),s,a,d),g(this,"_config",void 0),g(this,"_originalConstraints",void 0),g(this,"_constraints",void 0),g(this,"_enabled",!0),g(this,"_deviceName","default"),g(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Ad()||Rg())&&!function(){const u=Se();if(u.os!==Fn.IOS||!u.osVersion)return!1;const h=u.osVersion.split(".");return Number(h[0])===15&&Number(h[1])>=2}()&&aw()&&this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=e,this._originalConstraints=i,this._constraints=i,this._deviceName=t.label,this._encoderConfig=to(this._config.encoderConfig),Oe.on(Xn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Oe.on(Xn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(R.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const e=await br.getDeviceById(t),i={};i.video=Ar({},this._constraints),i.video.deviceId={exact:t},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let s=null;try{s=await Ir(i,this.getTrackId())}catch(a){throw R.error("[".concat(this.getTrackId(),"] setDevice failed"),a.toString()),s=await Ir({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=e.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(e){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const e=await br.getDeviceById(t);this._deviceName=e.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(e){throw R.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}R.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){R.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const e={video:Ar(Ar({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await Ir(e,this.getTrackId())}catch(s){throw R.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),s.toString()),i=await Ir({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=Ar({},e.video),R.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,e){if(!e){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(R.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const i=await Ir({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await ke(this,ft.NEED_ENABLE_TRACK,this)}catch(i){throw R.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),R.info("[".concat(this.getTrackId(),"] setEnabled to true success")),e||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),e||(this._enabled=!1);try{await ke(this,ft.NEED_DISABLE_TRACK,this)}catch(i){throw R.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}R.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,e){if(!this._enabled)throw new J(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t==="720p_auto"?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),t=to(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin);const i=yn(this._config);i.encoderConfig=t;const s=cf(i);(bi()||wi()||Js())&&(s.deviceId=void 0),R.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(s));try{await this._originMediaStreamTrack.applyConstraints(s),this.updateMediaStreamTrackResolution()}catch(a){const d=new J(O.UNEXPECTED_ERROR,a.toString());throw R.error("[".concat(this.getTrackId(),"] applyConstraints error"),d.toString()),d}this._config=i,this._constraints=s,this._originalConstraints=s,this._encoderConfig=t,this._hints.indexOf(Fe.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ke(this,ft.NEED_UPDATE_VIDEO_ENCODER,this)}catch(a){return a.throw(R)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((wi()||Js())&&this._enabled&&!this._isClosed&&Oe.duringInterruption){const t=async()=>{Oe.off(Xn.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(R.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Oe.on(Xn.IOS_INTERRUPTION_END,t)}else R.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(ga.TRACK_ENDED)}async renewMediaStreamTrack(t){const e=t||this._constraints,i=br.searchDeviceIdByName(this._deviceName);if(i&&!e.deviceId&&(e.deviceId={exact:i}),this._enabled){const s=await Ir({video:e},this.getTrackId());this._constraints=e,await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Oe.off(Xn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Oe.off(Xn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=Ar(Ar({},i),to(t))),i=Tc(i);const s=Le(8,"track-cam-cloned-"),a=new ya(e?this._mediaStreamTrack.clone():this._mediaStreamTrack,Tc(Ar(Ar({},this._config),{},{encoderConfig:i})),Tc(this._constraints),Tc(this._scalabilityMode),this._optimizationMode,s);return t&&i&&a.setEncoderConfiguration(i),R.debug("clone track from ".concat(this.getTrackId()," to ").concat(s,", clone ").concat(e)),a}bindProcessorContextEvents(){this.processorContext.on(Qi.REQUEST_UPDATE_CONSTRAINTS,async(t,e,i)=>{try{const s=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(s),e()}catch(s){i(s)}}),this.processorContext.on(Qi.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}}function wO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function df(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?wO(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):wO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}function IS(n,t,e,i){e.optimizationMode&&(i&&i.width&&i.height?(e.encoderConfig=df(df({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),e.optimizationMode!=="motion"&&e.optimizationMode!=="detail"||(t.contentHint=e.optimizationMode,t.contentHint===e.optimizationMode?R.debug("[".concat(n,"] set content hint to"),e.optimizationMode):R.debug("[".concat(n,"] set content hint failed")))):R.warning("[".concat(n,"] can not apply optimization mode bitrate config, no encoderConfig")))}function AO(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function lf(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?AO(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):AO(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}X([Lt({argsMap:(n,t)=>[n.getTrackId(),t]}),hn(),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",W)],ya.prototype,"setDevice",null),X([Pd("CameraVideoTrack","_enabledMutex"),Lt({argsMap:(n,t)=>[n.getTrackId(),t]}),hn(),C("design:type",Function),C("design:paramtypes",[Boolean,Boolean]),C("design:returntype",W)],ya.prototype,"setEnabled",null),X([Lt({argsMap:(n,t)=>[n.getTrackId(),t]}),hn(),C("design:type",Function),C("design:paramtypes",[Object,Boolean]),C("design:returntype",W)],ya.prototype,"setEncoderConfiguration",null),X([Lt({argsMap:n=>[n.getTrackId()]}),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],ya.prototype,"close",null);class OO extends $A{getUserId(){return this._userId}constructor(t,e,i,s){super(t,"track-".concat(t.kind,"-").concat(e,"-").concat(s.clientId,"_").concat(Le(5,""))),g(this,"_userId",void 0),g(this,"_uintId",void 0),g(this,"_isDestroyed",!1),g(this,"store",void 0),g(this,"processor",void 0),this._userId=e,this._uintId=i,this.store=s}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,R.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}class eo extends OO{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Si.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,e,i,s){super(t,e,i,s),g(this,"_videoVisibleTimer",null),g(this,"_previousVideoVisibleStatus",void 0),g(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),g(this,"trackMediaType","video"),g(this,"_videoWidth",void 0),g(this,"_videoHeight",void 0),g(this,"_player",void 0),g(this,"processorDestination",void 0),g(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new _O(this.getTrackId(),"remote"),this.processorDestination=new fO(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return pu(()=>{R.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Ki(this,ft.GET_STATS)||lf({},QA)}play(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const s=document.getElementById(t);s?t=s:(R.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}R.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));const i=lf(lf({fit:"cover"},e),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(i):(t instanceof HTMLVideoElement?this._player=new CS(i):this._player=new vO(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(wc.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const s=this.getVideoElementVisibleStatus();this.safeEmit(wc.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}},x("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,R.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){CO(this._originMediaStreamTrack).then(t=>{let[e,i]=t;this._videoHeight=i,this._videoWidth=e}).catch(Lp)}_updatePlayerSource(){R.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,e;const i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),s={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:a,slot:d}=s;if(this.isPlaying&&a instanceof HTMLVideoElement&&d instanceof HTMLElement){const u=hw.checkOneElementVisible(a),h=Object.assign({},u);if(h.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=h.visible;const p=vt.reportApiInvoke(null,{tag:Je.TRACER,name:An.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});h.visible?p.onSuccess("Video is visible"):p.onSuccess("Invisible because of ".concat(h.reason))}return h}return}catch(i){throw new J(O.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new J(O.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(gi.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(gi.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}X([Lt({argsMap:(n,t,e)=>[n.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",e]}),C("design:type",Function),C("design:paramtypes",[Object,Object]),C("design:returntype",void 0)],eo.prototype,"play",null),X([Lt({argsMap:n=>[n.getTrackId()]}),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],eo.prototype,"stop",null),X([Lt({argsMap:(n,t)=>[n.getTrackId(),t.name]}),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",Object)],eo.prototype,"pipe",null),X([Lt({argsMap:n=>[n.getTrackId()]}),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],eo.prototype,"unpipe",null);class hs extends OO{get isPlaying(){return this._useAudioElement?cr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,e,i,s){super(t,e,i,s),g(this,"trackMediaType","audio"),g(this,"_source",void 0),g(this,"_useAudioElement",!0),g(this,"_volume",100),g(this,"processorContext",void 0),g(this,"processorDestination",void 0),g(this,"_played",!1),g(this,"_bypassWebAudio",!1),x("DISABLE_WEBAUDIO")?(this._source=new TS,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new ES(t,!0),x("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Xi.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(wc.FIRST_FRAME_DECODED)}),this.processorContext=new af(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new of(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Xi.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Xi.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(Xi.ON_AUDIO_BUFFER),this._source.on(Xi.ON_AUDIO_BUFFER,i=>t(i))}setVolume(t){this._volume=t,this._useAudioElement?cr.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement)throw new J(O.NOT_SUPPORTED,"your browser does not support setting the audio output device");await cr.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return pu(()=>{R.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Ki(this,ft.GET_STATS)||lf({},XA)}play(){R.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(R.debug("[".concat(this.getTrackId(),"] use audio element to play")),cr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){R.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?cr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];R.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&cr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new J(O.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new J(O.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new J(O.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(gi.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(gi.ON_NODE,t=>{this._source.processedNode=t;const e=!t;this._useAudioElement!==e&&(this._played?(this.stop(),this._useAudioElement=e,this.play()):this._useAudioElement=e)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(gi.ON_TRACK),this.processorDestination.removeAllListeners(gi.ON_NODE)}}X([Lt({argsMap:(n,t)=>[n.getTrackId(),t],throttleTime:300}),C("design:type",Function),C("design:paramtypes",[Number]),C("design:returntype",void 0)],hs.prototype,"setVolume",null),X([Lt({argsMap:(n,t)=>[n.getTrackId(),t]}),C("design:type",Function),C("design:paramtypes",[String]),C("design:returntype",W)],hs.prototype,"setPlaybackDevice",null),X([Lt({argsMap:n=>[n.getTrackId()]}),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],hs.prototype,"play",null),X([Lt({argsMap:n=>[n.getTrackId()]}),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],hs.prototype,"stop",null),X([Lt({argsMap:(n,t)=>[n.getTrackId(),t.name]}),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",Object)],hs.prototype,"pipe",null),X([Lt({argsMap:n=>[n.getTrackId()]}),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],hs.prototype,"unpipe",null);function qd(n){let t=n.length;for(;--t>=0;)n[t]=0}const bS=256,NO=286,Tu=30,yu=15,wS=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),uf=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),xH=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),DO=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Lo=new Array(576);qd(Lo);const Ru=new Array(60);qd(Ru);const vu=new Array(512);qd(vu);const Cu=new Array(256);qd(Cu);const AS=new Array(29);qd(AS);const hf=new Array(Tu);function OS(n,t,e,i,s){this.static_tree=n,this.extra_bits=t,this.extra_base=e,this.elems=i,this.max_length=s,this.has_stree=n&&n.length}let PO,kO,LO;function NS(n,t){this.dyn_tree=n,this.max_code=0,this.stat_desc=t}qd(hf);const MO=n=>n<256?vu[n]:vu[256+(n>>>7)],Iu=(n,t)=>{n.pending_buf[n.pending++]=255&t,n.pending_buf[n.pending++]=t>>>8&255},Or=(n,t,e)=>{n.bi_valid>16-e?(n.bi_buf|=t<<n.bi_valid&65535,Iu(n,n.bi_buf),n.bi_buf=t>>16-n.bi_valid,n.bi_valid+=e-16):(n.bi_buf|=t<<n.bi_valid&65535,n.bi_valid+=e)},no=(n,t,e)=>{Or(n,e[2*t],e[2*t+1])},UO=(n,t)=>{let e=0;do e|=1&n,n>>>=1,e<<=1;while(--t>0);return e>>>1},xO=(n,t,e)=>{const i=new Array(16);let s,a,d=0;for(s=1;s<=yu;s++)d=d+e[s-1]<<1,i[s]=d;for(a=0;a<=t;a++){let u=n[2*a+1];u!==0&&(n[2*a]=UO(i[u]++,u))}},VO=n=>{let t;for(t=0;t<NO;t++)n.dyn_ltree[2*t]=0;for(t=0;t<Tu;t++)n.dyn_dtree[2*t]=0;for(t=0;t<19;t++)n.bl_tree[2*t]=0;n.dyn_ltree[512]=1,n.opt_len=n.static_len=0,n.sym_next=n.matches=0},FO=n=>{n.bi_valid>8?Iu(n,n.bi_buf):n.bi_valid>0&&(n.pending_buf[n.pending++]=n.bi_buf),n.bi_buf=0,n.bi_valid=0},BO=(n,t,e,i)=>{const s=2*t,a=2*e;return n[s]<n[a]||n[s]===n[a]&&i[t]<=i[e]},DS=(n,t,e)=>{const i=n.heap[e];let s=e<<1;for(;s<=n.heap_len&&(s<n.heap_len&&BO(t,n.heap[s+1],n.heap[s],n.depth)&&s++,!BO(t,i,n.heap[s],n.depth));)n.heap[e]=n.heap[s],e=s,s<<=1;n.heap[e]=i},jO=(n,t,e)=>{let i,s,a,d,u=0;if(n.sym_next!==0)do i=255&n.pending_buf[n.sym_buf+u++],i+=(255&n.pending_buf[n.sym_buf+u++])<<8,s=n.pending_buf[n.sym_buf+u++],i===0?no(n,s,t):(a=Cu[s],no(n,a+bS+1,t),d=wS[a],d!==0&&(s-=AS[a],Or(n,s,d)),i--,a=MO(i),no(n,a,e),d=uf[a],d!==0&&(i-=hf[a],Or(n,i,d)));while(u<n.sym_next);no(n,256,t)},PS=(n,t)=>{const e=t.dyn_tree,i=t.stat_desc.static_tree,s=t.stat_desc.has_stree,a=t.stat_desc.elems;let d,u,h,p=-1;for(n.heap_len=0,n.heap_max=573,d=0;d<a;d++)e[2*d]!==0?(n.heap[++n.heap_len]=p=d,n.depth[d]=0):e[2*d+1]=0;for(;n.heap_len<2;)h=n.heap[++n.heap_len]=p<2?++p:0,e[2*h]=1,n.depth[h]=0,n.opt_len--,s&&(n.static_len-=i[2*h+1]);for(t.max_code=p,d=n.heap_len>>1;d>=1;d--)DS(n,e,d);h=a;do d=n.heap[1],n.heap[1]=n.heap[n.heap_len--],DS(n,e,1),u=n.heap[1],n.heap[--n.heap_max]=d,n.heap[--n.heap_max]=u,e[2*h]=e[2*d]+e[2*u],n.depth[h]=(n.depth[d]>=n.depth[u]?n.depth[d]:n.depth[u])+1,e[2*d+1]=e[2*u+1]=h,n.heap[1]=h++,DS(n,e,1);while(n.heap_len>=2);n.heap[--n.heap_max]=n.heap[1],((_,m)=>{const S=m.dyn_tree,y=m.max_code,b=m.stat_desc.static_tree,I=m.stat_desc.has_stree,A=m.stat_desc.extra_bits,L=m.stat_desc.extra_base,U=m.stat_desc.max_length;let F,$,z,G,Y,q,ut=0;for(G=0;G<=yu;G++)_.bl_count[G]=0;for(S[2*_.heap[_.heap_max]+1]=0,F=_.heap_max+1;F<573;F++)$=_.heap[F],G=S[2*S[2*$+1]+1]+1,G>U&&(G=U,ut++),S[2*$+1]=G,$>y||(_.bl_count[G]++,Y=0,$>=L&&(Y=A[$-L]),q=S[2*$],_.opt_len+=q*(G+Y),I&&(_.static_len+=q*(b[2*$+1]+Y)));if(ut!==0){do{for(G=U-1;_.bl_count[G]===0;)G--;_.bl_count[G]--,_.bl_count[G+1]+=2,_.bl_count[U]--,ut-=2}while(ut>0);for(G=U;G!==0;G--)for($=_.bl_count[G];$!==0;)z=_.heap[--F],z>y||(S[2*z+1]!==G&&(_.opt_len+=(G-S[2*z+1])*S[2*z],S[2*z+1]=G),$--)}})(n,t),xO(e,p,n.bl_count)},WO=(n,t,e)=>{let i,s,a=-1,d=t[1],u=0,h=7,p=4;for(d===0&&(h=138,p=3),t[2*(e+1)+1]=65535,i=0;i<=e;i++)s=d,d=t[2*(i+1)+1],++u<h&&s===d||(u<p?n.bl_tree[2*s]+=u:s!==0?(s!==a&&n.bl_tree[2*s]++,n.bl_tree[32]++):u<=10?n.bl_tree[34]++:n.bl_tree[36]++,u=0,a=s,d===0?(h=138,p=3):s===d?(h=6,p=3):(h=7,p=4))},GO=(n,t,e)=>{let i,s,a=-1,d=t[1],u=0,h=7,p=4;for(d===0&&(h=138,p=3),i=0;i<=e;i++)if(s=d,d=t[2*(i+1)+1],!(++u<h&&s===d)){if(u<p)do no(n,s,n.bl_tree);while(--u!=0);else s!==0?(s!==a&&(no(n,s,n.bl_tree),u--),no(n,16,n.bl_tree),Or(n,u-3,2)):u<=10?(no(n,17,n.bl_tree),Or(n,u-3,3)):(no(n,18,n.bl_tree),Or(n,u-11,7));u=0,a=s,d===0?(h=138,p=3):s===d?(h=6,p=3):(h=7,p=4)}};let HO=!1;const YO=(n,t,e,i)=>{Or(n,0+(i?1:0),3),FO(n),Iu(n,e),Iu(n,~e),e&&n.pending_buf.set(n.window.subarray(t,t+e),n.pending),n.pending+=e};var VH=n=>{HO||((()=>{let t,e,i,s,a;const d=new Array(16);for(i=0,s=0;s<28;s++)for(AS[s]=i,t=0;t<1<<wS[s];t++)Cu[i++]=s;for(Cu[i-1]=s,a=0,s=0;s<16;s++)for(hf[s]=a,t=0;t<1<<uf[s];t++)vu[a++]=s;for(a>>=7;s<Tu;s++)for(hf[s]=a<<7,t=0;t<1<<uf[s]-7;t++)vu[256+a++]=s;for(e=0;e<=yu;e++)d[e]=0;for(t=0;t<=143;)Lo[2*t+1]=8,t++,d[8]++;for(;t<=255;)Lo[2*t+1]=9,t++,d[9]++;for(;t<=279;)Lo[2*t+1]=7,t++,d[7]++;for(;t<=287;)Lo[2*t+1]=8,t++,d[8]++;for(xO(Lo,287,d),t=0;t<Tu;t++)Ru[2*t+1]=5,Ru[2*t]=UO(t,5);PO=new OS(Lo,wS,257,NO,yu),kO=new OS(Ru,uf,0,Tu,yu),LO=new OS(new Array(0),xH,0,19,7)})(),HO=!0),n.l_desc=new NS(n.dyn_ltree,PO),n.d_desc=new NS(n.dyn_dtree,kO),n.bl_desc=new NS(n.bl_tree,LO),n.bi_buf=0,n.bi_valid=0,VO(n)},FH=(n,t,e,i)=>{let s,a,d=0;n.level>0?(n.strm.data_type===2&&(n.strm.data_type=(u=>{let h,p=4093624447;for(h=0;h<=31;h++,p>>>=1)if(1&p&&u.dyn_ltree[2*h]!==0)return 0;if(u.dyn_ltree[18]!==0||u.dyn_ltree[20]!==0||u.dyn_ltree[26]!==0)return 1;for(h=32;h<bS;h++)if(u.dyn_ltree[2*h]!==0)return 1;return 0})(n)),PS(n,n.l_desc),PS(n,n.d_desc),d=(u=>{let h;for(WO(u,u.dyn_ltree,u.l_desc.max_code),WO(u,u.dyn_dtree,u.d_desc.max_code),PS(u,u.bl_desc),h=18;h>=3&&u.bl_tree[2*DO[h]+1]===0;h--);return u.opt_len+=3*(h+1)+5+5+4,h})(n),s=n.opt_len+3+7>>>3,a=n.static_len+3+7>>>3,a<=s&&(s=a)):s=a=e+5,e+4<=s&&t!==-1?YO(n,t,e,i):n.strategy===4||a===s?(Or(n,2+(i?1:0),3),jO(n,Lo,Ru)):(Or(n,4+(i?1:0),3),((u,h,p,_)=>{let m;for(Or(u,h-257,5),Or(u,p-1,5),Or(u,_-4,4),m=0;m<_;m++)Or(u,u.bl_tree[2*DO[m]+1],3);GO(u,u.dyn_ltree,h-1),GO(u,u.dyn_dtree,p-1)})(n,n.l_desc.max_code+1,n.d_desc.max_code+1,d+1),jO(n,n.dyn_ltree,n.dyn_dtree)),VO(n),i&&FO(n)},BH=(n,t,e)=>(n.pending_buf[n.sym_buf+n.sym_next++]=t,n.pending_buf[n.sym_buf+n.sym_next++]=t>>8,n.pending_buf[n.sym_buf+n.sym_next++]=e,t===0?n.dyn_ltree[2*e]++:(n.matches++,t--,n.dyn_ltree[2*(Cu[e]+bS+1)]++,n.dyn_dtree[2*MO(t)]++),n.sym_next===n.sym_end),jH={_tr_init:VH,_tr_stored_block:YO,_tr_flush_block:FH,_tr_tally:BH,_tr_align:n=>{Or(n,2,3),no(n,256,Lo),(t=>{t.bi_valid===16?(Iu(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(n)}},bu=(n,t,e,i)=>{let s=65535&n|0,a=n>>>16&65535|0,d=0;for(;e!==0;){d=e>2e3?2e3:e,e-=d;do s=s+t[i++]|0,a=a+s|0;while(--d);s%=65521,a%=65521}return s|a<<16|0};const WH=new Uint32Array((()=>{let n,t=[];for(var e=0;e<256;e++){n=e;for(var i=0;i<8;i++)n=1&n?3988292384^n>>>1:n>>>1;t[e]=n}return t})());var Mi=(n,t,e,i)=>{const s=WH,a=i+e;n^=-1;for(let d=i;d<a;d++)n=n>>>8^s[255&(n^t[d])];return-1^n},Nc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},zd={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:GH,_tr_stored_block:kS,_tr_flush_block:HH,_tr_tally:Ra,_tr_align:YH}=jH,{Z_NO_FLUSH:va,Z_PARTIAL_FLUSH:KH,Z_FULL_FLUSH:qH,Z_FINISH:ps,Z_BLOCK:KO,Z_OK:Bi,Z_STREAM_END:qO,Z_STREAM_ERROR:io,Z_DATA_ERROR:zH,Z_BUF_ERROR:LS,Z_DEFAULT_COMPRESSION:JH,Z_FILTERED:XH,Z_HUFFMAN_ONLY:pf,Z_RLE:QH,Z_FIXED:$H,Z_DEFAULT_STRATEGY:ZH,Z_UNKNOWN:t4,Z_DEFLATED:ff}=zd,MS=286,e4=30,n4=19,i4=2*MS+1,r4=15,Dc=258,ro=262,Jd=42,Pc=113,wu=666,kc=(n,t)=>(n.msg=Nc[t],t),zO=n=>2*n-(n>4?9:0),Ca=n=>{let t=n.length;for(;--t>=0;)n[t]=0},s4=n=>{let t,e,i,s=n.w_size;t=n.hash_size,i=t;do e=n.head[--i],n.head[i]=e>=s?e-s:0;while(--t);t=s,i=t;do e=n.prev[--i],n.prev[i]=e>=s?e-s:0;while(--t)};let Ia=(n,t,e)=>(t<<n.hash_shift^e)&n.hash_mask;const Hr=n=>{const t=n.state;let e=t.pending;e>n.avail_out&&(e=n.avail_out),e!==0&&(n.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+e),n.next_out),n.next_out+=e,t.pending_out+=e,n.total_out+=e,n.avail_out-=e,t.pending-=e,t.pending===0&&(t.pending_out=0))},Yr=(n,t)=>{HH(n,n.block_start>=0?n.block_start:-1,n.strstart-n.block_start,t),n.block_start=n.strstart,Hr(n.strm)},cn=(n,t)=>{n.pending_buf[n.pending++]=t},Au=(n,t)=>{n.pending_buf[n.pending++]=t>>>8&255,n.pending_buf[n.pending++]=255&t},US=(n,t,e,i)=>{let s=n.avail_in;return s>i&&(s=i),s===0?0:(n.avail_in-=s,t.set(n.input.subarray(n.next_in,n.next_in+s),e),n.state.wrap===1?n.adler=bu(n.adler,t,s,e):n.state.wrap===2&&(n.adler=Mi(n.adler,t,s,e)),n.next_in+=s,n.total_in+=s,s)},JO=(n,t)=>{let e,i,s=n.max_chain_length,a=n.strstart,d=n.prev_length,u=n.nice_match;const h=n.strstart>n.w_size-ro?n.strstart-(n.w_size-ro):0,p=n.window,_=n.w_mask,m=n.prev,S=n.strstart+Dc;let y=p[a+d-1],b=p[a+d];n.prev_length>=n.good_match&&(s>>=2),u>n.lookahead&&(u=n.lookahead);do if(e=t,p[e+d]===b&&p[e+d-1]===y&&p[e]===p[a]&&p[++e]===p[a+1]){a+=2,e++;do;while(p[++a]===p[++e]&&p[++a]===p[++e]&&p[++a]===p[++e]&&p[++a]===p[++e]&&p[++a]===p[++e]&&p[++a]===p[++e]&&p[++a]===p[++e]&&p[++a]===p[++e]&&a<S);if(i=Dc-(S-a),a=S-Dc,i>d){if(n.match_start=t,d=i,i>=u)break;y=p[a+d-1],b=p[a+d]}}while((t=m[t&_])>h&&--s!=0);return d<=n.lookahead?d:n.lookahead},Xd=n=>{const t=n.w_size;let e,i,s;do{if(i=n.window_size-n.lookahead-n.strstart,n.strstart>=t+(t-ro)&&(n.window.set(n.window.subarray(t,t+t-i),0),n.match_start-=t,n.strstart-=t,n.block_start-=t,n.insert>n.strstart&&(n.insert=n.strstart),s4(n),i+=t),n.strm.avail_in===0)break;if(e=US(n.strm,n.window,n.strstart+n.lookahead,i),n.lookahead+=e,n.lookahead+n.insert>=3)for(s=n.strstart-n.insert,n.ins_h=n.window[s],n.ins_h=Ia(n,n.ins_h,n.window[s+1]);n.insert&&(n.ins_h=Ia(n,n.ins_h,n.window[s+3-1]),n.prev[s&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=s,s++,n.insert--,!(n.lookahead+n.insert<3)););}while(n.lookahead<ro&&n.strm.avail_in!==0)},XO=(n,t)=>{let e,i,s,a=n.pending_buf_size-5>n.w_size?n.w_size:n.pending_buf_size-5,d=0,u=n.strm.avail_in;do{if(e=65535,s=n.bi_valid+42>>3,n.strm.avail_out<s||(s=n.strm.avail_out-s,i=n.strstart-n.block_start,e>i+n.strm.avail_in&&(e=i+n.strm.avail_in),e>s&&(e=s),e<a&&(e===0&&t!==ps||t===va||e!==i+n.strm.avail_in)))break;d=t===ps&&e===i+n.strm.avail_in?1:0,kS(n,0,0,d),n.pending_buf[n.pending-4]=e,n.pending_buf[n.pending-3]=e>>8,n.pending_buf[n.pending-2]=~e,n.pending_buf[n.pending-1]=~e>>8,Hr(n.strm),i&&(i>e&&(i=e),n.strm.output.set(n.window.subarray(n.block_start,n.block_start+i),n.strm.next_out),n.strm.next_out+=i,n.strm.avail_out-=i,n.strm.total_out+=i,n.block_start+=i,e-=i),e&&(US(n.strm,n.strm.output,n.strm.next_out,e),n.strm.next_out+=e,n.strm.avail_out-=e,n.strm.total_out+=e)}while(d===0);return u-=n.strm.avail_in,u&&(u>=n.w_size?(n.matches=2,n.window.set(n.strm.input.subarray(n.strm.next_in-n.w_size,n.strm.next_in),0),n.strstart=n.w_size,n.insert=n.strstart):(n.window_size-n.strstart<=u&&(n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,n.insert>n.strstart&&(n.insert=n.strstart)),n.window.set(n.strm.input.subarray(n.strm.next_in-u,n.strm.next_in),n.strstart),n.strstart+=u,n.insert+=u>n.w_size-n.insert?n.w_size-n.insert:u),n.block_start=n.strstart),n.high_water<n.strstart&&(n.high_water=n.strstart),d?4:t!==va&&t!==ps&&n.strm.avail_in===0&&n.strstart===n.block_start?2:(s=n.window_size-n.strstart,n.strm.avail_in>s&&n.block_start>=n.w_size&&(n.block_start-=n.w_size,n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,s+=n.w_size,n.insert>n.strstart&&(n.insert=n.strstart)),s>n.strm.avail_in&&(s=n.strm.avail_in),s&&(US(n.strm,n.window,n.strstart,s),n.strstart+=s,n.insert+=s>n.w_size-n.insert?n.w_size-n.insert:s),n.high_water<n.strstart&&(n.high_water=n.strstart),s=n.bi_valid+42>>3,s=n.pending_buf_size-s>65535?65535:n.pending_buf_size-s,a=s>n.w_size?n.w_size:s,i=n.strstart-n.block_start,(i>=a||(i||t===ps)&&t!==va&&n.strm.avail_in===0&&i<=s)&&(e=i>s?s:i,d=t===ps&&n.strm.avail_in===0&&e===i?1:0,kS(n,n.block_start,e,d),n.block_start+=e,Hr(n.strm)),d?3:1)},xS=(n,t)=>{let e,i;for(;;){if(n.lookahead<ro){if(Xd(n),n.lookahead<ro&&t===va)return 1;if(n.lookahead===0)break}if(e=0,n.lookahead>=3&&(n.ins_h=Ia(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),e!==0&&n.strstart-e<=n.w_size-ro&&(n.match_length=JO(n,e)),n.match_length>=3)if(i=Ra(n,n.strstart-n.match_start,n.match_length-3),n.lookahead-=n.match_length,n.match_length<=n.max_lazy_match&&n.lookahead>=3){n.match_length--;do n.strstart++,n.ins_h=Ia(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart;while(--n.match_length!=0);n.strstart++}else n.strstart+=n.match_length,n.match_length=0,n.ins_h=n.window[n.strstart],n.ins_h=Ia(n,n.ins_h,n.window[n.strstart+1]);else i=Ra(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++;if(i&&(Yr(n,!1),n.strm.avail_out===0))return 1}return n.insert=n.strstart<2?n.strstart:2,t===ps?(Yr(n,!0),n.strm.avail_out===0?3:4):n.sym_next&&(Yr(n,!1),n.strm.avail_out===0)?1:2},Qd=(n,t)=>{let e,i,s;for(;;){if(n.lookahead<ro){if(Xd(n),n.lookahead<ro&&t===va)return 1;if(n.lookahead===0)break}if(e=0,n.lookahead>=3&&(n.ins_h=Ia(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),n.prev_length=n.match_length,n.prev_match=n.match_start,n.match_length=2,e!==0&&n.prev_length<n.max_lazy_match&&n.strstart-e<=n.w_size-ro&&(n.match_length=JO(n,e),n.match_length<=5&&(n.strategy===XH||n.match_length===3&&n.strstart-n.match_start>4096)&&(n.match_length=2)),n.prev_length>=3&&n.match_length<=n.prev_length){s=n.strstart+n.lookahead-3,i=Ra(n,n.strstart-1-n.prev_match,n.prev_length-3),n.lookahead-=n.prev_length-1,n.prev_length-=2;do++n.strstart<=s&&(n.ins_h=Ia(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart);while(--n.prev_length!=0);if(n.match_available=0,n.match_length=2,n.strstart++,i&&(Yr(n,!1),n.strm.avail_out===0))return 1}else if(n.match_available){if(i=Ra(n,0,n.window[n.strstart-1]),i&&Yr(n,!1),n.strstart++,n.lookahead--,n.strm.avail_out===0)return 1}else n.match_available=1,n.strstart++,n.lookahead--}return n.match_available&&(i=Ra(n,0,n.window[n.strstart-1]),n.match_available=0),n.insert=n.strstart<2?n.strstart:2,t===ps?(Yr(n,!0),n.strm.avail_out===0?3:4):n.sym_next&&(Yr(n,!1),n.strm.avail_out===0)?1:2};function so(n,t,e,i,s){this.good_length=n,this.max_lazy=t,this.nice_length=e,this.max_chain=i,this.func=s}const Ou=[new so(0,0,0,0,XO),new so(4,4,8,4,xS),new so(4,5,16,8,xS),new so(4,6,32,32,xS),new so(4,4,16,16,Qd),new so(8,16,32,32,Qd),new so(8,16,128,128,Qd),new so(8,32,128,256,Qd),new so(32,128,258,1024,Qd),new so(32,258,258,4096,Qd)];function o4(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ff,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*i4),this.dyn_dtree=new Uint16Array(2*(2*e4+1)),this.bl_tree=new Uint16Array(2*(2*n4+1)),Ca(this.dyn_ltree),Ca(this.dyn_dtree),Ca(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(r4+1),this.heap=new Uint16Array(2*MS+1),Ca(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*MS+1),Ca(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Nu=n=>{if(!n)return 1;const t=n.state;return!t||t.strm!==n||t.status!==Jd&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Pc&&t.status!==wu?1:0},QO=n=>{if(Nu(n))return kc(n,io);n.total_in=n.total_out=0,n.data_type=t4;const t=n.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Jd:Pc,n.adler=t.wrap===2?0:1,t.last_flush=-2,GH(t),Bi},$O=n=>{const t=QO(n);var e;return t===Bi&&((e=n.state).window_size=2*e.w_size,Ca(e.head),e.max_lazy_match=Ou[e.level].max_lazy,e.good_match=Ou[e.level].good_length,e.nice_match=Ou[e.level].nice_length,e.max_chain_length=Ou[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),t},ZO=(n,t,e,i,s,a)=>{if(!n)return io;let d=1;if(t===JH&&(t=6),i<0?(d=0,i=-i):i>15&&(d=2,i-=16),s<1||s>9||e!==ff||i<8||i>15||t<0||t>9||a<0||a>$H||i===8&&d!==1)return kc(n,io);i===8&&(i=9);const u=new o4;return n.state=u,u.strm=n,u.status=Jd,u.wrap=d,u.gzhead=null,u.w_bits=i,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=s+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+3-1)/3),u.window=new Uint8Array(2*u.w_size),u.head=new Uint16Array(u.hash_size),u.prev=new Uint16Array(u.w_size),u.lit_bufsize=1<<s+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new Uint8Array(u.pending_buf_size),u.sym_buf=u.lit_bufsize,u.sym_end=3*(u.lit_bufsize-1),u.level=t,u.strategy=a,u.method=e,$O(n)};var a4=(n,t)=>{if(Nu(n)||t>KO||t<0)return n?kc(n,io):io;const e=n.state;if(!n.output||n.avail_in!==0&&!n.input||e.status===wu&&t!==ps)return kc(n,n.avail_out===0?LS:io);const i=e.last_flush;if(e.last_flush=t,e.pending!==0){if(Hr(n),n.avail_out===0)return e.last_flush=-1,Bi}else if(n.avail_in===0&&zO(t)<=zO(i)&&t!==ps)return kc(n,LS);if(e.status===wu&&n.avail_in!==0)return kc(n,LS);if(e.status===Jd&&e.wrap===0&&(e.status=Pc),e.status===Jd){let s=ff+(e.w_bits-8<<4)<<8,a=-1;if(a=e.strategy>=pf||e.level<2?0:e.level<6?1:e.level===6?2:3,s|=a<<6,e.strstart!==0&&(s|=32),s+=31-s%31,Au(e,s),e.strstart!==0&&(Au(e,n.adler>>>16),Au(e,65535&n.adler)),n.adler=1,e.status=Pc,Hr(n),e.pending!==0)return e.last_flush=-1,Bi}if(e.status===57){if(n.adler=0,cn(e,31),cn(e,139),cn(e,8),e.gzhead)cn(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),cn(e,255&e.gzhead.time),cn(e,e.gzhead.time>>8&255),cn(e,e.gzhead.time>>16&255),cn(e,e.gzhead.time>>24&255),cn(e,e.level===9?2:e.strategy>=pf||e.level<2?4:0),cn(e,255&e.gzhead.os),e.gzhead.extra&&e.gzhead.extra.length&&(cn(e,255&e.gzhead.extra.length),cn(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(n.adler=Mi(n.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=69;else if(cn(e,0),cn(e,0),cn(e,0),cn(e,0),cn(e,0),cn(e,e.level===9?2:e.strategy>=pf||e.level<2?4:0),cn(e,3),e.status=Pc,Hr(n),e.pending!==0)return e.last_flush=-1,Bi}if(e.status===69){if(e.gzhead.extra){let s=e.pending,a=(65535&e.gzhead.extra.length)-e.gzindex;for(;e.pending+a>e.pending_buf_size;){let u=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+u),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>s&&(n.adler=Mi(n.adler,e.pending_buf,e.pending-s,s)),e.gzindex+=u,Hr(n),e.pending!==0)return e.last_flush=-1,Bi;s=0,a-=u}let d=new Uint8Array(e.gzhead.extra);e.pending_buf.set(d.subarray(e.gzindex,e.gzindex+a),e.pending),e.pending+=a,e.gzhead.hcrc&&e.pending>s&&(n.adler=Mi(n.adler,e.pending_buf,e.pending-s,s)),e.gzindex=0}e.status=73}if(e.status===73){if(e.gzhead.name){let s,a=e.pending;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>a&&(n.adler=Mi(n.adler,e.pending_buf,e.pending-a,a)),Hr(n),e.pending!==0)return e.last_flush=-1,Bi;a=0}s=e.gzindex<e.gzhead.name.length?255&e.gzhead.name.charCodeAt(e.gzindex++):0,cn(e,s)}while(s!==0);e.gzhead.hcrc&&e.pending>a&&(n.adler=Mi(n.adler,e.pending_buf,e.pending-a,a)),e.gzindex=0}e.status=91}if(e.status===91){if(e.gzhead.comment){let s,a=e.pending;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>a&&(n.adler=Mi(n.adler,e.pending_buf,e.pending-a,a)),Hr(n),e.pending!==0)return e.last_flush=-1,Bi;a=0}s=e.gzindex<e.gzhead.comment.length?255&e.gzhead.comment.charCodeAt(e.gzindex++):0,cn(e,s)}while(s!==0);e.gzhead.hcrc&&e.pending>a&&(n.adler=Mi(n.adler,e.pending_buf,e.pending-a,a))}e.status=103}if(e.status===103){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(Hr(n),e.pending!==0))return e.last_flush=-1,Bi;cn(e,255&n.adler),cn(e,n.adler>>8&255),n.adler=0}if(e.status=Pc,Hr(n),e.pending!==0)return e.last_flush=-1,Bi}if(n.avail_in!==0||e.lookahead!==0||t!==va&&e.status!==wu){let s=e.level===0?XO(e,t):e.strategy===pf?((a,d)=>{let u;for(;;){if(a.lookahead===0&&(Xd(a),a.lookahead===0)){if(d===va)return 1;break}if(a.match_length=0,u=Ra(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,u&&(Yr(a,!1),a.strm.avail_out===0))return 1}return a.insert=0,d===ps?(Yr(a,!0),a.strm.avail_out===0?3:4):a.sym_next&&(Yr(a,!1),a.strm.avail_out===0)?1:2})(e,t):e.strategy===QH?((a,d)=>{let u,h,p,_;const m=a.window;for(;;){if(a.lookahead<=Dc){if(Xd(a),a.lookahead<=Dc&&d===va)return 1;if(a.lookahead===0)break}if(a.match_length=0,a.lookahead>=3&&a.strstart>0&&(p=a.strstart-1,h=m[p],h===m[++p]&&h===m[++p]&&h===m[++p])){_=a.strstart+Dc;do;while(h===m[++p]&&h===m[++p]&&h===m[++p]&&h===m[++p]&&h===m[++p]&&h===m[++p]&&h===m[++p]&&h===m[++p]&&p<_);a.match_length=Dc-(_-p),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=3?(u=Ra(a,1,a.match_length-3),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(u=Ra(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),u&&(Yr(a,!1),a.strm.avail_out===0))return 1}return a.insert=0,d===ps?(Yr(a,!0),a.strm.avail_out===0?3:4):a.sym_next&&(Yr(a,!1),a.strm.avail_out===0)?1:2})(e,t):Ou[e.level].func(e,t);if(s!==3&&s!==4||(e.status=wu),s===1||s===3)return n.avail_out===0&&(e.last_flush=-1),Bi;if(s===2&&(t===KH?YH(e):t!==KO&&(kS(e,0,0,!1),t===qH&&(Ca(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),Hr(n),n.avail_out===0))return e.last_flush=-1,Bi}return t!==ps?Bi:e.wrap<=0?qO:(e.wrap===2?(cn(e,255&n.adler),cn(e,n.adler>>8&255),cn(e,n.adler>>16&255),cn(e,n.adler>>24&255),cn(e,255&n.total_in),cn(e,n.total_in>>8&255),cn(e,n.total_in>>16&255),cn(e,n.total_in>>24&255)):(Au(e,n.adler>>>16),Au(e,65535&n.adler)),Hr(n),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?Bi:qO)},c4=(n,t)=>{let e=t.length;if(Nu(n))return io;const i=n.state,s=i.wrap;if(s===2||s===1&&i.status!==Jd||i.lookahead)return io;if(s===1&&(n.adler=bu(n.adler,t,e,0)),i.wrap=0,e>=i.w_size){s===0&&(Ca(i.head),i.strstart=0,i.block_start=0,i.insert=0);let h=new Uint8Array(i.w_size);h.set(t.subarray(e-i.w_size,e),0),t=h,e=i.w_size}const a=n.avail_in,d=n.next_in,u=n.input;for(n.avail_in=e,n.next_in=0,n.input=t,Xd(i);i.lookahead>=3;){let h=i.strstart,p=i.lookahead-2;do i.ins_h=Ia(i,i.ins_h,i.window[h+3-1]),i.prev[h&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=h,h++;while(--p);i.strstart=h,i.lookahead=2,Xd(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,n.next_in=d,n.input=u,n.avail_in=a,i.wrap=s,Bi},Du={deflateInit:(n,t)=>ZO(n,t,ff,15,8,ZH),deflateInit2:ZO,deflateReset:$O,deflateResetKeep:QO,deflateSetHeader:(n,t)=>Nu(n)||n.state.wrap!==2?io:(n.state.gzhead=t,Bi),deflate:a4,deflateEnd:n=>{if(Nu(n))return io;const t=n.state.status;return n.state=null,t===Pc?kc(n,zH):Bi},deflateSetDictionary:c4,deflateInfo:"pako deflate (from Nodeca project)"};const d4=(n,t)=>Object.prototype.hasOwnProperty.call(n,t);var _f={assign:function(n){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const e=t.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const i in e)d4(e,i)&&(n[i]=e[i])}}return n},flattenChunks:n=>{let t=0;for(let i=0,s=n.length;i<s;i++)t+=n[i].length;const e=new Uint8Array(t);for(let i=0,s=0,a=n.length;i<a;i++){let d=n[i];e.set(d,s),s+=d.length}return e}};let t0=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{t0=!1}const Pu=new Uint8Array(256);for(let n=0;n<256;n++)Pu[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;Pu[254]=Pu[254]=1;var ku={string2buf:n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let t,e,i,s,a,d=n.length,u=0;for(s=0;s<d;s++)e=n.charCodeAt(s),(64512&e)==55296&&s+1<d&&(i=n.charCodeAt(s+1),(64512&i)==56320&&(e=65536+(e-55296<<10)+(i-56320),s++)),u+=e<128?1:e<2048?2:e<65536?3:4;for(t=new Uint8Array(u),a=0,s=0;a<u;s++)e=n.charCodeAt(s),(64512&e)==55296&&s+1<d&&(i=n.charCodeAt(s+1),(64512&i)==56320&&(e=65536+(e-55296<<10)+(i-56320),s++)),e<128?t[a++]=e:e<2048?(t[a++]=192|e>>>6,t[a++]=128|63&e):e<65536?(t[a++]=224|e>>>12,t[a++]=128|e>>>6&63,t[a++]=128|63&e):(t[a++]=240|e>>>18,t[a++]=128|e>>>12&63,t[a++]=128|e>>>6&63,t[a++]=128|63&e);return t},buf2string:(n,t)=>{const e=t||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,t));let i,s;const a=new Array(2*e);for(s=0,i=0;i<e;){let d=n[i++];if(d<128){a[s++]=d;continue}let u=Pu[d];if(u>4)a[s++]=65533,i+=u-1;else{for(d&=u===2?31:u===3?15:7;u>1&&i<e;)d=d<<6|63&n[i++],u--;u>1?a[s++]=65533:d<65536?a[s++]=d:(d-=65536,a[s++]=55296|d>>10&1023,a[s++]=56320|1023&d)}}return((d,u)=>{if(u<65534&&d.subarray&&t0)return String.fromCharCode.apply(null,d.length===u?d:d.subarray(0,u));let h="";for(let p=0;p<u;p++)h+=String.fromCharCode(d[p]);return h})(a,s)},utf8border:(n,t)=>{(t=t||n.length)>n.length&&(t=n.length);let e=t-1;for(;e>=0&&(192&n[e])==128;)e--;return e<0||e===0?t:e+Pu[n[e]]>t?e:t}},e0=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const n0=Object.prototype.toString,{Z_NO_FLUSH:l4,Z_SYNC_FLUSH:u4,Z_FULL_FLUSH:h4,Z_FINISH:p4,Z_OK:mf,Z_STREAM_END:f4,Z_DEFAULT_COMPRESSION:_4,Z_DEFAULT_STRATEGY:m4,Z_DEFLATED:E4}=zd;function Lu(n){this.options=_f.assign({level:_4,method:E4,chunkSize:16384,windowBits:15,memLevel:8,strategy:m4},n||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new e0,this.strm.avail_out=0;let e=Du.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(e!==mf)throw new Error(Nc[e]);if(t.header&&Du.deflateSetHeader(this.strm,t.header),t.dictionary){let i;if(i=typeof t.dictionary=="string"?ku.string2buf(t.dictionary):n0.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,e=Du.deflateSetDictionary(this.strm,i),e!==mf)throw new Error(Nc[e]);this._dict_set=!0}}function VS(n,t){const e=new Lu(t);if(e.push(n,!0),e.err)throw e.msg||Nc[e.err];return e.result}Lu.prototype.push=function(n,t){const e=this.strm,i=this.options.chunkSize;let s,a;if(this.ended)return!1;for(a=t===~~t?t:t===!0?p4:l4,typeof n=="string"?e.input=ku.string2buf(n):n0.call(n)==="[object ArrayBuffer]"?e.input=new Uint8Array(n):e.input=n,e.next_in=0,e.avail_in=e.input.length;;)if(e.avail_out===0&&(e.output=new Uint8Array(i),e.next_out=0,e.avail_out=i),(a===u4||a===h4)&&e.avail_out<=6)this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;else{if(s=Du.deflate(e,a),s===f4)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),s=Du.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===mf;if(e.avail_out!==0){if(a>0&&e.next_out>0)this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;else if(e.avail_in===0)break}else this.onData(e.output)}return!0},Lu.prototype.onData=function(n){this.chunks.push(n)},Lu.prototype.onEnd=function(n){n===mf&&(this.result=_f.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var g4={Deflate:Lu,deflate:VS,deflateRaw:function(n,t){return(t=t||{}).raw=!0,VS(n,t)},gzip:function(n,t){return(t=t||{}).gzip=!0,VS(n,t)},constants:zd};const Ef=16209;var S4=function(n,t){let e,i,s,a,d,u,h,p,_,m,S,y,b,I,A,L,U,F,$,z,G,Y,q,ut;const ct=n.state;e=n.next_in,q=n.input,i=e+(n.avail_in-5),s=n.next_out,ut=n.output,a=s-(t-n.avail_out),d=s+(n.avail_out-257),u=ct.dmax,h=ct.wsize,p=ct.whave,_=ct.wnext,m=ct.window,S=ct.hold,y=ct.bits,b=ct.lencode,I=ct.distcode,A=(1<<ct.lenbits)-1,L=(1<<ct.distbits)-1;t:do{y<15&&(S+=q[e++]<<y,y+=8,S+=q[e++]<<y,y+=8),U=b[S&A];e:for(;;){if(F=U>>>24,S>>>=F,y-=F,F=U>>>16&255,F===0)ut[s++]=65535&U;else{if(!(16&F)){if(!(64&F)){U=b[(65535&U)+(S&(1<<F)-1)];continue e}if(32&F){ct.mode=16191;break t}n.msg="invalid literal/length code",ct.mode=Ef;break t}$=65535&U,F&=15,F&&(y<F&&(S+=q[e++]<<y,y+=8),$+=S&(1<<F)-1,S>>>=F,y-=F),y<15&&(S+=q[e++]<<y,y+=8,S+=q[e++]<<y,y+=8),U=I[S&L];n:for(;;){if(F=U>>>24,S>>>=F,y-=F,F=U>>>16&255,!(16&F)){if(!(64&F)){U=I[(65535&U)+(S&(1<<F)-1)];continue n}n.msg="invalid distance code",ct.mode=Ef;break t}if(z=65535&U,F&=15,y<F&&(S+=q[e++]<<y,y+=8,y<F&&(S+=q[e++]<<y,y+=8)),z+=S&(1<<F)-1,z>u){n.msg="invalid distance too far back",ct.mode=Ef;break t}if(S>>>=F,y-=F,F=s-a,z>F){if(F=z-F,F>p&&ct.sane){n.msg="invalid distance too far back",ct.mode=Ef;break t}if(G=0,Y=m,_===0){if(G+=h-F,F<$){$-=F;do ut[s++]=m[G++];while(--F);G=s-z,Y=ut}}else if(_<F){if(G+=h+_-F,F-=_,F<$){$-=F;do ut[s++]=m[G++];while(--F);if(G=0,_<$){F=_,$-=F;do ut[s++]=m[G++];while(--F);G=s-z,Y=ut}}}else if(G+=_-F,F<$){$-=F;do ut[s++]=m[G++];while(--F);G=s-z,Y=ut}for(;$>2;)ut[s++]=Y[G++],ut[s++]=Y[G++],ut[s++]=Y[G++],$-=3;$&&(ut[s++]=Y[G++],$>1&&(ut[s++]=Y[G++]))}else{G=s-z;do ut[s++]=ut[G++],ut[s++]=ut[G++],ut[s++]=ut[G++],$-=3;while($>2);$&&(ut[s++]=ut[G++],$>1&&(ut[s++]=ut[G++]))}break}}break}}while(e<i&&s<d);$=y>>3,e-=$,y-=$<<3,S&=(1<<y)-1,n.next_in=e,n.next_out=s,n.avail_in=e<i?i-e+5:5-(e-i),n.avail_out=s<d?d-s+257:257-(s-d),ct.hold=S,ct.bits=y};const gf=15,T4=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),y4=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),R4=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),v4=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Mu=(n,t,e,i,s,a,d,u)=>{const h=u.bits;let p,_,m,S,y,b,I=0,A=0,L=0,U=0,F=0,$=0,z=0,G=0,Y=0,q=0,ut=null;const ct=new Uint16Array(16),$t=new Uint16Array(16);let pe,sn,Nn,Ge=null;for(I=0;I<=gf;I++)ct[I]=0;for(A=0;A<i;A++)ct[t[e+A]]++;for(F=h,U=gf;U>=1&&ct[U]===0;U--);if(F>U&&(F=U),U===0)return s[a++]=20971520,s[a++]=20971520,u.bits=1,0;for(L=1;L<U&&ct[L]===0;L++);for(F<L&&(F=L),G=1,I=1;I<=gf;I++)if(G<<=1,G-=ct[I],G<0)return-1;if(G>0&&(n===0||U!==1))return-1;for($t[1]=0,I=1;I<gf;I++)$t[I+1]=$t[I]+ct[I];for(A=0;A<i;A++)t[e+A]!==0&&(d[$t[t[e+A]]++]=A);if(n===0?(ut=Ge=d,b=20):n===1?(ut=T4,Ge=y4,b=257):(ut=R4,Ge=v4,b=0),q=0,A=0,I=L,y=a,$=F,z=0,m=-1,Y=1<<F,S=Y-1,n===1&&Y>852||n===2&&Y>592)return 1;for(;;){pe=I-z,d[A]+1<b?(sn=0,Nn=d[A]):d[A]>=b?(sn=Ge[d[A]-b],Nn=ut[d[A]-b]):(sn=96,Nn=0),p=1<<I-z,_=1<<$,L=_;do _-=p,s[y+(q>>z)+_]=pe<<24|sn<<16|Nn|0;while(_!==0);for(p=1<<I-1;q&p;)p>>=1;if(p!==0?(q&=p-1,q+=p):q=0,A++,--ct[I]==0){if(I===U)break;I=t[e+d[A]]}if(I>F&&(q&S)!==m){for(z===0&&(z=F),y+=L,$=I-z,G=1<<$;$+z<U&&(G-=ct[$+z],!(G<=0));)$++,G<<=1;if(Y+=1<<$,n===1&&Y>852||n===2&&Y>592)return 1;m=q&S,s[m]=F<<24|$<<16|y-a|0}}return q!==0&&(s[y+q]=I-z<<24|64<<16|0),u.bits=F,0};const{Z_FINISH:i0,Z_BLOCK:C4,Z_TREES:Sf,Z_OK:Lc,Z_STREAM_END:I4,Z_NEED_DICT:b4,Z_STREAM_ERROR:fs,Z_DATA_ERROR:r0,Z_MEM_ERROR:s0,Z_BUF_ERROR:w4,Z_DEFLATED:o0}=zd,Tf=16180,yf=16190,Mo=16191,FS=16192,BS=16194,Rf=16199,vf=16200,jS=16206,Qn=16209,a0=n=>(n>>>24&255)+(n>>>8&65280)+((65280&n)<<8)+((255&n)<<24);function A4(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Mc=n=>{if(!n)return 1;const t=n.state;return!t||t.strm!==n||t.mode<Tf||t.mode>16211?1:0},c0=n=>{if(Mc(n))return fs;const t=n.state;return n.total_in=n.total_out=t.total=0,n.msg="",t.wrap&&(n.adler=1&t.wrap),t.mode=Tf,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Lc},d0=n=>{if(Mc(n))return fs;const t=n.state;return t.wsize=0,t.whave=0,t.wnext=0,c0(n)},l0=(n,t)=>{let e;if(Mc(n))return fs;const i=n.state;return t<0?(e=0,t=-t):(e=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?fs:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=e,i.wbits=t,d0(n))},u0=(n,t)=>{if(!n)return fs;const e=new A4;n.state=e,e.strm=n,e.window=null,e.mode=Tf;const i=l0(n,t);return i!==Lc&&(n.state=null),i};let WS,GS,h0=!0;const O4=n=>{if(h0){WS=new Int32Array(512),GS=new Int32Array(32);let t=0;for(;t<144;)n.lens[t++]=8;for(;t<256;)n.lens[t++]=9;for(;t<280;)n.lens[t++]=7;for(;t<288;)n.lens[t++]=8;for(Mu(1,n.lens,0,288,WS,0,n.work,{bits:9}),t=0;t<32;)n.lens[t++]=5;Mu(2,n.lens,0,32,GS,0,n.work,{bits:5}),h0=!1}n.lencode=WS,n.lenbits=9,n.distcode=GS,n.distbits=5},p0=(n,t,e,i)=>{let s;const a=n.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),i>=a.wsize?(a.window.set(t.subarray(e-a.wsize,e),0),a.wnext=0,a.whave=a.wsize):(s=a.wsize-a.wnext,s>i&&(s=i),a.window.set(t.subarray(e-i,e-i+s),a.wnext),(i-=s)?(a.window.set(t.subarray(e-i,e),0),a.wnext=i,a.whave=a.wsize):(a.wnext+=s,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=s))),0};var N4=(n,t)=>{let e,i,s,a,d,u,h,p,_,m,S,y,b,I,A,L,U,F,$,z,G,Y,q=0;const ut=new Uint8Array(4);let ct,$t;const pe=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Mc(n)||!n.output||!n.input&&n.avail_in!==0)return fs;e=n.state,e.mode===Mo&&(e.mode=FS),d=n.next_out,s=n.output,h=n.avail_out,a=n.next_in,i=n.input,u=n.avail_in,p=e.hold,_=e.bits,m=u,S=h,Y=Lc;t:for(;;)switch(e.mode){case Tf:if(e.wrap===0){e.mode=FS;break}for(;_<16;){if(u===0)break t;u--,p+=i[a++]<<_,_+=8}if(2&e.wrap&&p===35615){e.wbits===0&&(e.wbits=15),e.check=0,ut[0]=255&p,ut[1]=p>>>8&255,e.check=Mi(e.check,ut,2,0),p=0,_=0,e.mode=16181;break}if(e.head&&(e.head.done=!1),!(1&e.wrap)||(((255&p)<<8)+(p>>8))%31){n.msg="incorrect header check",e.mode=Qn;break}if((15&p)!==o0){n.msg="unknown compression method",e.mode=Qn;break}if(p>>>=4,_-=4,G=8+(15&p),e.wbits===0&&(e.wbits=G),G>15||G>e.wbits){n.msg="invalid window size",e.mode=Qn;break}e.dmax=1<<e.wbits,e.flags=0,n.adler=e.check=1,e.mode=512&p?16189:Mo,p=0,_=0;break;case 16181:for(;_<16;){if(u===0)break t;u--,p+=i[a++]<<_,_+=8}if(e.flags=p,(255&e.flags)!==o0){n.msg="unknown compression method",e.mode=Qn;break}if(57344&e.flags){n.msg="unknown header flags set",e.mode=Qn;break}e.head&&(e.head.text=p>>8&1),512&e.flags&&4&e.wrap&&(ut[0]=255&p,ut[1]=p>>>8&255,e.check=Mi(e.check,ut,2,0)),p=0,_=0,e.mode=16182;case 16182:for(;_<32;){if(u===0)break t;u--,p+=i[a++]<<_,_+=8}e.head&&(e.head.time=p),512&e.flags&&4&e.wrap&&(ut[0]=255&p,ut[1]=p>>>8&255,ut[2]=p>>>16&255,ut[3]=p>>>24&255,e.check=Mi(e.check,ut,4,0)),p=0,_=0,e.mode=16183;case 16183:for(;_<16;){if(u===0)break t;u--,p+=i[a++]<<_,_+=8}e.head&&(e.head.xflags=255&p,e.head.os=p>>8),512&e.flags&&4&e.wrap&&(ut[0]=255&p,ut[1]=p>>>8&255,e.check=Mi(e.check,ut,2,0)),p=0,_=0,e.mode=16184;case 16184:if(1024&e.flags){for(;_<16;){if(u===0)break t;u--,p+=i[a++]<<_,_+=8}e.length=p,e.head&&(e.head.extra_len=p),512&e.flags&&4&e.wrap&&(ut[0]=255&p,ut[1]=p>>>8&255,e.check=Mi(e.check,ut,2,0)),p=0,_=0}else e.head&&(e.head.extra=null);e.mode=16185;case 16185:if(1024&e.flags&&(y=e.length,y>u&&(y=u),y&&(e.head&&(G=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(i.subarray(a,a+y),G)),512&e.flags&&4&e.wrap&&(e.check=Mi(e.check,i,y,a)),u-=y,a+=y,e.length-=y),e.length))break t;e.length=0,e.mode=16186;case 16186:if(2048&e.flags){if(u===0)break t;y=0;do G=i[a+y++],e.head&&G&&e.length<65536&&(e.head.name+=String.fromCharCode(G));while(G&&y<u);if(512&e.flags&&4&e.wrap&&(e.check=Mi(e.check,i,y,a)),u-=y,a+=y,G)break t}else e.head&&(e.head.name=null);e.length=0,e.mode=16187;case 16187:if(4096&e.flags){if(u===0)break t;y=0;do G=i[a+y++],e.head&&G&&e.length<65536&&(e.head.comment+=String.fromCharCode(G));while(G&&y<u);if(512&e.flags&&4&e.wrap&&(e.check=Mi(e.check,i,y,a)),u-=y,a+=y,G)break t}else e.head&&(e.head.comment=null);e.mode=16188;case 16188:if(512&e.flags){for(;_<16;){if(u===0)break t;u--,p+=i[a++]<<_,_+=8}if(4&e.wrap&&p!==(65535&e.check)){n.msg="header crc mismatch",e.mode=Qn;break}p=0,_=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),n.adler=e.check=0,e.mode=Mo;break;case 16189:for(;_<32;){if(u===0)break t;u--,p+=i[a++]<<_,_+=8}n.adler=e.check=a0(p),p=0,_=0,e.mode=yf;case yf:if(e.havedict===0)return n.next_out=d,n.avail_out=h,n.next_in=a,n.avail_in=u,e.hold=p,e.bits=_,b4;n.adler=e.check=1,e.mode=Mo;case Mo:if(t===C4||t===Sf)break t;case FS:if(e.last){p>>>=7&_,_-=7&_,e.mode=jS;break}for(;_<3;){if(u===0)break t;u--,p+=i[a++]<<_,_+=8}switch(e.last=1&p,p>>>=1,_-=1,3&p){case 0:e.mode=16193;break;case 1:if(O4(e),e.mode=Rf,t===Sf){p>>>=2,_-=2;break t}break;case 2:e.mode=16196;break;case 3:n.msg="invalid block type",e.mode=Qn}p>>>=2,_-=2;break;case 16193:for(p>>>=7&_,_-=7&_;_<32;){if(u===0)break t;u--,p+=i[a++]<<_,_+=8}if((65535&p)!=(p>>>16^65535)){n.msg="invalid stored block lengths",e.mode=Qn;break}if(e.length=65535&p,p=0,_=0,e.mode=BS,t===Sf)break t;case BS:e.mode=16195;case 16195:if(y=e.length,y){if(y>u&&(y=u),y>h&&(y=h),y===0)break t;s.set(i.subarray(a,a+y),d),u-=y,a+=y,h-=y,d+=y,e.length-=y;break}e.mode=Mo;break;case 16196:for(;_<14;){if(u===0)break t;u--,p+=i[a++]<<_,_+=8}if(e.nlen=257+(31&p),p>>>=5,_-=5,e.ndist=1+(31&p),p>>>=5,_-=5,e.ncode=4+(15&p),p>>>=4,_-=4,e.nlen>286||e.ndist>30){n.msg="too many length or distance symbols",e.mode=Qn;break}e.have=0,e.mode=16197;case 16197:for(;e.have<e.ncode;){for(;_<3;){if(u===0)break t;u--,p+=i[a++]<<_,_+=8}e.lens[pe[e.have++]]=7&p,p>>>=3,_-=3}for(;e.have<19;)e.lens[pe[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,ct={bits:e.lenbits},Y=Mu(0,e.lens,0,19,e.lencode,0,e.work,ct),e.lenbits=ct.bits,Y){n.msg="invalid code lengths set",e.mode=Qn;break}e.have=0,e.mode=16198;case 16198:for(;e.have<e.nlen+e.ndist;){for(;q=e.lencode[p&(1<<e.lenbits)-1],A=q>>>24,L=q>>>16&255,U=65535&q,!(A<=_);){if(u===0)break t;u--,p+=i[a++]<<_,_+=8}if(U<16)p>>>=A,_-=A,e.lens[e.have++]=U;else{if(U===16){for($t=A+2;_<$t;){if(u===0)break t;u--,p+=i[a++]<<_,_+=8}if(p>>>=A,_-=A,e.have===0){n.msg="invalid bit length repeat",e.mode=Qn;break}G=e.lens[e.have-1],y=3+(3&p),p>>>=2,_-=2}else if(U===17){for($t=A+3;_<$t;){if(u===0)break t;u--,p+=i[a++]<<_,_+=8}p>>>=A,_-=A,G=0,y=3+(7&p),p>>>=3,_-=3}else{for($t=A+7;_<$t;){if(u===0)break t;u--,p+=i[a++]<<_,_+=8}p>>>=A,_-=A,G=0,y=11+(127&p),p>>>=7,_-=7}if(e.have+y>e.nlen+e.ndist){n.msg="invalid bit length repeat",e.mode=Qn;break}for(;y--;)e.lens[e.have++]=G}}if(e.mode===Qn)break;if(e.lens[256]===0){n.msg="invalid code -- missing end-of-block",e.mode=Qn;break}if(e.lenbits=9,ct={bits:e.lenbits},Y=Mu(1,e.lens,0,e.nlen,e.lencode,0,e.work,ct),e.lenbits=ct.bits,Y){n.msg="invalid literal/lengths set",e.mode=Qn;break}if(e.distbits=6,e.distcode=e.distdyn,ct={bits:e.distbits},Y=Mu(2,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,ct),e.distbits=ct.bits,Y){n.msg="invalid distances set",e.mode=Qn;break}if(e.mode=Rf,t===Sf)break t;case Rf:e.mode=vf;case vf:if(u>=6&&h>=258){n.next_out=d,n.avail_out=h,n.next_in=a,n.avail_in=u,e.hold=p,e.bits=_,S4(n,S),d=n.next_out,s=n.output,h=n.avail_out,a=n.next_in,i=n.input,u=n.avail_in,p=e.hold,_=e.bits,e.mode===Mo&&(e.back=-1);break}for(e.back=0;q=e.lencode[p&(1<<e.lenbits)-1],A=q>>>24,L=q>>>16&255,U=65535&q,!(A<=_);){if(u===0)break t;u--,p+=i[a++]<<_,_+=8}if(L&&!(240&L)){for(F=A,$=L,z=U;q=e.lencode[z+((p&(1<<F+$)-1)>>F)],A=q>>>24,L=q>>>16&255,U=65535&q,!(F+A<=_);){if(u===0)break t;u--,p+=i[a++]<<_,_+=8}p>>>=F,_-=F,e.back+=F}if(p>>>=A,_-=A,e.back+=A,e.length=U,L===0){e.mode=16205;break}if(32&L){e.back=-1,e.mode=Mo;break}if(64&L){n.msg="invalid literal/length code",e.mode=Qn;break}e.extra=15&L,e.mode=16201;case 16201:if(e.extra){for($t=e.extra;_<$t;){if(u===0)break t;u--,p+=i[a++]<<_,_+=8}e.length+=p&(1<<e.extra)-1,p>>>=e.extra,_-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=16202;case 16202:for(;q=e.distcode[p&(1<<e.distbits)-1],A=q>>>24,L=q>>>16&255,U=65535&q,!(A<=_);){if(u===0)break t;u--,p+=i[a++]<<_,_+=8}if(!(240&L)){for(F=A,$=L,z=U;q=e.distcode[z+((p&(1<<F+$)-1)>>F)],A=q>>>24,L=q>>>16&255,U=65535&q,!(F+A<=_);){if(u===0)break t;u--,p+=i[a++]<<_,_+=8}p>>>=F,_-=F,e.back+=F}if(p>>>=A,_-=A,e.back+=A,64&L){n.msg="invalid distance code",e.mode=Qn;break}e.offset=U,e.extra=15&L,e.mode=16203;case 16203:if(e.extra){for($t=e.extra;_<$t;){if(u===0)break t;u--,p+=i[a++]<<_,_+=8}e.offset+=p&(1<<e.extra)-1,p>>>=e.extra,_-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){n.msg="invalid distance too far back",e.mode=Qn;break}e.mode=16204;case 16204:if(h===0)break t;if(y=S-h,e.offset>y){if(y=e.offset-y,y>e.whave&&e.sane){n.msg="invalid distance too far back",e.mode=Qn;break}y>e.wnext?(y-=e.wnext,b=e.wsize-y):b=e.wnext-y,y>e.length&&(y=e.length),I=e.window}else I=s,b=d-e.offset,y=e.length;y>h&&(y=h),h-=y,e.length-=y;do s[d++]=I[b++];while(--y);e.length===0&&(e.mode=vf);break;case 16205:if(h===0)break t;s[d++]=e.length,h--,e.mode=vf;break;case jS:if(e.wrap){for(;_<32;){if(u===0)break t;u--,p|=i[a++]<<_,_+=8}if(S-=h,n.total_out+=S,e.total+=S,4&e.wrap&&S&&(n.adler=e.check=e.flags?Mi(e.check,s,S,d-S):bu(e.check,s,S,d-S)),S=h,4&e.wrap&&(e.flags?p:a0(p))!==e.check){n.msg="incorrect data check",e.mode=Qn;break}p=0,_=0}e.mode=16207;case 16207:if(e.wrap&&e.flags){for(;_<32;){if(u===0)break t;u--,p+=i[a++]<<_,_+=8}if(4&e.wrap&&p!==(4294967295&e.total)){n.msg="incorrect length check",e.mode=Qn;break}p=0,_=0}e.mode=16208;case 16208:Y=I4;break t;case Qn:Y=r0;break t;case 16210:return s0;default:return fs}return n.next_out=d,n.avail_out=h,n.next_in=a,n.avail_in=u,e.hold=p,e.bits=_,(e.wsize||S!==n.avail_out&&e.mode<Qn&&(e.mode<jS||t!==i0))&&p0(n,n.output,n.next_out,S-n.avail_out),m-=n.avail_in,S-=n.avail_out,n.total_in+=m,n.total_out+=S,e.total+=S,4&e.wrap&&S&&(n.adler=e.check=e.flags?Mi(e.check,s,S,n.next_out-S):bu(e.check,s,S,n.next_out-S)),n.data_type=e.bits+(e.last?64:0)+(e.mode===Mo?128:0)+(e.mode===Rf||e.mode===BS?256:0),(m===0&&S===0||t===i0)&&Y===Lc&&(Y=w4),Y},Uo={inflateReset:d0,inflateReset2:l0,inflateResetKeep:c0,inflateInit:n=>u0(n,15),inflateInit2:u0,inflate:N4,inflateEnd:n=>{if(Mc(n))return fs;let t=n.state;return t.window&&(t.window=null),n.state=null,Lc},inflateGetHeader:(n,t)=>{if(Mc(n))return fs;const e=n.state;return 2&e.wrap?(e.head=t,t.done=!1,Lc):fs},inflateSetDictionary:(n,t)=>{const e=t.length;let i,s,a;return Mc(n)?fs:(i=n.state,i.wrap!==0&&i.mode!==yf?fs:i.mode===yf&&(s=1,s=bu(s,t,e,0),s!==i.check)?r0:(a=p0(n,t,e,e),a?(i.mode=16210,s0):(i.havedict=1,Lc)))},inflateInfo:"pako inflate (from Nodeca project)"},D4=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const f0=Object.prototype.toString,{Z_NO_FLUSH:P4,Z_FINISH:k4,Z_OK:Uu,Z_STREAM_END:HS,Z_NEED_DICT:YS,Z_STREAM_ERROR:L4,Z_DATA_ERROR:_0,Z_MEM_ERROR:M4}=zd;function xu(n){this.options=_f.assign({chunkSize:65536,windowBits:15,to:""},n||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||n&&n.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new e0,this.strm.avail_out=0;let e=Uo.inflateInit2(this.strm,t.windowBits);if(e!==Uu)throw new Error(Nc[e]);if(this.header=new D4,Uo.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=ku.string2buf(t.dictionary):f0.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=Uo.inflateSetDictionary(this.strm,t.dictionary),e!==Uu)))throw new Error(Nc[e])}function KS(n,t){const e=new xu(t);if(e.push(n),e.err)throw e.msg||Nc[e.err];return e.result}xu.prototype.push=function(n,t){const e=this.strm,i=this.options.chunkSize,s=this.options.dictionary;let a,d,u;if(this.ended)return!1;for(d=t===~~t?t:t===!0?k4:P4,f0.call(n)==="[object ArrayBuffer]"?e.input=new Uint8Array(n):e.input=n,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(i),e.next_out=0,e.avail_out=i),a=Uo.inflate(e,d),a===YS&&s&&(a=Uo.inflateSetDictionary(e,s),a===Uu?a=Uo.inflate(e,d):a===_0&&(a=YS));e.avail_in>0&&a===HS&&e.state.wrap>0&&n[e.next_in]!==0;)Uo.inflateReset(e),a=Uo.inflate(e,d);switch(a){case L4:case _0:case YS:case M4:return this.onEnd(a),this.ended=!0,!1}if(u=e.avail_out,e.next_out&&(e.avail_out===0||a===HS))if(this.options.to==="string"){let h=ku.utf8border(e.output,e.next_out),p=e.next_out-h,_=ku.buf2string(e.output,h);e.next_out=p,e.avail_out=i-p,p&&e.output.set(e.output.subarray(h,h+p),0),this.onData(_)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(a!==Uu||u!==0){if(a===HS)return a=Uo.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(e.avail_in===0)break}}return!0},xu.prototype.onData=function(n){this.chunks.push(n)},xu.prototype.onEnd=function(n){n===Uu&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=_f.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var U4={Inflate:xu,inflate:KS,inflateRaw:function(n,t){return(t=t||{}).raw=!0,KS(n,t)},ungzip:KS,constants:zd};const{Deflate:HQ,deflate:x4,deflateRaw:YQ,gzip:KQ}=g4,{Inflate:qQ,inflate:V4,inflateRaw:zQ,ungzip:JQ}=U4;var qS,F4=x4,B4=V4;(function(n){n[n.ONE_BYTE=0]="ONE_BYTE",n[n.TWO_BYTE=1]="TWO_BYTE"})(qS||(qS={}));class j4{constructor(){g(this,"_sequence",0),g(this,"_startTime",Date.now()),g(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const e={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const u=new Uint8Array(4);u.set([1,0,0,0]);const h={id:0,length:4,data:u.buffer},p={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[h]};e.commonPacketHeader.extension=1,e.extension=p,e.payload=this.compress(t),e.commonPacketHeader.length=8+(e.extension.length+2)+e.payload.byteLength}else e.commonPacketHeader.length=8+e.payload.byteLength;const i=new ArrayBuffer(e.commonPacketHeader.length),s=new Uint8Array(i),a=new DataView(i);let d=0;if(a.setUint16(d,e.commonPacketHeader.extension<<15|e.commonPacketHeader.reserved<<14|e.commonPacketHeader.length,!0),d+=2,a.setUint32(d,e.commonPacketHeader.sequence,!0),d+=4,a.setUint16(d,e.commonStreamHeader,!0),d+=2,e.extension){const u=this.serializeExtension(e.extension);s.set(new Uint8Array(u),d),d+=u.byteLength}if(s.set(new Uint8Array(e.payload),d),d+=e.payload.byteLength,d!==e.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const e=new DataView(t);let i=0;const s=e.getUint16(i,!0);i+=2;const a=(32768&s)>>15;e.getUint16(i+2,!0),e.getUint16(i,!0);let d,u;if(i+=4,e.getUint16(i,!0),i+=2,a){u=this.deserializeExtension(t.slice(i)),i+=2+u.length,d=t.slice(i);let h=!1;if(u.datas.length>0){const p=u.datas.find(_=>_.id===0);p&&(h=(1&new DataView(p.data).getUint32(0,!0))==1)}d=h?this.decompress(d):d}else d=t.slice(8);return d}serializeExtension(t){const{profile:e,length:i,datas:s}=t,a=new ArrayBuffer(i+2),d=new Uint8Array(a),u=new DataView(a);let h=0;if(u.setUint8(h++,e),u.setUint8(h++,i),s.forEach(p=>{e?(u.setUint8(h++,p.id),u.setUint8(h++,p.length),d.set(new Uint8Array(p.data),h),h+=p.data.byteLength):(u.setUint8(h++,p.id|p.length<<4),d.set(new Uint8Array(p.data),h),h+=p.data.byteLength)}),h!==i+2)throw Error("serialize extension error, is ".concat(h,"!==").concat(i+2));return a}deserializeExtension(t){const e=new DataView(t);let i=0;const s=e.getUint8(i);i++;const a=e.getUint8(i);i++;const d=s===qS.TWO_BYTE,u=[],h=new DataView(t,2);let p=0;for(;p<a;){let _=0,m=0,S=new ArrayBuffer(0);d?(_=h.getUint8(p),p++,m=h.getUint8(p),p++):(_=15&h.getUint8(p),m=h.getUint8(p)>>4,p++),m>0&&(S=h.buffer.slice(p+2,p+2+m),p+=S.byteLength),u.push({id:_,length:m,data:S})}if(p!==a)throw Error("parse error");return{profile:s,length:a,datas:u}}decompress(t){return B4(new Uint8Array(t))}compress(t){return F4(new Uint8Array(t))}}class m0 extends Ye{constructor(t,e){super(),g(this,"_version",1),g(this,"_type",3),g(this,"_config",void 0),g(this,"_originDataChannel",void 0),g(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),g(this,"_dataStreamPacketHandler",void 0),g(this,"_datachannelEventMap",new Map),this._config=t,e&&(this._originDataChannel=e,this._bandDataChannelEvents(e)),this._initPacketHeader(),this._dataStreamPacketHandler=new j4}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return x("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,e;return(t=(e=this._originDataChannel)===null||e===void 0?void 0:e.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,e;return(t=(e=this._originDataChannel)===null||e===void 0?void 0:e.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new W((t,e)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const i=setTimeout(()=>{var s;e(new J(O.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((s=this._originDataChannel)===null||s===void 0?void 0:s.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new J(O.DATACHANNEL_CONNECTION_TIMEOUT)}}else e(new J(O.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[Gd.OPEN,Gd.CLOSE,Gd.ERROR].forEach(e=>{const i=()=>{this.emit(e)};this._datachannelEventMap.set(e,i),t.addEventListener(e,i)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(e=>{let[i,s]=e;t.removeEventListener(i,s)}),this._datachannelEventMap.clear()}}class W4 extends m0{constructor(t){super(t),g(this,"_messageListener",void 0),this._messageListener=e=>{if(e.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const i=e.data.slice(0,this._dataStreamPacketHeader.byteLength);if(new DataView(i).getUint8(3)!==this.id)return;let s=e.data.slice(this._dataStreamPacketHeader.byteLength);s=this._dataStreamPacketHandler.deserialize(s),this.emit(Gd.MESSAGE,s)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class E0 extends m0{send(t){if(this._originDataChannel){let e=t;e=this._dataStreamPacketHandler.serialize(t);const i=new Uint8Array(this._dataStreamPacketHeader.byteLength+e.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(e),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}class G4 extends Ye{constructor(){super(...arguments),g(this,"resultStorage",new Map)}setLocalAudioStats(t,e,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(i,e)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(i,e))}setLocalVideoStats(t,e,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(i,e)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(i,e)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(i))}setRemoteAudioStats(t,e){const i=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(e))}setRemoteVideoStats(t,e){const i=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(e))}record(t,e,i){if(x("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const s=this.resultStorage.get(t);if(s&&(s.result.push(i),s.result.length>=5)){var a;const d=It(a=s.result).call(a,!0);s.isPrevNormal&&!d&&this.emit("exception",g0[t],t,e),!s.isPrevNormal&&d&&this.emit("exception",g0[t]+2e3,t+"_RECOVER",e),s.isPrevNormal=d,s.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,e){return e instanceof vn&&!e.isActive||!!e.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,e){let i=null;e._encoderConfig&&e._encoderConfig.frameRate&&(i=Nr(e._encoderConfig.frameRate));const s=t.captureFrameRate;return!i||!s||!(i>10&&s<5||i<10&&i>=5&&s<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,e){return!!e.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,e){return e instanceof vn&&!e.isActive||!!e.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const g0={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},li=new class{markSubscribeStart(n,t){performance.mark("agora-web-sdk/".concat(n,"/subscribe-").concat(t))}markPublishStart(n,t){performance.mark("agora-web-sdk/".concat(n,"/publish-").concat(t))}measureFromSubscribeStart(n,t){const e=performance.getEntriesByName("agora-web-sdk/".concat(n,"/subscribe-").concat(t));if(e.length>0){const i=e[e.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(n,t){const e=performance.getEntriesByName("agora-web-sdk/".concat(n,"/publish-").concat(t));if(e.length>0){const i=e[e.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function S0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Uc(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?S0(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):S0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class $d{constructor(t){g(this,"store",void 0),g(this,"onStatsException",void 0),g(this,"onUploadPublishDuration",void 0),g(this,"onStatsChanged",void 0),g(this,"localStats",new Map),g(this,"remoteStats",new Map),g(this,"updateStatsInterval",void 0),g(this,"trafficStats",void 0),g(this,"trafficStatsPeerList",[]),g(this,"uplinkStats",void 0),g(this,"exceptionMonitor",void 0),g(this,"p2pChannel",void 0),g(this,"scalabilityMode",$g.L1T1),g(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new G4,this.exceptionMonitor.on("exception",(e,i,s)=>{this.onStatsException&&this.onStatsException(e,i,s)})}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Z.LocalAudioTrack)||Uc({},hS)}getLocalVideoTrackStats(){return this.localStats.get(Z.LocalVideoTrack)||Uc({},pS)}getRemoteAudioTrackStats(t){const e=(a,d)=>{if(!this.trafficStats)return d;const u=this.trafficStats.peer_delay.find(h=>h.peer_uid===a);return u&&(d.publishDuration=u.B_ppad+(Date.now()-this.trafficStats.timestamp)),d},i={};if(t){var s;const a=(s=this.remoteStats.get(t))===null||s===void 0?void 0:s.audioStats;a&&(i[t]=e(t,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[d,{audioStats:u}]=a;u&&(i[d]=e(d,u))});return i}getRemoteNetworkQualityStats(t){const e={};if(t){var i;const s=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.networkStats;s&&(e[t]=s)}else Array.from(this.remoteStats.entries()).forEach(s=>{let[a,{networkStats:d}]=s;d&&(e[a]=d)});return e}getRemoteVideoTrackStats(t){const e=(a,d)=>{if(!this.trafficStats)return d;const u=this.trafficStats.peer_delay.find(h=>h.peer_uid===a);return u&&(d.publishDuration=u.B_ppvd+(Date.now()-this.trafficStats.timestamp)),d},i={};if(t){var s;const a=(s=this.remoteStats.get(t))===null||s===void 0?void 0:s.videoStats;a&&(i[t]=e(t,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[d,{videoStats:u}]=a;u&&(i[d]=e(d,u))});return i}getRTCStats(){let t=0,e=0,i=0,s=0;const a=this.localStats.get(Z.LocalAudioTrack);a&&(t+=a.sendBytes,e+=a.sendBitrate);const d=this.localStats.get(Z.LocalVideoTrack);d&&(t+=d.sendBytes,e+=d.sendBitrate);const u=this.localStats.get(Z.LocalVideoLowTrack);u&&(t+=u.sendBytes,e+=u.sendBitrate),this.remoteStats.forEach(p=>{let{audioStats:_,videoStats:m}=p;_&&(i+=_.receiveBytes,s+=_.receiveBitrate),m&&(i+=m.receiveBytes,s+=m.receiveBitrate)});let h=1;return this.trafficStats&&(h+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:h,SendBitrate:e,SendBytes:t,RecvBytes:i,RecvBitrate:s,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(e=>e.B_ppad!==void 0||e.B_ppvd!==void 0),t.peer_delay.filter(e=>this.trafficStatsPeerList.indexOf(e.peer_uid)===-1).forEach(e=>{var i;const s=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(e.peer_uid),a=s!=null&&s.videoSSRC?li.measureFromSubscribeStart(this.store.clientId,s.videoSSRC):0,d=s!=null&&s.audioSSRC?li.measureFromSubscribeStart(this.store.clientId,s.audioSSRC):0;e.B_ppad!==void 0&&e.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(e.peer_uid,e.B_ppad,e.B_ppvd,a>d?a:d),this.trafficStatsPeerList.push(e.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&R.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,e,i){if(!t)return!1;const s=!!i&&e.framesDecodeFreezeTime>i.framesDecodeFreezeTime,a=!i||e.framesDecodeCount>i.framesDecodeCount;return s||!a}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(e=>{let[i,s]=e;switch(i){case Z.LocalVideoTrack:case Z.LocalVideoLowTrack:{const d=s,u=Uc({},pS),h=t.getStats(),p=t.getLocalMedia(i);if(h){const _=h.videoSend.find(m=>m.ssrc===(p==null?void 0:p.ssrcs[0].ssrcId));if(_){const m=t.getLocalVideoSize(),S=t.getEncoderConfig(Z.LocalVideoTrack);_.codec!=="H264"&&_.codec!=="H265"&&_.codec!=="VP8"&&_.codec!=="VP9"&&_.codec!=="AV1X"&&_.codec!=="AV1"||(u.codecType=_.codec),u.sendBytes=_.bytes,u.sendBitrate=d?8*Math.max(0,u.sendBytes-d.sendBytes):0,_.inputFrame?(u.captureFrameRate=_.inputFrame.frameRate,u.captureResolutionHeight=_.inputFrame.height,u.captureResolutionWidth=_.inputFrame.width):m&&(u.captureResolutionWidth=m.width,u.captureResolutionHeight=m.height),_.sentFrame?(u.sendFrameRate=_.sentFrame.frameRate,u.sendResolutionHeight=_.sentFrame.height,u.sendResolutionWidth=_.sentFrame.width):m&&(u.sendResolutionWidth=m.width,u.sendResolutionHeight=m.height),_.avgEncodeMs&&(u.encodeDelay=_.avgEncodeMs),S&&S.bitrateMax&&(u.targetSendBitrate=1e3*S.bitrateMax),u.sendPackets=_.packets,u.sendPacketsLost=_.packetsLost,u.sendJitterMs=_.jitterMs,u.sendRttMs=_.rttMs,u.totalDuration=d?d.totalDuration+1:1,u.totalFreezeTime=d?d.totalFreezeTime:0,this.isLocalVideoFreeze(_)&&(u.totalFreezeTime+=1),_.scalabilityMode&&this.scalabilityMode!==_.scalabilityMode&&(R.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(_.scalabilityMode)),this.scalabilityMode=_.scalabilityMode)}this.trafficStats&&(u.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var a;this.localStats.set(i,u),((d==null?void 0:d.sendResolutionWidth)!==u.sendResolutionWidth||(d==null?void 0:d.sendResolutionHeight)!==u.sendResolutionHeight)&&((a=this.onStatsChanged)===null||a===void 0||a.call(this,"resolution",{width:u.sendResolutionWidth,height:u.sendResolutionHeight})),u&&p&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,p.track,u);break}case Z.LocalAudioTrack:{const d=s,u=Uc({},hS),h=t.getStats(),p=t.getLocalMedia(i);if(h){const _=h.audioSend.find(m=>m.ssrc===(p==null?void 0:p.ssrcs[0].ssrcId));if(_){if(_.codec!=="opus"&&_.codec!=="aac"&&_.codec!=="PCMU"&&_.codec!=="PCMA"&&_.codec!=="G722"||(u.codecType=_.codec),_.inputLevel)u.sendVolumeLevel=Math.round(32767*_.inputLevel);else{const m=t.getLocalAudioVolume();m&&(u.sendVolumeLevel=Math.round(32767*m))}u.sendBytes=_.bytes,u.sendPackets=_.packets,u.sendPacketsLost=_.packetsLost,u.sendJitterMs=_.jitterMs,u.sendRttMs=_.rttMs,u.sendBitrate=d?8*Math.max(0,u.sendBytes-d.sendBytes):0}}this.trafficStats&&(u.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Z.LocalAudioTrack,u),u&&p&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,p.track,u);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(e=>{let[i,{videoStats:s,audioStats:a,videoPcStats:d}]=e;const u=a,h=s,p=d,_=Uc({},XA),m=Uc({},QA),S=Uc({},wH),{audioTrack:y,videoTrack:b,audioSSRC:I,videoSSRC:A}=t.getRemoteMedia(i),L=t.getStats(),U=L==null?void 0:L.audioRecv.find(z=>z.ssrc===I),F=L==null?void 0:L.videoRecv.find(z=>z.ssrc===A),$=this.trafficStats&&this.trafficStats.peer_delay.find(z=>z.peer_uid===i);if(U&&(U.codec!=="opus"&&U.codec!=="aac"&&U.codec!=="PCMU"&&U.codec!=="PCMA"&&U.codec!=="G722"||(_.codecType=U.codec),U.outputLevel?_.receiveLevel=Math.round(32767*U.outputLevel):y&&(_.receiveLevel=Math.round(32767*y.getVolumeLevel())),_.receiveBytes=U.bytes,_.receivePackets=U.packets,_.receivePacketsLost=U.packetsLost,_.packetLossRate=_.receivePacketsLost/(_.receivePackets+_.receivePacketsLost),_.receiveBitrate=u?8*Math.max(0,_.receiveBytes-u.receiveBytes):0,_.totalDuration=u?u.totalDuration+1:1,_.totalFreezeTime=u?u.totalFreezeTime:0,_.freezeRate=_.totalFreezeTime/_.totalDuration,_.receiveDelay=U.jitterBufferMs,_.totalDuration>10&&$d.isRemoteAudioFreeze(y)&&(_.totalFreezeTime+=1)),F){F.codec!=="H264"&&F.codec!=="H265"&&F.codec!=="VP8"&&F.codec!=="VP9"&&F.codec!=="AV1X"&&F.codec!=="AV1"||(m.codecType=F.codec),m.receiveBytes=F.bytes,m.receiveBitrate=h?8*Math.max(0,m.receiveBytes-h.receiveBytes):0,m.decodeFrameRate=F.decodeFrameRate<0?0:F.decodeFrameRate,m.renderFrameRate=F.decodeFrameRate<0?0:F.decodeFrameRate,F.outputFrame&&(m.renderFrameRate=F.outputFrame.frameRate),F.receivedFrame?(m.receiveFrameRate=F.receivedFrame.frameRate,m.receiveResolutionHeight=F.receivedFrame.height,m.receiveResolutionWidth=F.receivedFrame.width):b&&(m.receiveResolutionHeight=b._videoHeight||0,m.receiveResolutionWidth=b._videoWidth||0),F.framesRateFirefox!==void 0&&(m.receiveFrameRate=Math.round(F.framesRateFirefox)),m.receivePackets=F.packets,m.receivePacketsLost=F.packetsLost,m.packetLossRate=m.receivePacketsLost/(m.receivePackets+m.receivePacketsLost),m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,m.receiveDelay=F.jitterBufferMs||0;const z=!!A&&t.getRemoteVideoIsReady(A);b&&z&&$d.isRemoteVideoFreeze(b,F,p)&&(m.totalFreezeTime+=1),m.freezeRate=m.totalFreezeTime/m.totalDuration}$&&(_.end2EndDelay=$.B_ad,m.end2EndDelay=$.B_vd,_.transportDelay=$.B_ed,m.transportDelay=$.B_ed,_.currentPacketLossRate=$.B_ealr4/100,m.currentPacketLossRate=$.B_evlr4/100,S.uplinkNetworkQuality=$.B_punq?$.B_punq:0,S.downlinkNetworkQuality=$.B_pdnq?$.B_pdnq:0),this.remoteStats.set(i,{audioStats:_,videoStats:m,videoPcStats:F,networkStats:S}),y&&this.exceptionMonitor.setRemoteAudioStats(y,_),b&&this.exceptionMonitor.setRemoteVideoStats(b,m)})}}function T0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Cf(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?T0(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):T0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}function Vu(n){return n.match(/^[\.\:\d]+$/)?"".concat(n.replace(/[^\d]/g,"-"),".").concat(x("TURN_DOMAIN")):(R.info("Cannot recognized as IP address ".concat(n,". Used As Host instead")),n)}function y0(n,t){var e,i;const s=x("GATEWAY_DOMAINS");let a=s[1]&&t.indexOf(s[1])!==-1?1:0;n.addresses=n.addresses||[];const d=n.addresses.map(h=>h.domain_prefix?{address:"".concat(h.domain_prefix,".").concat(s[a++%s.length],":").concat(h.port)}:h.ip.match(/^[\.\:\d]+$/)?{ip:h.ip,port:h.port,address:"".concat(h.ip.replace(/[^\d]/g,"-"),".").concat(s[a++%s.length],":").concat(h.port)}:(R.info("Cannot recognized as IP address ".concat(h.ip,". Used As Host instead")),{ip:h.ip,port:h.port,address:"".concat(h.ip,":").concat(h.port)}));if((e=n.detail)!==null&&e!==void 0&&e[18]&&typeof((i=n.detail)===null||i===void 0?void 0:i[18])=="string"){const h=n.detail[18],p=h==null?void 0:h.split(";");for(let _=0;_<p.length;_++){var u;const m=cS(u=p[_]).call(u);d[_]&&m&&(d[_].ip6=m)}}return{gatewayAddrs:d,uid:n.uid,cid:n.cid,cert:n.cert,vid:n.detail&&n.detail[8],uni_lbs_ip:n.detail&&n.detail[1],res:n,csIp:n.detail&&n.detail[502]}}function Nr(n){return typeof n=="number"?n:n.exact||n.ideal||n.max||n.min||0}function If(n){const t=n._encoderConfig;if(!t)return{};const e={resolution:t.width&&t.height?"".concat(Nr(t.width),"x").concat(Nr(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(e.maxFrameRate=t.frameRate,e.minFrameRate=t.frameRate):t.frameRate&&(e.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,e.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),e}function R0(n){const t={connectionType:0,googRtt:n.rtt};switch(n.selectedCandidatePair.localCandidate.candidateType){case"relay":{const e=n.selectedCandidatePair.localCandidate.relayProtocol;e==="udp"&&(t.connectionType=1),e==="tcp"&&(t.connectionType=3),e==="tls"&&(t.connectionType=4);break}case"srflx":t.connectionType=2}return t}function v0(n){return n>=0&&n<.17?1:n>=.17&&n<.36?2:n>=.36&&n<.59?3:n>=.59&&n<=1?4:n>1?5:0}function zS(n,t){let e,i,s;switch(t){case Jn.CHOOSE_SERVER:i=4096,s="choose server";break;case Jn.CLOUD_PROXY:i=1048576,s="proxy";break;case Jn.CLOUD_PROXY_5:i=4194304,s="proxy5";break;case Jn.CLOUD_PROXY_FALLBACK:i=4194310,s="proxy fallback";break;default:throw new B(O.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:n.detail&&n.detail[502],retry:!1})}if(n.response_body.forEach(a=>{a.buffer&&a.buffer.flag===i&&(e={code:a.buffer.code,addresses:(a.buffer.edges_services||[]).map(d=>Cf(Cf({},d),{},{ticket:a.buffer.cert})),server_ts:n.enter_ts,uid:a.buffer.uid,cid:a.buffer.cid,cname:a.buffer.cname,detail:Cf(Cf({},a.buffer.detail),n.detail),flag:a.buffer.flag,opid:n.opid,cert:a.buffer.cert})}),!e)throw new B(O.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(s," from multi unilbs response"),{csIp:n.detail&&n.detail[502]});return e}async function H4(n,t){return await W.all(n.addresses.map(async e=>({address:Vu(e.ip),tcpport:e.port,udpport:e.port,username:t&&x("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Tr.username,password:t&&x("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await $G(t.toString()):Tr.password})))}function JS(n,t){const e=t._videoHeight||t.getMediaStreamTrack(!0).getSettings().height;return e?Math.max(e/Nr(n.height),1):(R.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function ba(n){let{candidateType:t,relayProtocol:e,type:i,address:s,port:a,protocol:d}=n;return i==="local-candidate"?{candidateType:t,relayProtocol:e,protocol:d}:{candidateType:t,relayProtocol:e,address:s,port:a,protocol:d}}function C0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}class Y4 extends Ye{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var e;It(e=["tryNext","recover"]).call(e,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(un.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(un.CONNECTED):this._state==="closed"?this.emit(un.CLOSED):this._state==="failed"&&this.emit(un.FAILED))}constructor(t,e,i,s){super(),g(this,"connectionID",0),g(this,"currentURLIndex",0),g(this,"reconnectReason",void 0),g(this,"_reconnectMode","tryNext"),g(this,"_name",void 0),g(this,"_state","closed"),g(this,"_retryConfig",void 0),g(this,"_reconnectCount",0),g(this,"_forceCloseTimeout",5e3),g(this,"_onlineReconnectListener",void 0),g(this,"_closeEstablishingTransmitter",()=>{}),g(this,"_store",void 0),g(this,"_joinChannelServiceRecordIndex",void 0),g(this,"_useCompress",void 0),g(this,"_inflateLength",0),g(this,"_deflateLength",0),this._store=s,this._name=t,this._retryConfig=function(a){for(var d=1;d<arguments.length;d++){var u=arguments[d]!=null?arguments[d]:{};d%2?C0(Object(u),!0).forEach(function(h){g(a,h,u[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(u)):C0(Object(u)).forEach(function(h){Object.defineProperty(a,h,Object.getOwnPropertyDescriptor(u,h))})}return a}({},e),this._useCompress=i}resetReconnectCount(t){R.debug("".concat(this._name," reset reconnect count, reason: ").concat(t)),this._reconnectCount=0}close(t,e){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const i=this._transmitter;e?setTimeout(()=>i.close(),500):i.close(),this._transmitter=void 0}this.state=t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(t,e){if(!this._transmitter)return void R.warning("[".concat(this._name,"] can not reconnect, no websocket"));var i;t!==void 0&&(this.reconnectMode=t),R.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((i=this._store)===null||i===void 0||i.recordJoinChannelService({status:"error",errors:[new Error(e)]},this._joinChannelServiceRecordIndex));const s=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),s&&s.bind(this._transmitter)({code:9999,reason:e})}getInflateData(){const t=this._inflateLength,e=this._deflateLength;return this.clearInflateData(),{inflateLength:t,deflateLength:e}}setInflateData(t){this._deflateLength=this._deflateLength+t.originLength,this._inflateLength=this._inflateLength+t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}var Kr;(function(n){n[n.Default=0]="Default",n[n.Ack=1]="Ack"})(Kr||(Kr={}));class K4{constructor(t,e,i){g(this,"version",1),g(this,"initialRTO",void 0),g(this,"maxBatchAckCount",void 0),g(this,"maxRTO",void 0),g(this,"initialRTT",void 0),g(this,"ID",void 0),g(this,"rtt",void 0),g(this,"packetNumber",1),g(this,"rtoRatioMap",new Map),g(this,"timeoutMap",new Map),g(this,"unorderedPacketQueue",[]),g(this,"batchAckPacketQueue",[]),g(this,"lastOrderedPacketNumber",0),g(this,"batchAckTimer",void 0),g(this,"sendImpl",void 0),g(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=e,this.ID=Le(7,"transmitter-"),this.initialRTO=(i==null?void 0:i.initialRTO)!==void 0?i.initialRTO:x("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:x("TRANSMITTER_INITIAL_RTT"),this.rtt=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:x("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(i==null?void 0:i.maxBatchAckCount)!==void 0?i.maxBatchAckCount:x("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(i==null?void 0:i.maxRTO)!==void 0?i.maxRTO:x("TRANSMITTER_MAX_RTO")}packetize(t,e){return{type:Kr.Default,version:this.version,packetNumber:e,payload:t}}serialize(t){switch(t.type){case Kr.Default:{let e;typeof t.payload=="string"?e=new TextEncoder().encode(t.payload):e=t.payload;const i=new ArrayBuffer(e.length+15),s=new DataView(i);return s.setUint16(0,t.version),s.setUint8(2,t.type),s.setUint32(3,t.packetNumber),uw(s,7,BigInt(t.sendTs)),new Uint8Array(s.buffer).set(e,15),i}case Kr.Ack:{const e=new ArrayBuffer(16),i=new DataView(e);return i.setUint16(0,t.version),i.setUint8(2,t.type),i.setUint32(3,t.maxAckPacketNumber),i.setUint8(7,t.shift),uw(i,8,BigInt(t.ackSendTs)),e}}}deserialize(t){const e=new DataView(t),i=e.getUint16(0),s=e.getUint8(2);switch(s){case Kr.Default:{const a=e.getUint32(3),d=lw(e,7),u=t.slice(15),h=new TextDecoder().decode(u);return{version:i,type:s,packetNumber:a,sendTs:Number(d),payload:h}}case Kr.Ack:{const a=e.getUint32(3),d=e.getUint8(7),u=lw(e,8);return{version:i,type:s,maxAckPacketNumber:a,shift:d,ackSendTs:Number(u)}}default:throw R.error("[".concat(this.ID,"] Unrecognized packet type ").concat(s)),new Error("Unrecognized packet type ".concat(s))}}sendMessage(t){const e=this.packetize(t,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const i=this.calculateRTO(e),s=window.setTimeout(()=>{this.resendMessage(e)},i);this.timeoutMap.set(e.packetNumber,s),this.sendPacket(e)}onData(t){const e=this.deserialize(t);e.type===Kr.Default?this.ack(e):e.type===Kr.Ack&&(this.updateRTT(e,Math.round(performance.now())),this.clearRTO(e))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(t=>{let[e,i]=t;window.clearTimeout(i)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(t){const e=this.calculateRTO(t),i=window.setTimeout(()=>{this.resendMessage(t)},e);this.timeoutMap.set(t.packetNumber,i),this.sendPacket(t)}calculateRTO(t){const e=this.rtoRatioMap.get(t.packetNumber);if(e===void 0)return this.rtoRatioMap.set(t.packetNumber,1),this.initialRTO;{const i=9*this.rtt/8*e;return this.rtoRatioMap.set(t.packetNumber,e+1),i>this.maxRTO?this.maxRTO:i}}updateRTT(t,e){const i=t.ackSendTs;this.rtt=this.rtt*(7/8)+(e-i-this.rtt)/8}ack(t){if(t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(t):(this.batchAckPacketQueue.push(t),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(t.payload);;){const e=this.unorderedPacketQueue[0];if(!e){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(e.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(t.packetNumber<=this.lastOrderedPacketNumber){const e={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Kr.Ack,version:this.version};this.sendPacket(e)}else if(t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[t.packetNumber-this.lastOrderedPacketNumber-2]=t;const e={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Kr.Ack,version:this.version};this.sendPacket(e)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Kr.Ack,version:this.version};this.sendPacket(t),this.batchAckPacketQueue=[]}sendPacket(t){t.type===Kr.Default&&(t.sendTs=Math.round(performance.now()));const e=this.serialize(t);this.sendImpl(e)}clearRTO(t){for(let e=t.maxAckPacketNumber-t.shift;e<=t.maxAckPacketNumber;e++){const i=this.timeoutMap.get(e);i!==void 0&&window.clearTimeout(i),this.timeoutMap.delete(e),this.rtoRatioMap.delete(e)}}}class I0 extends Y4{constructor(t,e){super(t,e,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),g(this,"_initMutex",void 0),g(this,"_reconnectInterrupter",void 0),g(this,"_url",void 0),g(this,"_transmitter",void 0),g(this,"_addresses",void 0),g(this,"_reliableTransmission",void 0),this._initMutex=new zn("datachannel");const{timeout:i,timeoutFactor:s}=e,a=Math.max(300,Math.floor(3*i/5)),d=Math.max(1.2,Math.floor(8*s)/10);Ai.ONLINE&&(this._retryConfig.timeout=a,this._retryConfig.timeoutFactor=d),Tn.on(No.NETWORK_STATE_CHANGE,(u,h)=>{u!==h&&(this.resetReconnectCount("network state change: ".concat(h," -> ").concat(u)),u===Ai.ONLINE?(this._retryConfig.timeout=a,this._retryConfig.timeoutFactor=d):(this._retryConfig.timeout=i,this._retryConfig.timeoutFactor=s))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=e;const i=(s,a)=>{this._addresses=t,this.currentURLIndex=this._addresses.findIndex(u=>u.fingerprint||x("FINGERPRINT"));const d=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(d).then(s).catch(a),this.once(un.CLOSED,()=>a(new B(O.WS_DISCONNECT))),this.once(un.CONNECTED,()=>s())};return this._initMutex.lock().then(s=>new W((a,d)=>{i(a,d)}).then(()=>{s()}).catch(()=>{s()}))}sendMessage(t){let e=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new B(O.WS_ABORT,"datachannel is not ready");try{e||(t=JSON.stringify(t)),this._reliableTransmission.sendMessage(t)}catch(i){throw new B(O.WS_ERR,"send datachannel signal message error"+i.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(t){const e=JSON.stringify(t);return{compressed:e,compressedLength:e.length,origin:t}}sendMessageWithUint8Array(t){return{compressed:t,compressedLength:t.byteLength,origin:t}}createTransmitterConnection(t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(t.ip,":").concat(t.port),new W((e,i)=>{var s;const a=()=>{R.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),e()},d=async _=>{var m;if((m=this._closeEstablishingTransmitter)===null||m===void 0||m.call(this),R.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(_.code,", reason: ").concat(_.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=_.reason,this.state="reconnecting");const S=Ki(this,un.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,y=await this.reconnectWithAction(S);if(this.state==="closed")return void R.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!y)return i(new B(O.WS_DISCONNECT,"datachannel reconnect failed: ".concat(_.code))),void this.close(!0);e()}else i(new B(O.WS_DISCONNECT,"datachannel close: ".concat(_.code))),this.close()},u=_=>{var m;(m=this._reliableTransmission)===null||m===void 0||m.onData(_.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),R.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(t)));const h=(s=this._store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),p=Date.now();tn(this,un.TO_CONNECT_DATACHANNEL,t).then(_=>{var m,S;if(!_)throw new Error("transmissonInfo not exist yet");const{transmitter:y,close:b}=_;this._transmitter=y,(m=this._store)===null||m===void 0||m.signalChannelOpen();const I=Date.now()-p;R.debug("[choose dc] dc open cost ".concat(I,"ms")),this._reliableTransmission=new K4(A=>{var L;this._transmitter&&this._transmitter.readyState==="open"&&((L=this._transmitter)===null||L===void 0||L.send(A))},A=>{typeof A=="string"&&this.emit(un.ON_MESSAGE,A)}),this._closeEstablishingTransmitter=()=>{var A;(A=this._reliableTransmission)===null||A===void 0||A.close(),this._reliableTransmission=void 0,b()},a&&a(),y.onclose=d,y.onmessage=u,(S=this._store)===null||S===void 0||S.recordJoinChannelService({endTs:Date.now(),status:"success"},h),this._joinChannelServiceRecordIndex=h}).catch(_=>{var m;if((m=this._store)===null||m===void 0||m.recordJoinChannelService({endTs:Date.now(),status:_ instanceof B&&_.code===O.WS_ABORT?"aborted":"error",errors:[_]},h),this.state!=="closed"){if(_ instanceof B&&_.code===O.WS_ERR){const S=new B(O.WS_ERR,"init datachannel failed! Error: ".concat(_.toString()));return R.error("[".concat(this._name,"]").concat(S)),void i(S)}d&&d(_)}else i(new B(O.WS_DISCONNECT,"datachannel is closed: ".concat(_.toString())))})})}async reconnectWithAction(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||Tn.networkState!==Ai.OFFLINE||(this._onlineReconnectListener=Tn.onlineWaiter&&Tn.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let i=!0;if(this._reconnectInterrupter=()=>{i=!1},e){const u=Up(this._reconnectCount,this._retryConfig);R.debug("[".concat(this._name,"] wait ").concat(u,"ms to reconnect datachannel, mode: ").concat(t)),await W.race([si(u),this._onlineReconnectListener||new W(()=>{})])}if(this.state==="closed"||!i)return!1;this._reconnectCount+=1;const s=async(u,h)=>{this.emit(un.RECONNECT_CREATE_CONNECTION,h),await this.createTransmitterConnection(u)};try{if(t==="retry"){const u=this._addresses[this.currentURLIndex];this.emit(un.RECONNECT_WAITTING_FINISH,t),await s(u,t)}else if(t==="tryNext"){this.currentURLIndex+=1;for(let h=this.currentURLIndex;h<this._addresses.length;h++){if(this._addresses[h].fingerprint||x("FINGERPRINT")){this.currentURLIndex=h;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return R.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);R.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const u=this._addresses[this.currentURLIndex];this.emit(un.RECONNECT_WAITTING_FINISH,t),await s(u,t)}else t==="recover"&&(R.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(un.RECONNECT_WAITTING_FINISH,t),this.emit(un.FAILBACK));return!0}catch(u){var a,d;return R.error("[".concat(this._name,"] reconnect failed"),u.toString()),u!=null&&(a=u.data)!==null&&a!==void 0&&a.desc&&Array.isArray(u.data.desc)&&u.data.desc.length&&It(d=u.data.desc).call(d,"dynamic key expired")?(this.emit(un.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,e)}}}class xo extends Ye{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===ie.CONNECTED?this.emit(ht.WS_CONNECTED):t===ie.RECONNECTING?this.emit(ht.WS_RECONNECTING,this._websocketReconnectReason):t===ie.CLOSED&&this.emit(ht.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(t,e){super(),g(this,"_disconnectedReason",void 0),g(this,"_websocketReconnectReason",void 0),g(this,"_connectionState",ie.CLOSED),g(this,"reconnectToken",void 0),g(this,"websocket",void 0),g(this,"openConnectionTime",void 0),g(this,"clientId",void 0),g(this,"lastMsgTime",Date.now()),g(this,"uploadCache",[]),g(this,"uploadCacheInterval",void 0),g(this,"rttRolling",new Ng(5)),g(this,"pingpongTimer",void 0),g(this,"inflateDataTimer",void 0),g(this,"pingpongTimeoutCount",0),g(this,"joinResponse",void 0),g(this,"multiIpOption",void 0),g(this,"initError",void 0),g(this,"spec",void 0),g(this,"store",void 0),g(this,"onWebsocketMessage",i=>{if(i instanceof ArrayBuffer)return void this.emit(ht.ON_BINARY_DATA,i);const s=JSON.parse(i);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){const a="res-@".concat(s._id);this.emit(a,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")&&(this.emit(s._type,s._message),s._type===Kt.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===Kt.ON_USER_BANNED))switch(s._message.error_code){case 14:this.close(oe.UID_BANNED);break;case 15:this.close(oe.IP_BANNED);break;case 16:this.close(oe.CHANNEL_BANNED)}}),this.clientId=t.clientId,this.spec=t,this.store=e,this.websocket=new I0("gateway-".concat(this.clientId),this.spec.retryConfig,!0,e),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===ie.CONNECTED&&this.reconnect("retry",$s.OFFLINE)})}async request(t,e,i,s){const a=Le(6,""),d={_id:a,_type:t,_message:e},u=this.websocket.connectionID,h=()=>new W((b,I)=>{if(this.connectionState===ie.CONNECTED)return b();const A=()=>{this.off(ht.WS_CLOSED,L),b()},L=()=>{this.off(ht.WS_CONNECTED,A),I(new B(O.WS_ABORT))};this.once(ht.WS_CONNECTED,A),this.once(ht.WS_CLOSED,L),t!==yt.PUBLISH&&t!==yt.SUBSCRIBE&&t!==yt.UNSUBSCRIBE&&t!==yt.UNPUBLISH&&t!==yt.CONTROL&&t!==yt.RESTART_ICE||this.once(ht.DISCONNECT_P2P,()=>{I(new B(O.DISCONNECT_P2P))}),t!==yt.PUBLISH&&t!==yt.RESTART_ICE||this.once(ht.ABORT_P2P_EXECUTION,()=>{I(new B(O.DISCONNECT_P2P))})});if(this.connectionState!==ie.CONNECTING&&this.connectionState!==ie.RECONNECTING||t===yt.JOIN||t===yt.REJOIN||await h(),t===yt.LEAVE&&(this.websocket.unbindDcCloseEventListener(),s=!0),this.websocket.sendMessage(d,!0,!1),s)return;const p=new W((b,I)=>{let A=!1;const L=(F,$)=>{A=!0,b({isSuccess:F==="success",message:$||{}}),this.off(ht.WS_CLOSED,U),this.off(ht.WS_RECONNECTING,U),this.emit(ht.REQUEST_SUCCESS,t,e)};this.once("res-@".concat(a),L);const U=()=>{I(new B(O.WS_ABORT,"type: ".concat(t))),this.off(ht.WS_CLOSED,U),this.off(ht.WS_RECONNECTING,U),this.off("res-@".concat(a),L)};this.once(ht.WS_CLOSED,U),this.once(ht.WS_RECONNECTING,U),si(x("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||A||(R.warning("dc request timeout, type: ".concat(t)),this.emit(ht.REQUEST_TIMEOUT,t,e))})});let _=null;try{_=await p}catch(b){if(this.connectionState===ie.CLOSED||t===yt.LEAVE)throw new B(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?b.throw():t===yt.JOIN||t===yt.REJOIN?null:(await h(),await this.request(t,e))}if(_.isSuccess)return _.message;const m=Number(_.message.error_code||_.message.code),S=bc(m),y=new B(O.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(_.message.error_str),{code:m,data:_.message});return S.action==="success"?_.message:(R.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(m,", message: ").concat(S.desc,", action: ").concat(S.action)),m===Dt.ERR_TOO_MANY_BROADCASTERS?((t===yt.JOIN||t===yt.REJOIN)&&(this.initError=y,this.close()),y.throw()):S.action==="failed"?y.throw():S.action==="quit"?(this.initError=y,this.close(),y.throw()):(m===Dt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",$s.MULTI_IP)):this.reconnect(S.action,$s.SERVER_ERROR),t===yt.JOIN||t===yt.REJOIN?null:await this.request(t,e)))}waitMessage(t,e){return new W(i=>{const s=a=>{(!e||e(a))&&(this.off(t,s),i(a))};this.on(t,s)})}upload(t,e){const i={_type:t,_message:e};try{this.websocket.sendMessage(i)}catch{const a=x("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==ie.CONNECTED)return;const d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},x("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,e){const i={_type:t,_message:e};this.websocket.sendMessage(i)}init(t,e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new W((i,s)=>{this.once(ht.WS_CONNECTED,()=>i(this.joinResponse)),this.once(ht.WS_CLOSED,()=>s(this.initError||new B(O.WS_ABORT))),this.connectionState=ie.CONNECTING,this.websocket.init(t).catch(s),this.websocket.once(un.FAILBACK,()=>{this.openConnectionTime===void 0&&s(new B(O.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{e&&this.openConnectionTime===void 0&&(R.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),s(new B(O.INIT_DATACHANNEL_TIMEOUT)))},x("DC_JOIN_WITH_FAILBACK"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||oe.LEAVE,this.connectionState=ie.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),t===oe.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new I0("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(ht.ABORT_P2P_EXECUTION);const t=await tn(this,ht.DATACHANNEL_CONNECTING),e=await this.request(yt.JOIN,t);if(!e)return this.emit(ht.REPORT_JOIN_GATEWAY,O.TIMEOUT,this.url||""),!1;this.joinResponse=e,this.emit(ht.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=ie.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new B(O.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=Do(this,ht.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const e=await this.request(yt.REJOIN,t);return!!e&&(this.connectionState=ie.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),e.peers&&e.peers.forEach(i=>{this.emit(Kt.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(Kt.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(Kt.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(Kt.MUTE_AUDIO,{uid:i.uid}):this.emit(Kt.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(Kt.MUTE_VIDEO,{uid:i.uid}):this.emit(Kt.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(Kt.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(Kt.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(Kt.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(Kt.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(Kt.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,e)}handleNotification(t){R.debug("[".concat(this.clientId,"] receive notification: "),t);const e=bc(t.code);if(e.action!=="success"){if(e.action!=="failed")return e.action==="quit"?(e.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(oe.UID_BANNED),void this.close()):void this.reconnect(e.action,$s.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),e.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=x("PING_PONG_TIME_OUT"),e=Date.now();this.pingpongTimeoutCount>=t&&(R.warning("PINGPONG Timeout. Last Socket Message: ".concat(e-this.lastMsgTime,"ms")),e-this.lastMsgTime>x("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",$s.TIMEOUT):this.request(yt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-e;this.rttRolling.add(i),x("REPORT_STATS")&&this.send(yt.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleInflateData(){const{inflateLength:t,deflateLength:e}=this.websocket.getInflateData();t!==0&&e!==0&&this.upload(Ji.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:e,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(un.RECONNECT_WAITTING_FINISH,t=>{this.emit(ht.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(un.RECONNECT_CREATE_CONNECTION,t=>{this.emit(ht.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(un.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(un.CLOSED,()=>{this.connectionState=ie.CLOSED}),this.websocket.on(un.FAILED,()=>{this._disconnectedReason=oe.NETWORK_ERROR,this.connectionState=ie.CLOSED}),this.websocket.on(un.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===ie.CONNECTED?this.connectionState=ie.RECONNECTING:this.connectionState=ie.CONNECTING}),this.websocket.on(un.WILL_RECONNECT,(t,e)=>{if(Do(this,ht.IS_P2P_DISCONNECTED)&&t==="retry")return R.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(ht.NEED_RENEW_SESSION),this.emit(ht.DISCONNECT_P2P),e("tryNext");t!=="retry"&&(R.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(ht.NEED_RENEW_SESSION),this.emit(ht.DISCONNECT_P2P)),e(t)}),this.websocket.on(un.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{R.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",$s.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(ht.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof B&&t.code===O.UNEXPECTED_RESPONSE&&t.data.code===Dt.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",$s.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",$s.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(un.REQUEST_NEW_URLS,(t,e)=>{tn(this,ht.REQUEST_RECOVER,this.multiIpOption).then(t).catch(e)}),this.websocket.on(un.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Kt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(un.TO_CONNECT_DATACHANNEL,async(t,e,i)=>tn(this,ht.DATACHANNEL_PRECONNECT,t).then(e).catch(i)),this.websocket.on(un.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(ht.DATACHANNEL_FAILBACK)})}}class bf extends Ye{constructor(t){super(),g(this,"_signal",void 0),g(this,"_sequence",0),g(this,"_userMap",new Map),g(this,"_encoder",new TextEncoder),this._signal=t}async send(t,e,i,s,a){var d,u,h;typeof e!="string"&&(e=JSON.stringify(e)),s=(d=s)!==null&&d!==void 0?d:Le(6,""),a=(u=a)!==null&&u!==void 0?u:this._sequence++;const p={_id:s,_type:t,_seq:(h=a)!==null&&h!==void 0?h:this._sequence++,_message:e};if(x("SHOW_P2P_LOG")&&R.debug("send message",p),this.sendStreamMessage(JSON.stringify(p)),i)return;const _=new W((S,y)=>{const b=window.setTimeout(()=>{this.off("res-@".concat(s),I),R.warning("[external-signal] request timeout, type: ".concat(t)),this._userMap.size===0?y(new J(O.INVALID_REMOTE_USER)):y(new J(O.TIMEOUT))},x("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),I=(A,L)=>{b&&window.clearTimeout(b),A==="success"?S({isSuccess:!0,message:L}):y(new J(O.UNEXPECTED_ERROR,L))};this.once("res-@".concat(s),I)});let m;try{m=await _}catch(S){if(S.code===O.TIMEOUT)return await this.send(t,e,!1,s,a);throw S}return m.isSuccess?m.message:void 0}sendStreamMessage(t){this._splitMessage(t).forEach(e=>{this._signal.request(yt.DATA_STREAM,{payload:kp(this._encoder.encode(e))})})}onMessage(t){const{_uid:e}=t;let i;const s=this._userMap.get(e);if(s?i=s.splitMessageMap:(i=new Map,this._userMap.set(e,{isStart:!1,splitMessageMap:i,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map})),"id"in t&&"total"in t){var a;const{id:d,total:u}=t,h=(a=i.get(d))!==null&&a!==void 0?a:[];if(h.push(t),i.has(d)||i.set(d,h),h.length!==u)return;{const p=eu(h).call(h,(_,m)=>_.index-m.index).map(_=>_.payload).join("");i.delete(d),(t=JSON.parse(p))._uid=e}}this.handleReceivedMessage(t)}setStart(t){this._userMap.has(t)?this._userMap.get(t).isStart=!0:this._userMap.set(t,{isStart:!0,splitMessageMap:new Map,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map}),this.handleReceivedMessage()}setEnd(t){return this._userMap.delete(t),this._userMap.size===0}ack(t,e,i){this.send(Ve.ACK,JSON.stringify({success:!i,message:e}),!0,t)}handleReceivedMessage(t){const e=()=>{this._userMap.forEach(p=>{const{receivedMessagesMap:_,nextExpectedSequenceNumber:m}=p;for(;_.has(m);){const S=_.get(m);_.delete(m),this.receiveMessage(S),p.nextExpectedSequenceNumber++}})};if(!t)return void e();const{_uid:i,_seq:s}=t,a=this._userMap.get(i),{receivedMessagesMap:d,isStart:u,nextExpectedSequenceNumber:h}=a;s<h?R.debug("[external-signal] receive old message, seq: ".concat(s)):(d.set(s,t),u&&s===h&&(this.receiveMessage(t),d.delete(h),a.nextExpectedSequenceNumber++,e()))}receiveMessage(t){const{_id:e,_type:i,_message:s,_uid:a}=t;if(x("SHOW_P2P_LOG")&&R.debug("收到消息",t),e)switch(t._type){case Ve.PUBLISH:const d=JSON.parse(s);this._signal.emit(i,d,a),this.ack(t._id);break;case Ve.CONTROL:case Ve.UNPUBLISH:case Ve.DO_SUBSCRIBE:case Ve.DO_UNSUBSCRIBE:{const u=JSON.parse(s);u.uid=a,tn(this._signal,i,u).then(h=>{this.ack(t._id,h)}).catch(h=>{this.ack(t._id,void 0,!0)});break}case Ve.ACK:{const{success:u,message:h}=JSON.parse(s);this.emit("res-@".concat(e),u?"success":"failed",h);break}case Ve.CALL:tn(this,i,s).then(u=>{this.ack(e,u)});break;case Ve.RESTART_ICE:case Ve.EXCHANGE_SDP:case Ve.SUBSCRIBE:case Ve.UNSUBSCRIBE:tn(this._signal,i,s).then(u=>{this.ack(e,u)}).catch(u=>{this.ack(t._id,void 0,!0)});break;case Ve.CANDIDATE:this._signal.emit(i,s),this.ack(e);break;case Ve.JOIN:this.emit(i,JSON.parse(s));break;default:this.emit(i,s),this.ack(e)}}_splitMessage(t){if(t.length<bf.MAX_MESSAGE_SIZE)return[t];const e=[],i=Le(6,"");let s=0;const a=Math.ceil(t.length/800);for(;t.length>0;){s++;const d=t.slice(0,800);e.push({id:i,index:s,total:a,payload:d}),t=t.slice(800)}return e.map(d=>JSON.stringify(d))}clear(){this._sequence=0,this._userMap.clear()}}g(bf,"MAX_MESSAGE_SIZE",1024);class b0 extends Ye{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===ie.CONNECTED?this.emit(ht.WS_CONNECTED):t===ie.RECONNECTING?this.emit(ht.WS_RECONNECTING,this._websocketReconnectReason):t===ie.CLOSED&&this.emit(ht.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,e){super(),g(this,"_disconnectedReason",void 0),g(this,"_websocketReconnectReason",void 0),g(this,"_connectionState",ie.CLOSED),g(this,"reconnectToken",void 0),g(this,"_userInRoom",!1),g(this,"_userOnlineTime",void 0),g(this,"websocket",void 0),g(this,"openConnectionTime",void 0),g(this,"clientId",void 0),g(this,"lastMsgTime",Date.now()),g(this,"uploadCache",[]),g(this,"uploadCacheInterval",void 0),g(this,"rttRolling",new Ng(5)),g(this,"pingpongTimer",void 0),g(this,"wsInflateDataTimer",void 0),g(this,"pingpongTimeoutCount",0),g(this,"joinResponse",void 0),g(this,"multiIpOption",void 0),g(this,"initError",void 0),g(this,"spec",void 0),g(this,"store",void 0),g(this,"_external_signal",void 0),g(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(ht.ON_BINARY_DATA,i.data);const s=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){const a="res-@".concat(s._id);this.emit(a,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")){switch(s._type){case Kt.ON_DATA_STREAM:return void this.handleDataStream(s._message);case Kt.MUTE_AUDIO:case Kt.MUTE_VIDEO:case Kt.ON_P2P_LOST:return;case Kt.ON_USER_ONLINE:this.emit(s._type,s._message);const{uid:a}=s._message;return this._external_signal.setStart(a),void this._external_signal.send(Ve.JOIN,{onlineTime:this._userOnlineTime},!0)}if(this.emit(s._type,s._message),s._type===Kt.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===Kt.ON_USER_BANNED)switch(s._message.error_code){case 14:this.close(oe.UID_BANNED);break;case 15:this.close(oe.IP_BANNED);break;case 16:this.close(oe.CHANNEL_BANNED)}if(s._type===Kt.ON_USER_LICENSE_BANNED)switch(s._message.error_code){case Dt.ERR_LICENSE_MISSING:this.close(oe.LICENSE_MISSING);break;case Dt.ERR_LICENSE_EXPIRED:this.close(oe.LICENSE_EXPIRED);break;case Dt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(oe.LICENSE_MINUTES_EXCEEDED);break;case Dt.ERR_LICENSE_PERIOD_INVALID:this.close(oe.LICENSE_PERIOD_INVALID);break;case Dt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(oe.LICENSE_MULTIPLE_SDK_SERVICE);break;case Dt.ERR_LICENSE_ILLEGAL:this.close(oe.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=e,this.websocket=new gu("gateway-".concat(this.clientId),this.spec.retryConfig,!0,x("JOIN_GATEWAY_USE_DUAL_DOMAIN"),x("JOIN_GATEWAY_USE_443PORT_ONLY"),e),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===ie.CONNECTED&&this.reconnect("retry",jn.OFFLINE)}),this._external_signal=new bf(this),this._handleSignalP2PEvents()}async request(t,e,i,s){const a=Le(6,""),d={_id:a,_type:t,_message:e},u=this.websocket.connectionID,h=()=>new W((b,I)=>{if(this.connectionState===ie.CONNECTED)return b();const A=()=>{this.off(ht.WS_CLOSED,L),b()},L=()=>{this.off(ht.WS_CONNECTED,A),I(new J(O.WS_ABORT))};this.once(ht.WS_CONNECTED,A),this.once(ht.WS_CLOSED,L),t!==yt.PUBLISH&&t!==yt.SUBSCRIBE&&t!==yt.UNSUBSCRIBE&&t!==yt.UNPUBLISH&&t!==yt.CONTROL&&t!==yt.RESTART_ICE||this.once(ht.DISCONNECT_P2P,()=>{I(new J(O.DISCONNECT_P2P))}),t!==yt.PUBLISH&&t!==yt.RESTART_ICE||this.once(ht.ABORT_P2P_EXECUTION,()=>{I(new J(O.DISCONNECT_P2P))})});if(this.connectionState!==ie.CONNECTING&&this.connectionState!==ie.RECONNECTING||t===yt.JOIN||t===yt.REJOIN||await h(),this.websocket.sendMessage(d,!0),s)return;const p=new W((b,I)=>{let A=!1;const L=(F,$)=>{A=!0,b({isSuccess:F==="success",message:$||{}}),this.off(ht.WS_CLOSED,U),this.off(ht.WS_RECONNECTING,U),this.emit(ht.REQUEST_SUCCESS,t,e)};this.once("res-@".concat(a),L);const U=()=>{I(new J(O.WS_ABORT,"type: ".concat(t))),this.off(ht.WS_CLOSED,U),this.off(ht.WS_RECONNECTING,U),this.off("res-@".concat(a),L)};this.once(ht.WS_CLOSED,U),this.once(ht.WS_RECONNECTING,U),si(x("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||A||(R.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(ht.REQUEST_TIMEOUT,t,e))})});let _=null;try{_=await p}catch(b){if(this.connectionState===ie.CLOSED||t===yt.LEAVE)throw new J(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?b.throw():t===yt.JOIN||t===yt.REJOIN?null:(await h(),await this.request(t,e))}if(_.isSuccess)return _.message;const m=Number(_.message.error_code||_.message.code),S=bc(m),y=new J(O.UNEXPECTED_RESPONSE,"".concat(S.desc,": ").concat(_.message.error_str),{code:m,data:_.message});return S.action==="success"?_.message:(R.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(m,", message: ").concat(S.desc,", action: ").concat(S.action)),m===Dt.ERR_TOO_MANY_BROADCASTERS?((t===yt.JOIN||t===yt.REJOIN)&&(this.initError=y,this.close()),y.throw()):S.action==="failed"?y.throw():S.action==="quit"?(this.initError=y,this.close(),y.throw()):(m===Dt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,R.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",jn.MULTI_IP)):this.reconnect(S.action,jn.SERVER_ERROR),t===yt.JOIN||t===yt.REJOIN?null:await this.request(t,e)))}waitMessage(t,e){return new W(i=>{const s=a=>{(!e||e(a))&&(this.off(t,s),i(a))};this.on(t,s)})}upload(t,e){const i={_type:t,_message:e};try{this.websocket.sendMessage(i)}catch{const a=x("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==ie.CONNECTED)return;const d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},x("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,e){const i={_type:t,_message:e};this.websocket.sendMessage(i)}async sendExtensionMessage(t,e,i){return await this.waitTillUserOnline(),await this._external_signal.send(t,e,i)}init(t,e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new W((i,s)=>{this.once(ht.WS_CONNECTED,()=>i(this.joinResponse)),this.once(ht.WS_CLOSED,()=>s(this.initError||new J(O.WS_ABORT))),this.connectionState=ie.CONNECTING,this.websocket.init(t).catch(s),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||oe.LEAVE,this.connectionState=ie.CLOSED,R.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),t===oe.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new gu("gateway-".concat(this.clientId),this.spec.retryConfig,!0,x("JOIN_GATEWAY_USE_DUAL_DOMAIN"),x("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(ht.ABORT_P2P_EXECUTION);const t=await tn(this,ht.REQUEST_JOIN_INFO),e=await this.request(yt.JOIN,t);if(!e)return this.emit(ht.REPORT_JOIN_GATEWAY,O.TIMEOUT,this.url||""),!1;this.joinResponse=e,this.emit(ht.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=ie.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),this._userOnlineTime=new Date().getTime(),this._external_signal.clear(),!0}async rejoin(){if(!this.reconnectToken)throw new J(O.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=Do(this,ht.REQUEST_REJOIN_INFO);return t.token=this.reconnectToken,!!await this.request(yt.REJOIN,t)&&(this.connectionState=ie.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0)}reconnect(t,e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,e)}handleDataStream(t){try{var e;const i=Pp(t.payload),s=new TextDecoder().decode(i),a=JSON.parse(s);"total"in a&&"id"in a||It(e=Object.values(Ve)).call(e,a._type)?(t.seq&&delete t.seq,a._uid=t.uid,this._external_signal.onMessage(a)):this.emit(Kt.ON_DATA_STREAM,t)}catch{}}handleNotification(t){R.debug("[".concat(this.clientId,"] receive notification: "),t);const e=bc(t.code);if(e.action!=="success"){if(e.action!=="failed")return e.action==="quit"?(e.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(oe.UID_BANNED),void this.close()):void this.reconnect(e.action,jn.SERVER_ERROR);R.error("[".concat(this.clientId,"] ignore error: "),e.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=x("PING_PONG_TIME_OUT"),e=Date.now();this.pingpongTimeoutCount>=t&&(R.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(e-this.lastMsgTime,"ms")),e-this.lastMsgTime>x("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",jn.TIMEOUT):this.request(yt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-e;this.rttRolling.add(i),x("REPORT_STATS")&&this.send(yt.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:e}=this.websocket.getWsInflateData();t!==0&&e!==0&&this.upload(Ji.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:e,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Bt.RECONNECT_WAITTING_FINISH,t=>{this.emit(ht.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(Bt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(ht.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Bt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Bt.CLOSED,()=>{this.connectionState=ie.CLOSED}),this.websocket.on(Bt.FAILED,()=>{this._disconnectedReason=oe.NETWORK_ERROR,this.connectionState=ie.CLOSED}),this.websocket.on(Bt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===ie.CONNECTED?this.connectionState=ie.RECONNECTING:this.connectionState=ie.CONNECTING}),this.websocket.on(Bt.WILL_RECONNECT,(t,e,i)=>{if(Do(this,ht.IS_P2P_DISCONNECTED)&&t==="retry")return R.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(ht.NEED_RENEW_SESSION),this.emit(ht.DISCONNECT_P2P),i("tryNext");t!=="retry"&&(R.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(ht.NEED_RENEW_SESSION),this.emit(ht.DISCONNECT_P2P)),i(t)}),this.websocket.on(Bt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{R.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",jn.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(ht.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof J&&t.code===O.UNEXPECTED_RESPONSE&&t.data.code===Dt.ERR_NO_AUTHORIZED)return R.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",jn.SERVER_ERROR);R.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",jn.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Bt.REQUEST_NEW_URLS,(t,e)=>{tn(this,ht.REQUEST_RECOVER,this.multiIpOption).then(t).catch(e)}),this.websocket.on(Bt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Kt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}_handleSignalP2PEvents(){this._external_signal.on(Ve.JOIN,async t=>{if(this._userOnlineTime&&this._userOnlineTime<t.onlineTime){const e=await tn(this,ht.P2P_START,void 0),i=await this._external_signal.send(Ve.CALL,e);this.emit(ht.P2P_CONNECTION,i,!0)}this._userInRoom=!0,this.emit("user-online")}),this.on(Kt.ON_USER_OFFLINE,async t=>{this._external_signal.clear(),this._userInRoom=!1}),this._external_signal.on(Ve.CALL,async(t,e,i)=>{this._userInRoom=!0,this.emit("user-online");try{e(await tn(this,ht.P2P_START,t))}catch(s){i(s)}})}async waitTillUserOnline(){return new W(t=>{if(this._userInRoom)t();else{const e=()=>{this.off("user-online",e),t()};this.on("user-online",e)}})}}function w0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function _s(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?w0(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):w0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}const XS=new Map;class q4 extends Ye{get state(){return this._state}set state(t){if(t===this._state)return;const e=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(nn.CONNECTION_STATE_CHANGE,t,e,this._disconnectedReason):this.emit(nn.CONNECTION_STATE_CHANGE,t,e)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){R.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,e){super(),g(this,"store",void 0),g(this,"joinInfo",void 0),g(this,"key",void 0),g(this,"ntpOffset",0),g(this,"signal",void 0),g(this,"role",void 0),g(this,"inChannelInfo",{joinAt:null,duration:0}),g(this,"spec",void 0),g(this,"_state","DISCONNECTED"),g(this,"_statsCollector",void 0),g(this,"_disconnectedReason",void 0),g(this,"isSignalRecover",!1),g(this,"hasChangeBGPAddress",!1),g(this,"trafficStatsInterval",void 0),g(this,"networkQualityInterval",void 0),g(this,"_joinGatewayStartTime",0),g(this,"_signalTimeout",!1),g(this,"_clientRoleOptions",void 0),g(this,"_isProactiveJoin",!1),this.store=t,this.spec=e,this.signal=this.store.useP2P?new b0(_s(_s({},e),{},{retryConfig:e.websocketRetryConfig}),t):this.store.useDataChannel?new xo(_s(_s({},e),{},{retryConfig:e.websocketRetryConfig}),t):new YA(_s(_s({},e),{},{retryConfig:e.websocketRetryConfig}),t),this._statsCollector=e.statsCollector,this.role=e.role||"audience",this._clientRoleOptions=e.clientRoleOptions,this.handleSignalEvents()}async join(t,e,i){if(this.signal instanceof xo){let h=!1;t.cloudProxyServer!=="disabled"?(R.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),h=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(R.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),h=!0):t.apResponse.addresses.some(p=>p.fingerprint)||x("FINGERPRINT")||(R.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),h=!0),h&&this.resetSignal()}this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const s=Date.now();let a=XS.get(t.cname);if(a||(a=new Map,XS.set(t.cname,a)),this._isProactiveJoin=!0,a.has(t.uid)){const h=new B(O.UID_CONFLICT);throw vt.joinGateway(t.sid,{lts:s,succ:!1,ec:h.message,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!t.proxyServer,signalChannel:this.signal instanceof xo?"1":"0"}),this._isProactiveJoin=!1,h}a.set(t.uid,!0),this.joinInfo=t,this.key=e;let d=0;this.joinGatewayStartTime=s;const u=t.proxyServer;try{let h;if(R.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof xo?"datachannel":"websocket"," join uid ").concat(d)),this.signal instanceof xo)h=await this.signal.init(t.apResponse.addresses,i);else{const p=t.gatewayAddrs.map(_=>{let{address:m}=_;const[S,y]=m.split(":"),b={host:S,port:y};return t.proxyServer&&(b.proxy=t.proxyServer),b});h=await this.signal.init(p,i)}d=h.uid,R.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof xo?"datachannel":"websocket"," join uid ").concat(d," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(h){throw h&&h.code===O.INIT_WEBSOCKET_TIMEOUT?(R.warning("[".concat(this.store.clientId,"] User join failed"),h.toString()),h):h&&h.code===O.INIT_DATACHANNEL_TIMEOUT?(R.warning("[".concat(this.store.clientId,"] User join datachannel failed"),h.toString()),this.resetSignal(),h):(R.error("[".concat(this.store.clientId,"] User join failed"),h.toString()),vt.joinGateway(t.sid,{lts:s,succ:!1,ec:h.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!u,signalChannel:this.signal instanceof xo?"1":"0"}),this._isProactiveJoin=!1,a.delete(t.uid),this.signal.close(),h)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),R.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(h=>{R.warning("[".concat(this.store.clientId,"] get traffic stats error"),h.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(nn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(nn.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(nn.NETWORK_QUALITY,{uplinkNetworkQuality:v0(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:v0(this._statsCollector.trafficStats.B_dnq)}):this.emit(nn.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),d}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],e=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){e!==oe.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==ie.CONNECTED||await function(i,s){return s===1/0?i:W.race([i,ZG(s)])}(this.signal.request(yt.LEAVE,void 0,!0),3e3)}catch(i){R.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(e),e!==oe.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,e,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={state:"offer",p2p_id:this.store.p2pId,ortc:e,mode:this.spec.mode,extend:x("PUB_EXTEND"),twcc:!!x("PUBLISH_TWCC"),rtx:!!x("USE_PUB_RTX")};try{return(await this.signal.request(yt.PUBLISH,s,!0))._message}catch(a){if(i&&a.data&&a.data.code===Dt.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),a.toString()),await this.tryUnpubBeforeRepub(t,e),this.publish(t,e,!1);throw a}}async publishDataChannel(t,e,i){var s;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const a={stream_id:e.streamId,ordered:e.ordered?1:0,max_retrans_times:(s=e.maxRetransmits)!==null&&s!==void 0?s:10,channel_id:e.channelId,metadata:e.metadata};try{await this.signal.request(yt.PUBLISH_DATASTREAM,a,!0)}catch(d){if(i&&d.data&&d.data.code===Dt.ERR_PUBLISH_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),d.toString()),await this.tryUnpubDataChannelBeforeRepub(t,e),this.publishDataChannel(t,e,!1);throw d}}async unpublish(t,e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(yt.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(i){R.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await W.all(t.map(e=>this.signal.request(yt.UNPUBLISH_DATASTREAM,{channel_id:e},!0)))}catch(e){R.warning("unpublish datachannels warning: ",e)}}async subscribe(t,e,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const s={stream_id:t,stream_type:e.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!x("SUBSCRIBE_TWCC"),rtx:!!x("USE_SUB_RTX"),extend:x("SUB_EXTEND"),ssrcId:e.ssrcId,svc:Array.isArray(x("SVC"))&&x("SVC").length!==0?x("SVC"):void 0};try{return(await this.signal.request(yt.SUBSCRIBE,s,!0))._message}catch(a){if(i&&a.data&&a.data.code===Dt.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),a.toString()),await this.tryUnsubBeforeResub(t,e),await this.subscribe(t,e,!1);throw a}}async subscribeDataChannel(t,e,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const s={uid:t,stream_id:e.id,channel_id:e.datachannelId};try{return void await this.signal.request(yt.SUBSCRIBE_DATASTREAM,s,!0)}catch(a){if(i&&a.data&&a.data.code===Dt.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),a.toString()),await this.tryUnsubDataChannelBeforeResub(t,e),await this.subscribeDataChannel(t,e,!1);throw a}}async subscribeAll(t,e){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!x("USE_SUB_RTX")};try{return await this.signal.request(yt.SUBSCRIBE_STREAMS,i,!0)}catch(s){if(e&&s.data&&s.data.code===Dt.ERR_SUBSCRIBE_REQUEST_INVALID)return R.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),s.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw s}}async setVideoProfile(t){const e=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let s=i.frameRate,a=i.width,d=i.height,u=!0;return typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(u=!1)),typeof a!="number"&&(a=a.exact||a.ideal||a.max||a.min||0,a||(u=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,s||(u=!1)),u?{stream_type:0,width:a,height:d,fps:s,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(t);if(e)return this.signal.request(yt.SET_VIDEO_PROFILE,e);R.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,e){try{await this.signal.request(yt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:e},!0)}catch(i){R.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(t,e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await W.all(t.map(i=>this.signal.request(yt.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:e},!0)))}catch(i){R.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(t){try{await this.signal.request(yt.UNSUBSCRIBE_STREAMS,t,!0)}catch(e){R.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),e)}}async reconnectPC(t){const{iceParameters:e,dtlsParameters:i,rtpCapabilities:s}=t;return{gatewayEstablishParams:await this.signal.request(yt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:e,dtlsParameters:i,rtpCapabilities:s}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(yt.GATEWAY_INFO)}async renewToken(t){await this.signal.request(yt.RENEW_TOKEN,t),this.key=t.token}async setClientRole(t,e){if(e&&(this._clientRoleOptions=Object.assign({},e)),this.state!=="CONNECTED")return void(this.role=t);let i,s=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,s=1):s=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:s=0,await this.signal.request(yt.SET_CLIENT_ROLE,{role:t,level:s,delay:i,client_ts:Date.now()}),this.role=t}async setRemoteVideoStreamType(t,e){await this.signal.request(yt.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:e})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(yt.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,e){await this.signal.request(yt.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:e})}async pickSVCLayer(t,e){await this.signal.request(yt.PICK_SVC_LAYER,{stream_id:t,spatial_layer:e.spatialLayer,temporal_layer:e.temporalLayer})}async setRTM2Flag(t){await this.signal.request(yt.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,e,i){if(this.signal instanceof b0)return this.signal.sendExtensionMessage(t,e,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),_s({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(yt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=XS.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(e){let i;return i=e.startsWith("dc")?e.match(/(dc\:\/\/)?([^:]+):(\d+)/):e.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:Tr.username,password:Tr.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(_s(_s({},Tr),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(yt.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(e=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(s=>s.peer_uid===e.peer_uid);i&&i.B_st!==e.B_st&&ds(()=>{this.emit(nn.STREAM_TYPE_CHANGE,e.peer_uid,e.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){if(!this.joinInfo||!this.key)throw new B(O.UNEXPECTED_ERROR,"can not generate join message, no join info");const e=Object.assign({},this.joinInfo.apResponse);let i=x("REPORT_APP_SCENARIO");if(typeof i!="string")try{i=JSON.stringify(i)}catch{i=void 0}i&&i.length>128&&(i=void 0);const s=_s({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:jr,browser:navigator.userAgent,process_id:x("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:e,extend:x("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:{enablePublishedUserList:x("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:x("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof x("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?x("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof x("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?x("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof x("ENABLE_USER_LICENSE_CHECK")=="boolean"?x("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:x("USE_PUB_RTX")===!0||x("USE_SUB_RTX")===!0||void 0,disableFEC:x("DISABLE_FEC"),enableNTPReport:!!x("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!x("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:typeof x("ENABLE_DATASTREAM_2")=="boolean"?x("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:typeof x("RTM2_FLAG")=="number"?x("RTM2_FLAG"):void 0,enableUserAutoRebalanceCheck:!!x("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:typeof x("USE_XR")=="boolean"?x("USE_XR"):void 0}},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(s.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(s.aes_mode=this.joinInfo.aesmode,x("ENCRYPT_AES")?(s.aes_secret=this.joinInfo.aespassword,s.aes_encrypt=!0):s.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(s.aes_salt=this.joinInfo.aessalt)),e.addresses[this.signal.websocket.currentURLIndex]&&(s.ap_response.ticket=e.addresses[this.signal.websocket.currentURLIndex].ticket,delete e.addresses),this.joinInfo.defaultVideoStream!==void 0&&(s.default_video_stream=this.joinInfo.defaultVideoStream),s}getRejoinMessage(){if(!this.joinInfo)throw new B(O.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(ht.WS_RECONNECT_WAITTING_FINISH,t=>{var e;It(e=["tryNext","recover"]).call(e,t)&&this.joinInfo&&vt.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(ht.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(ht.WS_RECONNECTING,t=>{this.joinInfo&&vt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||jn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",vt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(ht.WS_CLOSED,t=>{let e;switch(t){case oe.LEAVE:e=jn.LEAVE;break;case oe.UID_BANNED:case oe.IP_BANNED:case oe.CHANNEL_BANNED:case oe.SERVER_ERROR:e=jn.SERVER_ERROR;break;case oe.FALLBACK:e=jn.FALLBACK;break;case oe.LICENSE_MISSING:case oe.LICENSE_EXPIRED:case oe.LICENSE_MINUTES_EXCEEDED:case oe.LICENSE_PERIOD_INVALID:case oe.LICENSE_MULTIPLE_SDK_SERVICE:case oe.LICENSE_ILLEGAL:case oe.TOKEN_EXPIRE:e=t;break;default:e=jn.NETWORK_ERROR}R.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(e||"undefined -> "+jn.NETWORK_ERROR)),this.joinInfo&&vt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===oe.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e}),this._disconnectedReason=t,t!==oe.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(ht.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(R.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),vt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof xo?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void R.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));Ne("EVENT_REPORT_DOMAIN",t[1]),Ne("EVENT_REPORT_BACKUP_DOMAIN",t[1]),Ne("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}),this.signal.on(Kt.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(ht.REQUEST_RECOVER,(t,e,i)=>{if(!this.joinInfo)return i(new B(O.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,tn(this,nn.REQUEST_NEW_GATEWAY_LIST).then(e).catch(i)}),this.signal.on(ht.REQUEST_JOIN_INFO,async t=>{var e;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const{iceParameters:i,dtlsParameters:s,rtpCapabilities:a}=await tn(this,nn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(e=this.joinInfo)===null||e===void 0?void 0:e.turnServer});t(this.getJoinMessage({ortc:{iceParameters:i,dtlsParameters:s,rtpCapabilities:a,version:"2"}}))}),this.signal.on(ht.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(ht.REPORT_JOIN_GATEWAY,(t,e)=>{this.joinInfo&&(vt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:t,addr:e,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof xo?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(ht.IS_P2P_DISCONNECTED,t=>{t(Do(this,nn.IS_P2P_DISCONNECTED))}),this.signal.on(ht.DISCONNECT_P2P,()=>{this.emit(nn.DISCONNECT_P2P)}),this.signal.on(ht.NEED_RENEW_SESSION,()=>{this.emit(nn.NEED_RENEW_SESSION)}),this.signal.on(ht.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(ht.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(ht.JOIN_RESPONSE,t=>{const e=this.getCurrentGatewayAddress();this.emit(nn.JOIN_RESPONSE,t,e)}),this.signal.on(ht.DATACHANNEL_PRECONNECT,async(t,e,i)=>{this.updateTurnConfigFromSignal();const s=this.getCurrentGatewayAddress();return tn(this,nn.DATACHANNEL_PRECONNECT,t,s).then(e).catch(i)}),this.signal.on(ht.DATACHANNEL_CONNECTING,async t=>{const{iceParameters:e,dtlsParameters:i,rtpCapabilities:s}=await tn(this,nn.REQUEST_DC_CONNECTION_PARAMS);t(this.getJoinMessage({ortc:{iceParameters:e,dtlsParameters:i,rtpCapabilities:s,version:"2"}}))}),this.signal.on(ht.DATACHANNEL_FAILBACK,()=>{R.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(nn.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(t,e){try{await this.signal.request(yt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[e]},!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(t,e){try{await this.signal.request(yt.UNSUBSCRIBE,{stream_id:e.id},!0)}catch(i){throw R.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(t,e){try{await this.signal.request(yt.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(t,e){try{await this.signal.request(yt.UNPUBLISH_DATASTREAM,{channnel_id:e.channelId},!0)}catch(i){throw R.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(t){const e={users:t.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(yt.UNSUBSCRIBE_STREAMS,e,!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(t,e){const i={action:t.find(s=>s.stream_type===Ae.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:e};try{await this.signal.request(yt.CONTROL,i,!0,!0)}catch(s){throw R.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),s),s}}async unmuteLocal(t,e){const i={action:t.find(s=>s.stream_type===Ae.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:e};try{await this.signal.request(yt.CONTROL,i,!0,!0)}catch(s){throw R.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),s),s}}async muteRemote(t,e){const i={action:t===mt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:e};try{await this.signal.request(yt.CONTROL,i,!0,!0)}catch(s){throw R.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),s),s}}async unmuteRemote(t,e){const i={action:t===mt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:e};try{await this.signal.request(yt.CONTROL,i,!0,!0)}catch(s){throw R.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),s),s}}uploadStats(t,e){this.signal.upload(t,e)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const e={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(yt.RESTART_ICE,e,!0)}catch(i){throw R.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,jn.P2P_FAILED)}getCurrentGatewayAddress(){var t;if(!x("GATEWAY_WSS_ADDRESS"))return(t=this.joinInfo)!==null&&t!==void 0&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(yt.SET_PARAMETER,{enablePublishAudioFilter:t})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(oe.FALLBACK)),this.store.useDataChannel=!1,this.signal=new YA(_s(_s({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(nn.RESET_SIGNAL,zp.websocket)}}let wf=0,QS=0;function Vo(n,t,e,i){return new W((s,a)=>{t.timeout=t.timeout||x("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!e?(t.data=JSON.stringify(t.data),wf+=Xs(t.data)):e&&(t.data.size?wf+=t.data.size:t.data instanceof FormData?wf+=Tw(t.data):wf+=Xs(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=n,qi.request(t).then(d=>{typeof d.data=="string"?QS+=Xs(d.data):d.data instanceof ArrayBuffer||d.data instanceof Uint8Array?QS+=d.data.byteLength:QS+=Xs(JSON.stringify(d.data)),i&&s({data:d.data,headers:d.headers}),s(d.data)}).catch(d=>{qi.isCancel(d)?a(new B(O.OPERATION_ABORTED,"cancel token canceled")):d.code==="ECONNABORTED"?a(new B(O.NETWORK_TIMEOUT,d.message)):d.response?a(new B(O.NETWORK_RESPONSE_ERROR,d.response.status)):a(new B(O.NETWORK_ERROR,d.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var n;function t(tt){var ot=0;return function(){return ot<tt.length?{done:!1,value:tt[ot++]}:{done:!0}}}var e=typeof Object.defineProperties=="function"?Object.defineProperty:function(tt,ot,gt){return tt==Array.prototype||tt==Object.prototype||(tt[ot]=gt.value),tt},i,s=function(tt){tt=[typeof globalThis=="object"&&globalThis,tt,typeof window=="object"&&window,typeof self=="object"&&self,typeof K=="object"&&K];for(var ot=0;ot<tt.length;++ot){var gt=tt[ot];if(gt&&gt.Math==Math)return gt}throw Error("Cannot find global object")}(this);function a(tt,ot){if(ot)t:{var gt=s;tt=tt.split(".");for(var Ht=0;Ht<tt.length-1;Ht++){var ye=tt[Ht];if(!(ye in gt))break t;gt=gt[ye]}(ot=ot(Ht=gt[tt=tt[tt.length-1]]))!=Ht&&ot!=null&&e(gt,tt,{configurable:!0,writable:!0,value:ot})}}function d(tt){return(tt={next:tt})[Symbol.iterator]=function(){return this},tt}function u(tt){var ot=typeof Symbol<"u"&&Symbol.iterator&&tt[Symbol.iterator];return ot?ot.call(tt):{next:t(tt)}}if(a("Symbol",function(tt){function ot(ye,lt){this.A=ye,e(this,"description",{configurable:!0,writable:!0,value:lt})}if(tt)return tt;ot.prototype.toString=function(){return this.A};var gt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Ht=0;return function ye(lt){if(this instanceof ye)throw new TypeError("Symbol is not a constructor");return new ot(gt+(lt||"")+"_"+Ht++,lt)}}),a("Symbol.iterator",function(tt){if(tt)return tt;tt=Symbol("Symbol.iterator");for(var ot="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),gt=0;gt<ot.length;gt++){var Ht=s[ot[gt]];typeof Ht=="function"&&typeof Ht.prototype[tt]!="function"&&e(Ht.prototype,tt,{configurable:!0,writable:!0,value:function(){return d(t(this))}})}return tt}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var h;t:{var p={};try{p.__proto__={a:!0},h=p.a;break t}catch{}h=!1}i=h?function(tt,ot){if(tt.__proto__=ot,tt.__proto__!==ot)throw new TypeError(tt+" is not extensible");return tt}:null}var _=i;function m(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function S(tt){if(tt.m)throw new TypeError("Generator is already running");tt.m=!0}function y(tt,ot){return tt.h=3,{value:ot}}function b(tt){this.g=new m,this.G=tt}function I(tt,ot,gt,Ht){try{var ye=ot.call(tt.g.j,gt);if(!(ye instanceof Object))throw new TypeError("Iterator result "+ye+" is not an object");if(!ye.done)return tt.g.m=!1,ye;var lt=ye.value}catch(v){return tt.g.j=null,tt.g.s(v),A(tt)}return tt.g.j=null,Ht.call(tt.g,lt),A(tt)}function A(tt){for(;tt.g.h;)try{var ot=tt.G(tt.g);if(ot)return tt.g.m=!1,{value:ot.value,done:!1}}catch(gt){tt.g.v=void 0,tt.g.s(gt)}if(tt.g.m=!1,tt.g.l){if(ot=tt.g.l,tt.g.l=null,ot.F)throw ot.D;return{value:ot.return,done:!0}}return{value:void 0,done:!0}}function L(tt){this.next=function(ot){return tt.o(ot)},this.throw=function(ot){return tt.s(ot)},this.return=function(ot){return function(gt,Ht){S(gt.g);var ye=gt.g.j;return ye?I(gt,"return"in ye?ye.return:function(lt){return{value:lt,done:!0}},Ht,gt.g.return):(gt.g.return(Ht),A(gt))}(tt,ot)},this[Symbol.iterator]=function(){return this}}function U(tt,ot){return ot=new L(new b(ot)),_&&tt.prototype&&_(ot,tt.prototype),ot}if(m.prototype.o=function(tt){this.v=tt},m.prototype.s=function(tt){this.l={D:tt,F:!0},this.h=this.C||this.u},m.prototype.return=function(tt){this.l={return:tt},this.h=this.u},b.prototype.o=function(tt){return S(this.g),this.g.j?I(this,this.g.j.next,tt,this.g.o):(this.g.o(tt),A(this))},b.prototype.s=function(tt){return S(this.g),this.g.j?I(this,this.g.j.throw,tt,this.g.o):(this.g.s(tt),A(this))},a("Array.prototype.entries",function(tt){return tt||function(){return function(ot,gt){ot instanceof String&&(ot+="");var Ht=0,ye=!1,lt={next:function(){if(!ye&&Ht<ot.length){var v=Ht++;return{value:gt(v,ot[v]),done:!1}}return ye=!0,{done:!0,value:void 0}}};return lt[Symbol.iterator]=function(){return lt},lt}(this,function(ot,gt){return[ot,gt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var F=function(tt,ot){for(var gt=0;gt<tt.length;gt++)ot(tt[gt])},$=function(tt){return tt.replace(/\r?\n|\r/g,`\r
`)},z=function(tt,ot,gt){return ot instanceof Blob?(gt=gt!==void 0?gt+"":typeof ot.name=="string"?ot.name:"blob",ot.name===gt&&Object.prototype.toString.call(ot)!=="[object Blob]"||(ot=new File([ot],gt)),[String(tt),ot]):[String(tt),String(ot)]},G=function(tt,ot){if(tt.length<ot)throw new TypeError(ot+" argument required, but only "+tt.length+" present.")},Y=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,q=Y.FormData,ut=Y.XMLHttpRequest&&Y.XMLHttpRequest.prototype.send,ct=Y.Request&&Y.fetch,$t=Y.navigator&&Y.navigator.sendBeacon,pe=Y.Element&&Y.Element.prototype,sn=Y.Symbol&&Symbol.toStringTag;sn&&(Blob.prototype[sn]||(Blob.prototype[sn]="Blob"),"File"in Y&&!File.prototype[sn]&&(File.prototype[sn]="File"));try{new File([],"")}catch{Y.File=function(ot,gt,Ht){return ot=new Blob(ot,Ht||{}),Object.defineProperties(ot,{name:{value:gt},lastModified:{value:+(Ht&&Ht.lastModified!==void 0?new Date(Ht.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),sn&&Object.defineProperty(ot,sn,{value:"File"}),ot}}var Nn=function(tt){return tt.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Ge=function(tt){this.i=[];var ot=this;tt&&F(tt.elements,function(gt){if(gt.name&&!gt.disabled&&gt.type!=="submit"&&gt.type!=="button"&&!gt.matches("form fieldset[disabled] *"))if(gt.type==="file"){var Ht=gt.files&&gt.files.length?gt.files:[new File([],"",{type:"application/octet-stream"})];F(Ht,function(ye){ot.append(gt.name,ye)})}else gt.type==="select-multiple"||gt.type==="select-one"?F(gt.options,function(ye){!ye.disabled&&ye.selected&&ot.append(gt.name,ye.value)}):gt.type==="checkbox"||gt.type==="radio"?gt.checked&&ot.append(gt.name,gt.value):(Ht=gt.type==="textarea"?$(gt.value):gt.value,ot.append(gt.name,Ht))})};if((n=Ge.prototype).append=function(tt,ot,gt){G(arguments,2),this.i.push(z(tt,ot,gt))},n.delete=function(tt){G(arguments,1);var ot=[];tt=String(tt),F(this.i,function(gt){gt[0]!==tt&&ot.push(gt)}),this.i=ot},n.entries=function tt(){var ot,gt=this;return U(tt,function(Ht){if(Ht.h==1&&(ot=0),Ht.h!=3)return ot<gt.i.length?Ht=y(Ht,gt.i[ot]):(Ht.h=0,Ht=void 0),Ht;ot++,Ht.h=2})},n.forEach=function(tt,ot){G(arguments,1);for(var gt=u(this),Ht=gt.next();!Ht.done;Ht=gt.next()){var ye=u(Ht.value);Ht=ye.next().value,ye=ye.next().value,tt.call(ot,ye,Ht,this)}},n.get=function(tt){G(arguments,1);var ot=this.i;tt=String(tt);for(var gt=0;gt<ot.length;gt++)if(ot[gt][0]===tt)return ot[gt][1];return null},n.getAll=function(tt){G(arguments,1);var ot=[];return tt=String(tt),F(this.i,function(gt){gt[0]===tt&&ot.push(gt[1])}),ot},n.has=function(tt){G(arguments,1),tt=String(tt);for(var ot=0;ot<this.i.length;ot++)if(this.i[ot][0]===tt)return!0;return!1},n.keys=function tt(){var ot,gt,Ht,ye,lt=this;return U(tt,function(v){if(v.h==1&&(ot=u(lt),gt=ot.next()),v.h!=3)return gt.done?void(v.h=0):(Ht=gt.value,ye=u(Ht),y(v,ye.next().value));gt=ot.next(),v.h=2})},n.set=function(tt,ot,gt){G(arguments,2),tt=String(tt);var Ht=[],ye=z(tt,ot,gt),lt=!0;F(this.i,function(v){v[0]===tt?lt&&(lt=!Ht.push(ye)):Ht.push(v)}),lt&&Ht.push(ye),this.i=Ht},n.values=function tt(){var ot,gt,Ht,ye,lt=this;return U(tt,function(v){if(v.h==1&&(ot=u(lt),gt=ot.next()),v.h!=3)return gt.done?void(v.h=0):(Ht=gt.value,(ye=u(Ht)).next(),y(v,ye.next().value));gt=ot.next(),v.h=2})},Ge.prototype._asNative=function(){for(var tt=new q,ot=u(this),gt=ot.next();!gt.done;gt=ot.next()){var Ht=u(gt.value);gt=Ht.next().value,Ht=Ht.next().value,tt.append(gt,Ht)}return tt},Ge.prototype._blob=function(){var tt="----formdata-polyfill-"+Math.random(),ot=[],gt="--"+tt+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Ht,ye){return typeof Ht=="string"?ot.push(gt+Nn($(ye))+`"\r
\r
`+$(Ht)+`\r
`):ot.push(gt+Nn($(ye))+'"; filename="'+Nn(Ht.name)+`"\r
Content-Type: `+(Ht.type||"application/octet-stream")+`\r
\r
`,Ht,`\r
`)}),ot.push("--"+tt+"--"),new Blob(ot,{type:"multipart/form-data; boundary="+tt})},Ge.prototype[Symbol.iterator]=function(){return this.entries()},Ge.prototype.toString=function(){return"[object FormData]"},pe&&!pe.matches&&(pe.matches=pe.matchesSelector||pe.mozMatchesSelector||pe.msMatchesSelector||pe.oMatchesSelector||pe.webkitMatchesSelector||function(tt){for(var ot=(tt=(this.document||this.ownerDocument).querySelectorAll(tt)).length;0<=--ot&&tt.item(ot)!==this;);return-1<ot}),sn&&(Ge.prototype[sn]="FormData"),ut){var lr=Y.XMLHttpRequest.prototype.setRequestHeader;Y.XMLHttpRequest.prototype.setRequestHeader=function(tt,ot){lr.call(this,tt,ot),tt.toLowerCase()==="content-type"&&(this.B=!0)},Y.XMLHttpRequest.prototype.send=function(tt){tt instanceof Ge?(tt=tt._blob(),this.B||this.setRequestHeader("Content-Type",tt.type),ut.call(this,tt)):ut.call(this,tt)}}ct&&(Y.fetch=function(tt,ot){return ot&&ot.body&&ot.body instanceof Ge&&(ot.body=ot.body._blob()),ct.call(this,tt,ot)}),$t&&(Y.navigator.sendBeacon=function(tt,ot){return ot instanceof Ge&&(ot=ot._asNative()),$t.call(this,tt,ot)}),Y.FormData=Ge}})();const Af=()=>{const n=x("AREAS");return n.length===0&&n.push(me.GLOBAL),yc(n).call(n,(t,e,i)=>{const s=A0(e);return s?i===0?s:"".concat(t,",").concat(s):t},"")},A0=n=>n===me.OVERSEA?"".concat(ii.ASIA,",").concat(ii.EUROPE,",").concat(ii.AFRICA,",").concat(ii.NORTH_AMERICA,",").concat(ii.SOUTH_AMERICA,",").concat(ii.OCEANIA):ii[n],z4=n=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return n.map(e=>{const i=Jp[e],s=Object.keys(i);s&&s.map(a=>{a!=="CODE"&&(t[a]=t[a].concat(i[a]))})}),t},Of={GLOBAL:{ASIA:[me.CHINA,me.JAPAN,me.INDIA,me.KOREA,me.HKMC],EUROPE:[],NORTH_AMERICA:[me.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Nf=Object.keys(Of[me.GLOBAL]),$S=[me.CHINA,me.NORTH_AMERICA,me.EUROPE,me.ASIA,me.JAPAN,me.INDIA,me.OCEANIA,me.SOUTH_AMERICA,me.AFRICA,me.KOREA,me.HKMC,me.US],J4=function(n,t){let e=[];if(It(n).call(n,me.GLOBAL)){const a=[me.GLOBAL,me.OVERSEA],d=Object.keys(Jp);if(t===me.GLOBAL)throw new B(O.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===me.CHINA)e=[me.OVERSEA];else if(s=t,It(Nf).call(Nf,s)){const u=(i=t,Of[me.GLOBAL][i]||[]),h=[...a,t,...u];e=d.filter(p=>!It(h).call(h,p))}else if(function(u){let h=!1;return Nf.forEach(p=>{var _;It(_=Of[me.GLOBAL][p]).call(_,u)&&(h=!0)}),h}(t)){const u=function(p){let _;return Nf.forEach(m=>{var S;It(S=Of[me.GLOBAL][m]).call(S,p)&&(_=m)}),_}(t),h=[...a,u,t];e=d.filter(p=>!It(h).call(h,p))}else e=n;e=function(u){const h=[];return $S.forEach(p=>{It(u).call(u,p)&&h.push(p)}),h.concat(u.filter(p=>!It($S).call($S,p)))}(e)}else e=n;var i,s;return e};function O0(n){var t,e;if(!n&&It(t=x("AREAS")).call(t,me.EXTENSIONS))return R.debug("update area from ap : reset"),void ZS(z3,!0);if(!It(e=x("AREAS")).call(e,me.GLOBAL)||!n)return;let i=Jp.EXTENSIONS;i&&(i={CODE:A0(me.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(n,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(n,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(n,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(n,".agora.io"),"cds-ap-web-2-".concat(n,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(n,".agora.io"),"sua-ap-web-2-".concat(n,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(n,".agora.io"),"uap-ap-web-2-".concat(n,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(n,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(n,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(n,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(n,".agora.io")]},R.debug("update area from ap success: ".concat(n,",config is "),i),Ne("AREAS",[me.EXTENSIONS],!0),Object.keys(i).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?Ne(s,i[s][0]):Ne(s,i[s])}))}function ZS(n){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const e=vt.reportApiInvoke(null,{name:An.SET_AREA,options:n,tag:Je.TRACER});try{let i=[];if(typeof n=="string"&&(i=[n]),Array.isArray(n)&&(n.forEach(a=>{if(!It(LA).call(LA,a))throw new B(O.INVALID_PARAMS,"invalid area code")}),i=n),Object.prototype.toString.call(n)==="[object Object]"){const{areaCode:a,excludedArea:d}=n;if(!a)throw new B(O.INVALID_PARAMS,"area code is needed");let u=a;typeof a=="string"&&(u=[a]),i=d?J4(u,d):u}if(!t){if(ha.AREAS){const a=new B(O.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return e.onError(a),void R.warning("setArea is prohibited because of config-distribute")}if(It(i).call(i,me.GLOBAL)&&x("AREAS")===me.EXTENSIONS){const a=new B(O.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return e.onError(a),void R.warning("setArea is prohibited because of ap extensions")}}Ne("AREAS",i,t);const s=z4(i);Object.keys(s).map(a=>{a==="LOG_UPLOAD_SERVER"||a==="EVENT_REPORT_DOMAIN"||a==="EVENT_REPORT_BACKUP_DOMAIN"||a==="PROXY_SERVER_TYPE3"?Ne(a,s[a][0]):Ne(a,s[a])}),R.debug("set area success:",i.join(","))}catch(i){throw e.onError(i),i}e.onSuccess()}function N0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function tT(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?N0(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):N0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}let eT=1;function X4(n,t,e,i,s){eT+=1;const a={sid:e.sid,command:"convergeAllocateEdge",uid:"666",appId:e.appId,ts:Math.floor(Date.now()/1e3),seq:eT,requestId:eT,version:jr,cname:e.cname},d={service_name:t,json_body:JSON.stringify(a)};let u,h,p=n[0];return Ns(async()=>{u=Date.now();const _=await Vo(p,{data:d,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(h=Date.now()-u,_.code!==0){const y=new B(O.UNEXPECTED_RESPONSE,"live streaming ap error, code"+_.code,{retry:!0,responseTime:h});throw R.error(y.toString()),y}const m=JSON.parse(_.json_body);if(m.code!==200){const y=new B(O.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(m.code,", reason: ").concat(m.reason),{code:m.code,responseTime:h});throw R.error(y.toString()),y}if(!m.servers||m.servers.length===0){const y=new B(O.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:m.code,responseTime:h});throw R.error(y.toString()),y}const S=function(y,b){return{addressList:y.servers.map(I=>"wss://".concat(I.address.replace(/\./g,"-"),".").concat(x("WORKER_DOMAIN"),":").concat(I.wss,"?serviceName=").concat(encodeURIComponent(b))),workerToken:y.workerToken,vid:y.vid}}(m,t);return x("LIVE_STREAMING_ADDRESS")&&(S.addressList=x("LIVE_STREAMING_ADDRESS")instanceof Array?x("LIVE_STREAMING_ADDRESS"):[x("LIVE_STREAMING_ADDRESS")]),tT(tT({},S),{},{responseTime:h})},(_,m)=>(vt.apworkerEvent(e.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(_.addressList),firstSuccess:m===0,responseTime:h,serverIp:n[m%n.length]}),!1),(_,m)=>(vt.apworkerEvent(e.sid,{success:!1,sc:_.data&&_.data.code||200,serviceName:t,responseTime:h,serverIp:n[m%n.length]}),!!(_.code!==O.OPERATION_ABORTED&&_.code!==O.UNEXPECTED_RESPONSE||_.data&&_.data.retry)&&(p=n[(m+1)%n.length],!0)),s)}let nT=1;function D0(n,t,e,i){let{url:s,areaCode:a}=n;const d=Date.now();let u;const[h,p]=M0(t,a,[Jn.CHOOSE_SERVER]);let _=Tn.networkState;return Ns(async()=>{_&&Tn.networkState===Ai.OFFLINE&&Tn.onlineWaiter&&await W.race([Tn.onlineWaiter,si(i&&i.maxRetryTimeout||Rn.maxRetryTimeout)]),_=Tn.networkState;const{data:m,headers:S}=await Vo(s,{data:h,cancelToken:e,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);u=S.http3==="1"?1:-1,vt.reportResourceTiming(s,t.sid),k0(m,s,t,d,[Jn.CHOOSE_SERVER],u);const y=zS(m,Jn.CHOOSE_SERVER);return L0(y),y0(y,s)},m=>(m&&vt.joinChooseServer(t.sid,{lts:d,succ:!0,csAddr:s,opid:p,serverList:m.gatewayAddrs.map(S=>S.address),ec:null,cid:m.cid.toString(),uid:m.uid.toString(),csIp:m.csIp,unilbsServerIds:[Jn.CHOOSE_SERVER].toString(),isHttp3:u}),!1),m=>m.code!==O.OPERATION_ABORTED&&(m.code===O.CAN_NOT_GET_GATEWAY_SERVER?m.data.retry:(vt.joinChooseServer(t.sid,{lts:d,succ:!1,csAddr:s,serverList:null,opid:p,ec:m.code,csIp:m.data&&m.data.csIp,unilbsServerIds:[Jn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:_}),isHttp3:u}),R.warning("[".concat(t.clientId,"] Choose server network error, retry"),m),!0)),i)}function P0(n,t,e,i){let s,{url:a,areaCode:d,serviceIds:u}=n;const h=Date.now(),[p,_]=M0(t,d,u);let m;return Ns(async()=>{m&&Tn.networkState===Ai.OFFLINE&&Tn.onlineWaiter&&await W.race([Tn.onlineWaiter,si(i&&i.maxRetryTimeout||Rn.maxRetryTimeout)]),m=Tn.networkState;const{data:S,headers:y}=await Vo(a,{data:p,cancelToken:e,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);s=y.http3==="1"?1:-1,vt.reportResourceTiming(a,t.sid),k0(S,a,t,h,u,s);const b=zS(S,Jn.CHOOSE_SERVER),I=zS(S,t.cloudProxyServer==="proxy5"?Jn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Jn.CLOUD_PROXY:Jn.CLOUD_PROXY_FALLBACK);return L0(b),{gatewayInfo:y0(b,a),proxyInfo:I,url:a}},S=>(S.gatewayInfo&&vt.joinChooseServer(t.sid,{lts:h,succ:!0,csAddr:a,serverList:S.gatewayInfo.gatewayAddrs.map(y=>y.address),ec:null,opid:_,cid:S.gatewayInfo.cid.toString(),uid:S.gatewayInfo.uid.toString(),csIp:S.gatewayInfo.csIp,unilbsServerIds:u.toString(),isHttp3:s}),S.proxyInfo&&vt.joinWebProxyAP(t.sid,{lts:h,sucess:1,apServerAddr:a,turnServerAddrList:S.proxyInfo.addresses.map(y=>y.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:u.toString()}),!1),S=>S.code!==O.OPERATION_ABORTED&&(S.code===O.CAN_NOT_GET_GATEWAY_SERVER?S.data.retry:(vt.joinWebProxyAP(t.sid,{lts:h,sucess:0,apServerAddr:a,turnServerAddrList:null,errorCode:S.code,eventType:t.cloudProxyServer,unilbsServerIds:u.toString(),extend:JSON.stringify({networkState:m})}),R.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),S),!0)),i)}const k0=(n,t,e,i,s,a)=>{const d=[],u=h=>{h.flag===4096?vt.joinChooseServer(e.sid,{lts:i,succ:!1,csAddr:t,opid:n.opid,serverList:null,ec:h.error.message,csIp:h.error.data&&h.error.data.csIp,unilbsServerIds:s.toString(),isHttp3:a}):h.flag!==1048576&&h.flag!==4194304&&h.flag!==4194310||vt.joinWebProxyAP(e.sid,{lts:i,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:h.error.code,eventType:e.cloudProxyServer,unilbsServerIds:s.toString()})};if(n.response_body.forEach(h=>{const p=h.buffer.code;if(h.uri===23&&p===0&&!h.buffer.edges_services)if(h.buffer.flag===4194310)R.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),h.buffer.edges_services=[];else{const _={error:new B(O.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:n.detail[502]}),flag:h.buffer.flag};d.push(_),u(_)}if(p!==0){const _=Qp(p),m={error:new B(O.CAN_NOT_GET_GATEWAY_SERVER,_.desc,{desc:_.desc,retry:_.retry,csIp:n.detail[502]}),flag:h.buffer.flag};h.buffer.flag===4194310?R.warning(m.error.toString()):d.push(m),u(m)}}),d.length)throw R.warning("[".concat(e.clientId,"] multi unilbs ").concat(t," failed, ").concat(d.map(h=>"flag: ".concat(h.flag,", message: ").concat(h.error.message,", retry: ").concat(h.error.data.retry)).join(" | "))),new B(O.CAN_NOT_GET_GATEWAY_SERVER,d.map(h=>"flag: ".concat(h.flag,", message: ").concat(h.error.message)).join(" | "),{retry:!!d.find(h=>h.error.data.retry),csIp:n.detail[502],desc:[...new Set(d.map(h=>{var p;return h==null||(p=h.error)===null||p===void 0||(p=p.data)===null||p===void 0?void 0:p.desc}).filter(h=>!!h))]})},L0=n=>{var t,e,i,s;if(n.addresses&&n.addresses.length===0&&n.code===0)throw new B(O.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:n.detail&&n.detail[502]});if(x("AP_AREA")&&((i=n.detail)!==null&&i!==void 0&&i[23]&&typeof((s=n.detail)===null||s===void 0?void 0:s[23])=="string"?O0(n.detail[23].toLowerCase()):O0()),(t=n.detail)!==null&&t!==void 0&&t[19]&&typeof((e=n.detail)===null||e===void 0?void 0:e[19])=="string"){const d=n.detail[19],u=d==null?void 0:d.split(";");for(let h=0;h<u.length;h++){var a;const p=cS(a=u[h]).call(a);n.addresses[h]&&u&&(n.addresses[h].fingerprint=p)}}if(x("GATEWAY_ADDRESS")&&x("GATEWAY_ADDRESS").length>0){R.debug("assign gateway address to",x("GATEWAY_ADDRESS"));const d=x("GATEWAY_ADDRESS").map(u=>{var h,p;const _=(h=(p=n.addresses.find(m=>m.ip===u.ip&&m.port===u.port))===null||p===void 0?void 0:p.fingerprint)!==null&&h!==void 0?h:"";return{ip:u.ip,port:u.port,ticket:n.addresses[0]&&n.addresses[0].ticket,fingerprint:_}});n.addresses=d}},Q4=(n,t)=>{if(n.response_body&&n.response_body.length){const e=n.response_body[0];if(e.buffer.code!==0){const i=Qp(e.buffer.code);throw new B(O.UPDATE_TICKET_FAILED,"[".concat(e.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return e.buffer.ticket}throw R.debug("update ticket request received ap response without response body:",t),new B(O.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},M0=(n,t,e)=>{const i=Math.floor(Math.random()*1e12),s={appid:n.appId,client_ts:Date.now(),opid:i,sid:n.sid,request_bodies:[{uri:22,buffer:{cname:n.cname,detail:tT({6:n.stringUid,11:t,12:x("USE_NEW_TOKEN")?"1":void 0,22:t},x("AP_RTM")?{26:"RTM2"}:{}),key:n.token,service_ids:e,uid:n.uid||0}}]};s.request_bodies.forEach(d=>{n.multiIP&&n.multiIP.gateway_ip&&(d.buffer.detail[5]=JSON.stringify({vocs_ip:[n.multiIP.uni_lbs_ip],vos_ip:[n.multiIP.gateway_ip]}))});const a=new FormData;return a.append("request",JSON.stringify(s)),[a,i]},$4=(n,t)=>{const e=Math.floor(Math.random()*1e12),i={appid:n.appId,client_ts:Date.now(),opid:e,sid:n.sid,request_bodies:[{uri:28,buffer:{cname:n.cname,detail:{1:"",6:n.stringUid,12:"1"},token:n.token,service_ids:t,uid:n.uid||0,edges_services:n.apResponse.addresses.map(a=>({ip:a.ip,port:a.port}))}}]},s=new FormData;return s.append("request",JSON.stringify(i)),[s,e]};let Zd=0;function tl(n){return W.all(n.map(t=>t.then(e=>{throw e},e=>e))).then(t=>{throw t},t=>t)}const Fu=async n=>{let{fragementLength:t,referenceList:e,asyncMapHandler:i,allFailedhandler:s,promisesCollector:a}=n,d=0;const u=t;let h,p=0;const _=async()=>{const m=(()=>{const S=d*u,y=S+u;return e.slice(S,y).map(i)})();a&&a.push(...m);try{h=await tl(m)}catch(S){if(p+=u,d++,!(p>=e.length))return void await _();s(S)}m.forEach(S=>S.cancel())};return await _(),h};async function iT(n,t,e,i){return{gatewayInfo:await async function(a,d,u,h){let p=null;const _=[],m=async()=>{const y=x("WEBCS_DOMAIN").slice(0,x("AJAX_REQUEST_CONCURRENT")).map(A=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(A+"/api/v2/transpond/webrtc?v=2"):"https://".concat(A,"/api/v2/transpond/webrtc?v=2"),areaCode:Af()})),b=h.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(A=>A.url)}),I=await Fu({fragementLength:x("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:A=>(R.debug("[".concat(a.clientId,"] Connect to choose_server:"),A.url),D0(A,a,d,u)),allFailedhandler:A=>{throw h.recordJoinChannelService({endTs:Date.now(),status:"error",errors:A},b),A[0]},promisesCollector:_});return h.recordJoinChannelService({endTs:Date.now(),status:"success"},b),I},S=async()=>{if(await si(1e3),p!==null)return p;const y=x("WEBCS_DOMAIN_BACKUP_LIST").map(A=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(A+"/api/v2/transpond/webrtc?v=2"):"https://".concat(A,"/api/v2/transpond/webrtc?v=2"),areaCode:Af()})),b=h.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(A=>A.url)}),I=await Fu({fragementLength:x("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:A=>(R.debug("[".concat(a.clientId,"] Connect to backup choose_server:"),A.url),D0(A,a,d,u)),allFailedhandler:A=>{throw h.recordJoinChannelService({endTs:Date.now(),status:"error",errors:A},b),A[0]},promisesCollector:_});return h.recordJoinChannelService({endTs:Date.now(),status:"success"},b),I};try{return p=await tl([m(),S()]),_.length&&_.forEach(y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),p}catch(y){throw y[0]}}(n,t,e,i)}}async function U0(n,t,e,i,s){const a=n.cloudProxyServer;if(a==="disabled"){if(!i)return;if(n.useLocalAccessPoint)return await iT(n,t,e,s);if(x("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:p,proxyInfo:_}=await V0(n,t,e,s);return n.turnServer&&n.turnServer.mode!=="auto"||(n.turnServer={mode:"manual",servers:_.map(m=>({turnServerURL:m.address,tcpport:m.tcpport||Tr.tcpport,udpport:m.udpport||Tr.udpport,username:m.username||Tr.username,password:m.password||Tr.password,forceturn:!1,security:!0}))}),{gatewayInfo:p}}return await iT(n,t,e,s)}const{proxyInfo:d,gatewayInfo:u}=await V0(n,t,e,s),h={gatewayInfo:u};return n.turnServer={mode:"manual",servers:d.map(p=>({turnServerURL:p.address,tcpport:a==="proxy3"?void 0:p.tcpport?p.tcpport:Tr.tcpport,udpport:a==="proxy4"?void 0:p.udpport?p.udpport:Tr.udpport,username:p.username||Tr.username,password:p.password||Tr.password,forceturn:a!=="proxy4",security:a==="proxy5"}))},R.debug("[".concat(n.clientId,"] set proxy server: ").concat(n.proxyServer,", mode: ").concat(a)),h}async function x0(n,t,e,i,s){const a=x("ACCOUNT_REGISTER").slice(0,x("AJAX_REQUEST_CONCURRENT"));let d=[];d=t.proxyServer?a.map(h=>"https://".concat(t.proxyServer,"/ap/?url=").concat(h+"/api/v1")):a.map(h=>"https://".concat(h,"/api/v1"));const u=s==null?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:d});try{const h=await async function(p,_,m,S,y){const b=Date.now(),I={sid:m.sid,opid:10,appid:m.appId,string_uid:_};let A=p[0];const L=await Ns(()=>Vo(A+"".concat(A.indexOf("?")===-1?"?":"&","action=stringuid"),{data:I,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(U,F)=>{if(U.code===0){if(U.uid<=0||U.uid>=Math.pow(2,32))throw R.error("Invalid Uint Uid ".concat(_," => ").concat(U.uid),U),vt.reqUserAccount(I.sid,{lts:b,success:!1,serverAddr:A,stringUid:I.string_uid,uid:U.uid,errorCode:O.INVALID_UINT_UID_FROM_STRING_UID,extend:I}),new B(O.INVALID_UINT_UID_FROM_STRING_UID);return vt.reqUserAccount(I.sid,{lts:b,success:!0,serverAddr:A,stringUid:I.string_uid,uid:U.uid,errorCode:null,extend:I}),!1}const $=Qp(U.code);return $.retry&&(A=p[(F+1)%p.length]),vt.reqUserAccount(I.sid,{lts:b,success:!1,serverAddr:A,stringUid:I.string_uid,uid:U.uid,errorCode:$.desc,extend:I}),$.retry},(U,F)=>U.code!==O.OPERATION_ABORTED&&(vt.reqUserAccount(I.sid,{lts:b,success:!1,serverAddr:A,stringUid:I.string_uid,uid:null,errorCode:U.code,extend:I}),A=p[(F+1)%p.length],!0),y);if(L.code!==0){const U=Qp(L.code);throw new B(O.UNEXPECTED_RESPONSE,U.desc)}return L}(d,n,t,e,i);return s==null||s.recordJoinChannelService({status:"success",endTs:Date.now()},u),h.uid}catch(h){throw s==null||s.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[h]},u),h}}async function Z4(n,t,e){const i=x("CDS_AP").slice(0,x("AJAX_REQUEST_CONCURRENT")).map(u=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(u+"/api/v1"):"https://".concat(u,"/api/v1?action=config")).map(u=>function(h,p,_,m){const S=Se(),y={flag:64,cipher_method:0,features:{device:S.name,system:S.os,system_general:navigator.userAgent,vendor:p.appId,version:jr,cname:p.cname,sid:p.sid,session_id:p.sid,detail:"",proxyServer:p.proxyServer}};return Ns(()=>Vo(h,{data:y,timeout:1e3,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,b=>b.code!==O.OPERATION_ABORTED,m)}(u,n,t,e));let s=null,a=null,d={};try{s=await tl(i)}catch(u){if(u.code===O.OPERATION_ABORTED)throw u;a=u}if(i.forEach(u=>u.cancel()),vt.reportApiInvoke(n.sid,{name:An.REQUEST_CONFIG_DISTRIBUTE,options:{error:a,res:s}}).onSuccess(),s&&s.test_tags)try{d=function(u){if(!u.test_tags)return{};const h=u.test_tags,p=Object.keys(h),_={};return p.forEach(m=>{var S;const y=cS(S=m.slice(4)).call(S),b=JSON.parse(h[m])[1];_[y]=b}),_}(s)}catch{}return d}async function V0(n,t,e,i){const s=x("PROXY_SERVER_TYPE3"),a=(y,b,I)=>{let A=I||s;return Array.isArray(A)&&(A=b%2==0?s[1]:s[0]),"https://".concat(A,"/ap/?url=").concat(y)};let d=null;const u=[],h=async()=>{const y=x("WEBCS_DOMAIN").slice(0,x("AJAX_REQUEST_CONCURRENT")).map((A,L)=>{let U;return U=n.cloudProxyServer==="disabled"&&n.proxyServer?a("".concat(A,"/api/v2/transpond/webrtc?v=2"),L,n.proxyServer):n.cloudProxyServer==="disabled"||n.cloudProxyServer==="fallback"?"https://".concat(A,"/api/v2/transpond/webrtc?v=2"):a("".concat(A,"/api/v2/transpond/webrtc?v=2"),L),{url:U,areaCode:Af(),serviceIds:[Jn.CHOOSE_SERVER,n.cloudProxyServer==="proxy5"?Jn.CLOUD_PROXY_5:n.cloudProxyServer==="proxy3"||n.cloudProxyServer==="proxy4"?Jn.CLOUD_PROXY:Jn.CLOUD_PROXY_FALLBACK]}}),b=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(A=>A.url)}),I=await Fu({fragementLength:x("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:A=>(R.debug("[".concat(n.clientId,"] Connect to choose_server:"),A.url),P0(A,n,t,e)),allFailedhandler:A=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:A},b),A[0]},promisesCollector:u});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},b),I},p=async()=>{if(await si(1e3),d!==null)return d;const y=x("WEBCS_DOMAIN_BACKUP_LIST").map((A,L)=>{let U;return U=n.cloudProxyServer==="disabled"&&n.proxyServer?a("".concat(A,"/api/v2/transpond/webrtc?v=2"),L,n.proxyServer):n.cloudProxyServer==="disabled"||n.cloudProxyServer==="fallback"?"https://".concat(A,"/api/v2/transpond/webrtc?v=2"):a("".concat(A,"/api/v2/transpond/webrtc?v=2"),L),{url:U,areaCode:Af(),serviceIds:[Jn.CHOOSE_SERVER,n.cloudProxyServer==="proxy5"?Jn.CLOUD_PROXY_5:n.cloudProxyServer==="proxy3"||n.cloudProxyServer==="proxy4"?Jn.CLOUD_PROXY:Jn.CLOUD_PROXY_FALLBACK]}}),b=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(A=>A.url)}),I=await Fu({fragementLength:x("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:A=>(R.debug("[".concat(n.clientId,"] Connect to backup choose_server:"),A.url),P0(A,n,t,e)),allFailedhandler:A=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:A},b),A[0]},promisesCollector:u});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},b),I};let _,m,S;try{({gatewayInfo:_,proxyInfo:m,url:S}=await tl([h(),p()]))}catch(y){throw y[0]}if(u.length&&u.forEach(y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),!_||!m)throw new B(O.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(n.apUrl=S,n.cloudProxyServer!=="disabled"&&Array.isArray(s)&&S){const y=/^https?:\/\/(.+?)(\/.*)?$/.exec(S)[1];It(s).call(s,y)&&(n.proxyServer=y,R.setProxyServer(y),vt.setProxyServer(y))}return d={gatewayInfo:_,proxyInfo:await H4(m,_.uid)},d}async function F0(n,t,e,i){const s=x("UAP_AP").slice(0,x("AJAX_REQUEST_CONCURRENT")).map(a=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(a+"/api/v1?action=uap"):"https://".concat(a,"/api/v1?action=uap"));return await X4(s,n,t,e,i)}async function t5(n,t,e){const i=x("UAP_AP").slice(0,x("AJAX_REQUEST_CONCURRENT")).map(s=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(s+"/api/v1?action=uap"):"https://".concat(s,"/api/v1?action=uap")).map(s=>function(a,d,u,h){const p={command:"convergeAllocateEdge",sid:d.sid,appId:d.appId,token:d.token,ts:Date.now(),version:jr,cname:d.cname,uid:d.uid.toString(),requestId:nT,seq:nT};nT+=1;const _={service_name:"tele_channel",json_body:JSON.stringify(p)};return Ns(async()=>{const m=await Vo(a,{data:_,cancelToken:u,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(m.code!==0){const y=new B(O.UNEXPECTED_RESPONSE,"cross channel ap error, code"+m.code,{retry:!0});throw R.error(y.toString()),y}const S=JSON.parse(m.json_body);if(S.code!==200){const y=new B(O.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(S.code,", reason: ").concat(S.reason));throw R.error(y.toString()),y}if(!S.servers||S.servers.length===0){const y=new B(O.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw R.error(y.toString()),y}return{vid:S.vid,workerToken:S.workerToken,addressList:(x("CHANNEL_MEDIA_RELAY_SERVERS")||S.servers).map(y=>"wss://".concat(y.address.replace(/\./g,"-"),".").concat(x("WORKER_DOMAIN"),":").concat(y.wss))}},void 0,m=>!!(m.code!==O.OPERATION_ABORTED&&m.code!==O.UNEXPECTED_RESPONSE||m.data&&m.data.retry),h)}(s,n,t,e));try{const s=await tl(i);return i.forEach(a=>a.cancel()),s}catch(s){throw s[0]}}async function e5(n,t,e){let i=null;const s=[],a=async d=>{const u=x(d?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(h=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(h+"/api/v2/transpond/webrtc?v=2"):"https://".concat(h,"/api/v2/transpond/webrtc?v=2"));return d&&(await si(1e3),i!==null)?i:await Fu({fragementLength:x("FRAGEMENT_LENGTH"),referenceList:u,asyncMapHandler:h=>(R.debug("[".concat(n.clientId,"] update ticket, Connect to ").concat(d?"backup":""," choose_server:"),h),function(p,_,m,S){const[y]=$4(_,[Jn.CHOOSE_SERVER]);let b=Tn.networkState;return Ns(async()=>{b&&Tn.networkState===Ai.OFFLINE&&Tn.onlineWaiter&&await W.race([Tn.onlineWaiter,si(S&&S.maxRetryTimeout||Rn.maxRetryTimeout)]),b=Tn.networkState;const I=await Vo(p,{data:y,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0);return Q4(I,p)},()=>!1,I=>I.code!==O.OPERATION_ABORTED&&(I.code===O.UPDATE_TICKET_FAILED?I.data.retry:(R.warning("[".concat(_.clientId,"] update ticket network error, retry"),I),!0)),S)}(h,n,t,e)),allFailedhandler:h=>{throw h[0]},promisesCollector:s})};try{return i=await tl([a(!1),a(!0)]),s.length&&s.forEach(d=>d.cancel&&typeof d.cancel=="function"&&d.cancel()),i}catch(d){throw d[0]}}function B0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function j0(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?B0(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):B0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class n5 extends Ye{constructor(){super(),g(this,"configs",void 0),g(this,"joinInfo",void 0),g(this,"cancelToken",void 0),g(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),g(this,"interval",void 0),g(this,"mutex",new zn("config-distribute")),g(this,"mutableParamsRead",!1)}startGetConfigDistribute(t,e){this.joinInfo=t,this.cancelToken=e,this.interval&&this.stopGetConfigDistribute(),x("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},x("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,vt.reportApiInvoke(null,{options:void 0,name:An.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Je.TRACER}).onSuccess(JSON.stringify(ha))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void R.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const e=await this.mutex.lock();try{t=await Z4(this.joinInfo,this.cancelToken,this.retryConfig),R.debug("[config-distribute] get config distribute",JSON.stringify(t)),t.limit_bitrate&&this.handleBitrateLimit(t.limit_bitrate),this.cacheGlobalParameterConfig(t),this.configs=t}catch(i){const s=new B(O.NETWORK_RESPONSE_ERROR,i);R.warning("[config-distribute] ".concat(s.toString()))}finally{e()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(t){var e;(e=t)&&e.uplink&&e.id&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==t.id&&this.emit(Eu.UPDATE_BITRATE_LIMIT,t):this.emit(Eu.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&j0({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(t){var e;const i=eu(e=Object.keys(t).filter(a=>/^webrtc_ng_global_parameter/.test(a))).call(e);for(let a=0;a<i.length;a++)for(let d=i.length-1;d>a;d--){const u=i[d];if(typeof t[u].__priority=="number"){const h=t[u].__priority,p=i[d-1];if(typeof t[p].__priority=="number"){if(!(h>t[p].__priority))continue;{const _=u;i[d]=i[d-1],i[d-1]=_}}else{const _=u;i[d]=i[d-1],i[d-1]=_}}}const s={};i.forEach(a=>{const d=t[a],u=d.__expires;Object.keys(d).forEach(h=>{h==="__priority"||h==="__expires"||Object.prototype.hasOwnProperty.call(s,h)||(s[h]=j0({value:d[h]},u&&{expires:u}))})});try{(function(u){try{const h=Date.now();Object.keys(u).forEach(p=>{switch(p){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":if(Object.prototype.hasOwnProperty.call(ki,p)){const{value:_,expires:m}=u[p];if(m&&m<=h)return;ha[p]=_,ki[p]=_,R.debug("Update global parameters from config distribute",p,_)}}})}catch(h){R.error("Error update config immediately: ".concat(u),h.message)}})(s);const a=JSON.stringify(s),d=window.btoa(a);window.localStorage.setItem("websdk_ng_global_parameter",d),R.debug("Caching global parameters ".concat(a))}catch(a){R.error("Error caching global parameters:",a.message)}}}function W0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Bu(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?W0(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):W0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class i5 extends Ye{constructor(t,e,i,s){super(),g(this,"spec",void 0),g(this,"token",void 0),g(this,"websocket",void 0),g(this,"pingpongTimer",void 0),g(this,"reconnectMode","retry"),g(this,"serviceMode",void 0),g(this,"reqId",0),g(this,"commandReqId",0),g(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),g(this,"handleWebSocketMessage",a=>{if(!a.data)return;const d=JSON.parse(a.data);d.requestId?this.emit("@".concat(d.requestId,"-").concat(d.sid),d):this.serviceMode===kn.INJECT?this.emit(ls.INJECT_STREAM_STATUS,d):(vt.workerEvent(this.spec.sid,{actionType:"status",serverCode:d.code,workerType:this.serviceMode===kn.TRANSCODE?1:2}),this.emit(ls.PUBLISH_STREAM_STATUS,d))}),this.spec=e,this.token=t,this.serviceMode=s,this.websocket=new Su("live-streaming",i),this.websocket.on(Bt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Bt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Bt.REQUEST_NEW_URLS,(a,d)=>{tn(this,ls.REQUEST_NEW_ADDRESS).then(a).catch(d)}),this.websocket.on(Bt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,e,i,s){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const a=this.commandReqId,d=this.reqId;if(!d||!this.websocket)throw new B(O.UNEXPECTED_ERROR);const u=Bu({command:t,sdkVersion:jr==="4.19.3"?"0.0.1":jr,seq:d,requestId:d,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},e);if(this.websocket.state==="closed")throw new B(O.WS_DISCONNECT);const h=()=>new W((S,y)=>{this.websocket.once(Bt.CLOSED,()=>y(new B(O.WS_ABORT))),this.websocket.once(Bt.CONNECTED,S)});this.websocket.state!=="connected"&&await h(),u.clientRequest&&(u.clientRequest.workerToken=this.token);const p=new W((S,y)=>{const b=()=>{y(new B(O.WS_ABORT))};this.websocket.once(Bt.RECONNECTING,b),this.websocket.once(Bt.CLOSED,b),this.once("@".concat(d,"-").concat(this.spec.sid),I=>{S(I)})});s&&vt.workerEvent(this.spec.sid,Bu(Bu({},s),{},{requestId:a,actionType:"request",payload:JSON.stringify(e.clientRequest),serverCode:0,code:0}));const _=Date.now();this.websocket.sendMessage(u);let m=null;try{m=await p}catch(S){if(this.websocket.state==="closed")throw S;return await h(),await this.request(t,e,i)}return s&&vt.workerEvent(this.spec.sid,Bu(Bu({},s),{},{requestId:a,actionType:"response",payload:JSON.stringify(m.serverResponse),serverCode:m.code,success:m.code===200,responseTime:Date.now()-_})),m.code!==200&&this.handleResponseError(m),m}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=jr==="4.19.3"?"0.0.1":jr;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case En.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void R.warning("live stream response already exists stream");case En.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case En.LIVE_STREAM_RESPONSE_BAD_STREAM:case En.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new B(O.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case En.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case En.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new B(O.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case En.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const e=new B(O.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(ls.WARNING,e,t.serverResponse.url)}case En.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const e=new B(O.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(ls.WARNING,e,t.serverResponse.url)}case En.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case En.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new B(O.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case En.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const e=new B(O.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(ls.WARNING,e,t.serverResponse.url)}case En.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case En.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case En.LIVE_STREAM_RESPONSE_WORKER_LOST:case En.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case En.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case En.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case En.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case En.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case En.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new B(O.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Lp)},6e3)}}function G0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function ji(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?G0(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):G0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class r5 extends Ye{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Rn,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Rn;super(),g(this,"onLiveStreamWarning",void 0),g(this,"onLiveStreamError",void 0),g(this,"onInjectStatusChange",void 0),g(this,"spec",void 0),g(this,"retryTimeout",1e4),g(this,"connection",void 0),g(this,"httpRetryConfig",void 0),g(this,"wsRetryConfig",void 0),g(this,"streamingTasks",new Map),g(this,"isStartingStreamingTask",!1),g(this,"taskMutex",new zn("live-streaming")),g(this,"cancelToken",qi.CancelToken.source()),g(this,"transcodingConfig",void 0),g(this,"injectConfig",ji({},iH)),g(this,"injectLoopTimes",0),g(this,"uapResponse",void 0),g(this,"lastTaskId",1),g(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=i,this.wsRetryConfig=e}async setTranscodingConfig(t){const e=ji(ji({},nH),t);e.videoCodecProfile!==66&&e.videoCodecProfile!==77&&e.videoCodecProfile!==100&&(R.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(e.videoCodecProfile," -> 100")),e.videoCodecProfile=100),e.transcodingUsers||(e.transcodingUsers=e.userConfigs),e.transcodingUsers&&(e.transcodingUsers=e.transcodingUsers.map(d=>ji(ji(ji({},eH),d),{},{zOrder:d.zOrder?d.zOrder+1:1}))),function(d){Ze(d.width)||Pe(d.width,"config.width",0,1e4),Ze(d.height)||Pe(d.height,"config.height",0,1e4),Ze(d.videoBitrate)||Pe(d.videoBitrate,"config.videoBitrate",1,1e6),Ze(d.videoFrameRate)||Pe(d.videoFrameRate,"config.videoFrameRate"),Ze(d.lowLatency)||gc(d.lowLatency,"config.lowLatency"),Ze(d.audioSampleRate)||Bn(d.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Ze(d.audioBitrate)||Pe(d.audioBitrate,"config.audioBitrate",1,128),Ze(d.audioChannels)||Bn(d.audioChannels,"config.audioChannels",[1,2,3,4,5]),Ze(d.videoGop)||Pe(d.videoGop,"config.videoGop"),Ze(d.videoCodecProfile)||Bn(d.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Ze(d.userCount)||Pe(d.userCount,"config.userCount",0,17),Ze(d.backgroundColor)||Pe(d.backgroundColor,"config.backgroundColor",0,16777215),Ze(d.userConfigExtraInfo)||ai(d.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),d.transcodingUsers&&!Ze(d.transcodingUsers)&&(Oo(d.transcodingUsers,"config.transcodingUsers"),d.transcodingUsers.forEach((u,h)=>{eS(u.uid),Ze(u.x)||Pe(u.x,"transcodingUser[".concat(h,"].x"),0,1e4),Ze(u.y)||Pe(u.y,"transcodingUser[".concat(h,"].y"),0,1e4),Ze(u.width)||Pe(u.width,"transcodingUser[".concat(h,"].width"),0,1e4),Ze(u.height)||Pe(u.height,"transcodingUser[".concat(h,"].height"),0,1e4),Ze(u.zOrder)||Pe(u.zOrder-1,"transcodingUser[".concat(h,"].zOrder"),0,100),Ze(u.alpha)||Pe(u.alpha,"transcodingUser[".concat(h,"].alpha"),0,1,!1)})),Ze(d.watermark)||iS(d.watermark,"watermark"),Ze(d.backgroundImage)||iS(d.backgroundImage,"backgroundImage"),d.images&&!Ze(d.images)&&(Oo(d.images,"config.images"),d.images.forEach((u,h)=>{iS(u,"images[".concat(h,"]"))}))}(e);const i=[];e.images&&i.push(...e.images.map(d=>ji(ji(ji({},nS),d),{},{zOrder:255}))),e.backgroundImage&&(i.push(ji(ji(ji({},nS),e.backgroundImage),{},{zOrder:0})),delete e.backgroundImage),e.watermark&&(i.push(ji(ji(ji({},nS),e.watermark),{},{zOrder:255})),delete e.watermark),e.images=i,e.transcodingUsers&&(e.userConfigs=e.transcodingUsers.map(d=>ji({},d)),e.userCount=e.transcodingUsers.length,delete e.transcodingUsers);const s=(e.userConfigs||[]).map(d=>typeof d.uid=="number"?W.resolve(d.uid):x0(d.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await W.all(s)).forEach((d,u)=>{e.userConfigs&&e.userConfigs[u]&&(e.userConfigs[u].uid=d)}),this.transcodingConfig=e,this.connection)try{var a;const d=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Qs(a=this.streamingTasks).call(a)).map(u=>u.taskId).join("#")});R.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(d.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(d){if(!d.data||!d.data.retry)throw d;d.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(u=>{R.warning("[".concat(this.spec.clientId,"] live streaming receive error"),d.toString(),"try to republish",u.url),this.startLiveStreamingTask(u.url,u.mode,d).then(()=>{R.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(u.url," success"))}).catch(h=>{R.error("[".concat(this.spec.clientId,"] live streaming republish failed"),u.url,h.toString()),this.onLiveStreamError&&this.onLiveStreamError(u.url,h)})})}}setInjectStreamConfig(t,e){this.injectConfig=Object.assign({},this.injectConfig,t),this.injectLoopTimes=e}async startLiveStreamingTask(t,e,i){var s;if(Array.from(Qs(s=this.streamingTasks).call(s)).find(h=>h.mode===kn.INJECT)&&e===kn.INJECT)return new B(O.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&e===kn.TRANSCODE)throw new B(O.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let a={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};R.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(e));const d=await this.taskMutex.lock();if(!this.connection&&i)return void d();if(this.streamingTasks.get(t)&&!i)return d(),new B(O.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(e))}catch(h){throw d(),h}switch(e){case kn.TRANSCODE:a.transcodingConfig=ji({},this.transcodingConfig);break;case kn.RAW:break;case kn.INJECT:a={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:t,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(a.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const u=this.lastTaskId++;try{const h=new W((_,m)=>{si(this.retryTimeout).then(()=>{if(i)return m(i);const S=this.statusError.get(t);return S?(this.statusError.delete(t),m(S)):void 0})}),p=await W.race([this.connection.request("request",{clientRequest:a},!0,{url:t,command:"PublishStream",workerType:e===kn.TRANSCODE?1:2,requestByUser:!i,tid:u.toString()}),h]);this.isStartingStreamingTask=!1,R.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(p.code)),this.streamingTasks.set(t,{clientRequest:a,mode:e,url:t,taskId:u}),d()}catch(h){if(d(),this.isStartingStreamingTask=!1,!h.data||!h.data.retry||i)throw h;return h.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,e,h)):await this.startLiveStreamingTask(t,e,h)}}stopLiveStreamingTask(t){return new W((e,i)=>{const s=this.streamingTasks.get(t);if(!s||!this.connection)return new B(O.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const a=s.mode;s.abortTask=()=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),e()},this.connection.request("request",{clientRequest:{command:a===kn.INJECT?"UninjectStream":"UnpublishStream",url:s.url}},!1,{url:t,command:"UnPublishStream",workerType:a===kn.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(d=>{R.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(d.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&a!==kn.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),e(),a===kn.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(fa.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,t)}).catch(i)})}async controlInjectStream(t,e,i,s){const a=this.streamingTasks.get(t);if(!a||!this.connection||a.mode!==kn.INJECT)throw new B(O.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:t,control:e,audioVolume:i,position:s}})).serverResponse}resetAllTask(){var t;const e=Array.from(Qs(t=this.streamingTasks).call(t));this.terminate();for(const i of e)this.startLiveStreamingTask(i.url,i.mode).catch(s=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,s)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=qi.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new B(O.UNEXPECTED_ERROR,"live streaming connection has already connected");const e=await tn(this,Fd.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=e,this.connection=new i5(e.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(ls.WARNING,(i,s)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(s,i)),this.connection.on(ls.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(ls.INJECT_STREAM_STATUS,i=>this.handleInjectStreamServerStatus(i)),this.connection.on(ls.REQUEST_NEW_ADDRESS,(i,s)=>{if(!this.connection)return s(new B(O.UNEXPECTED_ERROR,"can not get new live streaming address list"));tn(this,Fd.REQUEST_WORKER_MANAGER_LIST,t).then(a=>{this.uapResponse=a,i(a.addressList)}).catch(s)}),await this.connection.init(e.addressList),this.connection}handlePublishStreamServer(t){const e=t.serverStatus&&t.serverStatus.url||"empty_url",i=this.streamingTasks.get(e),s=t.reason;switch(t.code){case En.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case En.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case En.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case En.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const d=new B(O.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(i)return R.error(d.toString()),this.onLiveStreamError&&this.onLiveStreamError(e,d);if(!this.isStartingStreamingTask)return;this.statusError.set(e,d)}case En.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const d=new B(O.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,s);return this.onLiveStreamWarning&&this.onLiveStreamWarning(e,d)}case En.LIVE_STREAM_RESPONSE_WORKER_LOST:case En.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var a;if(!this.connection)return;this.connection.tryNextAddress();const d=Array.from(Qs(a=this.streamingTasks).call(a));for(const u of d)u.abortTask?u.abortTask():(R.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",u.url),this.startLiveStreamingTask(u.url,u.mode,new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{R.debug("[".concat(this.spec.clientId,"] republish live stream success"),u.url)}).catch(h=>{R.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(u.url,h)}));return}}}handleInjectStreamServerStatus(t){const e=Number(t.uid),i=t.serverStatus&&t.serverStatus.url;switch(t.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(fa.INJECT_STREAM_STATUS_START_SUCCESS,e,i));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(fa.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,e,i),void this.streamingTasks.delete(i);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(fa.INJECT_STREAM_STATUS_START_UNAUTHORIZED,e,i),void this.streamingTasks.delete(i);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(fa.INJECT_STREAM_STATUS_BROKEN,e,i),void this.streamingTasks.delete(i);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(fa.INJECT_STREAM_STATUS_START_TIMEOUT,e,i),void this.streamingTasks.delete(i);default:return void R.debug("inject stream server status",t)}}hasUrl(t){return this.streamingTasks.has(t)}}class Df{constructor(){g(this,"destChannelMediaInfos",new Map),g(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){kA(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){kA(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){tS(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function H0(n){if(!(n instanceof Df))return new B(O.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=n.getSrcChannelMediaInfo(),e=n.getDestChannelMediaInfo();if(!t)return new B(O.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(e.size===0)return new B(O.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class s5 extends Ye{constructor(t,e,i){super(),g(this,"ws",void 0),g(this,"requestId",1),g(this,"heartBeatTimer",void 0),g(this,"joinInfo",void 0),g(this,"clientId",void 0),g(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),g(this,"onClose",s=>{this.emit("close"),this.dispose()}),g(this,"onMessage",s=>{const a=JSON.parse(s.data);if(!a||a.command!=="serverResponse"||!a.requestId)return a&&a.command==="serverStatus"&&a.serverStatus&&a.serverStatus.command?(this.emit("status",a.serverStatus),void this.emit(a.serverStatus.command,a.serverStatus)):void 0;this.emit("req_".concat(a.requestId),a)}),this.joinInfo=t,this.clientId=e,this.ws=new Su("cross-channel-".concat(this.clientId),i),this.ws.on(Bt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Bt.CONNECTED,this.onOpen),this.ws.on(Bt.ON_MESSAGE,this.onMessage),this.ws.on(Bt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const e=this.requestId++;return t.requestId=e,t.seq=e,this.ws.sendMessage(t),e}waitStatus(t){return new W((e,i)=>{const s=window.setTimeout(()=>{i(new B(O.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,a=>{window.clearTimeout(s),a.state&&a.state!==0?i(new B(O.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):e(void 0)}),this.once("dispose",()=>{window.clearTimeout(s),i(new B(O.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new B(O.WS_DISCONNECT);const e=()=>new W((d,u)=>{this.ws.once(Bt.CLOSED,()=>u(new B(O.WS_ABORT))),this.ws.once(Bt.CONNECTED,d)});this.ws.state!=="connected"&&await e();const i=this.sendMessage(t),s=new W((d,u)=>{const h=()=>{u(new B(O.WS_ABORT))};this.ws.once(Bt.RECONNECTING,h),this.ws.once(Bt.CLOSED,h),this.once("req_".concat(i),d),si(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(Bt.RECONNECTING,h),this.ws.off(Bt.CLOSED,h),u(new B(O.TIMEOUT,"cross channel ws request timeout"))})}),a=await s;if(!a||a.code!==200)throw new B(O.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(a)));return a}async connect(t){this.ws.removeAllListeners(Bt.REQUEST_NEW_URLS),this.ws.on(Bt.REQUEST_NEW_URLS,e=>{e(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const e=this.requestId++;return t.requestId=e,this.ws.sendMessage(t),e}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class o5 extends Ye{set state(t){t!==this._state&&(t!==Li.RELAY_STATE_FAILURE&&(this.errorCode=_a.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,e,i,s,a){super(),g(this,"joinInfo",void 0),g(this,"sid",void 0),g(this,"clientId",void 0),g(this,"cancelToken",qi.CancelToken.source()),g(this,"workerToken",void 0),g(this,"requestId",0),g(this,"signal",void 0),g(this,"prevChannelMediaConfig",void 0),g(this,"httpRetryConfig",void 0),g(this,"_resolution",void 0),g(this,"_state",Li.RELAY_STATE_IDLE),g(this,"errorCode",_a.RELAY_OK),g(this,"onStatus",d=>{R.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(d))),d&&d.command&&(d.command==="onAudioPacketReceived"&&this.emit("event",Ds.PACKET_RECEIVED_AUDIO_FROM_SRC),d.command==="onVideoPacketReceived"&&this.emit("event",Ds.PACKET_RECEIVED_VIDEO_FROM_SRC),d.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=_a.SRC_TOKEN_EXPIRED,this.state=Li.RELAY_STATE_FAILURE),d.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=_a.DEST_TOKEN_EXPIRED,this.state=Li.RELAY_STATE_FAILURE))}),g(this,"onReconnect",async()=>{R.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Ds.NETWORK_DISCONNECTED),this.state=Li.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(d=>{this.state!==Li.RELAY_STATE_IDLE&&(R.error("auto restart channel media relay failed",d.toString()),this.errorCode=_a.SERVER_CONNECTION_LOST,this.state=Li.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=e,this.sid=wg(),this.signal=new s5(this.joinInfo,this.clientId,i),this.httpRetryConfig=s,this._resolution=a}async startChannelMediaRelay(t){if(this.state!==Li.RELAY_STATE_IDLE)throw new B(O.INVALID_OPERATION);this.state=Li.RELAY_STATE_CONNECTING,await this.connect(),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(e){throw e.data&&e.data.serverResponse&&e.data.serverResponse.command==="SetSourceChannel"?new B(O.CROSS_CHANNEL_FAILED_JOIN_SRC):e.data&&e.data.serverResponse&&e.serverResponse.command==="SetDestChannelStatus"?new B(O.CROSS_CHANNEL_FAILED_JOIN_DEST):e.data&&e.data.serverResponse&&e.serverResponse.command==="StartPacketTransfer"?new B(O.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):e}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Li.RELAY_STATE_RUNNING)throw new B(O.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==Li.RELAY_STATE_RUNNING)throw new B(O.INVALID_OPERATION);const e=this.genMessage(Ei.SetVideoProfile);await this.signal.request(e),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),R.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Li.RELAY_STATE_IDLE,this.dispose()}dispose(){R.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=qi.CancelToken.source(),this.state=Li.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await t5(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",Ds.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const e=this.genMessage(Ei.StopPacketTransfer);await this.signal.request(e),await this.signal.waitStatus("Normal Quit"),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const i=this.genMessage(Ei.SetSdkProfile,t);await this.signal.request(i),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const s=this.genMessage(Ei.SetSourceChannel,t);await this.signal.request(s),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Ds.PACKET_JOINED_SRC_CHANNEL),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const a=this.genMessage(Ei.SetSourceUserId,t);await this.signal.request(a),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const d=this.genMessage(Ei.SetDestChannel,t);await this.signal.request(d),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Ds.PACKET_JOINED_DEST_CHANNEL),R.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const u=this.genMessage(Ei.StartPacketTransfer,t);await this.signal.request(u),this.emit("event",Ds.PACKET_SENT_TO_DEST_CHANNEL),this.state=Li.RELAY_STATE_RUNNING,R.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const e=this.genMessage(Ei.UpdateDestChannel,t);await this.signal.request(e),this.emit("event",Ds.PACKET_UPDATE_DEST_CHANNEL),R.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(Ei.StopPacketTransfer);await this.signal.request(t),R.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,e){const i=[],s=[],a=[];this.requestId+=1;const d={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:jr,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};d.sdkVersion==="4.19.3"&&(d.sdkVersion="0.0.1");let u=null,h=null;switch(t){case Ei.SetSdkProfile:return d.clientRequest={command:"SetSdkProfile",type:"multi_channel"},d;case Ei.SetSourceChannel:if(h=e&&e.getSrcChannelMediaInfo(),!h)throw new B(O.UNEXPECTED_ERROR,"can not find source config");return d.clientRequest={command:"SetSourceChannel",uid:"0",channelName:h.channelName,token:h.token||this.joinInfo.appId},d;case Ei.SetSourceUserId:if(h=e&&e.getSrcChannelMediaInfo(),!h)throw new B(O.UNEXPECTED_ERROR,"can not find source config");return d.clientRequest={command:"SetSourceUserId",uid:h.uid+""},d;case Ei.SetDestChannel:if(u=e&&e.getDestChannelMediaInfo(),!u)throw new B(O.UNEXPECTED_ERROR,"can not find dest config");return u.forEach(p=>{i.push(p.channelName),s.push(p.uid+""),a.push(p.token||this.joinInfo.appId)}),d.clientRequest={command:"SetDestChannel",channelName:i,uid:s,token:a},d;case Ei.StartPacketTransfer:return d.clientRequest={command:"StartPacketTransfer"},d;case Ei.Reconnect:return d.clientRequest={command:"Reconnect"},d;case Ei.StopPacketTransfer:return d.clientRequest={command:"StopPacketTransfer"},d;case Ei.UpdateDestChannel:if(u=e&&e.getDestChannelMediaInfo(),!u)throw new B(O.UNEXPECTED_ERROR,"can not find dest config");return u.forEach(p=>{i.push(p.channelName),s.push(p.uid+""),a.push(p.token||this.joinInfo.appId)}),d.clientRequest={command:"UpdateDestChannel",channelName:i,uid:s,token:a},d;case Ei.SetVideoProfile:d.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return d}}class ui{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,e){g(this,"uid",void 0),g(this,"_uintid",void 0),g(this,"_trust_in_room_",!0),g(this,"_trust_audio_enabled_state_",!0),g(this,"_trust_video_enabled_state_",!0),g(this,"_trust_audio_mute_state_",!0),g(this,"_trust_video_mute_state_",!0),g(this,"_audio_muted_",!1),g(this,"_video_muted_",!1),g(this,"_audio_enabled_",!0),g(this,"_video_enabled_",!0),g(this,"_audio_added_",!1),g(this,"_video_added_",!1),g(this,"_trust_video_stream_added_state_",!0),g(this,"_trust_audio_stream_added_state_",!0),g(this,"_audioTrack",void 0),g(this,"_videoTrack",void 0),g(this,"_dataChannels",[]),g(this,"_audioSSRC",void 0),g(this,"_videoSSRC",void 0),g(this,"_audioOrtc",void 0),g(this,"_videoOrtc",void 0),g(this,"_cname",void 0),g(this,"_rtxSsrcId",void 0),this.uid=t,this._uintid=e}}var a5=tw,c5=qs;mn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var n=c5.f(this);return{promise:n.promise,resolve:n.resolve,reject:n.reject}}});var d5=qs,l5=Id;mn({target:"Promise",stat:!0,forced:!0},{try:function(n){var t=d5.f(this),e=l5(n);return(e.error?t.reject:t.resolve)(e.value),t.promise}});var rT=et(a5),Y0=_d.f("asyncIterator"),u5=et(Y0);function sT(n,t){this.v=n,this.k=t}function ju(n){var t,e;function i(a,d){try{var u=n[a](d),h=u.value,p=h instanceof sT;rT.resolve(p?h.v:h).then(function(_){if(p){var m=a==="return"?"return":"next";if(!h.k||_.done)return i(m,_);_=n[m](_).value}s(u.done?"return":"normal",_)},function(_){i("throw",_)})}catch(_){s("throw",_)}}function s(a,d){switch(a){case"return":t.resolve({value:d,done:!0});break;case"throw":t.reject(d);break;default:t.resolve({value:d,done:!1})}(t=t.next)?i(t.key,t.arg):e=null}this._invoke=function(a,d){return new rT(function(u,h){var p={key:a,arg:d,resolve:u,reject:h,next:null};e?e=e.next=p:(t=e=p,i(a,d))})},typeof n.return!="function"&&(this.return=void 0)}function qr(n){return function(){return new ju(n.apply(this,arguments))}}function Te(n){return new sT(n,0)}function Pf(n){var t={},e=!1;function i(s,a){return e=!0,{done:!1,value:new sT(a=new rT(function(d){d(n[s](a))}),1)}}return t[yd!==void 0&&xI||"@@iterator"]=function(){return this},t.next=function(s){return e?(e=!1,s):i("next",s)},typeof n.throw=="function"&&(t.throw=function(s){if(e)throw e=!1,s;return i("throw",s)}),typeof n.return=="function"&&(t.return=function(s){return e?(e=!1,s):i("return",s)}),t}ju.prototype[typeof yd=="function"&&u5||"@@asyncIterator"]=function(){return this},ju.prototype.next=function(n){return this._invoke("next",n)},ju.prototype.throw=function(n){return this._invoke("throw",n)},ju.prototype.return=function(n){return this._invoke("return",n)};var K0=et(Y0),q0={exports:{}};(function(n,t){n.exports=(()=>{var e={8:(a,d,u)=>{u.r(d),u.d(d,{Parser:()=>$t,Printer:()=>lr,parse:()=>Ht,print:()=>ye});const h=`
`,p="".concat("\r").concat(h),_=" ";let m;function S(lt){return lt>="0"&&lt<="9"}function y(lt){return lt>="!"&&lt<="~"}function b(lt){return y(lt)||lt>=""&&lt<="ÿ"}function I(lt){return lt==="!"||lt>="#"&&lt<="'"||lt>="*"&&lt<="+"||lt>="-"&&lt<="."||lt>="0"&&lt<="9"||lt>="A"&&lt<="Z"||lt>="^"&&lt<="~"}function A(lt){return lt>="1"&&lt<="9"}function L(lt){return lt>="A"&&lt<="Z"||lt>="a"&&lt<="z"}function U(lt){return lt==="d"||lt==="h"||lt==="m"||lt==="s"}function F(lt){return lt>""&&lt<"	"||lt>"\v"&&lt<"\f"||lt>""&&lt<"ÿ"}function $(lt){return L(lt)||S(lt)||lt==="+"||lt==="/"}function z(lt){return S(lt)||L(lt)||lt==="+"||lt==="/"||lt==="-"||lt==="_"}function G(lt){return L(lt)||S(lt)||lt==="+"||lt==="/"}function Y(lt,v){var P=Object.keys(lt);if(Object.getOwnPropertySymbols){var V=Object.getOwnPropertySymbols(lt);v&&(V=V.filter(function(st){return Object.getOwnPropertyDescriptor(lt,st).enumerable})),P.push.apply(P,V)}return P}function q(lt){for(var v=1;v<arguments.length;v++){var P=arguments[v]!=null?arguments[v]:{};v%2?Y(Object(P),!0).forEach(function(V){ut(lt,V,P[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(lt,Object.getOwnPropertyDescriptors(P)):Y(Object(P)).forEach(function(V){Object.defineProperty(lt,V,Object.getOwnPropertyDescriptor(P,V))})}return lt}function ut(lt,v,P){return v in lt?Object.defineProperty(lt,v,{value:P,enumerable:!0,configurable:!0,writable:!0}):lt[v]=P,lt}(function(lt){lt.VERSION="v",lt.ORIGIN="o",lt.SESSION_NAME="s",lt.INFORMATION="i",lt.URI="u",lt.EMAIL="e",lt.PHONE="p",lt.CONNECTION="c",lt.BANDWIDTH="b",lt.TIME="t",lt.REPEAT="r",lt.ZONE_ADJUSTMENTS="z",lt.KEY="k",lt.ATTRIBUTE="a",lt.MEDIA="m"})(m||(m={}));class ct{consumeText(v,P){let V=P;for(;V<v.length;){const st=v[V];if(st==="\0"||st==="\r"||st===h)break;V+=1}if(V-P==0)throw new Error("Invalid text, at ".concat(v));return V}consumeUnicastAddress(v,P,V){return this.consumeTill(v,P,_)}consumeOneOrMore(v,P,V){let st=P;for(;V(v[st]);)st++;if(st-P==0)throw new Error("Invalid rule at ".concat(P,"."));return st}consumeSpace(v,P){if(v[P]===_)return P+1;throw new Error("Invalid space at ".concat(P,"."))}consumeIP4Address(v,P){let V=P;for(let st=0;st<4;st++)if(V=this.consumeDecimalUChar(v,V),st!==3){if(v[V]!==".")throw new Error("Invalid IP4 address.");V++}return V}consumeDecimalUChar(v,P){let V=P;for(let Jt=0;Jt<3&&S(v[V]);Jt++,V++);if(V-P==0)throw new Error("Invalid decimal uchar.");const st=parseInt(v.slice(P,V));if(st>=0&&st<=255)return V;throw new Error("Invalid decimal uchar")}consumeIP6Address(v,P){let V=this.consumeHexpart(v,P);return v[V]===":"&&(V+=1,V=this.consumeIP4Address(v,V)),V}consumeHexpart(v,P){let V=P;if(v[V]===":"&&v[V+1]===":"){V+=2;try{V=this.consumeHexseq(v,V)}catch{}return V}if(V=this.consumeHexseq(v,V),v[V]===":"&&v[V+1]===":"){V+=2;try{V=this.consumeHexseq(v,V)}catch{}return V}return V}consumeHexseq(v,P){let V=P;for(;V=this.consumeHex4(v,V),v[V]===":"&&v[V+1]!==":";)V+=1;return V}consumeHex4(v,P){let V=0;for(;V<4;V++)if(!((st=v[P+V])>="0"&&st<="9"||st>="a"&&st<="f"||st>="A"&&st<="F")){if(V===0)throw new Error("Invalid hex 4");break}var st;return P+V}consumeFQDN(v,P){let V=P;for(;S(v[V])||L(v[V])||v[V]==="-"||v[V]===".";)V+=1;if(V-P<4)throw new Error("Invalid FQDN");return V}consumeExtnAddr(v,P){return this.consumeOneOrMore(v,P,b)}consumeMulticastAddress(v,P,V){switch(V){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(v,P);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(v,P);default:try{return this.consumeFQDN(v,P)}catch{return this.consumeExtnAddr(v,P)}}}consumeIP6MulticastAddress(v,P){const V=this.consumeHexpart(v,P);return v[V]==="/"?this.consumeInteger(v,V+1):V}consumeIP4MulticastAddress(v,P){let V=P+3;const st=v.slice(P,V),Jt=parseInt(st);if(Jt<224||Jt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let je=0;je<3;je++){if(v[V]!==".")throw new Error("Invalid IP4 multicast address.");V+=1,V=this.consumeDecimalUChar(v,V)}return v[V]==="/"&&(V+=1),V=this.consumeTTL(v,V),v[V]==="/"&&(V=this.consumeInteger(v,V)),V}consumeInteger(v,P){if(!A(v[P]))throw new Error("Invalid integer.");for(P+=1;S(v[P]);)P+=1;return P}consumeTTL(v,P){if(v[P]==="0")return P+1;if(!A(v[P]))throw new Error("Invalid TTL.");P+=1;for(let V=0;V<2&&S(v[P]);V++)P+=1;return P}consumeToken(v,P){return this.consumeOneOrMore(v,P,I)}consumeTime(v,P){let V=P;if(v[V]==="0")return V+1;for(A(v[V])&&(V+=1);S(v[V]);)V++;if(V-P<10)throw new Error("Invalid time");return V}consumeAddress(v,P){return this.consumeTill(v,P,_)}consumeTypedTime(v,P){let V=P;return V=this.consumeOneOrMore(v,V,S),U(v[V])?V+1:V}consumeRepeatInterval(v,P){if(!A(v[P]))throw new Error("Invalid repeat interval");for(P+=1;S(v[P]);)P+=1;return U(v[P])&&(P+=1),P}consumePort(v,P){return this.consumeOneOrMore(v,P,S)}consume(v,P,V){for(let st=0;st<V.length;st++){if(P+st>=v.length)throw new Error("consume exceeding value length");if(v[P+st]!==V[st])throw new Error("consume ".concat(V," failed at ").concat(st))}return P+V.length}consumeTill(v,P,V){let st=P;for(;st<v.length&&(typeof V!="string"||v[st]!==V)&&(typeof V!="function"||!V(v[st]));)st++;return st}}class $t extends ct{constructor(){super(),ut(this,"records",[]),ut(this,"currentLine",0)}parse(v){const P=this.probeEOL(v);this.records=v.split(P).filter(Dn=>!!Dn.trim()).map(this.parseLine),this.currentLine=0;const V=this.parseVersion(),st=this.parseOrigin(),Jt=this.parseSessionName(),je=this.parseInformation(),pi=this.parseUri(),ur=this.parseEmail(),Fo=this.parsePhone(),zf=this.parseConnection(),Jf=this.parseBandWidth(),$r=this.parseTimeFields(),ka=this.parseKey(),ol=this.parseSessionAttribute(),pn=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:V,origin:st,sessionName:Jt,information:je,uri:pi,emails:ur,phones:Fo,connection:zf,bandwidths:Jf,timeFields:$r,key:ka,attributes:ol,mediaDescriptions:pn}}getCurrentRecord(){const v=this.records[this.currentLine];if(!v)throw new Error("Record doesn't exit.");return v}probeEOL(v){for(let P=0;P<v.length;P++)if(v[P]===h)return v[P-1]==="\r"?p:h;throw new Error("Invalid newline character.")}parseLine(v,P){if(v.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const V=v[0];if(v[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:V,value:v.slice(2),line:P,cur:0}}parseSessionAttribute(){const v=new sn;for(;this.currentLine<this.records.length;){const P=this.getCurrentRecord();if(P.type!==m.ATTRIBUTE)break;const V={attField:this.extractOneOrMore(P,st=>I(st)&&st!==":"),_cur:0};P.value[P.cur]===":"&&(P.cur+=1,V.attValue=this.extractOneOrMore(P,F)),v.parse(V),this.currentLine++}return v.digest()}parseMediaAttributes(v){const P=new Nn(v);for(;this.currentLine<this.records.length;){const V=this.getCurrentRecord();if(V.type!==m.ATTRIBUTE)break;const st={attField:this.extractOneOrMore(V,Jt=>I(Jt)&&Jt!==":"),_cur:0};V.value[V.cur]===":"&&(V.cur+=1,st.attValue=this.extractOneOrMore(V,F)),P.parse(st),this.currentLine++}return P.digest()}parseKey(){const v=this.getCurrentRecord();if(v.type===m.KEY){if(v.value==="prompt"||v.value==="clear:"||v.value==="base64:"||v.value==="uri:")return v.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const v=this.getCurrentRecord();if(v.type===m.ZONE_ADJUSTMENTS){const P=[];for(;;)try{const V=this.extract(v,this.consumeTime);this.consumeSpaceForRecord(v);let st=!1;v.value[v.cur]==="-"&&(st=!0,v.cur+=1);const Jt=this.extract(v,this.consumeTypedTime);P.push({time:V,typedTime:Jt,back:st})}catch{break}if(P.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,P}return[]}parseRepeat(){const v=[];for(;;){const P=this.getCurrentRecord();if(P.type!==m.REPEAT)break;{const V=this.extract(P,this.consumeRepeatInterval),st=this.parseTypedTime(P);v.push({repeatInterval:V,typedTimes:st}),this.currentLine++}}return v}parseTypedTime(v){const P=[];for(;;)try{this.consumeSpaceForRecord(v),P.push(this.extract(v,this.consumeTypedTime))}catch{break}if(P.length===0)throw new Error("Invalid typed time.");return P}parseTime(){const v=this.getCurrentRecord(),P=this.extract(v,this.consumeTime);this.consumeSpaceForRecord(v);const V=this.extract(v,this.consumeTime);return this.currentLine++,{startTime:P,stopTime:V}}parseBandWidth(){const v=[];for(;this.currentLine<this.records.length;){const P=this.getCurrentRecord();if(P.type!==m.BANDWIDTH)break;{const V=this.extractOneOrMore(P,I);if(P.value[P.cur]!==":")throw new Error("Invalid bandwidth field.");P.cur++;const st=this.extractOneOrMore(P,S);v.push({bwtype:V,bandwidth:st}),this.currentLine++}}return v}parseVersion(){const v=this.getCurrentRecord();if(v.type!==m.VERSION)throw new Error("first sdp record must be version");const P=v.value.slice(0,this.consumeOneOrMore(v.value,0,S));if(P.length!==v.value.length)throw new Error('invalid proto version, "v='.concat(v.value,'"'));return this.currentLine++,P}parseOrigin(){const v=this.getCurrentRecord();if(v.type!==m.ORIGIN)throw new Error("second line of sdp must be origin");const P=this.extractOneOrMore(v,b);this.consumeSpaceForRecord(v);const V=this.extractOneOrMore(v,S);this.consumeSpaceForRecord(v);const st=this.extractOneOrMore(v,S);this.consumeSpaceForRecord(v);const Jt=this.extractOneOrMore(v,I);this.consumeSpaceForRecord(v);const je=this.extractOneOrMore(v,I);this.consumeSpaceForRecord(v);const pi=this.extract(v,this.consumeUnicastAddress);return this.currentLine++,{username:P,sessId:V,sessVersion:st,nettype:Jt,addrtype:je,unicastAddress:pi}}parseSessionName(){const v=this.getCurrentRecord();if(v.type===m.SESSION_NAME){const P=this.extract(v,this.consumeText);return this.currentLine++,P}}parseInformation(){const v=this.getCurrentRecord();if(v.type!==m.INFORMATION)return;const P=this.extract(v,this.consumeText);return this.currentLine++,P}parseUri(){const v=this.getCurrentRecord();if(v.type===m.URI)return this.currentLine++,v.value}parseEmail(){const v=[];for(;;){const P=this.getCurrentRecord();if(P.type!==m.EMAIL)break;v.push(P.value),this.currentLine++}return v}parsePhone(){const v=[];for(;;){const P=this.getCurrentRecord();if(P.type!==m.PHONE)break;v.push(P.value),this.currentLine++}return v}parseConnection(){const v=this.getCurrentRecord();if(v.type===m.CONNECTION){const P=this.extractOneOrMore(v,I);this.consumeSpaceForRecord(v);const V=this.extractOneOrMore(v,I);this.consumeSpaceForRecord(v);const st=this.extract(v,this.consumeAddress);return this.currentLine++,{nettype:P,addrtype:V,address:st}}}parseMedia(){const v=this.getCurrentRecord(),P=this.extract(v,this.consumeToken);this.consumeSpaceForRecord(v);let V=this.extract(v,this.consumePort);v.value[v.cur]==="/"&&(v.cur+=1,V+=this.extract(v,this.consumeInteger)),this.consumeSpaceForRecord(v);const st=[];for(st.push(this.extract(v,this.consumeToken));v.value[v.cur]==="/";)v.cur+=1,st.push(this.extract(v,this.consumeToken));if(st.length===0)throw new Error("Invalid proto");const Jt=this.parseFmt(v);return this.currentLine++,{mediaType:P,port:V,protos:st,fmts:Jt}}parseTimeFields(){const v=[];for(;this.getCurrentRecord().type===m.TIME;){const P=this.parseTime(),V=this.parseRepeat(),st=this.parseZone();v.push({time:P,repeats:V,zones:st})}return v}parseMediaDescription(){const v=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===m.MEDIA;){const P=this.parseMedia(),V=this.parseInformation(),st=this.parseConnections(),Jt=this.parseBandWidth(),je=this.parseKey(),pi=this.parseMediaAttributes(P);v.push({media:P,information:V,connections:st,bandwidths:Jt,key:je,attributes:pi})}return v}parseConnections(){const v=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===m.CONNECTION;)v.push(this.parseConnection());return v}parseFmt(v){const P=[];for(;;)try{this.consumeSpaceForRecord(v),P.push(this.extract(v,this.consumeToken))}catch{break}if(P.length===0)throw new Error("Invalid fmts");return P}extract(v,P,...V){const st=P.call(this,v.value,v.cur,...V),Jt=v.value.slice(v.cur,st);return v.cur=st,Jt}extractOneOrMore(v,P){const V=this.consumeOneOrMore(v.value,v.cur,P),st=v.value.slice(v.cur,V);return v.cur=V,st}consumeSpaceForRecord(v){if(v.value[v.cur]!==_)throw new Error("Invalid space at ".concat(v.cur,"."));v.cur+=1}}class pe extends ct{constructor(...v){super(...v),ut(this,"attributes",void 0),ut(this,"digested",!1)}extractOneOrMore(v,P,V){const st=this.consumeOneOrMore(v.attValue,v._cur,P),Jt=v.attValue.slice(v._cur,st),[je,pi]=V||[];if(typeof je=="number"&&Jt.length<je)throw new Error("error in length, should be more or equal than ".concat(je," characters."));if(typeof pi=="number"&&Jt.length>pi)throw new Error("error in length, should be less or equal than ".concat(pi," characters."));return v._cur=st,Jt}consumeAttributeSpace(v){if(v.attValue[v._cur]!==_)throw new Error("Invalid space at ".concat(v._cur,"."));v._cur+=1}extract(v,P,...V){if(!v.attValue)throw new Error("Nothing to extract from attValue.");const st=P.call(this,v.attValue,v._cur,...V),Jt=v.attValue.slice(v._cur,st);return v._cur=st,Jt}atEnd(v){if(!v.attValue)throw new Error;return v._cur>=v.attValue.length}peekChar(v){if(!v.attValue)throw new Error;return v.attValue[v._cur]}peek(v,P){if(!v.attValue)throw new Error;for(let V=0;V<P.length;V++)if(P[V]!==v.attValue[v._cur+V])return!1;return!0}parseIceUfrag(v){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(v,$,[4,256])}parseIcePwd(v){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(v,$,[22,256])}parseIceOptions(v){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const P=[];for(;!this.atEnd(v);){P.push(this.extractOneOrMore(v,$));try{this.consumeAttributeSpace(v)}catch(V){if(this.atEnd(v))break;throw V}}this.attributes.iceOptions=P}parseFingerprint(v){const P=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v);const V=this.extract(v,this.consumeTill);this.attributes.fingerprints.push({hashFunction:P,fingerprint:V})}parseExtmap(v){const P=this.extractOneOrMore(v,S);let V;this.peekChar(v)==="/"&&(this.extract(v,this.consume,"/"),V=this.extract(v,this.consumeToken)),this.consumeAttributeSpace(v);const st=this.extract(v,this.consumeTill,_),Jt=q(q({entry:parseInt(P,10)},V&&{direction:V}),{},{extensionName:st});this.peekChar(v)===_&&(this.consumeAttributeSpace(v),Jt.extensionAttributes=this.extract(v,this.consumeTill)),this.attributes.extmaps.push(Jt)}parseSetup(v){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const P=this.extract(v,this.consumeTill);if(P!=="active"&&P!=="passive"&&P!=="actpass"&&P!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=P}}class sn extends pe{constructor(...v){super(...v),ut(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(v){if(this.digested)throw new Error("already digested");try{switch(v.attField){case"group":this.parseGroup(v);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(v);break;case"ice-pwd":this.parseIcePwd(v);break;case"ice-options":this.parseIceOptions(v);break;case"fingerprint":this.parseFingerprint(v);break;case"setup":this.parseSetup(v);break;case"tls-id":this.parseTlsId(v);break;case"identity":this.parseIdentity(v);break;case"extmap":this.parseExtmap(v);break;case"msid-semantic":this.parseMsidSemantic(v);break;default:v.ignored=!0,this.attributes.unrecognized.push(v)}}catch(P){throw console.error("parsing session attribute ".concat(v.attField,' error, "a=').concat(v.attField,":").concat(v.attValue,'"')),P}if(!v.ignored&&v.attValue&&!this.atEnd(v))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(v){const P=this.extract(v,this.consumeToken),V=[];for(;!this.atEnd(v)&&this.peekChar(v)===_;)this.consumeAttributeSpace(v),V.push(this.extract(v,this.consumeToken));this.attributes.groups.push({semantic:P,identificationTag:V})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(v){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(v,z)}parseIdentity(v){const P=this.extractOneOrMore(v,G),V=[];for(;!this.atEnd(v)&&this.peekChar(v)===_;){this.consumeAttributeSpace(v);const st=this.extract(v,this.consumeToken);this.extract(v,this.consume,"=");const Jt=this.extractOneOrMore(v,je=>je!==_&&F(je));V.push({name:st,value:Jt})}this.attributes.identities.push({assertionValue:P,extensions:V})}parseMsidSemantic(v){this.peekChar(v)===_&&this.consumeAttributeSpace(v);const P={semantic:this.extract(v,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(v)}catch{break}if(this.peekChar(v)==="*"){this.extract(v,this.consume,"*"),P.applyForAll=!0;break}{const V=this.extract(v,this.consumeTill,_);P.identifierList.push(V)}}this.attributes.msidSemantic=P}}class Nn extends pe{constructor(v){super(),ut(this,"attributes",void 0),v.protos.indexOf("RTP")!==-1||v.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(v){if(this.digested)throw new Error("already digested");try{switch(v.attField){case"extmap":this.parseExtmap(v);break;case"setup":this.parseSetup(v);break;case"ice-ufrag":this.parseIceUfrag(v);break;case"ice-pwd":this.parseIcePwd(v);break;case"ice-options":this.parseIceOptions(v);break;case"candidate":this.parseCandidate(v);break;case"remote-candidate":this.parseRemoteCandidate(v);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(v);break;case"rtpmap":this.parseRtpmap(v);break;case"ptime":this.parsePtime(v);break;case"maxptime":this.parseMaxPtime(v);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(v);break;case"ssrc":this.parseSSRC(v);break;case"fmtp":this.parseFmtp(v);break;case"rtcp-fb":this.parseRtcpFb(v);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(v);break;case"mid":this.parseMid(v);break;case"msid":this.parseMsid(v);break;case"imageattr":this.parseImageAttr(v);break;case"rid":this.parseRid(v);break;case"simulcast":this.parseSimulcast(v);break;case"sctp-port":this.parseSctpPort(v);break;case"max-message-size":this.parseMaxMessageSize(v);break;case"ssrc-group":this.parseSSRCGroup(v);break;default:v.ignored=!0,this.attributes.unrecognized.push(v)}}catch(P){throw console.error("parsing media attribute ".concat(v.attField,' error, "a=').concat(v.attField,":").concat(v.attValue,'"')),P}if(!v.ignored&&v.attValue&&!this.atEnd(v))throw new Error("attribute parsing error")}parseCandidate(v){const P=this.extractOneOrMore(v,$,[1,32]);this.consumeAttributeSpace(v);const V=this.extractOneOrMore(v,S,[1,5]);this.consumeAttributeSpace(v);const st=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v);const Jt=this.extractOneOrMore(v,S,[1,10]);this.consumeAttributeSpace(v);const je=this.extract(v,this.consumeAddress);this.consumeAttributeSpace(v);const pi=this.extract(v,this.consumePort);this.consumeAttributeSpace(v),this.extract(v,this.consume,"typ"),this.consumeAttributeSpace(v);const ur={foundation:P,componentId:V,transport:st,priority:Jt,connectionAddress:je,port:pi,type:this.extract(v,this.consumeToken),extension:{}};for(this.peek(v," raddr")&&(this.extract(v,this.consume," raddr"),this.consumeAttributeSpace(v),ur.relAddr=this.extract(v,this.consumeAddress)),this.peek(v," rport")&&(this.extract(v,this.consume," rport"),this.consumeAttributeSpace(v),ur.relPort=this.extract(v,this.consumePort));this.peekChar(v)===_;){this.consumeAttributeSpace(v);const Fo=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v),ur.extension[Fo]=this.extractOneOrMore(v,y)}this.attributes.candidates.push(ur)}parseRemoteCandidate(v){const P=[];for(;;){const V=this.extractOneOrMore(v,S,[1,5]);this.consumeAttributeSpace(v);const st=this.extract(v,this.consumeAddress);this.consumeAttributeSpace(v);const Jt=this.extract(v,this.consumePort);P.push({componentId:V,connectionAddress:st,port:Jt});try{this.consumeAttributeSpace(v)}catch{break}}this.attributes.remoteCandidatesList.push(P)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(v){const P=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v);const V=this.extract(v,this.consumeTill,"/");this.extract(v,this.consume,"/");const st={encodingName:V,clockRate:this.extractOneOrMore(v,S)};this.atEnd(v)||this.peekChar(v)!=="/"||(this.extract(v,this.consume,"/"),st.encodingParameters=parseInt(this.extract(v,this.consumeTill),10));const Jt=this.attributes.payloads.find(je=>je.payloadType===parseInt(P,10));Jt?Jt.rtpMap=st:this.attributes.payloads.push({payloadType:parseInt(P,10),rtpMap:st,rtcpFeedbacks:[]})}parsePtime(v){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(v,this.consumeTill)}parseMaxPtime(v){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(v,this.consumeTill)}parseDirection(v){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=v.attField}parseSSRC(v){const P=this.extractOneOrMore(v,S);this.consumeAttributeSpace(v);const V=this.extract(v,this.consumeTill,":");let st;this.peekChar(v)===":"&&(this.extract(v,this.consume,":"),st=this.extract(v,this.consumeTill));const Jt=this.attributes.ssrcs.find(je=>je.ssrcId===parseInt(P,10));Jt?Jt.attributes[V]=st:this.attributes.ssrcs.push({ssrcId:parseInt(P,10),attributes:{[V]:st}})}parseFmtp(v){const P=this.extract(v,this.consumeTill,_);this.consumeAttributeSpace(v);const V=this.extract(v,this.consumeTill),st={};V.split(";").forEach(je=>{let[pi,ur]=je.split("=");pi=pi.trim();const Fo=typeof ur=="string"?ur.trim():null;typeof pi=="string"&&pi.length>0&&(st[pi]=Fo)});const Jt=this.attributes.payloads.find(je=>je.payloadType===parseInt(P,10));Jt?Jt.fmtp={parameters:st}:this.attributes.payloads.push({payloadType:parseInt(P,10),rtcpFeedbacks:[],fmtp:{parameters:st}})}parseFmtParameters(v){const P={},V=this.extract(v,this.consumeTill,"=");v._cur++;const st=this.extract(v,this.consumeTill,";");for(P[V]=st;v.attValue[v._cur]===";";){const Jt=this.extract(v,this.consumeTill,"=");v._cur++;const je=this.extract(v,this.consumeTill,";");P[Jt]=je}return P}parseRtcpFb(v){let P="";P=this.peekChar(v)==="*"?this.extract(v,this.consume,"*"):this.extract(v,this.consumeTill,_),this.consumeAttributeSpace(v);const V=this.extract(v,this.consumeTill,_);let st;if(V==="trr-int")st={type:V,interval:this.extract(v,this.consumeTill)};else{const Jt={type:V};this.peekChar(v)===_&&(this.consumeAttributeSpace(v),Jt.parameter=this.extract(v,this.consumeToken),this.peekChar(v)===_&&(Jt.additional=this.extract(v,this.consumeTill))),st=Jt}if(P==="*")this.attributes.rtcpFeedbackWildcards.push(st);else{const Jt=this.attributes.payloads.find(je=>je.payloadType===parseInt(P,10));Jt?Jt.rtcpFeedbacks.push(st):this.attributes.payloads.push({payloadType:parseInt(P,10),rtcpFeedbacks:[st]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(v){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const P={port:this.extract(v,this.consumePort)};this.peekChar(v)===_&&(this.consumeAttributeSpace(v),P.netType=this.extractOneOrMore(v,I),this.consumeAttributeSpace(v),P.addressType=this.extractOneOrMore(v,I),this.consumeAttributeSpace(v),P.address=this.extract(v,this.consumeAddress)),this.attributes.rtcp=P}parseMsid(v){const P={id:this.extractOneOrMore(v,I,[1,64])};this.peekChar(v)===_&&(this.consumeAttributeSpace(v),P.appdata=this.extractOneOrMore(v,I,[1,64])),this.attributes.msids.push(P)}parseImageAttr(v){this.attributes.imageattr.push(v.attValue)}parseRid(v){const P=this.extractOneOrMore(v,st=>L(st)||S(st)||st==="_"||st==="-");this.consumeAttributeSpace(v);const V={id:P,direction:this.extract(v,this.consumeToken),params:[]};if(this.peekChar(v)===_){if(this.consumeAttributeSpace(v),this.peek(v,"pt=")){this.extract(v,this.consume,"pt=");const st=[];for(;;){const Jt=this.extract(v,this.consumeToken);st.push(Jt);try{this.extract(v,this.consume,",")}catch{break}}V.payloads=st,this.peekChar(v)===_&&this.extract(v,this.consume,_)}for(;;){const st=this.extract(v,this.consumeToken);switch(st){case"depend":{const Jt={type:st,rids:this.extract(v,this.consume,"=").split(",")};V.params.push(Jt);break}default:{const Jt={type:st};this.peekChar(v)==="="&&(this.extract(v,this.consume,"="),Jt.val=this.extract(v,this.consumeTill,";")),V.params.push(Jt)}}try{this.extract(v,this.consume,";")}catch{break}}}this.attributes.rids.push(V)}parseSimulcast(v){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=v.attValue,this.extract(v,this.consumeTill)}parseSctpPort(v){this.attributes.sctpPort=this.extractOneOrMore(v,S,[1,5])}parseMaxMessageSize(v){this.attributes.maxMessageSize=this.extractOneOrMore(v,S,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(v){this.attributes.mid=this.extract(v,this.consumeToken)}parseSSRCGroup(v){const P=this.extract(v,this.consumeToken),V=[];for(;;)try{this.consumeAttributeSpace(v);const st=this.extract(v,this.consumeInteger);V.push(parseInt(st,10))}catch{break}this.attributes.ssrcGroups.push({semantic:P,ssrcIds:V})}}function Ge(lt,v,P){return v in lt?Object.defineProperty(lt,v,{value:P,enumerable:!0,configurable:!0,writable:!0}):lt[v]=P,lt}class lr{constructor(){Ge(this,"eol",p)}print(v,P){let V="";return P&&(this.eol=P),V+=this.printVersion(v.version),V+=this.printOrigin(v.origin),V+=this.printSessionName(v.sessionName),V+=this.printInformation(v.information),V+=this.printUri(v.uri),V+=this.printEmail(v.emails),V+=this.printPhone(v.phones),V+=this.printConnection(v.connection),V+=this.printBandwidth(v.bandwidths),V+=this.printTimeFields(v.timeFields),V+=this.printKey(v.key),V+=this.printSessionAttributes(v.attributes),V+=this.printMediaDescription(v.mediaDescriptions),V}printVersion(v){return"v=".concat(v).concat(this.eol)}printOrigin(v){return"o=".concat(v.username," ").concat(v.sessId," ").concat(v.sessVersion," ").concat(v.nettype," ").concat(v.addrtype," ").concat(v.unicastAddress).concat(this.eol)}printSessionName(v){return v?"s=".concat(v).concat(this.eol):""}printInformation(v){return v?"i=".concat(v).concat(this.eol):""}printUri(v){return v?"u=".concat(v).concat(this.eol):""}printEmail(v){let P="";for(const V of v)P+="e=".concat(V).concat(this.eol);return P}printPhone(v){let P="";for(const V of v)P+="e=".concat(V).concat(this.eol);return P}printConnection(v){return v?"c=".concat(v.nettype," ").concat(v.addrtype," ").concat(v.address).concat(this.eol):""}printBandwidth(v){let P="";for(const V of v)P+="b=".concat(V.bwtype,":").concat(V.bandwidth).concat(this.eol);return P}printTimeFields(v){let P="";for(const V of v){P+="t=".concat(V.time.startTime," ").concat(V.time.startTime).concat(this.eol);for(const st of V.repeats)P+="r=".concat(st.repeatInterval," ").concat(st.typedTimes.join(" ")).concat(this.eol);V.zoneAdjustments&&(P+="z=",P+="z=".concat(V.zoneAdjustments.map(st=>"".concat(st.time," ").concat(st.back?"-":""," ").concat(st.typedTime)).join(" ")).concat(this.eol),P+=this.eol)}return P}printKey(v){return v?"k=".concat(v).concat(this.eol):""}printAttributes(v){let P="";for(const V of v)P+="a=".concat(V.attField).concat(V.attValue?":".concat(V.attValue):"").concat(this.eol);return P}printMediaDescription(v){let P="";for(const V of v)P+=this.printMedia(V.media),P+=this.printInformation(V.information),P+=this.printConnections(V.connections),P+=this.printBandwidth(V.bandwidths),P+=this.printKey(V.key),P+=this.printMediaAttributes(V);return P}printConnections(v){let P="";for(const V of v)P+=this.printConnection(V);return P}printMedia(v){return"m=".concat(v.mediaType," ").concat(v.port," ").concat(v.protos.join("/")," ").concat(v.fmts.join(" ")).concat(this.eol)}printSessionAttributes(v){return new ot(this.eol).print(v)}printMediaAttributes(v){return new gt(this.eol).print(v)}}class tt{constructor(v){Ge(this,"eol",void 0),this.eol=v}printIceUfrag(v){return v===void 0?"":"a=ice-ufrag:".concat(v).concat(this.eol)}printIcePwd(v){return v===void 0?"":"a=ice-pwd:".concat(v).concat(this.eol)}printIceOptions(v){return v===void 0?"":"a=ice-options:".concat(v.join(_)).concat(this.eol)}printFingerprints(v){return v.length>0?v.map(P=>"a=fingerprint:".concat(P.hashFunction).concat(_).concat(P.fingerprint)).join(this.eol)+this.eol:""}printExtmap(v){return v.map(P=>"a=extmap:".concat(P.entry).concat(P.direction?"/".concat(P.direction):"").concat(_).concat(P.extensionName).concat(P.extensionAttributes?"".concat(_).concat(P.extensionAttributes):"").concat(this.eol)).join("")}printSetup(v){return v===void 0?"":"a=setup:".concat(v).concat(this.eol)}printUnrecognized(v){return v.map(P=>"a=".concat(P.attField).concat(P.attValue?":".concat(P.attValue):"").concat(this.eol)).join("")}}class ot extends tt{print(v){let P="";return P+=this.printGroups(v.groups),P+=this.printMsidSemantic(v.msidSemantic),P+=this.printIceLite(v.iceLite),P+=this.printIceUfrag(v.iceUfrag),P+=this.printIcePwd(v.icePwd),P+=this.printIceOptions(v.iceOptions),P+=this.printFingerprints(v.fingerprints),P+=this.printSetup(v.setup),P+=this.printTlsId(v.tlsId),P+=this.printIdentity(v.identities),P+=this.printExtmap(v.extmaps),P+=this.printUnrecognized(v.unrecognized),P}printGroups(v){let P="";return v.length>0&&(P+=v.map(V=>"a=group:".concat(V.semantic).concat(V.identificationTag.map(st=>"".concat(_).concat(st)).join("")).concat(this.eol)).join("")),P}printIceLite(v){return v===void 0?"":"a=ice-lite"+this.eol}printTlsId(v){return v?"a=tls-id:".concat(v).concat(this.eol):""}printIdentity(v){return v.length===0?"":v.map(P=>"a=identity:".concat(P.assertionValue).concat(P.extensions.map(V=>"".concat(_).concat(V.name).concat(V.value?"=".concat(V.value):"")))).join(this.eol)+this.eol}printMsidSemantic(v){if(!v)return"";let P="a=msid-semantic:".concat(v.semantic);return v.applyForAll?P+="".concat(_,"*"):v.identifierList.length>0&&(P+=v.identifierList.map(V=>"".concat(_).concat(V))),P+this.eol}}class gt extends tt{print(v){const P=v.attributes;let V="";return V+=this.printRTCP(P.rtcp),V+=this.printIceUfrag(P.iceUfrag),V+=this.printIcePwd(P.icePwd),V+=this.printIceOptions(P.iceOptions),V+=this.printCandidates(P.candidates),V+=this.printRemoteCandidatesList(P.remoteCandidatesList),V+=this.printEndOfCandidates(P.endOfCandidates),V+=this.printFingerprints(P.fingerprints),V+=this.printSetup(P.setup),V+=this.printMid(P.mid),V+=this.printExtmap(P.extmaps),V+=this.printRTPRelated(P),V+=this.printPtime(P.ptime),V+=this.printMaxPtime(P.maxPtime),V+=this.printDirection(P.direction),V+=this.printSSRCGroups(P.ssrcGroups),V+=this.printSSRC(P.ssrcs),V+=this.printRTCPMux(P.rtcpMux),V+=this.printRTCPMuxOnly(P.rtcpMuxOnly),V+=this.printRTCPRsize(P.rtcpRsize),V+=this.printMSId(P.msids),V+=this.printImageattr(P.imageattr),V+=this.printRid(P.rids),V+=this.printSimulcast(P.simulcast),V+=this.printSCTPPort(P.sctpPort),V+=this.printMaxMessageSize(P.maxMessageSize),V+=this.printUnrecognized(P.unrecognized),V}printCandidates(v){return v.map(P=>"a=candidate:".concat(P.foundation).concat(_).concat(P.componentId).concat(_).concat(P.transport).concat(_).concat(P.priority).concat(_).concat(P.connectionAddress).concat(_).concat(P.port).concat(_,"typ").concat(_).concat(P.type).concat(P.relAddr?"".concat(_,"raddr").concat(_).concat(P.relAddr):"").concat(P.relPort?"".concat(_,"rport").concat(_).concat(P.relPort):"").concat(Object.keys(P.extension).map(V=>"".concat(_).concat(V).concat(_).concat(P.extension[V])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(v){return v.map(P=>"a=remote-candidates:".concat(P.join(_)).concat(this.eol)).join("")}printEndOfCandidates(v){return v===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(v){if(!v.payloads)return"";const P=v.payloads;let V="";V+=v.rtcpFeedbackWildcards.map(st=>this.printRTCPFeedback("*",st)).join("");for(const st of P)V+=this.printRtpMap(st.payloadType,st.rtpMap),V+=this.printFmtp(st.payloadType,st.fmtp),V+=st.rtcpFeedbacks.map(Jt=>this.printRTCPFeedback(st.payloadType,Jt)).join("");return V}printFmtp(v,P){if(!P)return"";const V=Object.keys(P.parameters);return V.length===1&&P.parameters[V[0]]===null?"a=fmtp:".concat(v).concat(_).concat(V[0]).concat(this.eol):"a=fmtp:".concat(v).concat(_).concat(Object.keys(P.parameters).map(st=>"".concat(st,"=").concat(P.parameters[st])).join(";")).concat(this.eol)}printRtpMap(v,P){return P?"a=rtpmap:".concat(v).concat(_).concat(P.encodingName,"/").concat(P.clockRate).concat(P.encodingParameters?"/".concat(P.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(v,P){let V="a=rtcp-fb:".concat(v).concat(_),st=P;return st.type==="trr-int"?V+="ttr-int".concat(_).concat(st.interval):(V+="".concat(st.type),st.parameter&&(V+="".concat(_).concat(st.parameter),st.additional&&(V+="".concat(_).concat(st.additional)))),V+this.eol}printPtime(v){return v===void 0?"":"a=ptime:".concat(v).concat(this.eol)}printMaxPtime(v){return v===void 0?"":"a=maxptime:".concat(v).concat(this.eol)}printDirection(v){return v===void 0?"":"a=".concat(v).concat(this.eol)}printSSRC(v){return v.map(P=>Object.keys(P.attributes).map(V=>"a=ssrc:".concat(P.ssrcId.toString(10)).concat(_).concat(V).concat(P.attributes[V]?":".concat(P.attributes[V]):"").concat(this.eol)).join("")).join("")}printRTCPMux(v){return v===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(v){return v===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(v){return v===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(v){if(v===void 0)return"";let P="a=rtcp:".concat(v.port);return v.netType&&(P+="".concat(_).concat(v.netType)),v.addressType&&(P+="".concat(_).concat(v.addressType)),v.address&&(P+="".concat(_).concat(v.address)),P+this.eol}printMSId(v){return v.map(P=>"a=msid:".concat(P.id).concat(P.appdata?"".concat(_).concat(P.appdata):"").concat(this.eol)).join("")}printImageattr(v){return v.map(P=>"a=imageattr:".concat(P).concat(this.eol)).join("")}printRid(v){return v.map(P=>{let V="a=rid:".concat(P.id).concat(_).concat(P.direction);return P.payloads&&(V+="".concat(_,"pt=").concat(P.payloads.join(","))),P.params.length>0&&(V+="".concat(_).concat(P.params.map(st=>st.type==="depend"?"depend=".concat(st.rids.join(",")):"".concat(st.type,"=").concat(st.val)).join(";"))),V+this.eol}).join("")}printSimulcast(v){return v===void 0?"":"a=simulcast:".concat(v).concat(this.eol)}printSCTPPort(v){return v===void 0?"":"a=sctp-port:".concat(v).concat(this.eol)}printMaxMessageSize(v){return v===void 0?"":"a=max-message-size:".concat(v).concat(this.eol)}printMid(v){return v===void 0?"":"a=mid:".concat(v).concat(this.eol)}printSSRCGroups(v){return v.map(P=>"a=ssrc-group:".concat(P.semantic).concat(P.ssrcIds.map(V=>"".concat(_).concat(V.toString(10))).join("")).concat(this.eol)).join("")}}function Ht(lt){return new $t().parse(lt)}function ye(lt,v){return new lr().print(lt,v)}}},i={};function s(a){if(i[a])return i[a].exports;var d=i[a]={exports:{}};return e[a](d,d.exports,s),d.exports}return s.d=(a,d)=>{for(var u in d)s.o(d,u)&&!s.o(a,u)&&Object.defineProperty(a,u,{enumerable:!0,get:d[u]})},s.o=(a,d)=>Object.prototype.hasOwnProperty.call(a,d),s.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},s(8)})()})(q0);var dn=q0.exports;function z0(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function J0(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?z0(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):z0(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}function oT(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:s,filterVideoFec:a,filterAudioFec:d,filterAudioCodec:u,filterVideoCodec:h}=t,{useXR:p}=e;let _=[],m=[],S=[],y=[],b=!1,I=!1;if(dn.parse(n).mediaDescriptions.forEach(L=>{i&&i!==L.attributes.direction||(L.media.mediaType!=="video"||b||(m=L.attributes.payloads,y=L.attributes.extmaps,b=!0),L.media.mediaType!=="audio"||I||(_=L.attributes.payloads,S=L.attributes.extmaps,I=!0))}),!y||m.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!S||_.length===0)throw new Error("Cannot get audio capabilities from SDP.");m.forEach(L=>{var U;(U=L.rtpMap)!==null&&U!==void 0&&U.clockRate&&(L.rtpMap.clockRate=parseInt(L.rtpMap.clockRate)),p&&L.rtcpFeedbacks.push({type:"rrtr"})}),_.forEach(L=>{var U;(U=L.rtpMap)!==null&&U!==void 0&&U.clockRate&&(L.rtpMap.clockRate=parseInt(L.rtpMap.clockRate)),p&&L.rtcpFeedbacks.push({type:"rrtr"})}),s&&(_=_.filter(L=>{var U;return((U=L.rtpMap)===null||U===void 0?void 0:U.encodingName.toLowerCase())!=="rtx"}),m=m.filter(L=>{var U;return((U=L.rtpMap)===null||U===void 0?void 0:U.encodingName.toLowerCase())!=="rtx"})),a&&(m=m.filter(L=>{var U;return!/(red)|(ulpfec)|(flexfec)/i.test(((U=L.rtpMap)===null||U===void 0?void 0:U.encodingName)||"")})),d&&(_=_.filter(L=>{var U;return!/(red)|(ulpfec)|(flexfec)/i.test(((U=L.rtpMap)===null||U===void 0?void 0:U.encodingName)||"")})),u&&(u==null?void 0:u.length)>0&&(_=_.filter(L=>{var U;return It(u).call(u,((U=L.rtpMap)===null||U===void 0?void 0:U.encodingName.toLowerCase())||"")})),h&&(h==null?void 0:h.length)>0&&(m=m.filter(L=>{var U;return It(h).call(h,((U=L.rtpMap)===null||U===void 0?void 0:U.encodingName.toLowerCase())||"")}));const A=x("UNSUPPORTED_VIDEO_CODEC");return A&&A.length>0&&(m=m.filter(L=>!(L.rtpMap&&It(A).call(A,L.rtpMap.encodingName.toLowerCase())))),{audioCodecs:_,videoCodecs:m,audioExtensions:S,videoExtensions:y}}function xc(n){const t=dn.parse(n);let e,i;for(const s of t.mediaDescriptions){if(!e){const a=s.attributes.iceUfrag,d=s.attributes.icePwd;if(!a||!d)throw new Error("Cannot get iceUfrag or icePwd from SDP.");e={iceUfrag:a,icePwd:d}}if(!i){const a=s.attributes.fingerprints;a.length>0&&(i={fingerprints:a})}}if(!i&&t.attributes.fingerprints.length>0&&(i={fingerprints:t.attributes.fingerprints}),!i||!e)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:e,dtlsParameters:i}}function X0(n,t){const e=[],i=n.attributes.ssrcGroups.filter(d=>d.semantic==="FID"),s=n.attributes.ssrcGroups.find(d=>d.semantic==="SIM"),a=n.attributes.ssrcs;if(s)s.ssrcIds.forEach(d=>{var u;const h=(u=i.find(p=>p.ssrcIds[0]===d))===null||u===void 0?void 0:u.ssrcIds[1];e.push({ssrcId:d,rtx:t?h:void 0})});else if(i.length>0){const d=i[0].ssrcIds[0],u=i[0].ssrcIds[1];e.push({ssrcId:d,rtx:t?u:void 0})}else{if(a.length===0)throw new Error("No ssrcs found on local media description.");e.push({ssrcId:a[0].ssrcId})}return e}function Q0(n,t){const{cname:e}=n;let i;t&&t.ip&&typeof t.port=="number"?(i=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],R.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(i.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),R.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):i=n.iceParameters.candidates.map(u=>({foundation:u.foundation,componentId:"1",transport:u.protocol,priority:u.priority.toString(),connectionAddress:u.ip,port:u.port.toString(),type:u.type,extension:{}}));const s={fingerprints:n.dtlsParameters.fingerprints.map(u=>({hashFunction:u.algorithm,fingerprint:u.fingerprint}))},a={iceUfrag:n.iceParameters.iceUfrag,icePwd:n.iceParameters.icePwd};let d;switch(n.dtlsParameters.role){case"server":d="passive";break;case"client":d="active";break;case"auto":d="actpass"}return{dtlsParameters:s,iceParameters:a,candidates:i,rtpCapabilities:Mf(n.rtpCapabilities),setup:d,cname:e}}function zr(n,t,e){const i=[],s=[];return n.forEach(a=>{let{ssrcId:d,rtx:u}=a;const h=Le(8,"track-"),p={ssrcId:d,attributes:J0({label:h,mslabel:e=e||Le(10,""),msid:"".concat(e," ").concat(h)},t&&{cname:t})};if(i.push(p),u!==void 0){const _={ssrcId:u,attributes:J0({label:h,mslabel:e,msid:"".concat(e," ").concat(h)},t&&{cname:t})};i.push(_),s.push({semantic:"FID",ssrcIds:[d,u]})}}),n.length>1&&s.push({semantic:"SIM",ssrcIds:n.map(a=>{let{ssrcId:d}=a;return d})}),{ssrcs:i,ssrcGroups:s}}function Vc(n,t){t instanceof Ie&&n.attributes.payloads.forEach(e=>{var i;const s=(i=e.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!s||["opus","pcmu","pcma","g722"].indexOf(s)===-1)return;e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.minptime="10",e.fmtp.parameters.useinbandfec="1";const a=t._encoderConfig;a&&s!=="pcmu"&&s!=="pcma"&&s!=="g722"&&(a.bitrate&&!We()&&(e.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*a.bitrate))),a.sampleRate&&(e.fmtp.parameters.maxplaybackrate="".concat(a.sampleRate),e.fmtp.parameters["sprop-maxcapturerate"]="".concat(a.sampleRate)),a.stereo&&(e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"))})}function aT(n){const t=n.attributes.unrecognized.findIndex(e=>e.attField==="x-google-flag"&&e.attValue==="conference");t!==-1&&n.attributes.unrecognized.splice(t,1)}function cT(n,t){var e;if(!(t instanceof te&&t._encoderConfig&&t._hints.indexOf(Fe.SCREEN_TRACK)===-1))return;const i=t._encoderConfig;xe().supportMinBitrate&&i.bitrateMin&&n.attributes.payloads.forEach(s=>{var a,d;It(a=["h264","h265","vp8","vp9","av1"]).call(a,((d=s.rtpMap)===null||d===void 0?void 0:d.encodingName.toLowerCase())||"")&&(s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),xe().supportMinBitrate&&!It(e=t._hints).call(e,Fe.LOW_STREAM)&&i.bitrateMax&&n.attributes.payloads.forEach(s=>{var a,d;It(a=["h264","h265","vp8","vp9","av1"]).call(a,((d=s.rtpMap)===null||d===void 0?void 0:d.encodingName.toLowerCase())||"")&&(s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters["x-google-start-bitrate"]="".concat(x("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function $0(n){if(n.media.mediaType!=="video")return;const t=Se();if(t.name!==Ce.SAFARI&&t.os!==Fn.IOS)return;const e=n.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));e!==-1&&n.attributes.extmaps.splice(e,1)}function kf(n,t,e){if(!t)return;let i,s;if(n.media.mediaType==="video"?(i=e.videoExtensions,s=e.videoCodecs):(i=e.audioExtensions,s=e.audioCodecs),t.twcc===!0){const a=i.find(d=>d.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");a&&(n.attributes.extmaps.find(u=>u.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||n.attributes.extmaps.push({entry:a.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(u,h){return h.filter(p=>!!u.find(_=>_.payloadType===p.payloadType&&!!_.rtcpFeedbacks.find(m=>m.type==="transport-cc")))}(s,n.attributes.payloads).forEach(u=>{u.rtcpFeedbacks.find(h=>h.type==="transport-cc")||u.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(t.twcc===!1){const a=n.attributes.extmaps.findIndex(d=>d.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");a!==-1&&n.attributes.extmaps.splice(a,1),n.attributes.payloads.forEach(d=>{const u=d.rtcpFeedbacks.findIndex(h=>h.type==="transport-cc");u!==-1&&d.rtcpFeedbacks.splice(u,1)})}if(t.remb===!0){const a=i.find(d=>d.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");a&&(n.attributes.extmaps.find(u=>u.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||n.attributes.extmaps.push({entry:a.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(u,h){return h.filter(p=>!!u.find(_=>_.payloadType===p.payloadType&&!!_.rtcpFeedbacks.find(m=>m.type==="goog-remb")))}(s,n.attributes.payloads).forEach(u=>{u.rtcpFeedbacks.find(h=>h.type==="goog-remb")||u.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(t.remb===!1){const a=n.attributes.extmaps.findIndex(d=>d.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");a!==-1&&n.attributes.extmaps.splice(a,1),n.attributes.payloads.forEach(d=>{const u=d.rtcpFeedbacks.findIndex(h=>h.type==="goog-remb");u!==-1&&d.rtcpFeedbacks.splice(u,1)})}}function dT(n,t,e){if(We()||n.media.mediaType!=="video"||!(t instanceof te)||e!=="vp9"&&e!=="vp8"||e==="vp8"&&!x("SIMULCAST")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const i=e==="vp8"?2:t._scalabilityMode.numSpatialLayers,s=n.attributes.ssrcs[0],a=n.attributes.ssrcGroups.find(u=>u.semantic==="FID"&&u.ssrcIds[0]===s.ssrcId),d={semantic:"SIM",ssrcIds:[s.ssrcId]};for(let u=1;u<i;u++)n.attributes.ssrcs.push({ssrcId:s.ssrcId+u,attributes:yn(s.attributes)}),d.ssrcIds.push(s.ssrcId+u),a&&(n.attributes.ssrcs.push({ssrcId:a.ssrcIds[1]+u,attributes:yn(s.attributes)}),n.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[s.ssrcId+u,a.ssrcIds[1]+u]}));n.attributes.ssrcGroups.unshift(d)}async function Z0(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{filterRTX:e,filterVideoFec:i,filterAudioFec:s,filterAudioCodec:a,filterVideoCodec:d}=n,{useXR:u}=t,h=new RTCPeerConnection;h.addTransceiver("video",{direction:"sendonly"}),h.addTransceiver("audio",{direction:"sendonly"}),h.addTransceiver("video",{direction:"recvonly"}),h.addTransceiver("audio",{direction:"recvonly"});const p=(await h.createOffer()).sdp,_=oT(p,{filterRTX:e,filterVideoFec:i,filterAudioFec:s,filterAudioCodec:a,filterVideoCodec:d},{useXR:u},"sendonly"),m=oT(p,{filterRTX:e,filterVideoFec:i,filterAudioFec:s,filterAudioCodec:a,filterVideoCodec:d},{useXR:u},"recvonly"),S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Lf(_,m,"videoExtensions",S,y,b),Lf(_,m,"videoCodecs",S,y,b),Lf(_,m,"audioExtensions",S,y,b),Lf(_,m,"audioCodecs",S,y,b),x("RAISE_H264_BASELINE_PRIORITY")){const I=b.videoCodecs.findIndex(A=>{var L,U;return((L=A.rtpMap)===null||L===void 0?void 0:L.encodingName.toLocaleLowerCase())==="h264"&&((U=A.fmtp)===null||U===void 0?void 0:U.parameters["profile-level-id"])==="42001f"});if(I!==-1){const A=b.videoCodecs.findIndex(L=>{var U;return((U=L.rtpMap)===null||U===void 0?void 0:U.encodingName.toLocaleLowerCase())==="h264"});if(A<I){R.debug("raising H264 baseline profile priority");const L=b.videoCodecs[I];b.videoCodecs.splice(I,1),b.videoCodecs.splice(A,0,L)}A!==-1&&(y.videoCodecs=y.videoCodecs.filter(L=>{var U,F;return!(((U=L.rtpMap)===null||U===void 0?void 0:U.encodingName.toLocaleLowerCase())==="h264"&&((F=L.fmtp)===null||F===void 0?void 0:F.parameters["profile-level-id"])!=="42001f")})),A!==-1&&x("FILTER_SEND_H264_BASELINE")&&(S.videoCodecs=S.videoCodecs.filter(L=>{var U,F;return!(((U=L.rtpMap)===null||U===void 0?void 0:U.encodingName.toLocaleLowerCase())==="h264"&&((F=L.fmtp)===null||F===void 0?void 0:F.parameters["profile-level-id"])!=="42001f")}))}}try{h.close()}catch{}return{send:S,recv:y,sendrecv:b}}function Lf(n,t,e,i,s,a){if(e==="videoExtensions"||e==="audioExtensions"){const d=[];return n[e].forEach(u=>{t[e].some((h,p)=>{if(u.entry===h.entry&&u.extensionName===h.extensionName)return d.push(p),!0})?a[e].push(u):i[e].push(u)}),void t[e].forEach((u,h)=>{d.indexOf(h)===-1&&s[e].push(u)})}if(e==="videoCodecs"||e==="audioCodecs"){const d=[];return n[e].forEach(u=>{t[e].some((h,p)=>{if(u.payloadType===h.payloadType&&JSON.stringify(u)===JSON.stringify(h))return d.push(p),!0})?a[e].push(u):i[e].push(u)}),void t[e].forEach((u,h)=>{d.indexOf(h)===-1&&s[e].push(u)})}}function Mf(n){const{send:t,recv:e,sendrecv:i}=n;if(!i){if(!t||!e)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:e}}let s,a;return t?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...t.audioCodecs,...i.audioCodecs],s.videoCodecs=[...t.videoCodecs,...i.videoCodecs],s.audioExtensions=[...t.audioExtensions,...i.audioExtensions],s.videoExtensions=[...t.videoExtensions,...i.videoExtensions]):s=i,e?(a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a.audioCodecs=[...e.audioCodecs,...i.audioCodecs],a.videoCodecs=[...e.videoCodecs,...i.videoCodecs],a.audioExtensions=[...e.audioExtensions,...i.audioExtensions],a.videoExtensions=[...e.videoExtensions,...i.videoExtensions]):a=i,{send:s,recv:a}}function wa(n){n.media.mediaType==="audio"&&n.attributes.payloads.filter(t=>{var e;return((e=t.rtpMap)===null||e===void 0?void 0:e.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function Uf(n){n.mediaDescriptions.forEach(t=>{t.media.mediaType!=="video"&&t.media.mediaType!=="audio"||t.attributes.payloads.forEach(e=>{e.rtcpFeedbacks.findIndex(i=>i.type==="rrtr")===-1&&e.rtcpFeedbacks.push({type:"rrtr"})})})}function xf(n,t,e,i){let s=[];if(n===mt.VIDEO){if(x("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(s=t.videoCodecs.filter(a=>{var d;return It(d=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(d,i)&&a&&a.fmtp&&a.fmtp.parameters["profile-level-id"]===x("H264_PROFILE_LEVEL_ID")})),!Array.isArray(s)||s.length===0){const a=e.videoCodecs.filter(d=>{var u;return It(u=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(u,i)});a.length!==0&&(s=t.videoCodecs.filter(d=>a.some(u=>u.payloadType===d.payloadType)))}if(x("USE_PUB_RTX")){const a=s.map(u=>u.payloadType.toString()),d=t.videoCodecs.filter(u=>u.rtpMap&&u.rtpMap.encodingName==="rtx"&&It(a).call(a,u.fmtp&&u.fmtp.parameters.apt||""));s=[...s,...d]}s.length===0&&(R.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),s=t.videoCodecs)}else s=t.audioCodecs.filter(a=>{var d;return It(d=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(d,i)}),s.length===0&&(R.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),s=t.audioCodecs.filter(a=>{var d;return It(d=a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").call(d,"opus")}));return s}function tN(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function eN(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?tN(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):tN(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}function ms(n){if(Array.isArray(n))return n.map(e=>e);if(!nN(n))return n;const t={};for(const e in n){const i=n[e];nN(i)||Array.isArray(i)?t[e]=ms(i):t[e]=i}return t}function nN(n){return!(typeof n!="object"||Array.isArray(n)||!n)}class lT{constructor(t){g(this,"input",[]),g(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const oo={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Wu={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:oo,remoteCandidate:oo}},iN={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},rN={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},sN={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},oN={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function aN(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function cN(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?aN(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):aN(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class uT{constructor(t,e){g(this,"onFirstVideoReceived",void 0),g(this,"onFirstVideoDecoded",void 0),g(this,"onFirstAudioReceived",void 0),g(this,"onFirstVideoDecodedTimeout",void 0),g(this,"onFirstAudioDecoded",void 0),g(this,"onSelectedLocalCandidateChanged",void 0),g(this,"onSelectedRemoteCandidateChanged",void 0),g(this,"videoIsReady",!1),g(this,"videoIsReady2",{}),g(this,"pc",void 0),g(this,"options",void 0),g(this,"intervalTimer",void 0),g(this,"stats",ms(Wu)),g(this,"isFirstVideoReceived",{}),g(this,"isFirstVideoDecoded",{}),g(this,"isFirstAudioReceived",{}),g(this,"isFirstAudioDecoded",{}),g(this,"isFirstVideoDecodedTimeout",{}),g(this,"lossRateWindowStats",[]),this.pc=t,this.options=e,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new W(t=>{t({local:cN({},oo),remote:cN({},oo)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,e){this.videoIsReady2[t]=e}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const e=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let s=0,a=0,d=0,u=0;for(const h of i)t[h].forEach((p,_)=>{if(!this.lossRateWindowStats[e-1][h][_]||!this.lossRateWindowStats[0][h][_])return;const m=this.lossRateWindowStats[e-1][h][_].packets-this.lossRateWindowStats[0][h][_].packets,S=this.lossRateWindowStats[e-1][h][_].packetsLost-this.lossRateWindowStats[0][h][_].packetsLost;h==="videoSend"||h==="audioSend"?(s+=m,d+=S):(a+=m,u+=S),Number.isNaN(m)||Number.isNaN(m)?p.packetLostRate=0:p.packetLostRate=m<=0||S<=0?0:S/(m+S)});t.sendPacketLossRate=s<=0||d<=0?0:d/(s+d),t.recvPacketLossRate=a<=0||u<=0?0:u/(a+u)}}function dN(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function h5(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?dN(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):dN(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class p5 extends uT{constructor(){super(...arguments),g(this,"_stats",Wu),g(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),e=this.statsResponsesToObjects(t);this._stats=ms(Wu);const i=e.filter(a=>a.type==="ssrc");this.processSSRCStats(i);const s=e.find(a=>a.type==="VideoBwe");s&&this.processBandwidthStats(s),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(e=>{var i;const s=It(i=e.id).call(i,"send");switch("".concat(e.mediaType,"_").concat(s?"send":"recv")){case"video_send":{const a=ms(rN);a.codec=e.googCodecName,a.adaptionChangeReason="none",e.googCpuLimitedResolution&&(a.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(a.adaptionChangeReason="bandwidth"),a.avgEncodeMs=Number(e.googAvgEncodeMs),a.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},a.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},a.firsCount=Number(e.googFirReceived),a.nacksCount=Number(e.googNacksReceived),a.plisCount=Number(e.googPlisReceived),a.frameCount=Number(e.framesEncoded),a.bytes=Number(e.bytesSent),a.packets=Number(e.packetsSent),a.packetsLost=Number(e.packetsLost),a.ssrc=Number(e.ssrc),a.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(a),this._stats.rtt=a.rttMs;break}case"video_recv":{const a=ms(iN),d=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(a.codec=e.googCodecName,a.targetDelayMs=Number(e.googTargetDelayMs),a.renderDelayMs=Number(e.googRenderDelayMs),a.currentDelayMs=Number(e.googCurrentDelayMs),a.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),a.decodeMs=Number(e.googDecodeMs),a.maxDecodeMs=Number(e.googMaxDecodeMs),a.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},a.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},a.decodeFrameRate=Number(e.googFrameRateDecoded),a.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},a.jitterBufferMs=Number(e.googJitterBufferMs),a.firsCount=Number(e.googFirsSent),a.nacksCount=Number(e.googNacksSent),a.plisCount=Number(e.googPlisSent),a.framesDecodeCount=Number(e.framesDecoded),a.bytes=Number(e.bytesReceived),a.packets=Number(e.packetsReceived),a.packetsLost=Number(e.packetsLost),a.ssrc=Number(e.ssrc),a.packets>0&&!this.isFirstVideoReceived[a.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(a.ssrc),this.isFirstVideoReceived[a.ssrc]=!0),a.framesDecodeCount>0&&!this.isFirstVideoDecoded[a.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(a.ssrc,a.decodedFrame.width,a.decodedFrame.height),this.isFirstVideoDecoded[a.ssrc]=!0),d){const u=d.stats,h=Date.now()-d.lts;a.framesDecodeFreezeTime=u.framesDecodeFreezeTime,a.framesDecodeInterval=u.framesDecodeInterval,a.framesDecodeCount>u.framesDecodeCount&&this.isFirstVideoDecoded[a.ssrc]?(d.lts=Date.now(),a.framesDecodeInterval=h,a.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?a.framesDecodeFreezeTime+=a.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):a.framesDecodeCount<d.stats.framesDecodeCount&&(a.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(a.ssrc,{stats:h5({},a),lts:Date.now()}),this._stats.videoRecv.push(a);break}case"audio_recv":{const a=ms(oN);a.codec=e.googCodecName,a.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,a.decodingCNG=Number(e.googDecodingCNG),a.decodingCTN=Number(e.googDecodingCTN),a.decodingCTSG=Number(e.googDecodingCTSG),a.decodingNormal=Number(e.googDecodingNormal),a.decodingPLC=Number(e.googDecodingPLC),a.decodingPLCCNG=Number(e.googDecodingPLCCNG),a.expandRate=Number(e.googExpandRate),a.accelerateRate=Number(e.googAccelerateRate),a.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),a.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),a.speechExpandRate=Number(e.googSpeechExpandRate),a.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),a.jitterBufferMs=Number(e.googJitterBufferMs),a.jitterMs=Number(e.googJitterReceived),a.bytes=Number(e.bytesReceived),a.packets=Number(e.packetsReceived),a.packetsLost=Number(e.packetsLost),a.ssrc=Number(e.ssrc),a.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),a.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),a.receivedFrames>0&&!this.isFirstAudioReceived[a.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(a.ssrc),this.isFirstAudioReceived[a.ssrc]=!0),a.decodingNormal>0&&!this.isFirstAudioDecoded[a.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(a.ssrc),this.isFirstAudioDecoded[a.ssrc]=!0),this._stats.audioRecv.push(a);break}case"audio_send":{const a=ms(sN);a.codec=e.googCodecName,a.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,a.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),a.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),a.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),a.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),a.bytes=Number(e.bytesSent),a.packets=Number(e.packetsSent),a.packetsLost=Number(e.packetsLost),a.ssrc=Number(e.ssrc),a.rttMs=Number(e.googRtt||0),this._stats.rtt=a.rttMs,this._stats.audioSend.push(a);break}}})}_getStats(){return new W((t,e)=>{this.pc.getStats(t,e)})}statsResponsesToObjects(t){const e=[];return t.result().forEach(i=>{const s={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(a=>{s[a]=i.stat(a)}),e.push(s)}),e}}function lN(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Fc(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?lN(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):lN(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class uN extends uT{constructor(){super(...arguments),g(this,"_stats",Wu),g(this,"report",void 0),g(this,"lastDecodeVideoReceiverStats",new Map),g(this,"lastVideoFramesRecv",new Map),g(this,"lastVideoFramesSent",new Map),g(this,"lastVideoFramesDecode",new Map),g(this,"lastVideoJBDelay",new Map),g(this,"lastAudioJBDelay",new Map),g(this,"mediaBytesSent",new Map),g(this,"mediaBytesRetransmit",new Map),g(this,"mediaBytesTargetEncode",new Map),g(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=ms(Wu),this.report.forEach(t=>{switch(t.type){case zi.OUTBOUND:case zi.INBOUND:{const e=t.mediaType||t.kind,i=!e&&"frameWidth"in t,s=!e&&!("frameWidth"in t);t.type===zi.OUTBOUND?e==="audio"||s?this.processAudioOutboundStats(t):(e==="video"||i)&&this.processVideoOutboundStats(t):t.type===zi.INBOUND&&(e==="audio"||s?this.processAudioInboundStats(t):(e==="video"||i)&&this.processVideoInboundStats(t));break}case zi.TRANSPORT:{const e=this.report.get(t.selectedCandidatePairId);e&&this.processCandidatePairStats(e);break}case zi.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),e={local:Fc({},oo),remote:Fc({},oo)};return t.forEach(i=>{let s;if(i.type===zi.TRANSPORT&&(s=t.get(i.selectedCandidatePairId)),i.type===zi.CANDIDATE_PAIR&&i.selected&&(s=i),s){const a=(d,u)=>{d.type=u.type,d.id=u.id,u.address&&(d.address=u.address),u.candidateType&&(d.candidateType=u.candidateType),u.port&&(d.port=u.port),u.priority&&(d.priority=u.priority),u.protocol&&(d.protocol=u.protocol),u.relayProtocol&&(d.relayProtocol=u.relayProtocol)};if(s.localCandidateId){const d=t.get(s.localCandidateId);d&&a(e.local,d)}if(s.remoteCandidateId){const d=t.get(s.remoteCandidateId);d&&a(e.remote,d)}}}),e}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const e=this.report.get(t.localCandidateId);e&&this.processCandidateStats(e)}if(t.remoteCandidateId){const e=this.report.get(t.remoteCandidateId);e&&this.processCandidateStats(e)}}processCandidateStats(t){let e;t.type===zi.LOCAL_CANDIDATE&&(e=this._stats.selectedCandidatePair.localCandidate),t.type===zi.REMOTE_CANDIDATE&&(e=this._stats.selectedCandidatePair.remoteCandidate),e&&(e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol),t.type===zi.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==e.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Fc({},e),Fc({},this.stats.selectedCandidatePair.localCandidate)),t.type===zi.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==e.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Fc({},e),Fc({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let e=this._stats.audioRecv.find(i=>i.ssrc===t.ssrc);e||(e=ms(oN),this._stats.audioRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.bytes=t.bytesReceived,e.jitterMs=1e3*t.jitter,this.processAudioTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),e.receivedFrames||(e.receivedFrames=t.packetsReceived),e.droppedFrames||(e.droppedFrames=t.packetsLost),e.receivedFrames>0&&!this.isFirstAudioReceived[e.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(e.ssrc),this.isFirstAudioReceived[e.ssrc]=!0),e.outputLevel&&e.outputLevel>0&&!this.isFirstAudioDecoded[e.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(e.ssrc),this.isFirstAudioDecoded[e.ssrc]=!0),typeof t.concealedSamples=="number"&&(e.concealedSamples=t.concealedSamples)}processVideoInboundStats(t){let e=this._stats.videoRecv.find(d=>d.ssrc===t.ssrc);e||(e=ms(iN),this._stats.videoRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.bytes=t.bytesReceived,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.framesDecodeCount=t.framesDecoded,e.totalInterFrameDelay=t.totalInterFrameDelay,e.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay;const i=this.lastDecodeVideoReceiverStats.get(e.ssrc),s=this.lastVideoFramesDecode.get(e.ssrc),a=Date.now();if(e.framesDecodeCount>0&&!this.isFirstVideoDecoded[e.ssrc]){const d=e.decodedFrame?e.decodedFrame.width:0,u=e.decodedFrame?e.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(e.ssrc,d,u),this.isFirstVideoDecoded[e.ssrc]=!0}if(i){const d=i.stats,u=a-i.lts;e.framesDecodeFreezeTime=d.framesDecodeFreezeTime,e.framesDecodeInterval=d.framesDecodeInterval,!this.isFirstVideoDecoded[e.ssrc]&&u>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[e.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(e.ssrc),this.isFirstVideoDecodedTimeout[e.ssrc]=!0),e.framesDecodeCount>d.framesDecodeCount&&this.isFirstVideoDecoded[e.ssrc]?(i.lts=Date.now(),e.framesDecodeInterval=u,e.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?e.framesDecodeFreezeTime+=e.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):e.framesDecodeCount<d.framesDecodeCount&&(e.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(i.stats.framesDecodeCount>t.framesDecoded?e.qpSumPerFrame=t.qpSum/t.framesDecoded:e.qpSumPerFrame=(t.qpSum-i.qpSum)/(t.framesDecoded-i.stats.framesDecodeCount))}s&&a-s.lts>=800?(e.decodeFrameRate=Math.round((e.framesDecodeCount-s.count)/((a-s.lts)/1e3)),this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:a,rate:e.decodeFrameRate})):s?e.decodeFrameRate=s.rate:this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:a,rate:0}),t.totalDecodeTime&&(e.decodeMs=1e3*t.totalDecodeTime),this.processVideoTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(e.framesRateFirefox=t.framerateMean),e.packets>0&&!this.isFirstVideoReceived[e.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(e.ssrc),this.isFirstVideoReceived[e.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(e.ssrc,{stats:Fc({},e),lts:i?i.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let e=this._stats.videoSend.find(s=>s.ssrc===t.ssrc);e||(e=ms(rN),this._stats.videoSend.push(e));const i=this.mediaBytesSent.get(t.ssrc);if(i)i.add(t.bytesSent);else{const s=new lT(10);s.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,s)}if(t.retransmittedBytesSent!==void 0){const s=this.mediaBytesRetransmit.get(t.ssrc);if(s)s.add(t.retransmittedBytesSent);else{const a=new lT(10);a.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,a)}}if(t.totalEncodedBytesTarget){const s=this.mediaBytesTargetEncode.get(t.ssrc);if(s)s.add(t.totalEncodedBytesTarget);else{const a=new lT(10);a.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,a)}}if(e.ssrc=t.ssrc,e.bytes=t.bytesSent,e.packets=t.packetsSent,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.frameCount=t.framesEncoded,e.adaptionChangeReason=t.qualityLimitationReason,e.scalabilityMode=t.scalabilityMode,t.totalEncodeTime&&t.framesEncoded){const s=this.lastEncoderMs.get(t.ssrc);if(!s||s.lastFrameCount>t.framesEncoded)e.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const a=t.framesEncoded-s.lastFrameCount,d=t.totalEncodeTime-s.lastEncoderTime;e.avgEncodeMs=1e3*d/a}}if(t.framesEncoded&&t.qpSum){const s=this.lastEncoderMs.get(t.ssrc);!s||s.lastFrameCount>t.framesEncoded?e.qpSumPerFrame=t.qpSum/t.framesEncoded:e.qpSumPerFrame=(t.qpSum-s.lastQpSum)/(t.framesEncoded-s.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,e),this.processVideoTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const s=this.findRemoteStatsId(t.ssrc,zi.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,e)}}processAudioOutboundStats(t){let e=this._stats.audioSend.find(i=>i.ssrc===t.ssrc);if(e||(e=ms(sN),this._stats.audioSend.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsSent,e.bytes=t.bytesSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const i=this.findRemoteStatsId(t.ssrc,zi.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,e)}}findRemoteStatsId(t,e){var i;const s=Array.from(Qs(i=this.report).call(i)).find(a=>a.type===e&&a.ssrc===t);return s?s.id:null}processVideoMediaSource(t,e){const i=this.report.get(t);i&&i.width&&i.height&&i.framesPerSecond&&(e.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(t,e){const i=this.report.get(t);i&&(e.inputLevel=i.audioLevel)}processVideoTrackSenderStats(t,e,i){var s,a,d,u;const h=e?this.report.get(e):void 0,p=(s=h==null?void 0:h.framesSent)!==null&&s!==void 0?s:t.framesSent;if(typeof p!="number")return;let _=(a=h==null?void 0:h.frameWidth)!==null&&a!==void 0?a:t.frameWidth,m=(d=h==null?void 0:h.frameHeight)!==null&&d!==void 0?d:t.frameHeight,S=(u=h==null?void 0:h.framesPerSecond)!==null&&u!==void 0?u:t.framesPerSecond;if(typeof _=="number"&&typeof m=="number"||(_=0,m=0),S==null){const y=Date.now(),b=this.lastVideoFramesSent.get(i.ssrc);b&&y-b.lts>=800?(S=Math.round((p-b.count)/((y-b.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:p,lts:y,rate:S})):b?S=b.rate:this.lastVideoFramesSent.set(i.ssrc,{count:p,lts:y,rate:0})}i.sentFrame={width:_,height:m,frameRate:Math.max(0,S)}}processVideoTrackReceiverStats(t,e,i){var s,a,d,u,h;const p=e?this.report.get(e):void 0,_=(s=p==null?void 0:p.framesReceived)!==null&&s!==void 0?s:t.framesReceived,m=(a=p==null?void 0:p.frameWidth)!==null&&a!==void 0?a:t.frameWidth,S=(d=p==null?void 0:p.frameHeight)!==null&&d!==void 0?d:t.frameHeight,y=(u=p==null?void 0:p.jitterBufferDelay)!==null&&u!==void 0?u:t.jitterBufferDelay,b=(h=p==null?void 0:p.jitterBufferEmittedCount)!==null&&h!==void 0?h:t.jitterBufferEmittedCount;if(typeof _=="number"){const I=this.lastVideoFramesRecv.get(i.ssrc),A=Date.now();i.framesReceivedCount=_;let L=0;I&&A-I.lts>=800?(L=Math.round((_-I.count)/((A-I.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:_,lts:A,rate:L})):I?L=I.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:_,lts:A,rate:0}),i.receivedFrame={width:m||0,height:S||0,frameRate:L||0},i.decodedFrame={width:m||0,height:S||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:m||0,height:S||0,frameRate:i.decodeFrameRate||0}}if(y&&b){const I=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let A=I.jitterBufferMs;const L=b-I.jitterBufferEmittedCount;L>0&&(A=1e3*(y-I.jitterBufferDelay)/L),i.jitterBufferMs=A,i.currentDelayMs=Math.round(A),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:y,jitterBufferEmittedCount:b,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(t,e,i){var s,a,d,u;const h=e?this.report.get(e):void 0,p=(s=(a=h==null?void 0:h.echoReturnLoss)!==null&&a!==void 0?a:t.echoReturnLoss)!==null&&s!==void 0?s:0,_=(d=(u=h==null?void 0:h.echoReturnLossEnhancement)!==null&&u!==void 0?u:t.echoReturnLossEnhancement)!==null&&d!==void 0?d:0;i.aecReturnLoss=p,i.aecReturnLossEnhancement=_}processAudioTrackReceiverStats(t,e,i){var s,a,d,u,h,p,_;const m=e?this.report.get(e):void 0,S=(s=m==null?void 0:m.removedSamplesForAcceleration)!==null&&s!==void 0?s:t.removedSamplesForAcceleration,y=(a=m==null?void 0:m.totalSamplesReceived)!==null&&a!==void 0?a:t.totalSamplesReceived,b=(d=m==null?void 0:m.jitterBufferDelay)!==null&&d!==void 0?d:t.jitterBufferDelay,I=(u=m==null?void 0:m.jitterBufferEmittedCount)!==null&&u!==void 0?u:t.jitterBufferEmittedCount,A=(h=m==null?void 0:m.audioLevel)!==null&&h!==void 0?h:t==null?void 0:t.audioLevel,L=(p=m==null?void 0:m.totalSamplesDuration)!==null&&p!==void 0?p:t==null?void 0:t.totalSamplesDuration,U=(_=m==null?void 0:m.concealedSamples)!==null&&_!==void 0?_:t.concealedSamples;if(S&&y&&(i.accelerateRate=S/y),b&&I){const $=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let z=$.jitterBufferMs;const G=I-$.jitterBufferEmittedCount;G>0&&(z=1e3*(b-$.jitterBufferDelay)/G),i.jitterBufferMs=Math.round(z),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:b,jitterBufferEmittedCount:I,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=A;let F=1920;L&&y&&(F=y/L/50,i.receivedFrames=Math.round(y/F)),U&&(i.droppedFrames=Math.round(U/F))}processRemoteInboundStats(t,e){const i=this.report.get(t);i&&(e.packetsLost=i.packetsLost,i.roundTripTime&&(e.rttMs=1e3*i.roundTripTime),i.jitter&&(e.jitterMs=1e3*i.jitter),i.timestamp&&(e.timestamp=i.timestamp))}getCodecFromCodecStats(t){const e=this.report.get(t);if(!e)return"";const i=e.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let t=0,e=null,i=null;this.mediaBytesSent.forEach(a=>{t+=a.diffMean()}),this.mediaBytesRetransmit.forEach(a=>{e=e===null?a.diffMean():e+a.diffMean()}),this.mediaBytesTargetEncode.forEach(a=>{i=i===null?a.diffMean():i+a.diffMean()});const s=e!==null?t-e:t;this._stats.bitrate={actualEncoded:8*s/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},e!==null&&(this._stats.bitrate.retransmit=8*e/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}}class f5 extends uT{updateStats(){return W.resolve()}}function Vf(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const a=function(){const d=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return d&&d[0]?Number(d[0].split("/")[1]):null}();return a?a<76?new p5(n,{updateInterval:t,lossRateInterval:e,freezeRateLimit:i,firstVideoDecodedTimeout:s}):new uN(n,{updateInterval:t,lossRateInterval:e,freezeRateLimit:i,firstVideoDecodedTimeout:s}):function(d){return!!window.RTCStatsReport&&d.getStats()instanceof W}(n)?new uN(n,{updateInterval:t,lossRateInterval:e,freezeRateLimit:i,firstVideoDecodedTimeout:s}):new f5(n,{updateInterval:t,lossRateInterval:e,freezeRateLimit:i,firstVideoDecodedTimeout:s})}function hN(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function pN(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?hN(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):hN(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class $n extends Xp{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}constructor(t,e){super(t,e),g(this,"store",void 0),g(this,"peerConnection",void 0),g(this,"remoteSDP",void 0),g(this,"initialOffer",void 0),g(this,"statsFilter",void 0),g(this,"useRTX",!1),g(this,"localCapabilities",void 0),g(this,"localCandidateCount",0),g(this,"allCandidatesReceived",!1),g(this,"establishPromise",void 0),g(this,"mutex",new zn("P2PConnection-mutex")),this.store=e,this.peerConnection=new RTCPeerConnection($n.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=Vf(this.peerConnection,x("STATS_UPDATE_INTERVAL"),void 0,We()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const e=xc(t.sdp),i=oT(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:x("FILTER_VIDEO_FEC"),filterAudioFec:x("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=t,pN(pN({},e),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:t.sdp})}catch(t){throw new J(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,e,i,s,a,d){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(h){g(this,"sessionDesc",void 0),g(this,"localCapabilities",void 0),g(this,"rtpCapabilities",void 0),g(this,"candidates",void 0),g(this,"iceParameters",void 0),g(this,"dtlsParameters",void 0),g(this,"setup",void 0),g(this,"currentMidIndex",void 0),g(this,"cname",void 0),h=yn(h);const{remoteIceParameters:p,remoteDtlsParameters:_,candidates:m,remoteRTPCapabilities:S,remoteSetup:y,localCapabilities:b,sdkCodec:I,cname:A}=h,L=dn.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=S,this.candidates=m,this.iceParameters=p,this.dtlsParameters=_,this.setup=y,this.localCapabilities=b,this.cname=A;for(let U=0;U<L.mediaDescriptions.length;U++){const F=L.mediaDescriptions[U];if(F.attributes.iceUfrag=p.iceUfrag,F.attributes.icePwd=p.icePwd,F.attributes.fingerprints=_.fingerprints,F.attributes.candidates=m,F.attributes.setup=y,F.media.mediaType==="video"){F.media.fmts=S.videoCodecs.map(z=>z.payloadType.toString(10));let $=S.videoCodecs.filter(z=>{var G,Y;return(G=z.rtpMap)===null||G===void 0?void 0:It(Y=G.encodingName.toLowerCase()).call(Y,I)});$.length===0&&($=S.videoCodecs),F.attributes.payloads=$,F.attributes.extmaps=S.videoExtensions}F.media.mediaType==="audio"&&(F.media.fmts=S.audioCodecs.map($=>$.payloadType.toString(10)),F.attributes.payloads=S.audioCodecs,F.attributes.extmaps=S.audioExtensions),L.mediaDescriptions[U]=this.mungMediaDesc(F)}this.sessionDesc=L,this.currentMidIndex=L.mediaDescriptions.length-1}toString(){return dn.print(this.sessionDesc)}send(h,p,_){const{ssrcs:m,ssrcGroups:S}=zr(p,this.cname),y=this.sessionDesc.mediaDescriptions.find(A=>h===mt.VIDEO?A.media.mediaType==="video":A.media.mediaType==="audio"),b=m[0].attributes.label,I=m[0].attributes.mslabel;return y.attributes.ssrcs=y.attributes.ssrcs.concat(m),y.attributes.ssrcGroups=y.attributes.ssrcGroups.concat(S),{id:b,mslabel:I}}batchSend(h){return h.map(p=>{let{kind:_,ssrcMsg:m}=p;return this.send(_,m,void 0)})}stopSending(h){this.sessionDesc.mediaDescriptions.forEach(p=>{const _=[],m=[],S=[];p.attributes.ssrcs.forEach(y=>{It(h).call(h,y.attributes.label||"")?S.push(y):_.push(y)}),p.attributes.ssrcGroups.forEach(y=>{var b;It(b=S.map(I=>I.ssrcId)).call(b,y.ssrcIds[0])||m.push(y)}),p.attributes.ssrcs=_,p.attributes.ssrcGroups=m})}mute(h){const p=this.sessionDesc.mediaDescriptions.find(_=>_.attributes.mid===h);if(!p)throw new Error("mediaDescription not found with ".concat(h," in remote SDP when calling RemoteSDP.mute."));p.attributes.direction="inactive"}unmute(h){const p=this.sessionDesc.mediaDescriptions.find(_=>_.attributes.mid===h);if(!p)throw new Error("mediaDescription not found with ".concat(h," in remote SDP when calling RemoteSDP.unmute."));p.attributes.direction="sendonly"}receive(h,p,_){h.forEach((m,S)=>{const y=m._mediaStreamTrack,b=this.sessionDesc.mediaDescriptions.findIndex(A=>A.attributes.mid===y.kind),I=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[b],m);this.sessionDesc.mediaDescriptions[b]=I})}stopReceiving(h){}updateCandidates(h){h===ci.TCP?this.candidates.forEach(p=>{this.candidates.findIndex(_=>_.transport==="tcp"&&_.connectionAddress===p.connectionAddress&&_.port===p.port)===-1&&this.candidates.push(eN(eN({},p),{},{foundation:"tcpcandidate",priority:Number(p.priority)-1+"",transport:"tcp",port:Number(p.port)+90+""}))}):this.candidates=this.candidates.filter(p=>p.transport!=="tcp");for(const p of this.sessionDesc.mediaDescriptions)p.attributes.candidates=this.candidates}restartICE(h){h=yn(h),this.iceParameters=h,this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.iceUfrag=h.iceUfrag,p.attributes.icePwd=h.icePwd})}predictReceivingMids(h){const p=[];for(let _=0;_<h;_++)p.push((this.currentMidIndex+_+1).toString(10));return p}mungRecvMediaDsec(h,p){const _=yn(h);return Vc(_,p),cT(_,p),_}updateRecvMedia(h,p){const _=this.sessionDesc.mediaDescriptions.findIndex(m=>m.attributes.mid===h);if(_!==-1){const m=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[_],p);this.sessionDesc.mediaDescriptions[_]=m}}bumpMid(h){this.currentMidIndex+=h}updateTrackLabel(h,p,_){const m=this.sessionDesc.mediaDescriptions.find(y=>h===mt.VIDEO?y.attributes.mid==="video":y.attributes.mid==="audio");if(m){const y=m.attributes.ssrcs.find(b=>b.attributes.label===p);var S;y&&(y.attributes.label=_,(S=y.attributes.msid)===null||S===void 0||S.replace(p,_))}}mungMediaDesc(h){const p=yn(h);return aT(p),function(_){const m=_.attributes.extmaps.find(S=>S.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");m&&_.attributes.extmaps.splice(_.attributes.extmaps.indexOf(m),1),_.attributes.payloads.forEach(S=>{const y=S.rtcpFeedbacks.findIndex(b=>b.type==="transport-cc");y!==-1&&S.rtcpFeedbacks.splice(y,1)})}(p),p}getSSRC(h){for(const p of this.sessionDesc.mediaDescriptions)for(const _ of p.attributes.ssrcs)if(_.attributes.label===h)return[_]}}({remoteIceParameters:t,remoteDtlsParameters:e,candidates:i,remoteRTPCapabilities:s.send,remoteSetup:a,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:d});const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(u){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(u.toString()))}}async updateRemoteRTPCapabilities(t,e){throw new J(O.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}send(t,e){var i=this;return qr(function*(){const s=yield Te(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const a=t.map(S=>i.peerConnection.addTrack(S._mediaStreamTrack)),d=yield Te(i.peerConnection.createOffer()),u=dn.parse(d.sdp),h=t.map(S=>{const y=S._mediaStreamTrack,b=u.mediaDescriptions.find(I=>I.attributes.mid===y.kind);if(!b)throw new Error("Cannot extract ssrc from mediaDescription.");return function(I,A,L){const U=I.attributes.ssrcs.filter($=>$.attributes.label===A),F=I.attributes.ssrcGroups;if(U.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(F&&U.length>1){const $=F.find(z=>z.ssrcIds.indexOf(U[0].ssrcId)!==-1);return $?[{ssrcId:$.ssrcIds[0],rtx:L?$.ssrcIds[1]:void 0}]:[{ssrcId:U[0].ssrcId}]}return[{ssrcId:U[0].ssrcId}]}(b,y.id,i.useRTX)});let p;try{p=yield h}catch(S){throw a.forEach(y=>{bi()&&y.replaceTrack(null),i.peerConnection.removeTrack(y)}),S}const _=i.mungSendOfferSDP(d.sdp,t);i.remoteSDP.receive(t,e,p);const m=i.remoteSDP.toString();return yield Te(i.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Te(i.applySendEncodings(a,t)),yield Te(i.peerConnection.setRemoteDescription({type:"answer",sdp:m})),t.map((S,y)=>{const b=S._mediaStreamTrack.id;return{localSSRC:h[y],id:b}})}catch(a){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{s()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const e=this.peerConnection.getSenders().filter(a=>{var d;return t.indexOf(((d=a.track)===null||d===void 0?void 0:d.id)||"")!==-1});if(e.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");e.map(a=>{bi()&&a.replaceTrack(null),this.peerConnection.removeTrack(a)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(t);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(e){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}}async receive(t,e,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:a,mslabel:d}=this.remoteSDP.send(t,e,s),u=new W((_,m)=>{const S=setTimeout(()=>{m(new Error("Cannot receive track, id: ".concat(a)))},1e4),y=b=>{const I=Se();if((I.name==="Safari"&&Number(I.version)===11||wi())&&b.track.id!==a&&b.streams[0].id===d){var A;const L=b.streams[0].getTracks()[0];return(A=this.remoteSDP)===null||A===void 0||A.updateTrackLabel(t,a,b.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(S),void _(L)}if(b.track.id===a)return this.peerConnection.removeEventListener("track",y),clearTimeout(S),void _(b.track)};this.peerConnection.addEventListener("track",y)}),h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const p=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(p),{track:await u,id:a}}catch(a){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(e){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const e=this.peerConnection.getSenders().filter(i=>{var s;return t.indexOf(((s=i.track)===null||s===void 0?void 0:s.id)||"")!==-1});if(e.length!==t.length)throw new Error("sender' length doesn't match mids' length.");e.map(i=>{if(bi()&&i.track)i.track.enabled=!1;else{const s=i.getParameters();s.encodings.forEach(a=>a.active=!1),i.setParameters(s)}})}catch(e){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const e=this.peerConnection.getSenders().filter(a=>{var d;return t.indexOf(((d=a.track)===null||d===void 0?void 0:d.id)||"")!==-1});if(e.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");e.map(async a=>{if(bi()&&a.track)a.track.enabled=!0;else{const d=a.getParameters();d.encodings.forEach(u=>u.active=!0),await a.setParameters(d)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(e){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(t){var e=this;return qr(function*(){const i=yield Te(e.mutex.lock("From P2PConnection.restartICE"));try{if(!e.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(xe().supportPCSetConfiguration){const h=e.peerConnection.getConfiguration(),p=t===ci.RELAY?"relay":"all";h.iceTransportPolicy!==p&&(R.debug("[".concat(e.store.clientId,"] restartICE change iceTransportPolicy from [").concat(h.iceTransportPolicy,"] to [").concat(p,"]")),h.iceTransportPolicy=p,e.peerConnection.setConfiguration(h))}else if(t===ci.RELAY)return;t!==ci.RELAY&&e.remoteSDP.updateCandidates(t);const s=yield Te(e.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=xc(s.sdp),{remoteIceParameters:d}=yield a.iceParameters;e.remoteSDP.restartICE(d);const u=e.remoteSDP.toString();yield Te(e.peerConnection.setLocalDescription(s)),yield Te(e.peerConnection.setRemoteDescription({type:"answer",sdp:u}))}catch(s){R.warning("[".concat(e.store.clientId,"] restart ICE failed, abort operation"),s)}finally{i()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[e]);this.remoteSDP.updateRecvMedia(e._mediaStreamTrack.kind,e);const a=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new J(O.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,e){const i=this.peerConnection.getSenders().filter(s=>{var a;return((a=s.track)===null||a===void 0?void 0:a.id)===t});i.length===1&&await this.applySendEncodings(i,[e])}setStatsRemoteVideoIsReady(t,e){this.statsFilter.setVideoIsReady2(t,e)}async replaceTrack(t,e){const i=this.peerConnection.getSenders().find(s=>{var a;return((a=s.track)===null||a===void 0?void 0:a.id)===e});i&&await i.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,e){throw new J(O.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new J(O.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},x("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const e={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?e.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Nd(t.turnServer.servers)?e.iceServers=t.turnServer.servers:(e.iceServers&&e.iceServers.push(...$n.turnServerConfigToIceServers(t.turnServer.servers)),x("USE_TURN_SERVER_OF_GATEWAY")&&e.iceServers&&t.turnServer.serversFromGateway&&e.iceServers.push(...$n.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(e.iceTransportPolicy="relay")}))),e}static turnServerConfigToIceServers(t){const e=[];return t.forEach(i=>{i.security?i.tcpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),e}async updateRtpSenderEncodings(t,e){var i;if(e||(e=this.peerConnection.getSenders().find(p=>{var _;return((_=p.track)===null||_===void 0?void 0:_.id)===t._mediaStreamTrack.id})),!e)return R.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!xe().supportSetRtpSenderParameters)return R.warn("Browser not support set rtp-sender parameters");const s={},a={};if(t instanceof te)switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(x("DSCP_TYPE")&&la()){var d;const p=x("DSCP_TYPE");It(d=["very-low","low","medium","high"]).call(d,p)&&(a.networkPriority=p)}const u=e.getParameters(),h=(i=u.encodings)===null||i===void 0?void 0:i[0];h&&Object.assign(h,a),Object.assign(u,s),R.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(u.encodings))),await e.setParameters(u)}async applySendEncodings(t,e){try{if(!xe().supportSetRtpSenderParameters||t.length!==e.length)return;for(let i=0;i<t.length;i++){const s=t[i],a=e[i];s&&a&&await this.updateRtpSenderEncodings(a,s)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,e){const i=dn.parse(t);return e.forEach((s,a)=>{const d=s._mediaStreamTrack,u=i.mediaDescriptions.find(h=>h.attributes.mid===d.kind);u&&Vc(u,s)}),dn.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var e;(e=this.onFirstAudioReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var e;(e=this.onFirstVideoReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var e;(e=this.onFirstAudioDecoded)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,e,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,e,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,e)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,e)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,e)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const e=this.remoteSDP.batchSend(t).map((a,d)=>{let{id:u,mslabel:h}=a;const{kind:p}=t[d];return new W((_,m)=>{const S=setTimeout(()=>{m(new Error("Cannot receive track, id: ".concat(u)))},1e4),y=b=>{const I=Se();if(I.name==="Safari"&&Number(I.version)===11&&b.track.id!==u&&b.streams[0].id===h){var A;const L=b.streams[0].getTracks()[0];return(A=this.remoteSDP)===null||A===void 0||A.updateTrackLabel(p,u,b.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(S),void _({track:L,id:u})}if(b.track.id===u)return this.peerConnection.removeEventListener("track",y),clearTimeout(S),void _({track:b.track,id:u})};this.peerConnection.addEventListener("track",y)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const s=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(s),await W.all(e)}catch(e){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const e=this.remoteSDP.getSSRC(t);return e==null?void 0:e[0].ssrcId}setConfiguration(t){if(xe().supportPCSetConfiguration){const e=$n.resolvePCConfiguration(t);this.peerConnection.setConfiguration(e)}}}function Jr(n,t,e){const i=n[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return e.value=async function(){const s=this.mutex,a=await s.lock("Locking from P2PConnection.".concat(t));try{for(var d=arguments.length,u=new Array(d),h=0;h<d;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{a()}},e}function fN(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Aa(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?fN(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):fN(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}X([Jr,C("design:type",Function),C("design:paramtypes",[Object,Object,Array,Object,String,String]),C("design:returntype",W)],$n.prototype,"connect",null),X([Jr,C("design:type",Function),C("design:paramtypes",[Array]),C("design:returntype",W)],$n.prototype,"stopSending",null),X([Jr,C("design:type",Function),C("design:paramtypes",[String,Array,String,Object]),C("design:returntype",W)],$n.prototype,"receive",null),X([Jr,C("design:type",Function),C("design:paramtypes",[Array]),C("design:returntype",W)],$n.prototype,"stopReceiving",null),X([Jr,C("design:type",Function),C("design:paramtypes",[String]),C("design:returntype",W)],$n.prototype,"muteRemote",null),X([Jr,C("design:type",Function),C("design:paramtypes",[String]),C("design:returntype",W)],$n.prototype,"unmuteRemote",null),X([Jr,C("design:type",Function),C("design:paramtypes",[Array]),C("design:returntype",W)],$n.prototype,"muteLocal",null),X([Jr,C("design:type",Function),C("design:paramtypes",[Array]),C("design:returntype",W)],$n.prototype,"unmuteLocal",null),X([Jr,C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],$n.prototype,"close",null),X([Jr,C("design:type",Function),C("design:paramtypes",[String,di]),C("design:returntype",W)],$n.prototype,"updateEncoderConfig",null),X([Jr,C("design:type",Function),C("design:paramtypes",[String,di]),C("design:returntype",W)],$n.prototype,"updateSendParameters",null),X([Jr,C("design:type",Function),C("design:paramtypes",[di,String]),C("design:returntype",W)],$n.prototype,"replaceTrack",null),X([Jr,C("design:type",Function),C("design:paramtypes",[String]),C("design:returntype",W)],$n.prototype,"getRemoteSSRC",null);const Gu="9",_N=4e4;function mN(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function el(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?mN(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):mN(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}let Mn=class ih extends Xp{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,e;return(t=(e=this.peerConnection.getReceivers()[0])===null||e===void 0||(e=e.transport)===null||e===void 0?void 0:e.state)!==null&&t!==void 0?t:null}constructor(t,e){super(t,e),g(this,"store",void 0),g(this,"peerConnection",void 0),g(this,"remoteSDP",void 0),g(this,"initialOffer",void 0),g(this,"transportEventReceiver",void 0),g(this,"statsFilter",void 0),g(this,"useXR",x("USE_XR")),g(this,"localCapabilities",void 0),g(this,"remoteCodecs",void 0),g(this,"localCandidateCount",0),g(this,"allCandidatesReceived",!1),g(this,"dataStreamChannelMap",new Map),g(this,"establishPromise",void 0),g(this,"mutex",new zn("P2PConnection-mutex")),this.store=e,this.peerConnection=new RTCPeerConnection(ih.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=Vf(this.peerConnection,x("STATS_UPDATE_INTERVAL"),void 0,We()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async updateRemoteRTPCapabilities(t,e){this.remoteCodecs=e;const i=[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(s=>s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").filter(s=>{var a;return It(a=Object.keys(vc)).call(a,s)}))];if(vt.updateRemoteRTPCapabilities(this.store.sessionId,{mids:t,localCodecs:i,remoteCodecs:this.remoteCodecs}),!this.remoteSDP)return void R.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(i,", codecs: ").concat(e));if(this.remoteSDP.updateRemoteCodec(t,e,this.store.codec)){const s=await this.peerConnection.createOffer(),a=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s);const d=this.remoteSDP.toString();a==null||a(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}else R.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const t=await this.peerConnection.createOffer();if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const e=xc(t.sdp),i=await Z0({filterRTX:!x("USE_PUB_RTX")&&!x("USE_SUB_RTX"),filterVideoFec:x("FILTER_VIDEO_FEC"),filterAudioFec:x("FILTER_AUDIO_FEC"),filterVideoCodec:x("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=Mf(i),this.initialOffer=t,el(el({},e),{},{rtpCapabilities:i,offerSDP:t.sdp})}catch(t){throw new J(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,e,i,s,a,d){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{get localCapabilities(){return yn(this._localCapabilities)}get rtpCapabilities(){return yn(this._rtpCapabilities)}get candidates(){return yn(this._candidates)}get iceParameters(){return yn(this._iceParameters)}get dtlsParameters(){return yn(this._dtlsParameters)}constructor(y){g(this,"sessionDesc",void 0),g(this,"_localCapabilities",void 0),g(this,"_rtpCapabilities",void 0),g(this,"_candidates",void 0),g(this,"_iceParameters",void 0),g(this,"_dtlsParameters",void 0),g(this,"setup",void 0),g(this,"currentMidIndex",void 0),g(this,"cname",void 0),g(this,"firefoxSsrcMidMap",new Map),y=yn(y);const{remoteIceParameters:b,remoteDtlsParameters:I,candidates:A,remoteRTPCapabilities:L,remoteSetup:U,localCapabilities:F,cname:$}=y,z=dn.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=L,this._candidates=A,this._iceParameters=b,this._dtlsParameters=I,this._localCapabilities=F,this.setup=U,this.cname=$;const G=this.rtpCapabilities.send;for(const Y of z.mediaDescriptions){if(Y.attributes.iceUfrag=b.iceUfrag,Y.attributes.icePwd=b.icePwd,Y.attributes.fingerprints=I.fingerprints,Y.attributes.candidates=A,Y.attributes.setup=U,Y.media.mediaType==="video"&&(Y.media.fmts=G.videoCodecs.map(q=>q.payloadType.toString(10)),Y.attributes.payloads=G.videoCodecs,Y.attributes.extmaps=G.videoExtensions,x("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:q,ssrcGroups:ut}=zr([{ssrcId:_N,rtx:x("USE_SUB_RTX")?40001:void 0}],this.cname);Y.attributes.ssrcs=q,Y.attributes.ssrcGroups=ut}if(Y.media.mediaType==="audio"&&(Y.media.fmts=G.audioCodecs.map(q=>q.payloadType.toString(10)),Y.attributes.payloads=G.audioCodecs,Y.attributes.extmaps=G.audioExtensions,wa(Y),x("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:q,ssrcGroups:ut}=zr([{ssrcId:2e4}],this.cname);Y.attributes.ssrcs=q,Y.attributes.ssrcGroups=ut}}this.sessionDesc=z,this.currentMidIndex=z.mediaDescriptions.length-1}preloadRemoteMedia(){const y=x("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;const b=this.candidates,I=this.dtlsParameters,A=this.iceParameters,L=this.rtpCapabilities.send;for(let U=1;U<y;U++){const F=2*U+2e4,$=2*U+_N,{ssrcs:z,ssrcGroups:G}=zr([{ssrcId:F}],this.cname),{ssrcs:Y,ssrcGroups:q}=zr([{ssrcId:$,rtx:x("USE_SUB_RTX")?$+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Gu,protos:["UDP","TLS","RTP","SAVPF"],fmts:L.videoCodecs.map(ut=>ut.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:A.iceUfrag,icePwd:A.icePwd,unrecognized:[],candidates:b,extmaps:L.videoExtensions,fingerprints:I.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Y,ssrcGroups:q,rtcpFeedbackWildcards:[],payloads:L.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*U)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Gu,protos:["UDP","TLS","RTP","SAVPF"],fmts:L.audioCodecs.map(ut=>ut.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:A.iceUfrag,icePwd:A.icePwd,unrecognized:[],candidates:b,extmaps:L.audioExtensions,fingerprints:I.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:z,ssrcGroups:G,rtcpFeedbackWildcards:[],payloads:L.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*U+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return dn.print(this.sessionDesc)}send(y,b,I,A){const{ssrcs:L,ssrcGroups:U}=zr(b,this.cname,x("SYNC_GROUP")?I:void 0),F=this.findPreloadMediaDesc(L);if(F){if(We()&&this.firefoxSsrcMidMap.set(L[0].ssrcId,F.attributes.mid),A&&(A.twcc||A.remb)){const $=this.sessionDesc.mediaDescriptions.indexOf(F);return this.sessionDesc.mediaDescriptions[$]=this.mungSendMediaDesc(F,A),{mid:F.attributes.mid,needExchangeSDP:!0}}return{mid:F.attributes.mid,needExchangeSDP:!1}}{const $=this.findAvailableMediaIndex(y,L);let z;return $===-1||$===1&&(bi()||rw())||$===0&&x("USE_SUB_RTX")||sw()?(z=this.createOrRecycleSendMedia(y,L,U,"sendonly",A),this.updateBundleMids()):(z=yn(this.sessionDesc.mediaDescriptions[$]),z.attributes.direction="sendonly",z.attributes.ssrcs=L,z.attributes.ssrcGroups=U,this.sessionDesc.mediaDescriptions[$]=this.mungSendMediaDesc(z,A)),We()&&this.firefoxSsrcMidMap.set(L[0].ssrcId,z.attributes.mid),{mid:z.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:y,needExchangeSDP:b}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:y.attributes.mid,needExchangeSDP:b}}batchSend(y){const b=y.map(L=>{let{kind:U,ssrcMsg:F,mslabel:$}=L;return this.send(U,F,$)}),I=[];let A=!1;return b.forEach(L=>{let{mid:U,needExchangeSDP:F}=L;F&&(A=!0),I.push(U)}),{mids:I,needExchangeSDP:A}}stopSending(y){const b=this.sessionDesc.mediaDescriptions.filter(I=>I.attributes.mid&&y.indexOf(I.attributes.mid)!==-1);if(b.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");b.forEach(I=>{I.attributes.mid==="0"||We()||sw()?I.attributes.ssrcs=[]:(I.attributes.ssrcs=[],I.attributes.direction="inactive",I.media.port="0")}),this.updateBundleMids()}mute(y){const b=this.sessionDesc.mediaDescriptions.find(I=>I.attributes.mid===y);if(!b)throw new Error("mediaDescription not found with ".concat(y," in remote SDP when calling RemoteSDP.mute."));b.attributes.direction="inactive"}unmute(y){const b=this.sessionDesc.mediaDescriptions.find(I=>I.attributes.mid===y);if(!b)throw new Error("mediaDescription not found with ".concat(y," in remote SDP when calling RemoteSDP.unmute."));b.attributes.direction="sendonly"}muteRemote(y){const b=this.sessionDesc.mediaDescriptions.filter(I=>It(y).call(y,I.attributes.mid||""));if(b.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");b.forEach(I=>{I.attributes.direction="inactive"})}unmuteRemote(y){const b=this.sessionDesc.mediaDescriptions.filter(I=>It(y).call(y,I.attributes.mid||""));if(b.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");b.forEach(I=>{I.attributes.direction="recvonly"})}receive(y,b,I,A){y.forEach((L,U)=>{this.createOrRecycleRecvMedia(L,[],"recvonly",b,I,A[U])}),this.updateBundleMids()}stopReceiving(y){const b=this.sessionDesc.mediaDescriptions.filter(I=>y.indexOf(I.attributes.mid)!==-1);if(b.length!==y.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");b.forEach(I=>{I.media.port="0",I.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(y){const b=this._candidates.filter(I=>I.transport==="udp");if(y===ci.TCP){if(b.length===0)return;if(x("TCP_CANDIDATE_ONLY")){const I=this._candidates.filter(A=>A.transport==="tcp");b.forEach(A=>{I.findIndex(L=>L.connectionAddress===A.connectionAddress)===-1&&I.push(Aa(Aa({},A),{},{foundation:"tcpcandidate",priority:Number(A.priority)-1+"",transport:"tcp",port:Number(A.port)+90+""}))}),this._candidates=I}else{const I=[];b.forEach(A=>{I.push(Aa(Aa({},A),{},{foundation:"tcpcandidate",priority:Number(A.priority)-1+"",transport:"tcp",port:Number(A.port)+90+""}))}),this._candidates=[...b,...I]}}else if(y===ci.RELAY){if(b.length!==0)return;{const I=this._candidates.filter(A=>A.transport==="tcp");I.forEach(A=>{b.push(Aa(Aa({},A),{},{foundation:"udpcandidate",priority:Number(A.priority)+1+"",transport:"udp",port:Number(A.port)-90+""}))}),this._candidates=[...b,...I]}}else b.length===0?(this._candidates.filter(I=>I.transport==="tcp").forEach(I=>{b.push(Aa(Aa({},I),{},{foundation:"udpcandidate",priority:Number(I.priority)+1+"",transport:"udp",port:Number(I.port)-90+""}))}),this._candidates=b):this._candidates=this._candidates.filter(I=>I.transport!=="tcp");for(const I of this.sessionDesc.mediaDescriptions)I.attributes.candidates=this.candidates}restartICE(y){y=yn(y),this._iceParameters=y,this.sessionDesc.mediaDescriptions.forEach(b=>{b.attributes.iceUfrag=y.iceUfrag,b.attributes.icePwd=y.icePwd})}predictReceivingMids(y){const b=[];for(let I=0;I<y;I++)b.push((this.currentMidIndex+I+1).toString(10));return b}findAvailableMediaIndex(y,b){return this.sessionDesc.mediaDescriptions.findIndex(I=>{const A=I.media.mediaType===y&&I.media.port!=="0"&&(I.attributes.direction==="sendonly"||I.attributes.direction==="sendrecv")&&I.attributes.ssrcs.length===0;if(We()){if(A){const L=this.firefoxSsrcMidMap.get(b[0].ssrcId);return!(L||I.attributes.mid!=="0"&&I.attributes.mid!=="1")||!(!L||L!==I.attributes.mid)}return!1}return A})}createOrRecycleDataChannel(){for(const I of this.sessionDesc.mediaDescriptions)if(I.media.mediaType==="application")return{mediaDesc:I,needExchangeSDP:!1};this.currentMidIndex+=1;const y="".concat(this.currentMidIndex),b={media:{mediaType:"application",port:Gu,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(y),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(b),{mediaDesc:b,needExchangeSDP:!0}}createOrRecycleRecvMedia(y,b,I,A,L,U){const F=y._mediaStreamTrack.kind,$=this.rtpCapabilities.recv,z=xf(F,$,this.localCapabilities.send,F===mt.VIDEO?A:L),G=F===mt.VIDEO?$.videoExtensions:$.audioExtensions;this.currentMidIndex+=1;const Y="".concat(this.currentMidIndex);let q={media:{mediaType:F,port:Gu,protos:["UDP","TLS","RTP","SAVPF"],fmts:z.map(ct=>ct.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:G,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:b,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:z,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:I,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Y)}};q=this.mungRecvMediaDsec(q,y,U);const ut=this.findFirstClosedMedia(F);if(ut){const ct=this.sessionDesc.mediaDescriptions.indexOf(ut);this.sessionDesc.mediaDescriptions[ct]=q}else this.sessionDesc.mediaDescriptions.push(q);return q}updateRemoteCodec(y,b,I){const A=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(q=>q.rtpMap&&q.rtpMap.encodingName.toLowerCase()||"").filter(q=>{var ut;return It(ut=Object.keys(vc)).call(ut,q)}))],L=new Set(b);if(A.every(q=>L.has(q)))return R.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(b)),!1;const U=this._rtpCapabilities.recv.videoCodecs.filter(q=>b.some(ut=>{var ct;return It(ct=q.rtpMap&&q.rtpMap.encodingName.toLowerCase()||"").call(ct,ut)}));if(U.length===0)return R.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(A," codecs: ").concat(b)),!1;const F=[...new Set(U.map(q=>q.rtpMap&&q.rtpMap.encodingName.toLowerCase()||""))];let $;if(R.debug("updateRemoteCodec, from ".concat(A," to ").concat(F)),y.length===0)$=this.sessionDesc.mediaDescriptions.filter(q=>q.media.mediaType==="video"&&q.attributes.direction==="recvonly");else if($=this.sessionDesc.mediaDescriptions.filter(q=>q.attributes.mid&&It(y).call(y,q.attributes.mid)&&q.attributes.direction==="recvonly"),$.length!==y.length)return R.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(y,", codecs: ").concat(b)),!1;this._rtpCapabilities.recv.videoCodecs=U;const z=this.localCapabilities.send,G=this.rtpCapabilities.recv,Y=xf(mt.VIDEO,G,z,I);return $.forEach(q=>{const ut=Y.map(ct=>ct.payloadType.toString(10));R.debug("updateRemoteCodec mid: ".concat(q.attributes.mid,", from ").concat(q.attributes.payloads," to ").concat(Y)),q.attributes.payloads=Y,q.media.fmts=ut}),!0}createOrRecycleSendMedia(y,b,I,A,L){const U=this.rtpCapabilities.send,F=y===mt.VIDEO?U.videoCodecs:U.audioCodecs,$=y===mt.VIDEO?U.videoExtensions:U.audioExtensions;this.currentMidIndex+=1;const z="".concat(this.currentMidIndex);let G={media:{mediaType:y,port:Gu,protos:["UDP","TLS","RTP","SAVPF"],fmts:F.map(q=>q.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:$,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:b,ssrcGroups:I,rtcpFeedbackWildcards:[],payloads:F,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:A,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(z)}};G=this.mungSendMediaDesc(G,L);const Y=this.findFirstClosedMedia(y);if(Y){const q=this.sessionDesc.mediaDescriptions.indexOf(Y);this.sessionDesc.mediaDescriptions[q]=G}else this.sessionDesc.mediaDescriptions.push(G);return G}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(y=>y.media.port!=="0").map(y=>y.attributes.mid)}mungRecvMediaDsec(y,b,I){const A=yn(y);return aT(A),Vc(A,b),cT(A,b),$0(A),kf(A,I,this.localCapabilities.send),A}mungSendMediaDesc(y,b){const I=yn(y);return kf(I,b,this.localCapabilities.recv),wa(I),I}updateRecvMedia(y,b){const I=this.sessionDesc.mediaDescriptions.findIndex(A=>A.attributes.mid===y);if(I!==-1){const A=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[I],b);this.sessionDesc.mediaDescriptions[I]=A}}bumpMid(y){this.currentMidIndex+=y}findFirstClosedMedia(y){return this.sessionDesc.mediaDescriptions.find(b=>We()?b.media.port==="0"&&b.media.mediaType===y:b.media.port==="0")}findPreloadMediaDesc(y){return this.sessionDesc.mediaDescriptions.find(b=>{var I;return((I=b.attributes)===null||I===void 0||(I=I.ssrcs[0])===null||I===void 0?void 0:I.ssrcId)===y[0].ssrcId})}getSSRC(y){var b;return(b=this.sessionDesc.mediaDescriptions.find(I=>I.attributes.mid===y))===null||b===void 0?void 0:b.attributes.ssrcs}}({remoteIceParameters:t,remoteDtlsParameters:e,candidates:i,remoteRTPCapabilities:s,remoteSetup:a,localCapabilities:this.localCapabilities,cname:d}),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString(),h=dn.parse(this.initialOffer.sdp),p=h.mediaDescriptions.find(y=>y.media.mediaType==="audio");p&&wa(p),this.useXR&&Uf(h);const _=dn.print(h),m=this.logSDPExchange(_||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:_}),m==null||m(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u});const S=this.peerConnection.getTransceivers()[0];if(S!=null&&S.receiver&&this.tryBindTransportEvents(S.receiver),x("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const y=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:y});const b=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(b)}}catch(u){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(u.toString()))}}send(t,e,i){var s=this;return qr(function*(){const a=yield Te(s.mutex.lock("From P2PConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=[];t.forEach(I=>{const A=s.peerConnection.addTransceiver(I._mediaStreamTrack,{direction:"sendonly"});d.push(A),I._updateRtpTransceiver(A)}),We()&&x("SIMULCAST")===!0&&(yield Te(s.applySimulcastForFirefox(d,t)));const u=yield Te(s.peerConnection.createOffer()),h=s.remoteSDP.predictReceivingMids(t.length),p=s.mungSendOfferSDP(u.sdp,t,h),_=dn.parse(p),m=h.map(I=>{const A=_.mediaDescriptions.find(L=>L.attributes.mid===I);if(!A)throw new Error("Cannot extract ssrc from mediaDescription.");return X0(A,x("USE_PUB_RTX"))});let S;try{S=yield m}catch(I){S=[],s.remoteSDP.receive(t,e,i,S);const A=s.remoteSDP.toString();throw yield Te(s.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Te(s.peerConnection.setRemoteDescription({type:"answer",sdp:A})),yield Te(s.stopSending(h,!0)),I}s.remoteSDP.receive(t,e,i,S);const y=s.remoteSDP.toString(),b=s.logSDPExchange(p,"offer","local","send");return yield Te(s.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Te(s.applySimulcastEncodings(d,t)),yield Te(s.applySendEncodings(d,t)),b==null||b(y),yield Te(s.peerConnection.setRemoteDescription({type:"answer",sdp:y})),d.map((I,A)=>{const L=h[A];return{localSSRC:m[A],id:L,transceiver:I}})}catch(d){throw d instanceof J?d:new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{a()}})()}async createDataChannels(t,e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(t);i&&i.readyState==="open"?R.debug("[P2PConnection] Channels are already available and can be reused directly."):(i=this.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:x("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,i)),e.forEach(a=>{a._updateOriginDataChannel(i)});const{needExchangeSDP:s}=this.remoteSDP.sendDataChannel();if(s){const a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(d),R.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else R.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof J?i:new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(t){try{const e=this.dataStreamChannelMap.get(t);return e==null||e.close(),void this.dataStreamChannelMap.delete(t)}catch(e){throw e instanceof J?e:new J(O.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(e.toString()))}}async stopSending(t,e){const i=e?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getTransceivers().filter(h=>t.indexOf(h.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(h=>{var p;h.direction="inactive",(p=h.stop)===null||p===void 0||p.call(h)});const a=await this.peerConnection.createOffer(),d=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(t);const u=this.remoteSDP.toString();d==null||d(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}finally{i&&i()}}async receive(t,e,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:a,needExchangeSDP:d}=this.remoteSDP.send(t,e,i,s);if(d){const h=this.remoteSDP.toString(),p=this.logSDPExchange(h,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const _=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(_.sdp,a,t);p==null||p(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const u=this.peerConnection.getTransceivers().find(h=>h.mid===a);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:a,transceiver:u}}catch(a){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:e,needExchangeSDP:i}=this.remoteSDP.batchSend(t);if(i){const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=await this.peerConnection.createAnswer();a==null||a(d.sdp||""),await this.peerConnection.setLocalDescription(d),R.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else R.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return e.map(s=>{const a=this.peerConnection.getTransceivers().find(d=>d.mid===s);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:s,transceiver:a}})}catch(e){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const e=this.remoteSDP.toString(),i=this.logSDPExchange(e,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(e){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const e=this.remoteSDP.toString(),i=this.logSDPExchange(e,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(e){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(e.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const e=this.remoteSDP.toString(),i=this.logSDPExchange(e,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(e){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(e.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const e=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(e.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");e.map(d=>{d.direction="inactive"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const a=this.remoteSDP.toString();s==null||s(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(e){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const e=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(e.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");e.map(async(d,u)=>{d.direction="sendonly"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);const a=this.remoteSDP.toString();s==null||s(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(e){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(t){var e=this;return qr(function*(){const i=yield Te(e.mutex.lock("From P2PConnection.restartICE"));try{if(!e.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(xe().supportPCSetConfiguration){const p=e.peerConnection.getConfiguration(),_=t===ci.RELAY?"relay":"all";p.iceTransportPolicy!==_&&(R.debug("[".concat(e.store.clientId,"] restartICE change iceTransportPolicy from [").concat(p.iceTransportPolicy,"] to [").concat(_,"]")),p.iceTransportPolicy=_,e.peerConnection.setConfiguration(p))}else if(t===ci.RELAY)return;e.remoteSDP.updateCandidates(t);const s=yield Te(e.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=xc(s.sdp),{remoteIceParameters:d}=yield a.iceParameters;e.remoteSDP.restartICE(d);const u=e.remoteSDP.toString(),h=e.logSDPExchange(s.sdp||"","offer","local","restartICE");e.store.descriptionStart(),yield Te(e.peerConnection.setLocalDescription(s)),h==null||h(u),yield Te(e.peerConnection.setRemoteDescription({type:"answer",sdp:u}))}catch(s){R.warning("[".concat(e.store.clientId,"] restart ICE failed, abort operation"),s)}finally{i()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[e],[t]);this.remoteSDP.updateRecvMedia(t,e);const a=this.remoteSDP.toString(),d=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),d==null||d(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new J(O.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,e){const i=this.peerConnection.getTransceivers().filter(s=>s.mid===t);i.length===1&&(this.isVP8Simulcast(e)?We()||await this.applySimulcastEncodings(i,[e]):await this.applySendEncodings(i,[e]))}setStatsRemoteVideoIsReady(t,e){this.statsFilter.setVideoIsReady2(t,e)}async replaceTrack(t,e){const i=this.peerConnection.getTransceivers().find(s=>s.mid===e);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const e=t[0].transport.iceTransport,{local:i,remote:s}=e.getSelectedCandidatePair();return{local:el(el({},oo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:el(el({},oo),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},x("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const e={iceServers:[]};return t.iceServers?e.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Nd(t.turnServer.servers)?e.iceServers=t.turnServer.servers:(e.iceServers&&e.iceServers.push(...ih.turnServerConfigToIceServers(t.turnServer.servers)),x("USE_TURN_SERVER_OF_GATEWAY")&&e.iceServers&&t.turnServer.serversFromGateway&&e.iceServers.push(...ih.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),x("FORCE_TURN_TCP")?e.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(e.iceTransportPolicy="relay")}))),x("ENABLE_ENCODED_TRANSFORM")&&xe().supportWebRTCEncodedTransform&&(e.encodedInsertableStreams=!0),e}static turnServerConfigToIceServers(t){const e=[];return t.forEach(i=>{i.security?i.tcpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Vu(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!x("FORCE_TURN_TCP")&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),e}tryBindTransportEvents(t){const e=t.transport;if(e){this.transportEventReceiver=t,e.onstatechange=()=>{var s;e!=null&&e.state&&((s=this.onDTLSTransportStateChange)===null||s===void 0||s.call(this,e.state))},e.onerror=s=>{var a;(a=this.onDTLSTransportError)===null||a===void 0||a.call(this,"error"in s?s.error:s)};const i=e.iceTransport;i&&(i.onstatechange=()=>{const s=e==null?void 0:e.iceTransport.state;var a;s&&((a=this.onICETransportStateChange)===null||a===void 0||a.call(this,s))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:s,remote:a}=i.getSelectedCandidatePair();R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol}),", remote ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,e){var i;if(e||(e=this.peerConnection.getSenders().find(_=>_.track===t._mediaStreamTrack)),!e)return R.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!xe().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},a={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(t._encoderConfig){var d;const{bitrateMax:_,frameRate:m,scaleResolutionDownBy:S}=t._encoderConfig;_&&(a.maxBitrate=1e3*_),(It(d=t._hints).call(d,Fe.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(m&&(a.maxFramerate=Nr(m)),S&&S>=1&&(a.scaleResolutionDownBy=S))}if(x("DSCP_TYPE")&&la()){var u;const _=x("DSCP_TYPE");It(u=["very-low","low","medium","high"]).call(u,_)&&(a.networkPriority=_)}const h=e.getParameters(),p=(i=h.encodings)===null||i===void 0?void 0:i[0];We()&&!p&&(s.encodings=[a]),p&&Object.assign(p,a),Object.assign(h,s),R.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await e.setParameters(h)}async applySendEncodings(t,e){try{if(!xe().supportSetRtpSenderParameters||t.length!==e.length)return;for(let i=0;i<t.length;i++){const s=t[i],a=e[i];a instanceof te&&!this.isVP8Simulcast(a)&&await this.updateRtpSenderEncodings(a,s.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,e,i){const s=dn.parse(t);return e.forEach((a,d)=>{const u=i[d],h=s.mediaDescriptions.find(p=>p.attributes.mid===u);h&&(Vc(h,a),dT(h,a,this.store.codec))}),dn.print(s)}mungReceiveAnswerSDP(t,e,i){const s=dn.parse(t),a=s.mediaDescriptions.find(d=>d.attributes.mid===e);return a&&(i===mt.AUDIO&&a.media.mediaType==="audio"&&wa(a),this.useXR&&Uf(s)),dn.print(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var e;(e=this.onFirstAudioReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var e;(e=this.onFirstVideoReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var e;(e=this.onFirstAudioDecoded)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,e,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,e,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,e)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,e)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,e)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,e)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var e;(e=this.onFirstVideoDecodedTimeout)===null||e===void 0||e.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,e){if(t.length===e.length)for(let h=0;h<t.length;h++){var i,s,a,d,u;const p=t[h],_=e[h];if(_ instanceof te&&!It(i=_._hints).call(i,Fe.LOW_STREAM)&&(s=_._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((a=_._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(d=_._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((u=_._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){const m={},S={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};m.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];const y=p.sender.getParameters();await p.sender.setParameters(Object.assign(y,m))}}}async applySimulcastEncodings(t,e){if(!We()&&t.length===e.length)for(let i=0;i<t.length;i++){const s=e[i];if(s instanceof te&&this.isVP8Simulcast(s)){const a=t[i],d={},u={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];const h=a.sender.getParameters();await a.sender.setParameters(Object.assign(h,d))}}}isVP8Simulcast(t){var e,i,s,a,d;return!!(t instanceof te&&x("SIMULCAST")&&this.store.codec==="vp8"&&!It(e=t._hints).call(e,Fe.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=t._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(a=t._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((d=t._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1)}logSDPExchange(t,e,i,s){if(x("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(e," SDP during P2PConnection.").concat(s,`
`),t),e==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",s)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const e=this.remoteSDP.getSSRC(t);return e==null?void 0:e[0].ssrcId}setConfiguration(t){if(xe().supportPCSetConfiguration){const e=ih.resolvePCConfiguration(t);this.peerConnection.setConfiguration(e)}}};function dr(n,t,e){const i=n[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return e.value=async function(){const s=this.mutex,a=await s.lock("From P2PConnection.".concat(t));try{for(var d=arguments.length,u=new Array(d),h=0;h<d;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{a()}},e}function hT(n,t){let e=document.createElement("video"),i=document.createElement("canvas");e.setAttribute("style","display:none"),i.setAttribute("style","display:none"),e.setAttribute("muted",""),e.muted=!0,e.setAttribute("autoplay",""),e.autoplay=!0,e.setAttribute("playsinline",""),i.width=Nr(t.width),i.height=Nr(t.height);const s=Nr(t.framerate||15);document.body.append(e),document.body.append(i);let a=n._mediaStreamTrack;e.srcObject=new MediaStream([a]),e.play();const d=i.getContext("2d");if(!d)throw new B(O.UNEXPECTED_ERROR,"can not get canvas context");const u=xe(),h=i.captureStream(u.supportRequestFrame?0:s).getVideoTracks()[0];h.canvas||(h.canvas=i),i.startCapture=()=>{if(!e)return i.stopCapture&&i.stopCapture();if(e.paused&&e.play(),e.videoHeight>2&&e.videoWidth>2){const _=e.videoWidth,m=e.videoHeight/_,S=i.width*m;Math.abs(S-i.height)>=2&&(R.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(S)),i.height=S)}d.drawImage(e,0,0,i.width,i.height),h.requestFrame&&h.requestFrame(),a!==n._mediaStreamTrack&&(a=n._mediaStreamTrack,e.srcObject=new MediaStream([a]))},i.stopCapture=mS(()=>i.startCapture&&i.startCapture(),s);const p=h.stop;return h.stop=()=>{p.call(h),e&&(e.remove(),e.srcObject=null,e=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),R.debug("clean low stream renderer")},h}function EN(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function gN(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?EN(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):EN(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}X([dr,C("design:type",Function),C("design:paramtypes",[Array,Array]),C("design:returntype",W)],Mn.prototype,"updateRemoteRTPCapabilities",null),X([dr,C("design:type",Function),C("design:paramtypes",[Object,Object,Array,Object,String,String]),C("design:returntype",W)],Mn.prototype,"connect",null),X([dr,C("design:type",Function),C("design:paramtypes",[Object,Array]),C("design:returntype",W)],Mn.prototype,"createDataChannels",null),X([dr,C("design:type",Function),C("design:paramtypes",[String,Array,String,Object]),C("design:returntype",W)],Mn.prototype,"receive",null),X([dr,C("design:type",Function),C("design:paramtypes",[Array]),C("design:returntype",W)],Mn.prototype,"batchReceive",null),X([dr,C("design:type",Function),C("design:paramtypes",[Array]),C("design:returntype",W)],Mn.prototype,"stopReceiving",null),X([dr,C("design:type",Function),C("design:paramtypes",[String]),C("design:returntype",W)],Mn.prototype,"muteRemote",null),X([dr,C("design:type",Function),C("design:paramtypes",[String]),C("design:returntype",W)],Mn.prototype,"unmuteRemote",null),X([dr,C("design:type",Function),C("design:paramtypes",[Array]),C("design:returntype",W)],Mn.prototype,"muteLocal",null),X([dr,C("design:type",Function),C("design:paramtypes",[Array]),C("design:returntype",W)],Mn.prototype,"unmuteLocal",null),X([dr,C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],Mn.prototype,"close",null),X([dr,C("design:type",Function),C("design:paramtypes",[String,di]),C("design:returntype",W)],Mn.prototype,"updateEncoderConfig",null),X([dr,C("design:type",Function),C("design:paramtypes",[String,di]),C("design:returntype",W)],Mn.prototype,"updateSendParameters",null),X([dr,C("design:type",Function),C("design:paramtypes",[di,String]),C("design:returntype",W)],Mn.prototype,"replaceTrack",null),X([dr,C("design:type",Function),C("design:paramtypes",[String]),C("design:returntype",W)],Mn.prototype,"getRemoteSSRC",null);const SN=`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0
a=msid-semantic: WMS
a=ice-lite
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:0
`,Ff="9",pT=2e4,fT=4e4;class _5{get localCapabilities(){return yn(this._localCapabilities)}get rtpCapabilities(){return yn(this._rtpCapabilities)}get candidates(){return yn(this._candidates)}get iceParameters(){return yn(this._iceParameters)}get dtlsParameters(){return yn(this._dtlsParameters)}constructor(t){g(this,"sessionDesc",void 0),g(this,"_localCapabilities",void 0),g(this,"_rtpCapabilities",void 0),g(this,"_candidates",void 0),g(this,"_iceParameters",void 0),g(this,"_dtlsParameters",void 0),g(this,"setup",void 0),g(this,"currentMidIndex",void 0),g(this,"cname",void 0),g(this,"firefoxSsrcMidMap",new Map),t=yn(t);const{remoteIceParameters:e,remoteDtlsParameters:i,candidates:s,remoteRTPCapabilities:a,remoteSetup:d,localCapabilities:u,cname:h}=t,p=dn.parse(SN);this._rtpCapabilities=a,this._candidates=s,this._iceParameters=e,this._dtlsParameters=i,this._localCapabilities=u,this.setup=d,this.cname=h;const _=this.rtpCapabilities.send;for(const m of p.mediaDescriptions){if(m.attributes.iceUfrag=e.iceUfrag,m.attributes.icePwd=e.icePwd,m.attributes.fingerprints=i.fingerprints,m.attributes.candidates=s,m.attributes.setup=d,m.media.mediaType==="application"&&(m.attributes.sctpPort="5000"),m.media.mediaType==="video"&&(m.media.fmts=_.videoCodecs.map(S=>S.payloadType.toString(10)),m.attributes.payloads=_.videoCodecs,m.attributes.extmaps=_.videoExtensions,x("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:S,ssrcGroups:y}=zr([{ssrcId:fT,rtx:x("USE_SUB_RTX")?40001:void 0}],this.cname);m.attributes.ssrcs=S,m.attributes.ssrcGroups=y}if(m.media.mediaType==="audio"&&(m.media.fmts=_.audioCodecs.map(S=>S.payloadType.toString(10)),m.attributes.payloads=_.audioCodecs,m.attributes.extmaps=_.audioExtensions,wa(m),x("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:S,ssrcGroups:y}=zr([{ssrcId:pT}],this.cname);m.attributes.ssrcs=S,m.attributes.ssrcGroups=y}}this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}updateRemoteRTPCapabilities(t){const e=dn.parse(SN);this._rtpCapabilities=t;const i=this.rtpCapabilities.send;for(const s of e.mediaDescriptions){if(s.attributes.iceUfrag=this._iceParameters.iceUfrag,s.attributes.icePwd=this._iceParameters.icePwd,s.attributes.fingerprints=this._dtlsParameters.fingerprints,s.attributes.candidates=this._candidates,s.attributes.setup=this.setup,s.media.mediaType==="application"&&(s.attributes.sctpPort="5000"),s.media.mediaType==="video"&&(s.media.fmts=i.videoCodecs.map(a=>a.payloadType.toString(10)),s.attributes.payloads=i.videoCodecs,s.attributes.extmaps=i.videoExtensions,x("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:a,ssrcGroups:d}=zr([{ssrcId:fT,rtx:x("USE_SUB_RTX")?40001:void 0}],this.cname);s.attributes.ssrcs=a,s.attributes.ssrcGroups=d}if(s.media.mediaType==="audio"&&(s.media.fmts=i.audioCodecs.map(a=>a.payloadType.toString(10)),s.attributes.payloads=i.audioCodecs,s.attributes.extmaps=i.audioExtensions,x("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:a,ssrcGroups:d}=zr([{ssrcId:pT}],this.cname);s.attributes.ssrcs=a,s.attributes.ssrcGroups=d}}this.sessionDesc=e,this.currentMidIndex=e.mediaDescriptions.length-1}preloadRemoteMedia(t){this.rtpCapabilities;const e=this.candidates,i=this.dtlsParameters,s=this.iceParameters,a=this.rtpCapabilities.send;for(let d=1;d<t;d++){const u=2*d+pT,h=2*d+fT,{ssrcs:p,ssrcGroups:_}=zr([{ssrcId:u}],this.cname),{ssrcs:m,ssrcGroups:S}=zr([{ssrcId:h,rtx:x("USE_SUB_RTX")?h+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Ff,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.videoCodecs.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:s.iceUfrag,icePwd:s.icePwd,unrecognized:[],candidates:e,extmaps:a.videoExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:m,ssrcGroups:S,rtcpFeedbackWildcards:[],payloads:a.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*d-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Ff,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.audioCodecs.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:s.iceUfrag,icePwd:s.icePwd,unrecognized:[],candidates:e,extmaps:a.audioExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:_,rtcpFeedbackWildcards:[],payloads:a.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*d)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return dn.print(this.sessionDesc)}send(t,e,i,s){const{ssrcs:a,ssrcGroups:d}=zr(e,this.cname,x("SYNC_GROUP")?i:void 0),u=this.findPreloadMediaDesc(a);if(u){if(We()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,u.attributes.mid),s&&(s.twcc||s.remb)){const h=this.sessionDesc.mediaDescriptions.indexOf(u);return this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(u,s),{mid:u.attributes.mid,needExchangeSDP:!0}}return{mid:u.attributes.mid,needExchangeSDP:!1}}{const h=this.findAvailableMediaIndex(t,a);let p;return h===-1||bi()||wi()||rw()||h===0&&x("USE_SUB_RTX")?(p=this.createOrRecycleSendMedia(t,a,d,"sendonly",s),this.updateBundleMids()):(p=yn(this.sessionDesc.mediaDescriptions[h]),p.attributes.direction="sendonly",p.attributes.ssrcs=a,p.attributes.ssrcGroups=d,this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(p,s)),We()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,p.attributes.mid),{mid:p.attributes.mid,needExchangeSDP:!0}}}batchSend(t){const e=t.map(a=>{let{kind:d,ssrcMsg:u,mslabel:h}=a;return this.send(d,u,h)}),i=[];let s=!1;return e.forEach(a=>{let{mid:d,needExchangeSDP:u}=a;u&&(s=!0),i.push(d)}),{mids:i,needExchangeSDP:s}}stopSending(t){const e=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&t.indexOf(i.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach(i=>{i.attributes.mid==="0"||We()||bi()||wi()?i.attributes.ssrcs=[]:(i.attributes.ssrcs=[],i.attributes.direction="inactive",i.media.port="0")}),this.updateBundleMids()}mute(t){const e=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!e)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));e.attributes.direction="inactive"}unmute(t){const e=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!e)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));e.attributes.direction="sendonly"}muteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(i=>It(t).call(t,i.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(i=>It(t).call(t,i.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(i=>{i.attributes.direction="recvonly"})}receive(t,e,i,s){t.forEach((a,d)=>{this.createOrRecycleRecvMedia(a,[],"recvonly",e,i,s[d])}),this.updateBundleMids()}stopReceiving(t){const e=this.sessionDesc.mediaDescriptions.filter(i=>t.indexOf(i.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(t){t===ci.TCP?this._candidates.forEach(e=>{this._candidates.findIndex(i=>i.transport==="tcp"&&i.connectionAddress===e.connectionAddress&&i.port===e.port)===-1&&this._candidates.push(gN(gN({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))}):this._candidates=this._candidates.filter(e=>e.transport!=="tcp");for(const e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}restartICE(t){t=yn(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const e=[];for(let i=0;i<t;i++)e.push((this.currentMidIndex+i+1).toString(10));return e}findAvailableMediaIndex(t,e){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const s=i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(We()){if(s){const a=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(a||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!a||a!==i.attributes.mid)}return!1}return s})}createOrRecycleRecvMedia(t,e,i,s,a,d){const u=t._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,p=xf(u,h,this.localCapabilities.send,u===mt.VIDEO?s:a),_=u===mt.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const m="".concat(this.currentMidIndex);let S={media:{mediaType:u,port:Ff,protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(m)}};S=this.mungRecvMediaDsec(S,t,d);const y=this.findFirstClosedMedia(u);if(y){const b=this.sessionDesc.mediaDescriptions.indexOf(y);this.sessionDesc.mediaDescriptions[b]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}updateRemoteCodec(t,e,i){const s=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(S=>S.rtpMap&&S.rtpMap.encodingName.toLowerCase()||"").filter(S=>{var y;return It(y=Object.keys(vc)).call(y,S)}))],a=new Set(e);if(s.every(S=>a.has(S)))return R.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(e)),!1;const d=this._rtpCapabilities.recv.videoCodecs.filter(S=>e.some(y=>{var b;return It(b=S.rtpMap&&S.rtpMap.encodingName.toLowerCase()||"").call(b,y)}));if(d.length===0)return R.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(s," codecs: ").concat(e)),!1;const u=[...new Set(d.map(S=>S.rtpMap&&S.rtpMap.encodingName.toLowerCase()||""))];let h;if(R.debug("updateRemoteCodec, from ".concat(s," to ").concat(u)),t.length===0)h=this.sessionDesc.mediaDescriptions.filter(S=>S.media.mediaType==="video"&&S.attributes.direction==="recvonly");else if(h=this.sessionDesc.mediaDescriptions.filter(S=>S.attributes.mid&&It(t).call(t,S.attributes.mid)&&S.attributes.direction==="recvonly"),h.length!==t.length)return R.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(t,", codecs: ").concat(e)),!1;this._rtpCapabilities.recv.videoCodecs=d;const p=this.localCapabilities.send,_=this.rtpCapabilities.recv,m=xf(mt.VIDEO,_,p,i);return h.forEach(S=>{const y=m.map(b=>b.payloadType.toString(10));R.debug("updateRemoteCodec mid: ".concat(S.attributes.mid,", from ").concat(S.attributes.payloads," to ").concat(m)),S.attributes.payloads=m,S.media.fmts=y}),!0}createOrRecycleSendMedia(t,e,i,s,a){const d=this.rtpCapabilities.send,u=t===mt.VIDEO?d.videoCodecs:d.audioCodecs,h=t===mt.VIDEO?d.videoExtensions:d.audioExtensions;this.currentMidIndex+=1;const p="".concat(this.currentMidIndex);let _={media:{mediaType:t,port:Ff,protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(p)}};_=this.mungSendMediaDesc(_,a);const m=this.findFirstClosedMedia(t);if(m){const S=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[S]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,e,i){const s=yn(t);return aT(s),Vc(s,e),cT(s,e),$0(s),kf(s,i,this.localCapabilities.send),s}mungSendMediaDesc(t,e){const i=yn(t);return kf(i,e,this.localCapabilities.recv),wa(i),i}updateRecvMedia(t,e){const i=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===t);if(i!==-1){const s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],e);this.sessionDesc.mediaDescriptions[i]=s}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(e=>We()?e.media.port==="0"&&e.media.mediaType===t:e.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(e=>{var i;return((i=e.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===t[0].ssrcId})}getSSRC(t){var e;return(e=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t))===null||e===void 0?void 0:e.attributes.ssrcs}}function TN(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Bf(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?TN(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):TN(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class hi extends Xp{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(t,e,i){super(t,e),g(this,"store",void 0),g(this,"peerConnection",void 0),g(this,"remoteSDP",void 0),g(this,"initialOffer",void 0),g(this,"transportEventReceiver",void 0),g(this,"statsFilter",void 0),g(this,"useXR",x("USE_XR")),g(this,"localCapabilities",void 0),g(this,"localCandidateCount",0),g(this,"allCandidatesReceived",!1),g(this,"remoteCodecs",void 0),g(this,"dataStreamChannelMap",new Map),g(this,"establishPromise",void 0),g(this,"mutex",new zn("NVExtentionsConnection-mutex")),g(this,"rtcMedia",void 0),this.store=e,this.peerConnection=i,this.statsFilter=Vf(this.peerConnection,x("STATS_UPDATE_INTERVAL"),void 0,We()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(t){try{const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=xc(e.sdp),s=await Z0({filterRTX:!x("USE_PUB_RTX")&&!x("USE_SUB_RTX"),filterVideoFec:x("FILTER_VIDEO_FEC"),filterAudioFec:x("FILTER_AUDIO_FEC"),filterVideoCodec:x("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=s,this.initialOffer=e,Bf(Bf({},i),{},{rtpCapabilities:s,offerSDP:e.sdp})}catch(e){throw new B(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(t,e,i,s,a,d){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new _5({remoteIceParameters:t,remoteDtlsParameters:e,candidates:i,remoteRTPCapabilities:s,remoteSetup:a,localCapabilities:Mf(this.localCapabilities),cname:d});const u=this.remoteSDP.toString(),h=dn.parse(this.initialOffer.sdp),p=h.mediaDescriptions.find(S=>S.media.mediaType==="audio");p&&wa(p),this.useXR&&Uf(h);const _=dn.print(h),m=this.logSDPExchange(_||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:_}),m==null||m(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(u){throw new B(O.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(u.toString()))}}async updateRemoteRTPCapabilities(t,e){let i;this.remoteCodecs=e,this.localCapabilities&&(i=Mf(this.localCapabilities));const s=[...new Set(i&&i.send.videoCodecs.map(a=>a.rtpMap&&a.rtpMap.encodingName.toLowerCase()||"").filter(a=>{var d;return It(d=Object.keys(vc)).call(d,a)}))];if(vt.updateRemoteRTPCapabilities(this.store.sessionId,{mids:t,localCodecs:s,remoteCodecs:this.remoteCodecs}),!this.remoteSDP)return void R.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(s,", codecs: ").concat(e));if(this.remoteSDP.updateRemoteCodec(t,e,this.store.codec)){const a=await this.peerConnection.createOffer(),d=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a);const u=this.remoteSDP.toString();d==null||d(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else R.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async updateRemoteConnect(t){var e,i,s,a;(e=this.remoteSDP)===null||e===void 0||e.updateRemoteRTPCapabilities(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&((a=this.remoteSDP)===null||a===void 0||a.updateRemoteCodec([],this.remoteCodecs,this.store.codec)),(i=this.remoteSDP)===null||i===void 0||i.preloadRemoteMedia(2);const d=(s=this.remoteSDP)===null||s===void 0?void 0:s.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const u=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(u),R.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(t,e,i){var s=this;return qr(function*(){const a=yield Te(s.mutex.lock("From NVExtentionsConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const d=[];t.forEach(I=>{const A=s.peerConnection.addTransceiver(I._mediaStreamTrack,{direction:"sendonly"});d.push(A)}),We()&&x("SIMULCAST")===!0&&(yield Te(s.applySimulcastForFirefox(d,t)));const u=yield Te(s.peerConnection.createOffer()),h=s.remoteSDP.predictReceivingMids(t.length),p=s.mungSendOfferSDP(u.sdp,t,h),_=dn.parse(p),m=h.map(I=>{const A=_.mediaDescriptions.find(L=>L.attributes.mid===I);if(!A)throw new Error("Cannot extract ssrc from mediaDescription.");return X0(A,x("USE_PUB_RTX"))});let S;try{S=yield m}catch(I){S=[],s.remoteSDP.receive(t,e,i,S);const A=s.remoteSDP.toString();throw yield Te(s.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Te(s.peerConnection.setRemoteDescription({type:"answer",sdp:A})),yield Te(s.stopSending(h,!0)),I}s.remoteSDP.receive(t,e,i,S);const y=s.remoteSDP.toString(),b=s.logSDPExchange(p,"offer","local","send");return yield Te(s.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Te(s.applySimulcastEncodings(d,t)),yield Te(s.applySendEncodings(d,t)),b==null||b(y),yield Te(s.peerConnection.setRemoteDescription({type:"answer",sdp:y})),d.map((I,A)=>{const L=h[A];return{localSSRC:m[A],id:L,transceiver:I}})}catch(d){throw d instanceof B?d:new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(d.toString()))}finally{a()}})()}async stopSending(t,e){const i=e?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const s=this.peerConnection.getTransceivers().filter(h=>t.indexOf(h.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");s.map(h=>{var p;h.direction="inactive",(p=h.stop)===null||p===void 0||p.call(h)});const a=await this.peerConnection.createOffer(),d=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(t);const u=this.remoteSDP.toString();d==null||d(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(s.toString()))}finally{i&&i()}}async createDataChannels(t,e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(t);return i&&i.readyState==="open"?R.debug("[P2PConnection] Channels are already available and can be reused directly."):(i=this.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:x("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,i)),void e.forEach(s=>{s._updateOriginDataChannel(i)})}catch(i){throw i instanceof B?i:new B(O.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(t){try{const e=this.dataStreamChannelMap.get(t);return e==null||e.close(),void this.dataStreamChannelMap.delete(t)}catch(e){throw e instanceof B?e:new B(O.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(e.toString()))}}async receive(t,e,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(t," before remoteSDP created."));const{mid:a,needExchangeSDP:d}=this.remoteSDP.send(t,e,i,s);if(d){const h=this.remoteSDP.toString(),p=this.logSDPExchange(h,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const _=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(_.sdp,a,t);p==null||p(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),R.debug("[NVExtentionsConnection] receive ".concat(t," by exchanging SDP."))}else R.debug("[NVExtentionsConnection] receive ".concat(t," no need to exchange SDP."));const u=this.peerConnection.getTransceivers().find(h=>h.mid===a);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:a}}catch(a){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(a.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:e,needExchangeSDP:i}=this.remoteSDP.batchSend(t);if(i){const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=await this.peerConnection.createAnswer();a==null||a(d.sdp||""),await this.peerConnection.setLocalDescription(d),R.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else R.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return e.map(s=>{const a=this.peerConnection.getTransceivers().find(d=>d.mid===s);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:s}})}catch(e){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const e=this.remoteSDP.toString(),i=this.logSDPExchange(e,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(e){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const e=this.remoteSDP.toString(),i=this.logSDPExchange(e,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(e){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(e.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const e=this.remoteSDP.toString(),i=this.logSDPExchange(e,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(e){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(e.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const e=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(e.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");e.map(d=>{d.direction="inactive"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const a=this.remoteSDP.toString();s==null||s(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(e){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const e=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(e.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");e.map(async(d,u)=>{d.direction="sendonly"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);const a=this.remoteSDP.toString();s==null||s(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(e){throw new B(O.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(t){var e=this;return qr(function*(){const i=yield Te(e.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!e.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(xe().supportPCSetConfiguration){const p=e.peerConnection.getConfiguration(),_=t===ci.RELAY?"relay":"all";p.iceTransportPolicy!==_&&(R.debug("restartICE change iceTransportPolicy from [".concat(p.iceTransportPolicy,"] to [").concat(_,"]")),p.iceTransportPolicy=_,e.peerConnection.setConfiguration(p))}else if(t===ci.RELAY)return;t!==ci.RELAY&&e.remoteSDP.updateCandidates(t);const s=yield Te(e.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=xc(s.sdp),{remoteIceParameters:d}=yield a.iceParameters;e.remoteSDP.restartICE(d);const u=e.remoteSDP.toString(),h=e.logSDPExchange(s.sdp||"","offer","local","restartICE");yield Te(e.peerConnection.setLocalDescription(s)),h==null||h(u),yield Te(e.peerConnection.setRemoteDescription({type:"answer",sdp:u}))}catch(s){R.warning("restart ICE failed, abort operation",s)}finally{i()}})()}close(){var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[e],[t]);this.remoteSDP.updateRecvMedia(t,e);const a=this.remoteSDP.toString(),d=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),d==null||d(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new B(O.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,e){const i=this.peerConnection.getTransceivers().filter(s=>s.mid===t);i.length===1&&(this.isVP8Simulcast(e)?We()||await this.applySimulcastEncodings(i,[e]):await this.applySendEncodings(i,[e]))}setStatsRemoteVideoIsReady(t,e){this.statsFilter.setVideoIsReady2(t,e)}async replaceTrack(t,e){const i=this.peerConnection.getTransceivers().find(s=>s.mid===e);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}getP2PConnectionParams(){var t;if((t=this.peerConnection.currentLocalDescription)===null||t===void 0||!t.sdp||!this.localCapabilities)throw new Error;return Bf(Bf({},xc(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},x("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const e={iceServers:[]};return t.iceServers?e.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Nd(t.turnServer.servers)?e.iceServers=t.turnServer.servers:(e.iceServers&&e.iceServers.push(...hi.turnServerConfigToIceServers(t.turnServer.servers)),x("USE_TURN_SERVER_OF_GATEWAY")&&e.iceServers&&t.turnServer.serversFromGateway&&e.iceServers.push(...hi.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),x("FORCE_TURN_TCP")?e.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(e.iceTransportPolicy="relay")}))),e}static turnServerConfigToIceServers(t){const e=[];return t.forEach(i=>{i.security?i.tcpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Vu(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!x("FORCE_TURN_TCP")&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),e}async applySendEncodings(t,e){try{if(!xe().supportSetRtpSenderParameters||t.length!==e.length)return;for(let m=0;m<t.length;m++){const S=t[m],y=e[m];if(y&&y instanceof te){var i,s,a;if(this.isVP8Simulcast(y))continue;const b={},I={};switch(y._optimizationMode){case"motion":b.degradationPreference="maintain-framerate";break;case"detail":b.degradationPreference="maintain-resolution";break;default:b.degradationPreference="balanced"}var d,u,h,p;if((i=y._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&(I.maxBitrate=1e3*((d=y._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)),It(s=y._hints).call(s,Fe.LOW_STREAM)&&((u=y._encoderConfig)!==null&&u!==void 0&&u.frameRate&&(I.maxFramerate=Nr(y._encoderConfig.frameRate)),(h=y._encoderConfig)!==null&&h!==void 0&&h.scaleResolutionDownBy&&((p=y._encoderConfig)===null||p===void 0?void 0:p.scaleResolutionDownBy)>1&&(I.scaleResolutionDownBy=y._encoderConfig.scaleResolutionDownBy)),x("DSCP_TYPE")&&la()){var _;const U=x("DSCP_TYPE");It(_=["very-low","low","medium","high"]).call(_,U)&&(I.networkPriority=U)}const A=S.sender.getParameters(),L=(a=A.encodings)===null||a===void 0?void 0:a[0];We()&&!L&&(b.encodings=[I]),L&&Object.assign(L,I),Object.assign(A,b),await S.sender.setParameters(A)}}}catch{R.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(t,e,i){const s=dn.parse(t);return e.forEach((a,d)=>{const u=i[d],h=s.mediaDescriptions.find(p=>p.attributes.mid===u);h&&(Vc(h,a),dT(h,a,this.store.codec))}),dn.print(s)}mungReceiveAnswerSDP(t,e,i){const s=dn.parse(t),a=s.mediaDescriptions.find(d=>d.attributes.mid===e);return a&&i===mt.AUDIO&&a.media.mediaType==="audio"&&wa(a),this.useXR&&Uf(s),dn.print(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var e;(e=this.onFirstAudioReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var e;(e=this.onFirstVideoReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var e;(e=this.onFirstAudioDecoded)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,e,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,e,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,e)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,e)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,e)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,e)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var e;(e=this.onFirstVideoDecodedTimeout)===null||e===void 0||e.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,e){if(t.length===e.length)for(let h=0;h<t.length;h++){var i,s,a,d,u;const p=t[h],_=e[h];if(_ instanceof te&&!It(i=_._hints).call(i,Fe.LOW_STREAM)&&(s=_._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((a=_._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(d=_._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((u=_._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){const m={},S={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};m.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];const y=p.sender.getParameters();await p.sender.setParameters(Object.assign(y,m))}}}async applySimulcastEncodings(t,e){if(!We()&&t.length===e.length)for(let i=0;i<t.length;i++){const s=e[i];if(s instanceof te&&this.isVP8Simulcast(s)){const a=t[i],d={},u={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];const h=a.sender.getParameters();await a.sender.setParameters(Object.assign(h,d))}}}isVP8Simulcast(t){var e,i,s,a,d;return!!(t instanceof te&&x("SIMULCAST")&&this.store.codec==="vp8"&&!It(e=t._hints).call(e,Fe.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=t._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(a=t._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((d=t._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1)}logSDPExchange(t,e,i,s){if(x("SDP_LOGGING"))return R.upload("exchanging ".concat(i," ").concat(e," SDP during NVExtentionsConnection.").concat(s,`
`),t),e==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",s)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const e=this.remoteSDP.getSSRC(t);return e==null?void 0:e[0].ssrcId}setConfiguration(t){if(xe().supportPCSetConfiguration){const e=hi.resolvePCConfiguration(t);this.peerConnection.setConfiguration(e)}}}function $i(n,t,e){const i=n[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return e.value=async function(){const s=this.mutex,a=await s.lock("From NVExtentionsConnection.".concat(t));try{for(var d=arguments.length,u=new Array(d),h=0;h<d;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{a()}},e}function yN(n){var t,e,i,s=2;for(typeof Symbol<"u"&&(e=K0,i=Symbol.iterator);s--;){if(e&&(t=n[e])!=null)return t.call(n);if(i&&(t=n[i])!=null)return new jf(t.call(n));e="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function jf(n){function t(e){if(Object(e)!==e)return W.reject(new TypeError(e+" is not an object."));var i=e.done;return W.resolve(e.value).then(function(s){return{value:s,done:i}})}return jf=function(e){this.s=e,this.n=e.next},jf.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var i=this.s.return;return i===void 0?W.resolve({value:e,done:!0}):t(i.apply(this.s,arguments))},throw:function(e){var i=this.s.return;return i===void 0?W.reject(e):t(i.apply(this.s,arguments))}},new jf(n)}X([$i,C("design:type",Function),C("design:paramtypes",[Object,Object,Array,Object,String,String]),C("design:returntype",W)],hi.prototype,"connect",null),X([$i,C("design:type",Function),C("design:paramtypes",[Array,Array]),C("design:returntype",W)],hi.prototype,"updateRemoteRTPCapabilities",null),X([$i,C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",W)],hi.prototype,"updateRemoteConnect",null),X([$i,C("design:type",Function),C("design:paramtypes",[Object,Array]),C("design:returntype",W)],hi.prototype,"createDataChannels",null),X([$i,C("design:type",Function),C("design:paramtypes",[String,Array,String,Object]),C("design:returntype",W)],hi.prototype,"receive",null),X([$i,C("design:type",Function),C("design:paramtypes",[Array]),C("design:returntype",W)],hi.prototype,"batchReceive",null),X([$i,C("design:type",Function),C("design:paramtypes",[Array]),C("design:returntype",W)],hi.prototype,"stopReceiving",null),X([$i,C("design:type",Function),C("design:paramtypes",[String]),C("design:returntype",W)],hi.prototype,"muteRemote",null),X([$i,C("design:type",Function),C("design:paramtypes",[String]),C("design:returntype",W)],hi.prototype,"unmuteRemote",null),X([$i,C("design:type",Function),C("design:paramtypes",[Array]),C("design:returntype",W)],hi.prototype,"muteLocal",null),X([$i,C("design:type",Function),C("design:paramtypes",[Array]),C("design:returntype",W)],hi.prototype,"unmuteLocal",null),X([$i,C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],hi.prototype,"close",null),X([$i,C("design:type",Function),C("design:paramtypes",[String,di]),C("design:returntype",W)],hi.prototype,"updateEncoderConfig",null),X([$i,C("design:type",Function),C("design:paramtypes",[String,di]),C("design:returntype",W)],hi.prototype,"updateSendParameters",null),X([$i,C("design:type",Function),C("design:paramtypes",[di,String]),C("design:returntype",W)],hi.prototype,"replaceTrack",null),X([$i,C("design:type",Function),C("design:paramtypes",[String]),C("design:returntype",W)],hi.prototype,"getRemoteSSRC",null);class Un extends Xp{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(t,e){super(t,e),g(this,"store",void 0),g(this,"peerConnection",void 0),g(this,"cname",void 0),g(this,"mutex",new zn("DataChannelConnection-mutex")),g(this,"dataChannel",void 0),g(this,"_p2pConnection",void 0),g(this,"establishPromise",void 0),g(this,"_nvMedia",void 0),this.store=e,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(Un.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new hi(t,e,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var t;const e=(t=this._nvMedia)===null||t===void 0?void 0:t.getLocalRtpCapabilities();return await this._p2pConnection.establish(e)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(t,e,i,s,a,d){return this.cname=d,await this._p2pConnection.connect(t,e,i,s,a,d),await new W((u,h)=>{const p=setTimeout(()=>{this.closeSignal(),h(new B(O.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(i))))},2e3);this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(p),void u()},this.dataChannel.onerror=_=>{this.closeSignal(),h(_)}}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(t,e){return this._p2pConnection.updateRemoteRTPCapabilities(t,e)}send(t,e,i){var s=this;return qr(function*(){const a=yield Te(s.mutex.lock("From DataChannelConnection.send"));try{return yield*Pf(yN(s._p2pConnection.send(t,e,i)))}finally{a()}})()}async stopSending(t,e){return this._p2pConnection.stopSending(t,e)}async createDataChannels(t,e){return this._p2pConnection.createDataChannels(t,e)}async stopDataChannels(t){return this._p2pConnection.stopDataChannels(t)}async receive(t,e,i,s){return this._nvMedia?(R.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(t,e,this.cname)):(R.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),await this._p2pConnection.receive(t,e,i,s))}async batchReceive(t){return[...await this._p2pConnection.batchReceive(t)]}async stopReceiving(t){return await this._p2pConnection.stopReceiving(t)}async muteRemote(t){return await this._p2pConnection.muteRemote(t)}async unmuteRemote(t){return await this._p2pConnection.unmuteRemote(t)}async muteLocal(t){return await this._p2pConnection.muteLocal(t)}async unmuteLocal(t){return await this._p2pConnection.unmuteLocal(t)}restartICE(t){var e=this;return qr(function*(){return yield*Pf(yN(e._p2pConnection.restartICE(t)))})()}close(){var t;(t=this._nvMedia)===null||t===void 0||t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(t){return this._p2pConnection.getRemoteVideoIsReady(t)}updateRemoteConnect(t){var e;(e=this._nvMedia)===null||e===void 0||e.setRemoteRtpCapabilities(t),this._p2pConnection.updateRemoteConnect(t)}async updateEncoderConfig(t,e){return await this._p2pConnection.updateEncoderConfig(t,e)}async updateSendParameters(t,e){return await this._p2pConnection.updateSendParameters(t,e)}setStatsRemoteVideoIsReady(t,e){this._p2pConnection.setStatsRemoteVideoIsReady(t,e)}async replaceTrack(t,e){return await this._p2pConnection.replaceTrack(t,e)}async getRemoteSSRC(t){return this._p2pConnection.getRemoteSSRC(t)}logSDPExchange(t,e,i,s){if(x("SDP_LOGGING"))return R.upload("exchanging ".concat(i," ").concat(e," SDP during DataChannelConnection.").concat(s,`
`),t),e==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",s)}:void 0}static resolvePCConfiguration(t){const e={iceServers:[]};return t.iceServers?e.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Nd(t.turnServer.servers)?e.iceServers=t.turnServer.servers:(e.iceServers&&e.iceServers.push(...Un.turnServerConfigToIceServers(t.turnServer.servers)),x("USE_TURN_SERVER_OF_GATEWAY")&&e.iceServers&&t.turnServer.serversFromGateway&&e.iceServers.push(...Un.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),x("FORCE_TURN_TCP")?e.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(e.iceTransportPolicy="relay")}))),e}static turnServerConfigToIceServers(t){const e=[];return t.forEach(i=>{i.security?i.tcpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Vu(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!x("FORCE_TURN_TCP")&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),e}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=t=>{var e;return(e=this.onICEConnectionStateChange)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onConnectionStateChange=t=>{var e;return(e=this.onConnectionStateChange)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onDTLSTransportStateChange=t=>{var e;return(e=this.onDTLSTransportStateChange)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onDTLSTransportError=t=>{var e;return(e=this.onDTLSTransportError)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onICETransportStateChange=t=>{var e;return(e=this.onICETransportStateChange)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onFirstAudioReceived=t=>{var e;return(e=this.onFirstAudioReceived)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onFirstVideoReceived=t=>{var e;return(e=this.onFirstVideoReceived)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onFirstAudioDecoded=t=>{var e;return(e=this.onFirstAudioDecoded)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onFirstVideoDecoded=(t,e,i)=>{var s;return(s=this.onFirstVideoDecoded)===null||s===void 0?void 0:s.call(this,t,e,i)},this._p2pConnection.onFirstVideoDecodedTimeout=t=>{var e;return(e=this.onFirstVideoDecodedTimeout)===null||e===void 0?void 0:e.call(this,t)},this._p2pConnection.onSelectedLocalCandidateChanged=(t,e)=>{var i;return(i=this.onSelectedLocalCandidateChanged)===null||i===void 0?void 0:i.call(this,t,e)},this._p2pConnection.onSelectedRemoteCandidateChanged=(t,e)=>{var i;return(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0?void 0:i.call(this,t,e)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}setConfiguration(t){this._p2pConnection.setConfiguration(t)}}function Dr(n,t,e){const i=n[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return e.value=async function(){const s=this.mutex,a=await s.lock("From DataChannelConnection.".concat(t));try{for(var d=arguments.length,u=new Array(d),h=0;h<d;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{a()}},e}function RN(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function vN(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?RN(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):RN(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}X([Dr,C("design:type",Function),C("design:paramtypes",[Object,Object,Array,Object,String,String]),C("design:returntype",W)],Un.prototype,"connect",null),X([Dr,C("design:type",Function),C("design:paramtypes",[Array,Array]),C("design:returntype",W)],Un.prototype,"updateRemoteRTPCapabilities",null),X([Dr,C("design:type",Function),C("design:paramtypes",[Object,Array]),C("design:returntype",W)],Un.prototype,"createDataChannels",null),X([Dr,C("design:type",Function),C("design:paramtypes",[String,Array,String,Object]),C("design:returntype",W)],Un.prototype,"receive",null),X([Dr,C("design:type",Function),C("design:paramtypes",[Array]),C("design:returntype",W)],Un.prototype,"stopReceiving",null),X([Dr,C("design:type",Function),C("design:paramtypes",[String]),C("design:returntype",W)],Un.prototype,"muteRemote",null),X([Dr,C("design:type",Function),C("design:paramtypes",[String]),C("design:returntype",W)],Un.prototype,"unmuteRemote",null),X([Dr,C("design:type",Function),C("design:paramtypes",[Array]),C("design:returntype",W)],Un.prototype,"muteLocal",null),X([Dr,C("design:type",Function),C("design:paramtypes",[Array]),C("design:returntype",W)],Un.prototype,"unmuteLocal",null),X([Dr,C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],Un.prototype,"close",null),X([Dr,C("design:type",Function),C("design:paramtypes",[String,di]),C("design:returntype",W)],Un.prototype,"updateEncoderConfig",null),X([Dr,C("design:type",Function),C("design:paramtypes",[String,di]),C("design:returntype",W)],Un.prototype,"updateSendParameters",null),X([Dr,C("design:type",Function),C("design:paramtypes",[di,String]),C("design:returntype",W)],Un.prototype,"replaceTrack",null),X([Dr,C("design:type",Function),C("design:paramtypes",[String]),C("design:returntype",W)],Un.prototype,"getRemoteSSRC",null);class CN extends Ye{constructor(){super(),g(this,"uplinkStatsUploadInterval",void 0),g(this,"uplinkRelatedStatsUploadInterval",void 0),g(this,"uplinkDenoiserStatsUploadInterval",void 0),g(this,"transportStatsUploadInterval",void 0),g(this,"uplinkExtensionStatsUploadInterval",void 0),g(this,"downlinkExtensionStatsUploadInterval",void 0),g(this,"extensionUsageStatsUploadInterval",void 0),g(this,"downlinkStatsUploadInterval",void 0),g(this,"downlinkRelatedStatsUploadInterval",void 0),g(this,"lastStats",void 0),g(this,"uploadUnplinkStarted",!1),g(this,"uploadDownlinkStarted",!1),g(this,"uploadTransportStarted",!1),g(this,"uploadExtensionUsageStarted",!1),g(this,"requestStats",void 0),g(this,"requestTransportStats",void 0),g(this,"requestLocalMedia",void 0),g(this,"requestRemoteMedia",void 0),g(this,"requestAllTracks",void 0),g(this,"requestVideoIsReady",void 0),g(this,"requestUpload",void 0)}startUploadTransportStats(t){this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval(()=>{var e;const i=(e=this.requestStats)===null||e===void 0?void 0:e.call(this);if(i){const a=R0(i);if(t){var s;const d=(s=this.requestStats)===null||s===void 0?void 0:s.call(this,!0);if(d){const u=R0(d);a.connectionType+=u.connectionType<<3}a.connectionType+=110}else a.connectionType+=100;ds(()=>{var d;(d=this.requestUpload)===null||d===void 0||d.call(this,Ji.TRANSPORT_STATS,a)})}},1e3))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);const t=new Map;this.extensionUsageStatsUploadInterval=window.setInterval(async()=>{var e,i,s;const a=Date.now(),d={connectionInterval:x("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:a};let u=[];const h=((e=this.requestAllTracks)===null||e===void 0?void 0:e.call(this))||[];for(const S of h)!S.muted&&S.enabled&&(u=u.concat(await S.getProcessorUsage()));const p=((i=this.requestRemoteMedia)===null||i===void 0?void 0:i.call(this))||[];for(const[S,y]of p)y.has(mt.VIDEO)&&S.videoTrack&&(u=u.concat(await S.videoTrack.getProcessorUsage())),y.has(mt.AUDIO)&&S.audioTrack&&(u=u.concat(await S.audioTrack.getProcessorUsage()));if(u.length===0)return;d.details=function(S,y){const b={};for(const{id:U,value:F,level:$,direction:z}of S){var I;const G=(I=y.get(U))!==null&&I!==void 0?I:0,Y=F===2?G+x("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:G;var A,L;y.set(U,Y),b[U]?(F===2&&(b[U].value=F),$>b[U].level&&(b[U].level=$),z==="remote"&&(b[U].remoteUidCount+=1),b[U].totalTs=(A=y.get(U))!==null&&A!==void 0?A:0):b[U]={value:F,level:$,remoteUidCount:z==="local"?0:1,totalTs:(L=y.get(U))!==null&&L!==void 0?L:0}}return Object.keys(b).map(U=>{const{level:F,value:$,totalTs:z}=b[U];return{id:U,level:F,value:$,totalTs:z}})}(u,t);const _=Date.now(),m=_>a?_:a+1;(s=this.requestUpload)===null||s===void 0||s.call(this,Ji.EXTENSION_USAGE_STATS,{usageStats:d,sendTs:m})},x("EXTENSION_USAGE_UPLOAD_INTERVAL"))}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval(()=>{var t;const e=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);e&&(this.uploadUplinkStats(e),this.lastStats=e)},3e3),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval(()=>{var t;const e=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);e&&this.uploadRelatedUplinkStats(e,this.lastStats),this.lastStats=e},1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval(()=>{var t;const e=(t=this.requestAllTracks)===null||t===void 0?void 0:t.call(this);e&&this.uploadDenoiserStats(e)},2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval(()=>{var t;const e=(t=this.requestAllTracks)===null||t===void 0?void 0:t.call(this);e&&this.uploadExtensionStats(e)},2e3))}uploadUplinkStats(t){var e;(((e=this.requestLocalMedia)===null||e===void 0?void 0:e.call(this))||[]).forEach(i=>{let[s,{track:a,ssrcs:d}]=i;switch(s){case Z.LocalVideoLowTrack:case Z.LocalVideoTrack:{const u=function(_,m,S){var y;const b=m.videoSend.find(A=>A.ssrc===_);if(!b)return null;const I={id:Le(10,""),timestamp:new Date(m.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:b.ssrc.toString()};switch(I.A_vstd=S._originMediaStreamTrack&&!S._originMediaStreamTrack.enabled||S._mediaStreamTrack&&!S._mediaStreamTrack.enabled?"1":"0",b.sentFrame&&(I.A_fhs=b.sentFrame.height.toString(),I.A_frs=b.sentFrame.frameRate.toString(),I.A_fws=b.sentFrame.width.toString()),b.adaptionChangeReason){case"none":I.A_ac="0";break;case"cpu":I.A_ac="1";break;case"bandwidth":I.A_ac="2";break;case"other":I.A_ac="3"}return I.A_lvps=fS[S._player?S._player.videoElementStatus:"uninit"].toString(),I.A_nr=(y=b.nacksCount)===null||y===void 0?void 0:y.toString(),b.avgEncodeMs&&(I.A_aem=b.avgEncodeMs.toFixed(0).toString()),x("P2P")&&(b.bytes&&(I.bytesSent=b.bytes.toString()),typeof b.packetsLost=="number"&&(I.packetsLost=b.packetsLost.toString()),b.packets&&(I.packetsSent=b.packets.toString())),I}(d[0].ssrcId,t,a),h=s===Z.LocalVideoTrack?function(_,m,S){var y,b,I,A,L,U,F,$;const z=m.videoSend.find(ct=>ct.ssrc===_);if(!z)return null;const G={id:Le(10,""),timestamp:new Date(m.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:z.ssrc.toString()},Y=(y=(b=(I=z.inputFrame)===null||I===void 0?void 0:I.height)!==null&&b!==void 0?b:S==null?void 0:S._videoHeight)!==null&&y!==void 0?y:0,q=(A=(L=(U=z.inputFrame)===null||U===void 0?void 0:U.width)!==null&&L!==void 0?L:S==null?void 0:S._videoWidth)!==null&&A!==void 0?A:0,ut=(F=($=z.inputFrame)===null||$===void 0?void 0:$.frameRate)!==null&&F!==void 0?F:0;return Y&&(G.A_fhi=Y+""),q&&(G.A_fwi=q+""),ut&&(G.A_fri=ut+""),G}(d[0].ssrcId,t,a):null;u&&ds(()=>{var _;return(_=this.requestUpload)===null||_===void 0?void 0:_.call(this,Ji.PUBLISH_STATS,{stream_type:s===Z.LocalVideoLowTrack?"low":"high",stats:vN(vN({},u),h)})});const p=function(_){const m={id:"bweforvideo",timestamp:new Date(_.timestamp).toISOString(),type:"VideoBwe"};return _.bitrate.retransmit&&(m.A_rb=_.bitrate.retransmit.toString()),_.bitrate.targetEncoded&&(m.A_teb=_.bitrate.targetEncoded.toString()),m.A_aeb=_.bitrate.actualEncoded.toString(),m.A_tb=_.bitrate.transmit.toString(),_.sendBandwidth!==void 0&&(m.A_asb=_.sendBandwidth.toString()),m}(t);p&&setTimeout(()=>{var _;return(_=this.requestUpload)===null||_===void 0?void 0:_.call(this,Ji.PUBLISH_STATS,{stream_type:s===Z.LocalVideoLowTrack?"low":"high",stats:p})},1e3);break}case Z.LocalAudioTrack:{const u=function(h,p,_){const m=p.audioSend.find(y=>y.ssrc===h);if(!m)return null;const S={id:Le(10,""),timestamp:new Date(p.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:m.ssrc.toString()};return S.A_astd=_._originMediaStreamTrack&&!_._originMediaStreamTrack.enabled||_._mediaStreamTrack&&!_._mediaStreamTrack.enabled?"1":"0",m.inputLevel?S.A_ail=Math.round(100*m.inputLevel).toString():S.A_ail=Math.round(100*_._source.getAccurateVolumeLevel()).toString(),S.A_apil=Math.round(100*_._source.getAccurateVolumeLevel()).toString(),m.aecReturnLoss&&(S.A_ecrl=Math.round(m.aecReturnLoss).toString()),m.aecReturnLossEnhancement&&(S.A_ecrle=Math.round(m.aecReturnLossEnhancement).toString()),x("P2P")&&(m.bytes&&(S.bytesSent=m.bytes.toString()),typeof m.packetsLost=="number"&&(S.packetsLost=m.packetsLost.toString()),m.packets&&(S.packetsSent=m.packets.toString())),S}(d[0].ssrcId,t,a);u&&ds(()=>{var h;return(h=this.requestUpload)===null||h===void 0?void 0:h.call(this,Ji.PUBLISH_STATS,{stream_type:"high",stats:u})});break}}})}uploadRelatedUplinkStats(t,e){var i;(((i=this.requestLocalMedia)===null||i===void 0?void 0:i.call(this))||[]).filter(s=>{let[a]=s;return a===Z.LocalVideoLowTrack||a===Z.LocalVideoTrack}).forEach(s=>{let[a,{ssrcs:d}]=s;const u=function(h,p){const _=p.videoSend.find(m=>m.ssrc===h);return _?{mediaType:"video",isVideoMute:!1,frameRateInput:_.inputFrame&&_.inputFrame.frameRate.toString(),frameRateSent:_.sentFrame&&_.sentFrame.frameRate.toString(),googRtt:_.rttMs.toString(),qpSumPerFrame:Math.floor(_.qpSumPerFrame).toString()}:null}(d[0].ssrcId,t);u&&ds(()=>{var h;(h=this.requestUpload)===null||h===void 0||h.call(this,Ji.PUBLISH_RELATED_STATS,{stream_type:a===Z.LocalVideoLowTrack?"low":"high",stats:u})})})}uploadDenoiserStats(t){for(let a=0;a<t.length;a++){const d=t[a];if(d instanceof Sa){var e,i,s;const u=(e=(i=d._external).getDenoiserStats)===null||e===void 0?void 0:e.call(i);return void(u&&((s=this.requestUpload)===null||s===void 0||s.call(this,Ji.DENOISER_STATS,u)))}}}uploadExtensionStats(t){for(let e=0;e<t.length;e++)t[e].getProcessorStats().forEach(i=>{var s;(s=this.requestUpload)===null||s===void 0||s.call(this,i.type,i.stats)})}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){if(this.uploadDownlinkStarted)return;let t;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e=!1;this.downlinkStatsUploadInterval=window.setInterval(()=>{var i;const s=(i=this.requestStats)===null||i===void 0?void 0:i.call(this,!0);s&&(this.uploadDownlinkStats(s,e,t),t=s),e=!e},3e3),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval(()=>{var i;const s=(i=this.requestStats)===null||i===void 0?void 0:i.call(this,!0);s&&(this.uploadRelatedDownlinkStats(s,this.lastStats),this.lastStats=s)},1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval(()=>{var i;const s=(i=this.requestRemoteMedia)===null||i===void 0?void 0:i.call(this);s&&this.uploadDownlinkExtensionStats(s)},2e3)}uploadDownlinkStats(t,e,i){var s;(((s=this.requestRemoteMedia)===null||s===void 0?void 0:s.call(this))||[]).forEach(a=>{let[d,u]=a;if(u.has(mt.VIDEO)&&d.videoTrack){const h=d.videoTrack?function(p,_,m,S,y){const b=_.videoRecv.find(U=>U.ssrc===p);if(!b)return null;const I={id:Le(10,""),timestamp:new Date(_.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:b.ssrc.toString()};var A,L;if(I.bytesReceived=b.bytes.toString(),I.packetsLost=b.packetsLost.toString(),I.packetsReceived=b.packets.toString(),b.framesRateFirefox&&(I.A_frr=b.framesRateFirefox.toString()),b.receivedFrame?(I.A_frr=b.receivedFrame.frameRate.toString(),I.A_fhr=b.receivedFrame.height.toString(),I.A_fwr=b.receivedFrame.width.toString()):(I.A_fhr=(A=S._videoHeight)===null||A===void 0?void 0:A.toString(),I.A_fwr=(L=S._videoWidth)===null||L===void 0?void 0:L.toString()),I.A_frd=b.decodeFrameRate.toString(),b.outputFrame&&(I.A_fro=b.outputFrame.frameRate.toString()),b.jitterBufferMs!==void 0&&(I.A_jbm=Math.floor(b.jitterBufferMs).toString()),b.currentDelayMs!==void 0&&(I.A_cdm=Math.floor(b.currentDelayMs).toString()),I.A_fs=b.firsCount.toString(),I.A_ns=b.nacksCount.toString(),I.A_ps=b.plisCount.toString(),S&&(I.A_vrtd=S._originMediaStreamTrack.enabled&&S._mediaStreamTrack.enabled?"0":"1"),S._player&&S._player.freezeTimeCounterList.length>0&&(I.A_vrft=Math.round(S._player.freezeTimeCounterList.splice(0,1)[0]).toString()),y&&S._player&&ko.visibility==="visible"){const U=Math.min(6e3,S._player.renderFreezeAccTime);I.A_vrrft=Math.round(U).toString(),S._player.renderFreezeAccTime=Math.max(0,S._player.renderFreezeAccTime-U)}if(I.A_rvps=fS[S._player?S._player.videoElementStatus:"uninit"].toString(),m){const U=m.videoRecv.find(F=>F.ssrc===p);if(U&&b.totalInterFrameDelay!==void 0&&b.totalSquaredInterFrameDelay!==void 0&&U.totalInterFrameDelay!==void 0&&U.totalSquaredInterFrameDelay!==void 0){const F=b.totalInterFrameDelay-U.totalInterFrameDelay,$=b.totalSquaredInterFrameDelay-U.totalSquaredInterFrameDelay,z=b.framesDecodeCount-U.framesDecodeCount,G=F/z*1e3,Y=Math.round(1e3*Math.sqrt(($-Math.pow(F,2)/z)/z));!isNaN(Y)&&G+Y>Math.max(3*G,G+150)&&(I.A_ifdsd=Y.toString())}}return I}(d._videoSSRC,t,i,d.videoTrack,e):void 0;h&&ds(()=>{var p;return(p=this.requestUpload)===null||p===void 0?void 0:p.call(this,Ji.SUBSCRIBE_STATS,{stream_id:d.uid,stats:h})})}if(u.has(mt.AUDIO)&&d.audioTrack){const h=d.audioTrack?function(p,_,m,S){const y=_.audioRecv.find(I=>I.ssrc===p);if(!y)return null;const b={id:Le(10,""),timestamp:new Date(_.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:y.ssrc.toString()};if(b.bytesReceived=y.bytes.toString(),b.packetsLost=y.packetsLost.toString(),b.packetsReceived=y.packets.toString(),y.outputLevel?b.A_aol=Math.round(100*y.outputLevel).toString():b.A_aol=Math.round(100*S._source.getAccurateVolumeLevel()).toString(),b.A_apol=Math.round(100*S._source.getAccurateVolumeLevel()).toString(),S&&(b.A_artd=S._originMediaStreamTrack.enabled&&S._mediaStreamTrack.enabled?"0":"1"),b.A_jr=y.jitterMs.toString(),b.A_jbm=Math.floor(y.jitterBufferMs).toString(),b.A_cdm=Math.floor(y.jitterBufferMs).toString(),b.A_raps=fS[cr.getPlayerState(S.getTrackId())].toString(),m){const I=m.audioRecv.find(A=>A.ssrc===p);if(I){const A=y.concealedSamples-I.concealedSamples;A>0&&(b.A_cs=Math.round(A).toString())}}return b}(d._audioSSRC,t,i,d.audioTrack):void 0;h&&ds(()=>{var p;return(p=this.requestUpload)===null||p===void 0?void 0:p.call(this,Ji.SUBSCRIBE_STATS,{stream_id:d.uid,stats:h})})}})}uploadRelatedDownlinkStats(t,e){var i;(((i=this.requestRemoteMedia)===null||i===void 0?void 0:i.call(this))||[]).forEach(s=>{let[a,d]=s;if(d.has(mt.VIDEO)&&a.videoTrack){var u;const h=(a._videoSSRC&&((u=this.requestVideoIsReady)===null||u===void 0?void 0:u.call(this,a._videoSSRC))||!1)===!0,p=function(_,m,S,y,b,I){const A=S.videoRecv.find($=>$.ssrc===_),L=b?b.videoRecv.find($=>$.ssrc===_):void 0;if(!A)return null;const U=$d.isRemoteVideoFreeze(I,A,L)&&m,F={mediaType:"video",isVideoMute:!1,peerId:y,frameRateReceived:A.receivedFrame&&A.receivedFrame.frameRate.toString(),frameRateDecoded:A.decodedFrame&&A.decodedFrame.frameRate.toString(),isFreeze:U,bytesReceived:A.bytes.toString(),packetsReceived:A.packets.toString(),packetsLost:A.packetsLost.toString(),qpSumPerFrame:Math.floor(A.qpSumPerFrame).toString()};return A.framesRateFirefox&&(F.frameRateDecoded=A.framesRateFirefox.toString(),F.frameRateReceived=A.framesRateFirefox.toString()),F}(a._videoSSRC,h,t,a.uid,e,a.videoTrack);p&&ds(()=>{var _;(_=this.requestUpload)===null||_===void 0||_.call(this,Ji.SUBSCRIBE_RELATED_STATS,{stream_id:a.uid,stats:p})})}if(d.has(mt.AUDIO)&&a.audioTrack){const h=function(p,_,m,S){const y=_.audioRecv.find(I=>I.ssrc===p);if(!y)return null;const b=$d.isRemoteAudioFreeze(S);return{mediaType:"audio",isAudioMute:!1,peerId:m,googJitterReceived:y.jitterMs.toString(),isFreeze:b,bytesReceived:y.bytes.toString(),packetsReceived:y.packets.toString(),packetsLost:y.packetsLost.toString(),frameReceived:y.receivedFrames.toString(),frameDropped:y.droppedFrames.toString()}}(a._audioSSRC,t,a.uid,a.audioTrack);h&&ds(()=>{var p;(p=this.requestUpload)===null||p===void 0||p.call(this,Ji.SUBSCRIBE_RELATED_STATS,{stream_id:a.uid,stats:h})})}})}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}stopUploadTransportStats(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}uploadDownlinkExtensionStats(t){t.forEach(e=>{let[i,s]=e;s.has(mt.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(a=>{var d;(d=this.requestUpload)===null||d===void 0||d.call(this,a.type,a.stats)}),s.has(mt.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(a=>{var d;(d=this.requestUpload)===null||d===void 0||d.call(this,a.type,a.stats)})})}}function IN(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Oa(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?IN(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):IN(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}function bN(n){var t,e,i,s=2;for(typeof Symbol<"u"&&(e=K0,i=Symbol.iterator);s--;){if(e&&(t=n[e])!=null)return t.call(n);if(i&&(t=n[i])!=null)return new Wf(t.call(n));e="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function Wf(n){function t(e){if(Object(e)!==e)return W.reject(new TypeError(e+" is not an object."));var i=e.done;return W.resolve(e.value).then(function(s){return{value:s,done:i}})}return Wf=function(e){this.s=e,this.n=e.next},Wf.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var i=this.s.return;return i===void 0?W.resolve({value:e,done:!0}):t(i.apply(this.s,arguments))},throw:function(e){var i=this.s.return;return i===void 0?W.reject(e):t(i.apply(this.s,arguments))}},new Wf(n)}class Zn extends Ye{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(kt.StateChange,e,this._state)}constructor(t,e){super(),g(this,"store",void 0),g(this,"statsUploader",void 0),g(this,"connection",void 0),g(this,"localTrackMap",new Map),g(this,"remoteUserMap",new Map),g(this,"localDataChannels",[]),g(this,"remoteDataChannelMap",new Map),g(this,"pendingLocalTracks",[]),g(this,"pendingRemoteTracks",[]),g(this,"pendingLocalDataChannels",[]),g(this,"pendingRemoteDataChannels",[]),g(this,"statsCollector",void 0),g(this,"isPlanB",!1),g(this,"shouldForwardP2PCreation",void 0),g(this,"iceFailedCount",0),g(this,"dtlsFailedCount",0),g(this,"mutex",new zn("P2PChannel-mutex")),g(this,"_state",Ee.Disconnected),g(this,"_pcStatsUploadType",x("NEW_ICE_RESTART")?Ps.FIRST_CONNECTION:Ps.OLD_FIRST_CONNECTION),g(this,"_isInRestartIce",!1),g(this,"_isStartRestartIce",!1),g(this,"_restartStates",["disconnected","failed"]),g(this,"_restartTimer",void 0),g(this,"_isFirstConnected",!0),g(this,"handleMuteLocalTrack",async(i,s,a)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Ee.Connected)return void a(new J(O.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const u=this.filterTobeMutedTracks(i);if(u.length===0)return void s();const h=u.find(_=>_[0]==="videoLowTrack");h&&h[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(u.map(_=>{let[,{id:m}]=_;return m}));const p=this.createMuteMessage(u);await ke(this,kt.RequestMuteLocal,p),s()}catch(u){a(u)}finally{d()}}),g(this,"handleUnmuteLocalTrack",async(i,s,a)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Ee.Connected)return void a(new J(O.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const u=this.filterTobeUnmutedTracks(i);if(u.length===0)return void s();const h=u.find(_=>_[0]==="videoLowTrack");if(h){const _=h[1];if(_.track._originMediaStreamTrack.stop(),!x("DISABLE_DUAL_STREAM_USE_ENCODING")&&xe().supportDualStreamEncoding){const m=i._mediaStreamTrack.clone();_.track._mediaStreamTrack=m,_.track._originMediaStreamTrack=m}else{const m=hT(i,Do(this,kt.RequestLowStreamParameter));_.track._mediaStreamTrack=m,_.track._originMediaStreamTrack=m}await new W((m,S)=>{this.handleReplaceTrack(_.track,m,S,!0)})}await this.connection.unmuteLocal(u.map(_=>{let[,{id:m}]=_;return m}));const p=this.createUnmuteMessage(u);await ke(this,kt.RequestUnmuteLocal,p),s()}catch(u){a(u)}finally{d()}}),g(this,"handleUpdateVideoEncoder",async(i,s,a)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const u=this.localTrackMap.get(Z.LocalVideoTrack);if(!this.connection||!u||u.track!==i||this.state!==Ee.Connected)return void s();const{id:h,track:p}=u;await this.connection.updateSendParameters(h,p),await this.connection.updateEncoderConfig(h,p),this.emit(kt.UpdateVideoEncoder,p),s()}catch(u){a(u)}finally{d()}}),g(this,"handleSetOptimizationMode",async(i,s,a)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const u=this.localTrackMap.get(Z.LocalVideoTrack);if(!this.connection||!u||u.track!==i||this.state!==Ee.Connected)return;const{id:h,track:p}=u;await this.connection.updateSendParameters(h,p),s()}catch(u){a(u)}finally{d()}}),g(this,"handleReplaceTrack",async(i,s,a,d)=>{let u;R.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof d=="boolean"&&d||(u=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var h;const _=Array.from(this.localTrackMap.entries()).find(m=>{let[,{track:S}]=m;return i===S});if(!this.connection||!_||this.state!==Ee.Connected)return void s();if(await((h=this.connection)===null||h===void 0?void 0:h.replaceTrack(i,_[1].id)),this.isPlanB){const m=_[1];m.id=i._mediaStreamTrack.id,this.localTrackMap.set(_[0],m)}if(_[0]===Z.LocalVideoTrack&&!x("DISABLE_DUAL_STREAM_USE_ENCODING")&&xe().supportDualStreamEncoding){const m=this.localTrackMap.get(Z.LocalVideoLowTrack);if(m){const S=i._mediaStreamTrack.clone();m.track._originMediaStreamTrack.stop(),m.track._mediaStreamTrack=S,m.track._originMediaStreamTrack=S,await new W((y,b)=>{this.handleReplaceTrack(m.track,y,b,!0)})}}s()}catch(_){a(_)}finally{var p;(p=u)===null||p===void 0||p()}}),g(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),g(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),g(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),g(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),g(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new CN,this.bindStatsUploaderEvents(),this.isPlanB=!xe().supportUnifiedPlan||x("CHROME_FORCE_PLAN_B")&&la(),this.shouldForwardP2PCreation=x("FORWARD_P2P_CREATION")&&xe().supportPCSetConfiguration&&function(){const i=Ap();return i===Fn.ANDROID||i===Fn.IOS||i===Fn.HARMONY_OS}(),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Un({},this.store):this.isPlanB?new $n({},this.store):new Mn({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(t,e){var i;this.state=Ee.New;const s=this.shouldForwardP2PCreation&&((i=this.connection)===null||i===void 0?void 0:i.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!s||(s&&this.connection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new Un(t,this.store):this.isPlanB?new $n(t,this.store):new Mn(t,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new J(O.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=x("NEW_ICE_RESTART")?Ps.FIRST_CONNECTION:Ps.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t,e,i,s,a,d){if(!this.connection)throw new J(O.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof Un?this.connection.updateRemoteConnect(s):(this.store.peerConnectionStart(),await this.connection.connect(t,e,i,s,a,d),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ee.Connected)}updateRemoteRTPCapabilities(t){const e=Array.from(this.localTrackMap.entries()).filter(i=>{var s;let[a]=i;return It(s=[Z.LocalVideoLowTrack,Z.LocalVideoTrack]).call(s,a)}).map(i=>{let[,{id:s}]=i;return s});if(this.connection instanceof Mn){if(!It(t).call(t,this.store.codec)){const i=["vp8","h264"].find(s=>It(t).call(t,s));i&&(this.store.codec=i,R.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(i,".")))}this.connection.updateRemoteRTPCapabilities(e,t)}}async preConnect(t,e,i,s,a,d){if(!this.connection)throw new J(O.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();const u=await this.connection.connect(t,e,i,s,a,d);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ee.Connected,u}getEstablishParams(){if(this.connection instanceof Un)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}async publishDataChannel(t){if(!this.connection){if(this.state===Ee.Disconnected)throw new J(O.UNEXPECTED_ERROR,"PeerConnection already disconnected.");const i=t.filter(s=>this.pendingLocalDataChannels.findIndex(a=>a.id===s.id)!==-1);return void(this.pendingLocalDataChannels=this.pendingLocalDataChannels.concat(i))}const e=this.filterTobePublishedDataChannels(t);e.length!==0&&(e.forEach(i=>{const s=Date.now();this.store.publish(i.id.toString(),"datachannel",s)}),await this.connection.createDataChannels(this.store.uid,e),e.forEach(i=>{this.localDataChannels.push(i);const s=Date.now();this.store.publish(i.id+"","datachannel",void 0,s)}))}publish(t,e,i){var s=this;return qr(function*(){const a=yield Te(s.mutex.lock("From P2PChannel.publish"));try{if(!s.connection||s.state!==Ee.Connected){if(s.state===Ee.Disconnected)throw new J(O.UNEXPECTED_ERROR,"PeerConnection already disconnected.");s.throwIfTrackTypeNotMatch(t);const u=t.filter(h=>s.pendingLocalTracks.indexOf(h)===-1);return void(s.pendingLocalTracks=s.pendingLocalTracks.concat(u))}s.store.pubId=s.store.pubId+1,li.markPublishStart(s.store.clientId,s.store.pubId);const d=s.filterTobePublishedTracks(t,e,i);if(d.length===0)return void(yield Te(s.tryToUnmuteAudio(t)));yield*Pf(bN(s.doPublish(s.connection,d)))}finally{a()}})()}doPublish(t,e){var i=this;return qr(function*(){e.forEach(_=>{let{track:m,type:S}=_;const y=Date.now();i.store.publish(m.getTrackId(),S===Z.LocalAudioTrack?"audio":"video",y)}),i.bindLocalTrackEvents(e);const s=yield Te(t.send(e.map(_=>{let{track:m}=_;return m}),i.store.codec,i.store.audioCodec)),a=(yield Te(s.next())).value,d=i.createGatewayPublishMessage(e,a);let u;try{u=yield d}catch(_){throw s.throw(_),(_==null?void 0:_.code)===O.WS_ABORT&&e.forEach(m=>{let{track:S}=m;i.pendingLocalTracks.indexOf(S)===-1&&i.pendingLocalTracks.push(S)}),i.unbindLocalTrackEvents(e),_}const h=i.mapPubResToRemoteConfig(d,u),p=(yield Te(s.next(h))).value;e.forEach(_=>{let{type:m}=_;i.statsCollector.addLocalStats(m)}),i.assignLocalTracks(e,p),i.statsUploader.startUploadUplinkStats(),e.forEach(_=>{let{track:m,type:S}=_;const y=Date.now();i.store.publish(m.getTrackId(),S===Z.LocalAudioTrack?"audio":"video",void 0,y)})})()}async updateVideoStreamParameter(t,e){const i=this.localTrackMap.get(e);if(!i)return;if(!(i.track instanceof te))return R.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof Mn||this.connection instanceof $n))return R.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:s}=i,a=function(d,u){const h={};return d.height&&d.width&&(h.scaleResolutionDownBy=JS(d,u)),h.maxFramerate=d.framerate?Nr(d.framerate):void 0,h.maxBitrate=d.bitrate?1e3*d.bitrate:void 0,h}(t,s);if(s._encoderConfig||(s._encoderConfig={}),e!==Z.LocalVideoLowTrack||!x("DISABLE_DUAL_STREAM_USE_ENCODING")&&xe().supportDualStreamEncoding)a.scaleResolutionDownBy!=null&&(s._encoderConfig.scaleResolutionDownBy=a.scaleResolutionDownBy);else{const d=s._originMediaStreamTrack;if(!d.canvas)return R.warn("[".concat(s.getTrackId(),"] no canvas on track"));(function(u,h){const p=u.canvas;h.width&&(p.width=Nr(h.width)),h.height&&(p.height=Nr(h.height)),h.framerate&&(p.stopCapture&&p.stopCapture(),p.stopCapture=mS(()=>{!p.startCapture&&p.stopCapture&&p.stopCapture(),p.startCapture&&p.startCapture()},Nr(h.framerate)))})(d,t)}a.maxBitrate!=null&&(s._encoderConfig.bitrateMax=a.maxBitrate/1e3),a.maxFramerate!=null&&(s._encoderConfig.frameRate&&typeof s._encoderConfig.frameRate=="object"?s._encoderConfig.frameRate.max=a.maxFramerate:s._encoderConfig.frameRate={max:a.maxFramerate}),R.debug("[".concat(s.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(s._encoderConfig))),await this.connection.updateRtpSenderEncodings(s)}publishLowStream(t){var e=this;return qr(function*(){if(!e.connection||e.state!==Ee.Connected)return;const i=yield Te(e.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const a=e.localTrackMap.get(Z.LocalVideoTrack);if(!a)throw new J(O.UNEXPECTED_ERROR,"Could not find high stream");if(e.localTrackMap.has(Z.LocalVideoLowTrack))throw new J(O.UNEXPECTED_ERROR,"[".concat(e.store.clientId,"] Can't publish low stream when stream already publish"));const d=[{track:e.getLowVideoTrack(a.track,t),type:Z.LocalVideoLowTrack}];if(yield*Pf(bN(e.doPublish(e.connection,d))),a.track.muted||!a.track.enabled){var s;const u=(s=e.localTrackMap.get(Z.LocalVideoLowTrack))===null||s===void 0?void 0:s.id;u!==void 0&&(yield Te(e.connection.muteLocal([u])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(R.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await tn(this,kt.RequestRePublish,this.pendingLocalTracks),this.emit(kt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(R.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await tn(this,kt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(t){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){const{user:i,kind:s}=this.pendingRemoteTracks[e];(s!==mt.AUDIO||i._audio_added_&&i._audioSSRC)&&(s!==mt.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(t)await tn(this,kt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:e,kind:i}of this.pendingRemoteTracks)await this.subscribe(e,i,i===mt.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:i}=e;this.emit(kt.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==Ee.Connected)return void t.forEach(s=>{const a=this.pendingLocalTracks.indexOf(s);a!==-1&&this.pendingLocalTracks.splice(a,1)});const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const i=e.find(s=>s[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,e)}async unpublishDataChannel(t){if(!this.connection||this.state!==Ee.Connected)return void t.forEach(i=>{const s=this.pendingLocalDataChannels.indexOf(i);s!==-1&&this.pendingLocalDataChannels.splice(s,1)});const e=this.filterTobeUnpublishedDataChannels(t);return e.length!==0?(e.forEach(i=>{const s=this.localDataChannels.indexOf(i);s!==-1&&this.localDataChannels.splice(s,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),e.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Ee.Connected)return;const t=this.localTrackMap.get(Z.LocalVideoLowTrack);if(!t)return;t.track.close();const e=[[Z.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,e)}async doUnpublish(t,e){const i=this.createGatewayUnpublishMessage(e);return await t.stopSending(e.map(s=>{let[,{id:a}]=s;return a})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(s=>{let[a,{track:d}]=s;return{type:a,track:d}})),e.forEach(s=>{let[a]=s;this.statsCollector.removeLocalStats(a)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadUplinkStats(),i}async subscribeDataChannel(t,e){if(!this.connection||this.state!==Ee.Connected)throw new J(O.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const i=e.filter(s=>{var a;return!((a=this.remoteDataChannelMap.get(t))!==null&&a!==void 0&&a.get(s.id))});if(i.length!==0)return await this.connection.createDataChannels(t.uid,i),i.forEach(s=>{var a;this.remoteDataChannelMap.has(t)?(a=this.remoteDataChannelMap.get(t))===null||a===void 0||a.set(s.id,s):this.remoteDataChannelMap.set(t,new Map([[s.id,s]]));const d=this.pendingRemoteDataChannels.findIndex(u=>{let{user:h,id:p}=u;return h.uid===t.uid&&p===s.id});d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),i.map(s=>s.id)}async subscribe(t,e,i,s,a){var d;if(!this.connection||this.state!==Ee.Connected)throw new J(O.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((d=this.remoteUserMap.get(t))!==null&&d!==void 0&&d.has(e))return;let u,h,p;if(a){const S=a.find(b=>{let{stream_type:I}=b;return I===e});if(!S)throw new J(O.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(e," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(e,"."));const y=await this.connection.receive(e,S.ssrcs,String(t._uintid),S.attributes);this.connection instanceof Mn&&(p=y.transceiver),u=y.track,h=y.id}else{const S=await this.connection.receive(e,[{ssrcId:i,rtx:s}],String(t._uintid),void 0);this.connection instanceof Mn&&(p=S.transceiver),u=S.track,h=S.id}e===mt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(u):(t._audioTrack=new hs(u,t.uid,t._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),p&&t._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(u):(t._videoTrack=new eo(u,t.uid,t._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),p&&t._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(t,t._videoTrack));const _=this.remoteUserMap.get(t);_?_.set(e,h):this.remoteUserMap.set(t,new Map([[e,h]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadDownlinkStats();const m=this.pendingRemoteTracks.findIndex(S=>{let{user:y,kind:b}=S;return y.uid===t.uid&&e===b});m!==-1&&(this.pendingRemoteTracks.splice(m,1),this.emit(kt.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==Ee.Connected)throw new J(O.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(i=>{var s;let{user:a,mediaType:d}=i;return!((s=this.remoteUserMap.get(a))!==null&&s!==void 0&&s.has(d))});const e=await this.connection.batchReceive(t.map(i=>{let{user:s,mediaType:a,ssrcId:d,rtxSsrcId:u}=i;return{kind:a,ssrcMsg:[{ssrcId:d,rtx:u}],mslabel:String(s._uintid)}}));t.forEach((i,s)=>{let{user:a,mediaType:d}=i;const{track:u,id:h,transceiver:p}=e[s];d===mt.AUDIO?(a._audioTrack?a._audioTrack._updateOriginMediaStreamTrack(u):(a._audioTrack=new hs(u,a.uid,a._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(a._audioTrack.getTrackId()))),p&&a._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(a,a._audioTrack)):(a._videoTrack?a._videoTrack._updateOriginMediaStreamTrack(u):(a._videoTrack=new eo(u,a.uid,a._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(a._videoTrack.getTrackId()))),p&&a._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(a,a._videoTrack));const _=this.remoteUserMap.get(a);_?_.set(d,h):this.remoteUserMap.set(a,new Map([[d,h]])),this.statsCollector.addRemoteStats(a.uid),this.statsUploader.startUploadDownlinkStats();const m=this.pendingRemoteTracks.findIndex(S=>{let{user:y,kind:b}=S;return y.uid===a.uid&&d===b});m!==-1&&(this.pendingRemoteTracks.splice(m,1),this.emit(kt.MediaReconnectEnd,a.uid))})}async unsubscribe(t,e,i){const s=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:p}=u;return e!==void 0?h.uid===t.uid&&e===p:h.uid===t.uid});if(s.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.connection&&this.state===Ee.Connected||i||s.forEach(u=>{let{kind:h}=u;var p;if(h===mt.AUDIO)(p=t._audioTrack)===null||p===void 0||p._destroy(),t._audioTrack=void 0;else if(h===mt.VIDEO){var _;(_=t._videoTrack)===null||_===void 0||_._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==Ee.Connected)return;const a=this.filterTobeUnSubscribedTracks(t,e);if(a.length===0)return;await this.connection.stopReceiving(a.map(u=>{let[,{id:h}]=u;return h}));const d=this.createUnsubscribeMessage(a);return this.withdrawRemoteTracks(a),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),a.forEach(u=>{let[h,{kind:p}]=u;var _,m;if(p===mt.VIDEO&&h._videoSSRC&&((_=this.connection)===null||_===void 0||_.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),p===mt.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),i||((m=h._videoTrack)===null||m===void 0||m._destroy(),h._videoTrack=void 0);else if(p===mt.AUDIO){var S;this.unbindRemoteTrackEvents(h._audioTrack),!i&&((S=h._audioTrack)===null||S===void 0||S._destroy(),h._audioTrack=void 0)}}),d}async unsubscribeDataChannel(t,e){if(e.forEach(a=>{const d=this.pendingRemoteDataChannels.findIndex(u=>u.id===a.id);d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),!this.connection)return;const i=this.filterTobeUnSubscribedDataChannels(t,e);if(i.length===0)return;e.forEach(a=>{a._close()});const s=this.remoteDataChannelMap.get(t);return i.forEach(a=>{s&&s.delete(a.id)}),s&&s.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),i.map(a=>a.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let e=[];for(const{user:a,mediaType:d}of t){const u=this.pendingRemoteTracks.filter(h=>{let{user:p,kind:_}=h;return d!==void 0?p.uid===a.uid&&d===_:p.uid===a.uid});u.forEach(h=>{const p=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(p,1)}),e=e.concat(u)}if(!this.connection||this.state!==Ee.Connected)return void e.forEach(a=>{let{user:d,kind:u}=a;var h;if(u===mt.AUDIO)(h=d._audioTrack)===null||h===void 0||h._destroy(),d._audioTrack=void 0;else if(u===mt.VIDEO){var p;(p=d._videoTrack)===null||p===void 0||p._destroy(),d._videoTrack=void 0}});const i=yc(t).call(t,(a,d)=>{let{user:u,mediaType:h}=d;const p=this.filterTobeUnSubscribedTracks(u,h);return a.concat(p)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(a=>{let[,{id:d}]=a;return d}));const s=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),i.forEach(a=>{let[d,{kind:u}]=a;var h,p;if(u===mt.VIDEO&&d._videoSSRC&&((h=this.connection)===null||h===void 0||h.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),u===mt.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),(p=d._videoTrack)===null||p===void 0||p._destroy(),d._videoTrack=void 0;else if(u===mt.AUDIO){var _;this.unbindRemoteTrackEvents(d._audioTrack),(_=d._audioTrack)===null||_===void 0||_._destroy(),d._audioTrack=void 0}}),s}async muteRemote(t,e){if(!this.connection)return;const i=this.remoteUserMap.get(t);if(!i)return void R.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!i.get(e))return void R.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const s=e===mt.VIDEO?t._videoSSRC:t._audioSSRC;s!==void 0&&this.connection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.connection)return;const i=this.remoteUserMap.get(t);if(!i)return void R.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));i.get(e)||R.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(Z.LocalAudioTrack);if((e==null?void 0:e.track)instanceof vn){const i=e.track;return Array.from(this.localTrackMap.entries()).filter(s=>{let[a]=s;return a!==Z.LocalAudioTrack}).filter(s=>{let[a]=s;return!(t&&a===Z.LocalVideoLowTrack)}).map(s=>{let[,{track:a}]=s;return a}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[s]=i;return!(t&&s===Z.LocalVideoLowTrack)}).map(i=>{let[,{track:s}]=i;return s})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,e,i,s,a){if(t){const u=this.localTrackMap.get(Z.LocalAudioTrack),h=s?this.localTrackMap.get(Z.LocalVideoLowTrack):this.localTrackMap.get(Z.LocalVideoTrack);vt.publish(this.store.sessionId,{eventElapse:li.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:u==null?void 0:u.track.getTrackLabel(),videoName:h==null?void 0:h.track.getTrackLabel(),screenshare:(h==null?void 0:h.track._hints.indexOf(Fe.SCREEN_TRACK))!==-1,audio:!!u,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}else{var d;i||(i=[]);const u=i.find(p=>p instanceof Ie),h=s?(d=this.localTrackMap.get(Z.LocalVideoTrack))===null||d===void 0?void 0:d.track:i.find(p=>p instanceof te);vt.publish(this.store.sessionId,{eventElapse:li.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:u==null?void 0:u.getTrackLabel(),videoName:h==null?void 0:h.getTrackLabel(),screenshare:(h==null?void 0:h._hints.indexOf(Fe.SCREEN_TRACK))!==-1,audio:!!u,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}}reportSubscribeEvent(t,e,i,s){const a=s===mt.VIDEO?i._videoSSRC:i._audioSSRC;a&&vt.subscribe(this.store.sessionId,{succ:t,ec:e,video:s===mt.VIDEO,audio:s===mt.AUDIO,peerid:i.uid,subscribeRequestid:s===mt.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:li.measureFromSubscribeStart(this.store.clientId,a)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new zn("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Un({},this.store):this.isPlanB?new $n({},this.store):new Mn({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Z.LocalAudioTrack);if((t==null?void 0:t.track)instanceof vn){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(i=>{e.removeAudioTrack(i)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Ee.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.connection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Z.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Z.LocalVideoTrack);if(t)return{width:t.track._videoWidth||0,height:t.track._videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof te||e&&e.track instanceof Ie?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!e||i.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!e||i.has(e))}getRemoteMedia(t){var e;const i=Array.from(gr(e=this.remoteUserMap).call(e)).find(s=>s.uid===t);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(i=>{let[s]=i;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(Z.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=eu(t).call(t,(i,s)=>i.level-s.level),t}async disconnectForReconnect(){this.connection&&(R.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Ee.Reconnecting,x("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var i;e._videoTrack&&e._videoTrack._player&&((i=e._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Un({},this.store):this.isPlanB?new $n({},this.store):new Mn({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[i,{track:s}]=t;switch(i){case Z.LocalVideoTrack:It(e=s._hints).call(e,Fe.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case Z.LocalAudioTrack:s instanceof vn?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case Z.LocalVideoLowTrack:}}),this.emit(kt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,i]=t;Array.from(gr(i).call(i)).forEach(s=>{this.setPendingRemoteMedia(e,s)}),this.emit(kt.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[e,i]=t;Array.from(gr(i).call(i)).forEach(s=>{this.setPendingRemoteDataChannel(e,s)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),R.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,e){for(const i of this.pendingRemoteDataChannels){const{user:s,id:a}=i;if((t instanceof ui?t.uid:t)===s.uid&&a===e)return!0}return!1}setPendingRemoteDataChannel(t,e){this.hasPendingRemoteDataChannel(t,e)||this.pendingRemoteDataChannels.push({user:t,id:e})}hasPendingRemoteMedia(t,e){for(const i of this.pendingRemoteTracks){const{user:s,kind:a}=i;if((t instanceof ui?t.uid:t)===s.uid&&e===a)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}restartICE(t){var e=this;return qr(function*(){if(!e.connection||e.state!==Ee.Connected||e.connection instanceof Un)return;const i=yield Te(e.mutex.lock("From P2PChannel.restartICE"));let s;try{s=yield Te(e.connection.restartICE(t));const d=yield Te(s.next());if(d.done)return;const u=d.value,h=yield u;switch(e.reportPCDisconnectedOrFailed(t),t){case ci.TCP:e._pcStatsUploadType=Ps.TCP_RESTART;break;case ci.RELAY:e._pcStatsUploadType=Ps.RELAY_RESTART;break;default:e._pcStatsUploadType=Ps.OLD_RESTART}e._isInRestartIce=!0,s.next(h)}catch(d){var a;(a=s)===null||a===void 0||a.throw(d)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),e=this.localTrackMap.get(Z.LocalVideoTrack),i=this.localTrackMap.get(Z.LocalAudioTrack),s=t.videoSend.find(b=>b.ssrc===(e==null?void 0:e.ssrcs[0].ssrcId)),a=t.audioSend.find(b=>b.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId));if(!s||!a)return 1;const d=Ki(this,kt.NeedSignalRTT),u=s?s.rttMs:void 0,h=a?a.rttMs:void 0,p=u&&h?(u+h)/2:u||h,_=(p&&d?(p+d)/2:p||d)||0,m=100*t.sendPacketLossRate*.7/50+.3*_/1500,S=m<.17?1:m<.36?2:m<.59?3:m<.1?4:5,y=e==null?void 0:e.track;if(y&&y._encoderConfig&&y._hints.indexOf(Fe.SCREEN_TRACK)===-1){const b=y._encoderConfig.bitrateMax,I=t.bitrate.actualEncoded;if(b&&I){const A=(1e3*b-I)/(1e3*b);return NA[A<.15?0:A<.3?1:A<.45?2:A<.6?3:4][S]}}return S}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[s]=i;const a=s._audioSSRC,d=s._videoSSRC,u=t.audioRecv.find(I=>I.ssrc===a),h=t.videoRecv.find(I=>I.ssrc===d);if(!u&&!h)return void(e+=1);const p=Ki(this,kt.NeedSignalRTT),_=t.rtt,m=(_&&p?(_+p)/2:_||p)||0,S=u?u.jitterMs:void 0,y=t.recvPacketLossRate;let b=.7*y*100/50+.3*m/1500;S&&(b=.6*y*100/50+.2*m/1500+.2*S/400),e+=b<.1?1:b<.17?2:b<.36?3:b<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new W((e,i)=>{this.handleMuteLocalTrack(t,e,i)})}filterTobePublishedTracks(t,e,i){const s=[],a=xe(),d=this.getAllTracks();t=Dd(t=t.filter(p=>d.indexOf(p)===-1));let u=!1,h=!1;for(const p of t){if(p instanceof te&&(this.localTrackMap.has(Z.LocalVideoTrack)||u?new J(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:p,type:Z.LocalVideoTrack}),u=!0),e)){const _=this.getLowVideoTrack(p,i);s.push({track:_,type:Z.LocalVideoLowTrack})}if(p instanceof Ie){const _=this.localTrackMap.get(Z.LocalAudioTrack);if(_){if(!(_.track instanceof vn))throw new J(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(p._bypassWebAudio)throw new J(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");_.track.addAudioTrack(p),this.bindLocalAudioTrackEvents(p,!0)}else if(h){const m=s.find(S=>{let{type:y}=S;return y===Z.LocalAudioTrack});if(!(m.track instanceof vn))throw new J(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(p._bypassWebAudio)throw new J(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");m.track.addAudioTrack(p)}else{if(!a.webAudioMediaStreamDest||p instanceof vn||p._bypassWebAudio)s.push({track:p,type:Z.LocalAudioTrack});else{const m=new vn;m.addAudioTrack(p),s.push({track:m,type:Z.LocalAudioTrack})}h=!0}}}return s}filterTobeUnpublishedTracks(t){const e=[],i=this.getAllTracks();t=Dd(t=t.filter(s=>i.indexOf(s)!==-1));for(const s of t){if(s instanceof Ie){const a=this.localTrackMap.get(Z.LocalAudioTrack);if(!a)continue;a.track instanceof vn?(a.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),a.track.trackList.length===0&&(e.push([Z.LocalAudioTrack,a]),a.track.close())):e.push([Z.LocalAudioTrack,a])}if(s instanceof te){const a=this.localTrackMap.get(Z.LocalVideoTrack);if(!a)continue;e.push([Z.LocalVideoTrack,a]);const d=this.localTrackMap.get(Z.LocalVideoLowTrack);d&&e.push([Z.LocalVideoLowTrack,d])}}return e}filterTobePublishedDataChannels(t){return t=(t=Dd(t)).filter(e=>this.localDataChannels.findIndex(i=>i.id===e.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=Dd(t)).filter(e=>this.localDataChannels.indexOf(e)!==-1)).filter(e=>e._originDataChannel)}bindLocalTrackEvents(t){t.forEach(e=>{let{track:i,type:s}=e;switch(s){case Z.LocalVideoTrack:i.addListener(ft.GET_STATS,this.handleGetLocalVideoStats),i.addListener(ft.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(ft.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(ft.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),i.addListener(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Z.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Z.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof vn?t.trackList.forEach(i=>{i.addListener(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(ft.GET_STATS,this.handleGetLocalAudioStats),i.addListener(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(ft.GET_STATS,this.handleGetLocalAudioStats),t.addListener(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||t.addListener(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[i,{track:s}]=e;return{track:s,type:i}})),t.forEach(e=>{let{track:i,type:s}=e;switch(s){case Z.LocalVideoTrack:i.off(ft.GET_STATS,this.handleGetLocalVideoStats),i.off(ft.GET_RTC_STATS,this.handleGetRTCStats),i.off(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(ft.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(ft.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),i.off(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Z.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Z.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof vn?t.trackList.forEach(e=>{e.off(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(ft.GET_STATS,this.handleGetLocalAudioStats),e.off(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(ft.GET_STATS,this.handleGetLocalAudioStats),t.off(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof eo&&e.addListener(ft.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(t))}),e instanceof hs&&e.addListener(ft.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(ft.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,i]=t;i.has(mt.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),i.has(mt.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((i,s)=>{var a;let d,u,{track:h,type:p}=i;switch(p){case Z.LocalAudioTrack:d=Ae.Audio,u={dtx:h instanceof Sa&&h._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Z.LocalVideoTrack:d=It(a=h._hints).call(a,Fe.SCREEN_TRACK)?Ae.Screen:Ae.High,u=Oa(Oa({},If(h)),{},{codec:this.store.codec});break;case Z.LocalVideoLowTrack:d=Ae.Low,u=Oa(Oa({},If(h)),{},{codec:this.store.codec})}return{stream_type:d,attributes:u,ssrcs:e[s]}})}createGatewayUnpublishMessage(t){return t.map(e=>{var i;let s,[a,{track:d,ssrcs:u,id:h}]=e;switch(a){case Z.LocalVideoTrack:s=It(i=d._hints).call(i,Fe.SCREEN_TRACK)?Ae.Screen:Ae.High;break;case Z.LocalAudioTrack:s=Ae.Audio;break;case Z.LocalVideoLowTrack:s=Ae.Low}return{stream_type:s,ssrcs:u,mid:h}})}assignLocalTracks(t,e){t.forEach((i,s)=>{let{track:a,type:d}=i;this.localTrackMap.set(d,{track:a,id:e[s].id,ssrcs:e[s].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[i]=e;this.localTrackMap.delete(i)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{if(R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit(kt.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),x("NEW_ICE_RESTART")){var i;if(It(i=this._restartStates).call(i,e)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const s=u=>{(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")&&(R.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(u)),Ki(this,kt.QueryClientConnectionState)==="CONNECTED"&&this.emit(kt.RequestRestartICE,u))},a=()=>{t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="checking"&&t.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),R.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(kt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},d=x("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(x("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&xe().supportPCSetConfiguration)s(ci.RELAY),this._restartTimer=window.setTimeout(a,d);else if(We())s(ci.UDP),this._restartTimer=window.setTimeout(a,4e3);else{if(s(ci.TCP),xe().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{s(ci.RELAY),this._restartTimer=window.setTimeout(a,d)},d));this._restartTimer=window.setTimeout(a,d)}},800))}}else{if(e==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&x("ICE_RESTART")&&Ki(this,kt.QueryClientConnectionState)==="CONNECTED"&&this.emit(kt.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(kt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);e==="failed"&&(R.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(kt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),vt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:Je.TRACER}).onSuccess(),this.emit(kt.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var i;const s=Array.from(gr(i=this.remoteUserMap).call(i)).find(d=>d._audioSSRC===e);var a;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(a=s.audioTrack)===null||a===void 0||a.emit(wc.FIRST_FRAME_DECODED),vt.firstRemoteFrame(this.store.sessionId,Wn.FIRST_AUDIO_DECODE,Ke.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:li.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var i;const s=Array.from(gr(i=this.remoteUserMap).call(i)).find(a=>a._audioSSRC===e);s&&vt.firstRemoteFrame(this.store.sessionId,Wn.FIRST_AUDIO_RECEIVED,Ke.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:li.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,i,s)=>{this.reportVideoFirstFrameDecoded(e,i,s)},t.onFirstVideoReceived=e=>{var i;const s=Array.from(gr(i=this.remoteUserMap).call(i)).find(a=>a._videoSSRC===e);s&&vt.firstRemoteFrame(this.store.sessionId,Wn.FIRST_VIDEO_RECEIVED,Ke.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:li.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,i)=>{const s=e.candidateType==="relay",a=i.candidateType==="relay";i.candidateType!=="unknown"&&s===a||this.emit(kt.ConnectionTypeChange,s),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(ba(i))," -> ").concat(JSON.stringify(ba(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,i)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(ba(i))," -> ").concat(JSON.stringify(ba(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const i=this.localTrackMap.get(Z.LocalAudioTrack);if(t instanceof Ie&&(i==null?void 0:i.track)instanceof vn)return i.track.isActive||e.push([Z.LocalAudioTrack,i]),e;const s=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:d}]=a;return t===d});if(s&&(e.push(s),s[0]===Z.LocalVideoTrack)){const a=this.localTrackMap.get(Z.LocalVideoLowTrack);a&&e.push([Z.LocalVideoLowTrack,a])}return e}filterTobeUnmutedTracks(t){const e=[],i=this.localTrackMap.get(Z.LocalAudioTrack);if(t instanceof Ie&&(i==null?void 0:i.track)instanceof vn)return i.track.isActive&&e.push([Z.LocalAudioTrack,i]),e;const s=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:d}]=a;return t===d});if(s)if(s[0]===Z.LocalVideoTrack){e.push(s);const a=this.localTrackMap.get(Z.LocalVideoLowTrack);a&&e.push([Z.LocalVideoLowTrack,a])}else e.push(s);return e}createMuteMessage(t){return t.map(e=>{var i;let s,[a,{track:d,ssrcs:u,id:h}]=e;switch(a){case Z.LocalAudioTrack:s=Ae.Audio;break;case Z.LocalVideoTrack:s=It(i=d._hints).call(i,Fe.SCREEN_TRACK)?Ae.Screen:Ae.High;break;case Z.LocalVideoLowTrack:s=Ae.Low}return{stream_type:s,ssrcs:u,mid:h}})}createUnmuteMessage(t){return t.map(e=>{var i;let s,[a,{track:d,ssrcs:u,id:h}]=e;switch(a){case Z.LocalAudioTrack:s=Ae.Audio;break;case Z.LocalVideoTrack:s=It(i=d._hints).call(i,Fe.SCREEN_TRACK)?Ae.Screen:Ae.High;break;case Z.LocalVideoLowTrack:s=Ae.Low}return{stream_type:s,ssrcs:u,mid:h}})}filterTobeUnSubscribedTracks(t,e){const i=[],s=this.remoteUserMap.get(t);if(!s)return i;if(e){const a=s.get(e);if(!a)return i;i.push([t,{kind:e,id:a}])}else Array.from(s.entries()).forEach(a=>{let[d,u]=a;i.push([t,{kind:d,id:u}])});return i}filterTobeUnSubscribedDataChannels(t,e){const i=[];return e.forEach(s=>{var a;(a=this.remoteDataChannelMap.get(t))!==null&&a!==void 0&&a.has(s.id)&&i.push(s)}),i}createUnsubscribeMessage(t){const e=[];return t.forEach(i=>{let[s,{kind:a,id:d}]=i;switch(a){case mt.VIDEO:return void(s._videoSSRC&&e.push({stream_type:mt.VIDEO,ssrcId:s._videoSSRC}));case mt.AUDIO:return void(s._audioSSRC&&e.push({stream_type:mt.AUDIO,ssrcId:s._audioSSRC}))}}),e}createUnsubscribeAllMessage(t){const e=new Map;return t.forEach(i=>{let[s,{kind:a}]=i;if(e.has(s)){let d=e.get(s);a===mt.VIDEO?d|=On.Video:d|=On.Audio,e.set(s,d)}else a===mt.VIDEO?e.set(s,On.Video):e.set(s,On.Audio)}),{users:Array.from(e.entries()).map(i=>{let[s,a]=i;return{stream_id:s.uid,stream_type:a}})}}withdrawRemoteTracks(t){t.forEach(e=>{let[i,{kind:s}]=e;const a=this.remoteUserMap.get(i);a&&(a.delete(s),Array.from(a.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(Z.LocalVideoTrack),i=this.localTrackMap.get(Z.LocalVideoLowTrack);e&&await e.track.setBitrateLimit(t.uplink),i&&t.low_stream_uplink&&await i.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,e){return t.map((i,s)=>{var a;let{stream_type:d}=i;return(a=e.find(u=>{let{stream_type:h}=u;return d===h}))===null||a===void 0?void 0:a.attributes})}async tryToUnmuteAudio(t){for(let i=0;i<t.length;i++)if(t[i]instanceof Ie){var e;const s=this.filterTobeUnmutedTracks(t[i]);if(s.length===0)continue;await((e=this.connection)===null||e===void 0?void 0:e.unmuteLocal(s.map(d=>{let[,{id:u}]=d;return u})));const a=this.createUnmuteMessage(s);return void await ke(this,kt.RequestUnmuteLocal,a)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.connection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(kt.RequestUploadStats,t,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await si(Up(this.dtlsFailedCount,Rn)),this.emit(kt.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),e=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),e.length>0&&await tn(this,kt.RequestUnpublishForReconnectPC,e),this.disconnectForReconnect(),this.emit(kt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Z.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof te)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof te).length>1)throw new J(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof Ie).length>1&&(t.some(e=>e instanceof Ie&&e._bypassWebAudio)||!xe().webAudioMediaStreamDest))throw new J(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof te&&this.pendingLocalTracks.some(i=>i instanceof te))throw new J(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof Ie&&this.pendingLocalTracks.some(i=>i instanceof Ie)&&(!xe().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Ie&&i._bypassWebAudio)))throw new J(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const i=!x("DISABLE_DUAL_STREAM_USE_ENCODING")&&xe().supportDualStreamEncoding,s=Oa(Oa({},{width:160,height:120,framerate:15,bitrate:50}),e);let a;a=i?t._mediaStreamTrack.clone():hT(t,s);const d=Le(8,"track-low-"),u=new te(a,Oa(Oa({},i&&{scaleResolutionDownBy:JS(s,t)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,d);return u.on(Wd.TRANSCEIVER_UPDATED,h=>{t._updateRtpTransceiver(h,Ea.LOW_STREAM)}),u._hints.push(Fe.LOW_STREAM),t.addListener(ft.NEED_CLOSE,()=>{u.close()}),u}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,e,i){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Mn){var a,d,u,h;const p=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:_,dtlsTransportState:m,peerConnectionState:S}=this.connection,{local:y,remote:b}=await this.connection.getSelectedCandidatePair();vt.pcStats(this.store.sessionId,{startTime:p,eventElapse:t-p||0,iceconnectionsate:_,dtlsstate:m,connectionstate:S,intSucc:e?1:2,error:s,selectedLocalCandidateProtocol:(a=y==null?void 0:y.protocol)!==null&&a!==void 0?a:"",selectedLocalCandidateType:(d=y.candidateType)!==null&&d!==void 0?d:"",selectedLocalCandidateAddress:"".concat(y.address,":").concat(y.port),selectedRemoteCandidateProtocol:(u=b.protocol)!==null&&u!==void 0?u:"",selectedRemoteCandidateType:(h=b.candidateType)!==null&&h!==void 0?h:"",selectedRemoteCandidateAddress:"".concat(b.address,":").concat(b.port),restartCnt:i})}}reportVideoFirstFrameDecoded(t,e,i,s){var a;const d=Array.from(gr(a=this.remoteUserMap).call(a)).find(u=>u._videoSSRC===t);if(d){s||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const u=this.store.keyMetrics,h=u.subscribe.find(p=>p.userId===d.uid&&p.type==="video");vt.firstRemoteVideoDecode(this.store.sessionId,Wn.FIRST_VIDEO_DECODE,Ke.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:e,videoheight:i,subscribeElapse:li.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:u.requestAPEnd||0,apStart:u.requestAPStart||0,joinGwEnd:u.joinGatewayEnd||0,joinGwStart:u.joinGatewayStart||0,pcEnd:u.peerConnectionEnd||0,pcStart:u.peerConnectionStart||0,subscriberEnd:(h==null?void 0:h.subscribeEnd)||0,subscriberStart:(h==null?void 0:h.subscribeStart)||0,videoAddNotify:(h==null?void 0:h.streamAdded)||0,state:s?1:0})}}async remoteMediaSsrcChanged(t,e,i){if(!this.connection)return!1;const s=this.remoteUserMap.get(t);if(!s)return!1;const a=s.get(e);if(!a)return!1;const d=await this.connection.getRemoteSSRC(a);return d!==void 0&&d!==i}resetConnection(t){R.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(t)),this.state===Ee.Connected?(R.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=t===zp.datachannel?new Un({},this.store):this.isPlanB?new $n({},this.store):new Mn({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:i}]=t;e===Z.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Ea.LOW_STREAM):i._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(t){this.connection&&this.connection instanceof Mn&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===Ps.TCP_RESTART&&t===ci.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,Ps.DISCONNECTED_OR_FAILED)))}}function yi(n,t,e){const i=n[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return e.value=async function(){const s=this.mutex,a=await s.lock("From P2PChannel.".concat(t));try{for(var d=arguments.length,u=new Array(d),h=0;h<d;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{a()}},e}function m5(n){let t=ON();return function(e,i){let s=e.appId;s!==void 0&&(we(i,10),ao(i,s));let a=e.cid;a!==void 0&&(we(i,16),we(i,a));let d=e.cname;d!==void 0&&(we(i,26),ao(i,d));let u=e.deviceId;u!==void 0&&(we(i,34),ao(i,u));let h=e.elapse;h!==void 0&&(we(i,40),Na(i,h));let p=e.fileSize;p!==void 0&&(we(i,48),Na(i,nl(p)));let _=e.height;_!==void 0&&(we(i,56),Na(i,nl(_)));let m=e.jpg;m!==void 0&&(we(i,66),we(i,m.length),function(lr,tt){let ot=il(lr,tt.length);lr.bytes.set(tt,ot)}(i,m));let S=e.networkType;S!==void 0&&(we(i,72),Na(i,nl(S)));let y=e.osType;y!==void 0&&(we(i,80),Na(i,nl(y)));let b=e.requestId;b!==void 0&&(we(i,90),ao(i,b));let I=e.sdkVersion;I!==void 0&&(we(i,98),ao(i,I));let A=e.sequence;A!==void 0&&(we(i,104),Na(i,nl(A)));let L=e.sid;L!==void 0&&(we(i,114),ao(i,L));let U=e.timestamp;U!==void 0&&(we(i,120),Na(i,U));let F=e.uid;F!==void 0&&(we(i,128),we(i,F));let $=e.vid;$!==void 0&&(we(i,136),we(i,$));let z=e.width;z!==void 0&&(we(i,144),Na(i,nl(z)));let G=e.service;G!==void 0&&(we(i,152),we(i,G));let Y=e.callbackData;Y!==void 0&&(we(i,162),ao(i,Y));let q=e.jpgEncryption;q!==void 0&&(we(i,168),we(i,q));let ut=e.requestType;ut!==void 0&&(we(i,176),we(i,ut));let ct=e.scorePorn;ct!==void 0&&(we(i,185),ST(i,ct));let $t=e.scoreSexy;$t!==void 0&&(we(i,193),ST(i,$t));let pe=e.scoreNeutral;pe!==void 0&&(we(i,201),ST(i,pe));let sn=e.scene;sn!==void 0&&(we(i,208),we(i,sn));let Nn=e.ossFilePrefix;Nn!==void 0&&(we(i,218),ao(i,Nn));let Ge=e.serviceVendor;if(Ge!==void 0)for(let lr of Ge){we(i,226);let tt=ON();S5(lr,tt),we(i,tt.limit),v5(i,tt),R5(tt)}}(n,t),function(e){let i=e.bytes,s=e.limit;return i.length===s?i:i.subarray(0,s)}(t)}function E5(n){return function(e){let i={};t:for(;!NN(e);){let s=co(e);switch(s>>>3){case 0:break t;case 1:i.code=co(e);break;case 2:i.msg=DN(e,co(e));break;case 3:{let a=T5(e);i.data=g5(e),e.limit=a;break}default:wN(e,7&s)}}return i}({bytes:t=n,offset:0,limit:t.length});var t}function g5(n){let t={};t:for(;!NN(n);){let e=co(n);switch(e>>>3){case 0:break t;case 1:t.requestId=DN(n,co(n));break;case 2:t.requestType=co(n)>>>0;break;case 3:t.scorePorn=gT(n);break;case 4:t.scoreSexy=gT(n);break;case 5:t.scoreNeutral=gT(n);break;case 6:t.requestScene=co(n)>>>0;break;case 7:t.scene=co(n)>>>0;break;default:wN(n,7&e)}}return t}function S5(n,t){let e=n.service;e!==void 0&&(we(t,8),we(t,e));let i=n.vendor;i!==void 0&&(we(t,16),we(t,i));let s=n.token;s!==void 0&&(we(t,26),ao(t,s));let a=n.callbackUrl;a!==void 0&&(we(t,34),ao(t,a))}function T5(n){let t=co(n),e=n.limit;return n.limit=n.offset+t,e}function wN(n,t){switch(t){case 0:for(;128&PN(n););break;case 2:mT(n,co(n));break;case 5:mT(n,4);break;case 1:mT(n,8);break;default:throw new Error("Unimplemented type: "+t)}}X([yi,C("design:type",Function),C("design:paramtypes",[Object,Boolean]),C("design:returntype",W)],Zn.prototype,"startP2PConnection",null),X([yi,C("design:type",Function),C("design:paramtypes",[Object,Object,Array,Object,String,String]),C("design:returntype",W)],Zn.prototype,"connect",null),X([yi,C("design:type",Function),C("design:paramtypes",[Array]),C("design:returntype",void 0)],Zn.prototype,"updateRemoteRTPCapabilities",null),X([yi,C("design:type",Function),C("design:paramtypes",[Object,Object,Array,Object,String,String]),C("design:returntype",W)],Zn.prototype,"preConnect",null),X([yi,C("design:type",Function),C("design:paramtypes",[Array]),C("design:returntype",W)],Zn.prototype,"publishDataChannel",null),X([yi,C("design:type",Function),C("design:paramtypes",[Array]),C("design:returntype",W)],Zn.prototype,"unpublish",null),X([yi,C("design:type",Function),C("design:paramtypes",[Array]),C("design:returntype",W)],Zn.prototype,"unpublishDataChannel",null),X([yi,C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",W)],Zn.prototype,"unpublishLowStream",null),X([yi,C("design:type",Function),C("design:paramtypes",[ui,Array]),C("design:returntype",W)],Zn.prototype,"subscribeDataChannel",null),X([yi,C("design:type",Function),C("design:paramtypes",[ui,String,Number,Number,Array]),C("design:returntype",W)],Zn.prototype,"subscribe",null),X([yi,C("design:type",Function),C("design:paramtypes",[Array]),C("design:returntype",W)],Zn.prototype,"massSubscribe",null),X([yi,C("design:type",Function),C("design:paramtypes",[ui,String,Boolean]),C("design:returntype",W)],Zn.prototype,"unsubscribe",null),X([yi,C("design:type",Function),C("design:paramtypes",[ui,Array]),C("design:returntype",W)],Zn.prototype,"unsubscribeDataChannel",null),X([yi,C("design:type",Function),C("design:paramtypes",[Array]),C("design:returntype",W)],Zn.prototype,"massUnsubscribe",null),X([yi,C("design:type",Function),C("design:paramtypes",[ui,String]),C("design:returntype",W)],Zn.prototype,"muteRemote",null),X([yi,C("design:type",Function),C("design:paramtypes",[ui,String]),C("design:returntype",W)],Zn.prototype,"unmuteRemote",null),X([yi,C("design:type",Function),C("design:paramtypes",[ui,String]),C("design:returntype",W)],Zn.prototype,"hasRemoteMediaWithLock",null),X([yi,C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",W)],Zn.prototype,"disconnectForReconnect",null),X([yi,C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",W)],Zn.prototype,"updateBitrateLimit",null),X([yi,C("design:type",Function),C("design:paramtypes",[ui,String,Number]),C("design:returntype",W)],Zn.prototype,"remoteMediaSsrcChanged",null);let y5=new Float32Array(1);new Uint8Array(y5.buffer);let _T=new Float64Array(1),Zi=new Uint8Array(_T.buffer);function nl(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}let AN=[];function ON(){const n=AN.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}function R5(n){AN.push(n)}function mT(n,t){if(n.offset+t>n.limit)throw new Error("Skip past limit");n.offset+=t}function NN(n){return n.offset>=n.limit}function il(n,t){let e=n.bytes,i=n.offset,s=n.limit,a=i+t;if(a>e.length){let d=new Uint8Array(2*a);d.set(e),n.bytes=d}return n.offset=a,a>s&&(n.limit=a),i}function ET(n,t){let e=n.offset;if(e+t>n.limit)throw new Error("Read past limit");return n.offset+=t,e}function DN(n,t){let e=ET(n,t),i=String.fromCharCode,s=n.bytes,a="�",d="";for(let u=0;u<t;u++){let h,p,_,m,S=s[u+e];128&S?(224&S)==192?u+1>=t?d+=a:(h=s[u+e+1],(192&h)!=128?d+=a:(m=(31&S)<<6|63&h,m<128?d+=a:(d+=i(m),u++))):(240&S)==224?u+2>=t?d+=a:(h=s[u+e+1],p=s[u+e+2],(49344&(h|p<<8))!=32896?d+=a:(m=(15&S)<<12|(63&h)<<6|63&p,m<2048||m>=55296&&m<=57343?d+=a:(d+=i(m),u+=2))):(248&S)==240?u+3>=t?d+=a:(h=s[u+e+1],p=s[u+e+2],_=s[u+e+3],(12632256&(h|p<<8|_<<16))!=8421504?d+=a:(m=(7&S)<<18|(63&h)<<12|(63&p)<<6|63&_,m<65536||m>1114111?d+=a:(m-=65536,d+=i(55296+(m>>10),56320+(1023&m)),u+=3))):d+=a:d+=i(S)}return d}function ao(n,t){let e=t.length,i=0;for(let d=0;d<e;d++){let u=t.charCodeAt(d);u>=55296&&u<=56319&&d+1<e&&(u=(u<<10)+t.charCodeAt(++d)-56613888),i+=u<128?1:u<2048?2:u<65536?3:4}we(n,i);let s=il(n,i),a=n.bytes;for(let d=0;d<e;d++){let u=t.charCodeAt(d);u>=55296&&u<=56319&&d+1<e&&(u=(u<<10)+t.charCodeAt(++d)-56613888),u<128?a[s++]=u:(u<2048?a[s++]=u>>6&31|192:(u<65536?a[s++]=u>>12&15|224:(a[s++]=u>>18&7|240,a[s++]=u>>12&63|128),a[s++]=u>>6&63|128),a[s++]=63&u|128)}}function v5(n,t){let e=il(n,t.limit),i=n.bytes,s=t.bytes;for(let a=0,d=t.limit;a<d;a++)i[a+e]=s[a]}function PN(n){return n.bytes[ET(n,1)]}function kN(n,t){let e=il(n,1);n.bytes[e]=t}function gT(n){let t=ET(n,8),e=n.bytes;return Zi[0]=e[t++],Zi[1]=e[t++],Zi[2]=e[t++],Zi[3]=e[t++],Zi[4]=e[t++],Zi[5]=e[t++],Zi[6]=e[t++],Zi[7]=e[t++],_T[0]}function ST(n,t){let e=il(n,8),i=n.bytes;_T[0]=t,i[e++]=Zi[0],i[e++]=Zi[1],i[e++]=Zi[2],i[e++]=Zi[3],i[e++]=Zi[4],i[e++]=Zi[5],i[e++]=Zi[6],i[e++]=Zi[7]}function co(n){let t,e=0,i=0;do t=PN(n),e<32&&(i|=(127&t)<<e),e+=7;while(128&t);return i}function we(n,t){for(t>>>=0;t>=128;)kN(n,127&t|128),t>>>=7;kN(n,t)}function Na(n,t){let e=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,s=t.high>>>24,a=s===0?i===0?e<16384?e<128?1:2:e<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:s<128?9:10,d=il(n,a),u=n.bytes;switch(a){case 10:u[d+9]=s>>>7&1;case 9:u[d+8]=a!==9?128|s:127&s;case 8:u[d+7]=a!==8?i>>>21|128:i>>>21&127;case 7:u[d+6]=a!==7?i>>>14|128:i>>>14&127;case 6:u[d+5]=a!==6?i>>>7|128:i>>>7&127;case 5:u[d+4]=a!==5?128|i:127&i;case 4:u[d+3]=a!==4?e>>>21|128:e>>>21&127;case 3:u[d+2]=a!==3?e>>>14|128:e>>>14&127;case 2:u[d+1]=a!==2?e>>>7|128:e>>>7&127;case 1:u[d]=a!==1?128|e:127&e}}function LN(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}const C5=new Map([["moderation",1],["supervise",2]]);class Gf extends Ye{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const e=this._connectionState;this._connectionState=t,this.emit(Ln.CONNECTION_STATE_CHANGE,e,t)}get inspectType(){return this._inspectType}set inspectType(t){var e;this._inspectMode=yc(e=t.map(i=>C5.get(i)||0)).call(e,(i,s)=>i+s),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),g(this,"name","AgoraRTCVideoContentInspect"),g(this,"_connectionState",Rr.CONNECTING),g(this,"_innerConnectionState",void 0),g(this,"sequence",0),g(this,"inspectStartTime",void 0),g(this,"workerManagerConnection",void 0),g(this,"workerConnection",void 0),g(this,"workerMessageLengthLimit",void 0),g(this,"inspectIntervalMinimum",void 0),g(this,"qualityRatio",void 0),g(this,"_connectInfo",void 0),g(this,"_cancelTokenSource",qi.CancelToken.source()),g(this,"_retryConfig",void 0),g(this,"wmSequence",0),g(this,"inspectInterval",void 0),g(this,"inspectTimer",null),g(this,"ossFilePrefix",void 0),g(this,"extraInfo",void 0),g(this,"_inspectType",void 0),g(this,"_inspectMode",void 0),g(this,"_quality",1),g(this,"qualityTimer",null),g(this,"_inspectId",void 0),g(this,"_needWorkUrlOnly",!1),g(this,"inspectImage",()=>{if(this.connectionState!==Rr.CONNECTED)throw new B(O.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Rr.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Le(5,"inspect-"),this.workerMessageLengthLimit=x("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=x("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=x("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Su("worker-manager-"+this._inspectId,Rn),this.on(Ln.STATE_CHANGE,(e,i)=>{this._innerConnectionState=e,R.debug("[".concat(this._inspectId,"] Inspect operation :").concat(vr[e]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Su("worker-"+this._inspectId,Rn),this.handleWorkerEvents()}async init(t,e){this.emit(Ln.STATE_CHANGE,vr.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=e,new W((s,a)=>{this.on(Ln.CONNECTION_STATE_CHANGE,(d,u)=>{u===Rr.CONNECTED&&s()}),this.requestAP(t,i,e).then(d=>{this.connectWorkerManager(d)}).catch(d=>{a(d)})})}async requestAP(t,e,i){const s=x("WEBCS_DOMAIN").map(u=>"https://".concat(u,"/api/v1")),a=await function(u,h,p,_){let{appId:m,areaCode:S,cname:y,sid:b,token:I,uid:A}=h;Zd++;const L="image_moderation_api",U={service_name:L,json_body:JSON.stringify({appId:m,areaCode:S,cname:y,command:"allocateEdge",requestId:Zd,seq:Zd,sid:b,token:I,ts:Date.now(),uid:A+""})};let F,$,z=u[0];return Ns(async()=>{F=Date.now();const G=await Vo(z,{data:U,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if($=Date.now()-F,G.code!==0){const ct=new B(O.UNEXPECTED_RESPONSE,"image inspect ap error, code"+G.code,{retry:!0,responseTime:$});throw R.error(ct.toString()),ct}const Y=JSON.parse(G.json_body);if(Y.code!==200){const ct=new B(O.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Y.code,", reason: ").concat(Y.reason),{code:Y.code,responseTime:$});throw R.error(ct.toString()),ct}if(!Y.servers||!Array.isArray(Y.servers)||Y.servers.length===0){const ct=new B(O.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Y.code,responseTime:$});throw R.error(ct.toString()),ct}const q=x("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ut=x("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Y.servers.map(ct=>{let{address:$t,wss:pe}=ct;if($t&&pe)return"wss://".concat($t.replace(/\./g,"-"),".").concat(q,":").concat(ut||pe)}).filter(ct=>!!ct),workerToken:Y.workerToken,vid:Y.vid,responseTime:$}},(G,Y)=>(vt.apworkerEvent(b,{success:!0,sc:200,serviceName:L,responseDetail:JSON.stringify(G.addressList),firstSuccess:Y===0,responseTime:$,serverIp:u[Y%u.length]}),!1),(G,Y)=>(vt.apworkerEvent(b,{success:!1,sc:G.data&&G.data.code||200,serviceName:L,responseTime:$,serverIp:u[Y%u.length]}),!!(G.code!==O.OPERATION_ABORTED&&G.code!==O.UNEXPECTED_RESPONSE||G.data&&G.data.retry)&&(z=u[(Y+1)%u.length],!0)),_)}(s,t,e,i);this.emit(Ln.STATE_CHANGE,vr.AP_CONNECTED);const{addressList:d}=a;return this.wmSequence++,d}async connectWorkerManager(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=e,this.emit(Ln.STATE_CHANGE,vr.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Bt.CONNECTED,async()=>{this.emit(Ln.STATE_CHANGE,vr.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.19.3",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Bt.CLOSED,()=>{this._innerConnectionState<vr.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Bt.FAILED,()=>{this._innerConnectionState<vr.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Bt.RECONNECTING,()=>{this._innerConnectionState<vr.GET_WORKER_MANAGER_RESPONSE&&R.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Bt.ON_MESSAGE,async t=>{this.emit(Ln.STATE_CHANGE,vr.GET_WORKER_MANAGER_RESPONSE);const e=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(t.data);if(i.code!==200)throw R.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new B(O.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&e))throw R.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new B(O.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const s=x("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,a=e.replace(/:\d+\/?$/,":".concat(s));this.emit(Ln.STATE_CHANGE,vr.CONNECT_WORKER,a),this._needWorkUrlOnly?this.emit(Ln.REQUEST_NEW_WORKER_URL,a):await this.connectWorker(a)}}),this.workerManagerConnection.on(Bt.WILL_RECONNECT,(t,e,i)=>{i(t)}),this.workerManagerConnection.on(Bt.REQUEST_NEW_URLS,(t,e)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(e)})}handleWorkerEvents(){this.workerConnection.on(Bt.CONNECTED,async()=>{this.emit(Ln.STATE_CHANGE,vr.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Rr.CONNECTED}),this.workerConnection.on(Bt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const i=E5(new Uint8Array(t.data));if(x("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&R.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Ln.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var e;const s={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},a=yc(e=Object.keys(s)).call(e,(u,h)=>s[u]>s[h]?u:h,"porn"),d=Object.keys(s).find(u=>u===a);this.emit(Ln.INSPECT_RESULT,d)}else this.emit(Ln.INSPECT_RESULT,void 0,new B(O.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(Ln.INSPECT_RESULT,void 0,new B(O.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else R.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Ln.INSPECT_RESULT,void 0,new B(O.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Bt.CLOSED,()=>{this.connectionState=Rr.CLOSED}),this.workerConnection.on(Bt.FAILED,()=>{this.connectionState=Rr.CLOSED}),this.workerConnection.on(Bt.RECONNECTING,()=>{this.connectionState=this.connectionState===Rr.CONNECTED?Rr.RECONNECTING:Rr.CONNECTING}),this.workerConnection.on(Bt.WILL_RECONNECT,(t,e,i)=>{t==="recover"&&i(t),i("tryNext")}),this.workerConnection.on(Bt.REQUEST_NEW_URLS,(t,e)=>{this.workerManagerConnection.close(),this.once(Ln.REQUEST_NEW_WORKER_URL,i=>{t([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{e(i)})})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){this.sequence++;const t=Ki(this,Ln.CLIENT_LOCAL_VIDEO_TRACK),e={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(Ln.INSPECT_RESULT,void 0,new B(O.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(t,e);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(Ln.INSPECT_RESULT,void 0,new B(O.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,e){let{appId:i,cname:s,cid:a,vid:d,sid:u,uid:h}=e;const p=Date.now(),_=await t.getCurrentFrameImage("image/jpeg",this.quality),m=await IO(_,i,s),S=this.sequence+"-"+a+"-"+h+"-"+p+"-"+Le(12,""),y={appId:i,cid:a,cname:s,deviceId:"",elapse:Gf.intToLong(Number(p-this.inspectStartTime)),fileSize:m.byteLength,jpgEncryption:2,height:_.height,width:_.width,jpg:m,networkType:6,osType:7,requestId:S,sdkVersion:"4.19.3",sequence:this.sequence,sid:u,timestamp:Gf.intToLong(p),uid:h,vid:d,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete y.callbackData,this.ossFilePrefix===void 0&&delete y.ossFilePrefix;const b=m5(y);if(b.byteLength<this.workerMessageLengthLimit){if(x("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const I=function(A){for(var L=1;L<arguments.length;L++){var U=arguments[L]!=null?arguments[L]:{};L%2?LN(Object(U),!0).forEach(function(F){g(A,F,U[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(A,Object.getOwnPropertyDescriptors(U)):LN(Object(U)).forEach(function(F){Object.defineProperty(A,F,Object.getOwnPropertyDescriptor(U,F))})}return A}({},y);delete I.jpg,R.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(I))}return b}{const I=this.quality*this.qualityRatio;return this.quality=I,await this.generateRequestData(t,{appId:i,cname:s,cid:a,vid:d,sid:u,uid:h})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=qi.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Rr.CLOSED,this.emit(Ln.STATE_CHANGE,vr.CLOSED)}}function I5(n){let t=function(){const e=A5.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(e,i){let s=e.appId;s!==void 0&&(Cn(i,10),Bc(i,s));let a=e.cid;a!==void 0&&(Cn(i,16),Cn(i,a));let d=e.cname;d!==void 0&&(Cn(i,26),Bc(i,d));let u=e.deviceId;u!==void 0&&(Cn(i,34),Bc(i,u));let h=e.elapse;h!==void 0&&(Cn(i,40),Da(i,h));let p=e.fileSize;p!==void 0&&(Cn(i,48),Da(i,rl(p)));let _=e.height;_!==void 0&&(Cn(i,56),Da(i,rl(_)));let m=e.jpg;m!==void 0&&(Cn(i,66),Cn(i,m.length),UN(i,m));let S=e.networkType;S!==void 0&&(Cn(i,72),Da(i,rl(S)));let y=e.osType;y!==void 0&&(Cn(i,80),Da(i,rl(y)));let b=e.requestId;b!==void 0&&(Cn(i,90),Bc(i,b));let I=e.sdkVersion;I!==void 0&&(Cn(i,98),Bc(i,I));let A=e.sequence;A!==void 0&&(Cn(i,104),Da(i,rl(A)));let L=e.sid;L!==void 0&&(Cn(i,114),Bc(i,L));let U=e.timestamp;U!==void 0&&(Cn(i,120),Da(i,U));let F=e.uid;F!==void 0&&(Cn(i,128),Cn(i,F));let $=e.vid;$!==void 0&&(Cn(i,136),Cn(i,$));let z=e.width;z!==void 0&&(Cn(i,144),Da(i,rl(z)));let G=e.service;G!==void 0&&(Cn(i,152),Cn(i,G));let Y=e.callbackData;Y!==void 0&&(Cn(i,162),Cn(i,Y.length),UN(i,Y));let q=e.ticket;q!==void 0&&(Cn(i,170),Bc(i,q))}(n,t),function(e){let i=e.bytes,s=e.limit;return i.length===s?i:i.subarray(0,s)}(t)}function b5(n){return function(e){let i={};t:for(;!O5(e);){let s=Hu(e);switch(s>>>3){case 0:break t;case 1:i.code=Hu(e);break;case 2:i.msg=xN(e,Hu(e));break;case 3:i.requestId=xN(e,Hu(e));break;case 4:i.timestamp=N5(e,!1);break;default:w5(e,7&s)}}return i}({bytes:t=n,offset:0,limit:t.length});var t}function w5(n,t){switch(t){case 0:for(;128&Es(n););break;case 2:TT(n,Hu(n));break;case 5:TT(n,4);break;case 1:TT(n,8);break;default:throw new Error("Unimplemented type: "+t)}}function rl(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}let A5=[];function TT(n,t){if(n.offset+t>n.limit)throw new Error("Skip past limit");n.offset+=t}function O5(n){return n.offset>=n.limit}function Hf(n,t){let e=n.bytes,i=n.offset,s=n.limit,a=i+t;if(a>e.length){let d=new Uint8Array(2*a);d.set(e),n.bytes=d}return n.offset=a,a>s&&(n.limit=a),i}function MN(n,t){let e=n.offset;if(e+t>n.limit)throw new Error("Read past limit");return n.offset+=t,e}function UN(n,t){let e=Hf(n,t.length);n.bytes.set(t,e)}function xN(n,t){let e=MN(n,t),i=String.fromCharCode,s=n.bytes,a="�",d="";for(let u=0;u<t;u++){let h,p,_,m,S=s[u+e];128&S?(224&S)==192?u+1>=t?d+=a:(h=s[u+e+1],(192&h)!=128?d+=a:(m=(31&S)<<6|63&h,m<128?d+=a:(d+=i(m),u++))):(240&S)==224?u+2>=t?d+=a:(h=s[u+e+1],p=s[u+e+2],(49344&(h|p<<8))!=32896?d+=a:(m=(15&S)<<12|(63&h)<<6|63&p,m<2048||m>=55296&&m<=57343?d+=a:(d+=i(m),u+=2))):(248&S)==240?u+3>=t?d+=a:(h=s[u+e+1],p=s[u+e+2],_=s[u+e+3],(12632256&(h|p<<8|_<<16))!=8421504?d+=a:(m=(7&S)<<18|(63&h)<<12|(63&p)<<6|63&_,m<65536||m>1114111?d+=a:(m-=65536,d+=i(55296+(m>>10),56320+(1023&m)),u+=3))):d+=a:d+=i(S)}return d}function Bc(n,t){let e=t.length,i=0;for(let d=0;d<e;d++){let u=t.charCodeAt(d);u>=55296&&u<=56319&&d+1<e&&(u=(u<<10)+t.charCodeAt(++d)-56613888),i+=u<128?1:u<2048?2:u<65536?3:4}Cn(n,i);let s=Hf(n,i),a=n.bytes;for(let d=0;d<e;d++){let u=t.charCodeAt(d);u>=55296&&u<=56319&&d+1<e&&(u=(u<<10)+t.charCodeAt(++d)-56613888),u<128?a[s++]=u:(u<2048?a[s++]=u>>6&31|192:(u<65536?a[s++]=u>>12&15|224:(a[s++]=u>>18&7|240,a[s++]=u>>12&63|128),a[s++]=u>>6&63|128),a[s++]=63&u|128)}}function Es(n){return n.bytes[MN(n,1)]}function VN(n,t){let e=Hf(n,1);n.bytes[e]=t}function Hu(n){let t,e=0,i=0;do t=Es(n),e<32&&(i|=(127&t)<<e),e+=7;while(128&t);return i}function Cn(n,t){for(t>>>=0;t>=128;)VN(n,127&t|128),t>>>=7;VN(n,t)}function N5(n,t){let e,i=0,s=0,a=0;return e=Es(n),i=127&e,128&e&&(e=Es(n),i|=(127&e)<<7,128&e&&(e=Es(n),i|=(127&e)<<14,128&e&&(e=Es(n),i|=(127&e)<<21,128&e&&(e=Es(n),s=127&e,128&e&&(e=Es(n),s|=(127&e)<<7,128&e&&(e=Es(n),s|=(127&e)<<14,128&e&&(e=Es(n),s|=(127&e)<<21,128&e&&(e=Es(n),a=127&e,128&e&&(e=Es(n),a|=(127&e)<<7))))))))),{low:i|s<<28,high:s>>>4|a<<24,unsigned:t}}function Da(n,t){let e=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,s=t.high>>>24,a=s===0?i===0?e<16384?e<128?1:2:e<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:s<128?9:10,d=Hf(n,a),u=n.bytes;switch(a){case 10:u[d+9]=s>>>7&1;case 9:u[d+8]=a!==9?128|s:127&s;case 8:u[d+7]=a!==8?i>>>21|128:i>>>21&127;case 7:u[d+6]=a!==7?i>>>14|128:i>>>14&127;case 6:u[d+5]=a!==6?i>>>7|128:i>>>7&127;case 5:u[d+4]=a!==5?128|i:127&i;case 4:u[d+3]=a!==4?e>>>21|128:e>>>21&127;case 3:u[d+2]=a!==3?e>>>14|128:e>>>14&127;case 2:u[d+1]=a!==2?e>>>7|128:e>>>7&127;case 1:u[d]=a!==1?128|e:127&e}}const FN={},BN={},Yf=4294967296,jN=Yf*Yf,WN=jN/2,yT=HN(0,!0),GN=HN(0),D5=sl(0,-2147483648,!1),P5=sl(-1,2147483647,!1),k5=sl(-1,-1,!0);function HN(n,t){let e,i,s;return t?(s=0<=(n>>>=0)&&n<256)&&(i=BN[n],i)?i:(e=sl(n,0,!0),s&&(BN[n]=e),e):(s=-128<=(n|=0)&&n<128)&&(i=FN[n],i)?i:(e=sl(n,n<0?-1:0,!1),s&&(FN[n]=e),e)}function sl(n,t,e){return{low:0|n,high:0|t,unsigned:!!e}}function L5(n,t){if(isNaN(n))return t?yT:GN;if(t){if(n<0)return yT;if(n>=jN)return k5}else{if(n<=-WN)return D5;if(n+1>=WN)return P5}return n<0?t?yT:GN:sl(n%Yf|0,n/Yf|0,t)}function YN(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}class RT extends Ye{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const e=this._connectionState;this._connectionState=t,this.emit(Gr.CONNECTION_STATE_CHANGE,t,e)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var e;super(),g(this,"name","AgoraRTCImageModeration"),g(this,"_connectionState",ar.CONNECTING),g(this,"_sequence",0),g(this,"_moderationStartTime",void 0),g(this,"_workerConnection",void 0),g(this,"_workerMessageLengthLimit",void 0),g(this,"_qualityRatio",void 0),g(this,"_connectInfo",void 0),g(this,"_cancelTokenSource",qi.CancelToken.source()),g(this,"_retryConfig",void 0),g(this,"_moderationInterval",void 0),g(this,"_moderationTimer",null),g(this,"_moderationMode",1),g(this,"_quality",1),g(this,"_qualityTimer",null),g(this,"_ticket",void 0),g(this,"_moderationIntervalMinimum",void 0),g(this,"_uploadFailedNum",0),g(this,"_uploadNum",0),g(this,"_uploadTimer",null),g(this,"_moderationId",void 0),g(this,"inspectImage",()=>{if(this.connectionState!==ar.CONNECTED)throw new B(O.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===ar.CONNECTED?this.requestToInspectImage():R.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Le(5,"image-moderation-"),this._workerMessageLengthLimit=x("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=x("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(e=t.interval)!==null&&e!==void 0?e:1e3,this._qualityRatio=x("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Su("worker-"+this._moderationId,Rn),this.on(Gr.STATE_CHANGE,(i,s)=>{R.debug("[".concat(this._moderationId,"] Moderation operation :").concat(ma[i]," ").concat(s||""))}),this.handleWorkerEvents()}async init(t,e){this.emit(Gr.STATE_CHANGE,ma.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=e,new W((s,a)=>{this.on(Gr.CONNECTION_STATE_CHANGE,(d,u)=>{d===ar.CONNECTED&&s()}),this.requestAP(t,i,e).then(d=>{this.connectWorker(d)}).catch(d=>{a(d)})})}updateConfig(t){var e;this._moderationInterval=(e=t.interval)!==null&&e!==void 0?e:1e3,R.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===ar.CONNECTED&&this.inspectImage()}async requestAP(t,e,i){const s=x("WEBCS_DOMAIN").map(h=>"https://".concat(h,"/api/v1")),a=await function(h,p,_,m){let{appId:S,areaCode:y,cname:b,sid:I,token:A,uid:L}=p;Zd++;const U="moderation_plugin",F={service_name:U,json_body:JSON.stringify({appId:S,areaCode:y,cname:b,command:"allocateEdge",requestId:Zd,seq:Zd,sid:I,appToken:A,ts:Date.now(),uid:L+""})};let $,z,G=h[0];return Ns(async()=>{$=Date.now();const Y=await Vo(G,{data:F,cancelToken:_,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(z=Date.now()-$,Y.code!==0){const ct=new B(O.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Y.code,{retry:!0,responseTime:z});throw R.error(ct.toString()),ct}const q=JSON.parse(Y.json_body);if(q.code!==200){const ct=new B(O.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(q.code,", reason: ").concat(q.reason),{code:q.code,responseTime:z});throw R.error(ct.toString()),ct}if(!q.servers||!Array.isArray(q.servers)||q.servers.length===0){const ct=new B(O.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:q.code,responseTime:z});throw R.error(ct.toString()),ct}if(!q.servers.some(ct=>!!ct.wss)){const ct=new B(O.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:q.code,responseTime:z});throw R.error(ct.toString()),ct}const ut=x("IMAGE_MODERATION_WORKER_HOST");return{addressList:q.servers.map(ct=>{let{address:$t,wss:pe}=ct;if($t&&pe)return"wss://".concat($t.replace(/\./g,"-"),".").concat(ut,":").concat(pe,"/moderation")}).filter(ct=>!!ct),workerToken:q.workerToken,vid:q.vid,ticket:q.appTicket,responseTime:z}},(Y,q)=>(vt.apworkerEvent(I,{success:!0,sc:200,serviceName:U,responseDetail:JSON.stringify(Y.addressList),firstSuccess:q===0,responseTime:z,serverIp:h[q%h.length]}),!1),(Y,q)=>(vt.apworkerEvent(I,{success:!1,sc:Y.data&&Y.data.code||200,serviceName:U,responseTime:z,serverIp:h[q%h.length]}),!!(Y.code!==O.OPERATION_ABORTED&&Y.code!==O.UNEXPECTED_RESPONSE||Y.data&&Y.data.retry)&&(G=h[(q+1)%h.length],!0)),m)}(s,t,e,i);this.emit(Gr.STATE_CHANGE,ma.AP_CONNECTED);const{addressList:d,ticket:u}=a;return this._ticket=u,d}async connectWorker(t){this.emit(Gr.STATE_CHANGE,ma.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(Bt.CONNECTED,async()=>{this.emit(Gr.STATE_CHANGE,ma.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=ar.CONNECTED}),this._workerConnection.on(Bt.CLOSED,()=>{this.connectionState=ar.CLOSED}),this._workerConnection.on(Bt.FAILED,()=>{this.connectionState=ar.CLOSED}),this._workerConnection.on(Bt.RECONNECTING,()=>{this.connectionState=this.connectionState===ar.CONNECTED?ar.RECONNECTING:ar.CONNECTING}),this._workerConnection.on(Bt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const e=b5(new Uint8Array(t.data));x("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(e)),this._uploadNum++,e.code===void 0||e.code===0||(this._uploadFailedNum++,R.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(e.code,", msg is ").concat(e.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{vt.reportApiInvoke(this._connectInfo.sid||null,{name:An.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,e.code],tag:Je.TRACER}).onError(new B(O.IMAGE_MODERATION_UPLOAD_FAILED,e.msg)),this._uploadTimer=null},x("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else R.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Bt.WILL_RECONNECT,(t,e,i)=>{t==="recover"&&i(t),i("tryNext")}),this._workerConnection.on(Bt.REQUEST_NEW_URLS,(t,e)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(e)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=Ki(this,Gr.CLIENT_LOCAL_VIDEO_TRACK),e={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(x("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being played can be inspected"));this._sequence++;const i=await this.generateRequestData(t,e);this._workerConnection.sendMessage(i,!0,!0)}else x("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&R.debug("Only the track being published can be inspected")}async generateRequestData(t,e){let{appId:i,cname:s,cid:a,vid:d,sid:u,uid:h}=e;const p=Date.now(),_=await t.getCurrentFrameImage("image/jpeg",this.quality),m=await IO(_,i,s),S=this._sequence+"-"+a+"-"+h+"-"+p+"-"+Le(12,""),y={appId:i,cid:a,cname:s,deviceId:"",elapse:RT.intToLong(Number(p-this._moderationStartTime)),fileSize:_.buffer.byteLength,height:_.height,width:_.width,jpg:m,networkType:6,osType:7,requestId:S,sdkVersion:"4.19.3",sequence:this._sequence,sid:u,timestamp:L5(p),uid:h,vid:d,service:this._moderationMode,ticket:this._ticket},b=I5(y);if(b.byteLength<this._workerMessageLengthLimit){if(x("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const I=function(A){for(var L=1;L<arguments.length;L++){var U=arguments[L]!=null?arguments[L]:{};L%2?YN(Object(U),!0).forEach(function(F){g(A,F,U[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(A,Object.getOwnPropertyDescriptors(U)):YN(Object(U)).forEach(function(F){Object.defineProperty(A,F,Object.getOwnPropertyDescriptor(U,F))})}return A}({},y);delete I.jpg,R.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(I))}return b}{const I=this.quality*this._qualityRatio;return this.quality=I,await this.generateRequestData(t,{appId:i,cname:s,cid:a,vid:d,sid:u,uid:h})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=qi.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=ar.CLOSED,this.emit(Gr.STATE_CHANGE,ma.CLOSED)}}function KN(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Kf(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?KN(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):KN(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}class Ui extends FA{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,e;return(t=(e=this.peerConnection.getReceivers()[0])===null||e===void 0||(e=e.transport)===null||e===void 0?void 0:e.state)!==null&&t!==void 0?t:null}constructor(t,e,i){super(t,e),g(this,"direction",void 0),g(this,"store",void 0),g(this,"peerConnection",void 0),g(this,"transportEventReceiver",void 0),g(this,"statsFilter",void 0),g(this,"localCandidateCount",0),g(this,"allCandidatesReceived",!1),g(this,"mutex",new zn("P2PConnection-mutex")),g(this,"dataChannel",void 0),g(this,"onLocalCandidate",void 0),this.store=e,this.peerConnection=new RTCPeerConnection(Ui.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.direction=i??Vd.SEND_ONLY,this.dataChannel=this.peerConnection.createDataChannel("agora-p2p-signal",{ordered:!0}),this.statsFilter=Vf(this.peerConnection,x("STATS_UPDATE_INTERVAL"),void 0,We()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{if(t){await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const e=await this.peerConnection.createAnswer();if(await this.peerConnection.setLocalDescription(e),!e.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");return e.sdp}{const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");return await this.peerConnection.setLocalDescription(e),e.sdp}}catch(e){throw new J(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(t){try{await this.peerConnection.setRemoteDescription({type:"answer",sdp:t})}catch(e){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async addRemoteCandidate(t){try{await this.peerConnection.addIceCandidate(t)}catch(e){throw new J(O.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(e.toString()))}}async send(t){try{const e=[];t.forEach(a=>{const d=this.peerConnection.addTransceiver(a._mediaStreamTrack,{direction:"sendonly"});e.push(d)}),We()&&x("SIMULCAST")===!0&&await this.applySimulcastForFirefox(e,t),await this.applySimulcastEncodings(e,t),await this.applySendEncodings(e,t);const i=await this.peerConnection.createOffer();if(await this.peerConnection.setLocalDescription(i),!i.sdp)throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");const s=e.map(a=>{const d=this.getLocalSSRC(a.mid,i.sdp);if(!d)throw new Error("Cannot get ssrc when trying to send PeerConnection.");return{mid:a.mid,localSSRC:[{ssrcId:d}]}});return{sdp:i.sdp,trackMessage:s}}catch(e){throw e instanceof J?e:new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}}async stopSending(t,e){const i=e?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{const s=this.peerConnection.getTransceivers().filter(d=>t.indexOf(d.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length (".concat(s.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));s.map(d=>{var u;d.direction="inactive",(u=d.stop)===null||u===void 0||u.call(d),this.peerConnection.removeTrack(d.sender)});const a=await this.peerConnection.createOffer();if(await this.peerConnection.setLocalDescription(a),!a.sdp)throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");return a.sdp}catch(s){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}finally{i&&i()}}async receive(t,e,i){try{await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");await this.peerConnection.setLocalDescription(s),R.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."));const a=this.getRemoteMid(i,e);if(a===void 0)throw new Error("Cannot get transceiver mid when trying to receive track.");const d=this.peerConnection.getTransceivers().find(u=>u.mid===a);if(!d||d.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,mid:d.mid,sdp:s.sdp}}catch(s){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async setDescription(t,e){try{if(t==="remote"){await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");return await this.peerConnection.setLocalDescription(i),R.debug("[".concat(this.store.clientId,"] [P2PConnection] exchanging SDP, type is ").concat(t)),i.sdp}await this.peerConnection.setRemoteDescription({type:"answer",sdp:e})}catch(i){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection.setDescription failed; ".concat(i.toString()))}}async stopReceiving(t,e){try{const i=this.peerConnection.getTransceivers().filter(a=>t.indexOf(a.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(a=>{var d;a.direction="inactive",(d=a.stop)===null||d===void 0||d.call(a)}),await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const s=await this.peerConnection.createAnswer();if(await this.peerConnection.setLocalDescription(s),!s.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");return s.sdp}catch(i){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(){try{const t=await this.peerConnection.createOffer({iceRestart:!0});if(!t.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");return this.store.descriptionStart(),await this.peerConnection.setLocalDescription(t),t.sdp}catch(t){throw new J(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,e){}async updateSendParameters(t,e){const i=this.peerConnection.getTransceivers().filter(s=>s.mid===t);i.length===1&&(this.isVP8Simulcast(e)?We()||await this.applySimulcastEncodings(i,[e]):await this.applySendEncodings(i,[e]))}setStatsRemoteVideoIsReady(t,e){this.statsFilter.setVideoIsReady2(t,e)}async replaceTrack(t,e){const i=this.peerConnection.getTransceivers().find(s=>s.mid===e);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const e=t[0].transport.iceTransport,{local:i,remote:s}=e.getSelectedCandidatePair();return{local:Kf(Kf({},oo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:Kf(Kf({},oo),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{var e;t.candidate&&((e=this.onLocalCandidate)===null||e===void 0||e.call(this,t.candidate)),t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,R.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},x("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const e={iceServers:[]};return t.iceServers?e.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Nd(t.turnServer.servers)?e.iceServers=t.turnServer.servers:(e.iceServers&&e.iceServers.push(...Ui.turnServerConfigToIceServers(t.turnServer.servers)),x("USE_TURN_SERVER_OF_GATEWAY")&&e.iceServers&&t.turnServer.serversFromGateway&&e.iceServers.push(...Ui.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),x("FORCE_TURN_TCP")?e.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(e.iceTransportPolicy="relay")}))),x("ENABLE_ENCODED_TRANSFORM")&&xe().supportWebRTCEncodedTransform&&(e.encodedInsertableStreams=!0),e}static turnServerConfigToIceServers(t){const e=[];return t.forEach(i=>{i.tcpport&&(e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Vu(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}),e.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=udp")}),e.push({username:i.username,credential:i.password,credentialType:"password",urls:"stun:".concat(i.turnServerURL,":").concat(i.tcpport)}))}),e}tryBindTransportEvents(t){const e=t.transport;if(e){this.transportEventReceiver=t,e.onstatechange=()=>{var s;e!=null&&e.state&&((s=this.onDTLSTransportStateChange)===null||s===void 0||s.call(this,e.state))},e.onerror=s=>{var a;(a=this.onDTLSTransportError)===null||a===void 0||a.call(this,"error"in s?s.error:s)};const i=e.iceTransport;i&&(i.onstatechange=()=>{const s=e==null?void 0:e.iceTransport.state;var a;s&&((a=this.onICETransportStateChange)===null||a===void 0||a.call(this,s))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:s,remote:a}=i.getSelectedCandidatePair();R.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol}),", remote ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,e){var i;if(e||(e=this.peerConnection.getSenders().find(_=>_.track===t._mediaStreamTrack)),!e)return R.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return R.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!xe().supportSetRtpSenderParameters)return R.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},a={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(t._encoderConfig){var d;const{bitrateMax:_,frameRate:m,scaleResolutionDownBy:S}=t._encoderConfig;_&&(a.maxBitrate=1e3*_),It(d=t._hints).call(d,Fe.LOW_STREAM)&&(m&&(a.maxFramerate=Nr(m)),S&&S>=1&&(a.scaleResolutionDownBy=S))}if(x("DSCP_TYPE")&&la()){var u;const _=x("DSCP_TYPE");It(u=["very-low","low","medium","high"]).call(u,_)&&(a.networkPriority=_)}const h=e.getParameters(),p=(i=h.encodings)===null||i===void 0?void 0:i[0];We()&&!p&&(s.encodings=[a]),p&&Object.assign(p,a),Object.assign(h,s),R.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await e.setParameters(h)}async applySendEncodings(t,e){try{if(!xe().supportSetRtpSenderParameters||t.length!==e.length)return;for(let i=0;i<t.length;i++){const s=t[i],a=e[i];a instanceof te&&!this.isVP8Simulcast(a)&&await this.updateRtpSenderEncodings(a,s.sender)}}catch{R.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,e,i){const s=dn.parse(t);return e.forEach((a,d)=>{const u=i[d],h=s.mediaDescriptions.find(p=>p.attributes.mid===u);h&&(Vc(h,a),dT(h,a,this.store.codec))}),dn.print(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var e;(e=this.onFirstAudioReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var e;(e=this.onFirstVideoReceived)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var e;(e=this.onFirstAudioDecoded)===null||e===void 0||e.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,e,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,e,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,e)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,e)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,e)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,e)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var e;(e=this.onFirstVideoDecodedTimeout)===null||e===void 0||e.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,e){if(t.length===e.length)for(let h=0;h<t.length;h++){var i,s,a,d,u;const p=t[h],_=e[h];if(_ instanceof te&&!It(i=_._hints).call(i,Fe.LOW_STREAM)&&(s=_._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((a=_._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(d=_._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((u=_._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){const m={},S={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};m.encodings=[{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:S.high}];const y=p.sender.getParameters();await p.sender.setParameters(Object.assign(y,m))}}}async applySimulcastEncodings(t,e){if(!We()&&t.length===e.length)for(let i=0;i<t.length;i++){const s=e[i];if(s instanceof te&&this.isVP8Simulcast(s)){const a=t[i],d={},u={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];const h=a.sender.getParameters();await a.sender.setParameters(Object.assign(h,d))}}}isVP8Simulcast(t){var e,i,s,a,d;return!!(t instanceof te&&x("SIMULCAST")&&this.store.codec==="vp8"&&!It(e=t._hints).call(e,Fe.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=t._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(a=t._scalabilityMode)!==null&&a!==void 0&&a.numSpatialLayers&&((d=t._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1)}logSDPExchange(t,e,i,s){if(x("SDP_LOGGING"))return R.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(e," SDP during P2PConnection.").concat(s,`
`),t),e==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",s)}:void 0}getLocalSSRC(t,e){var i,s;if(e=(i=e)!==null&&i!==void 0?i:(s=this.currentLocalDescription)===null||s===void 0?void 0:s.sdp){var a;const d=(a=dn.parse(e).mediaDescriptions.find(u=>u.attributes.mid===t))===null||a===void 0?void 0:a.attributes.ssrcs;return d==null?void 0:d[0].ssrcId}}getRemoteMid(t,e){var i,s;if(e=(i=e)!==null&&i!==void 0?i:(s=this.currentRemoteDescription)===null||s===void 0?void 0:s.sdp){var a;return(a=dn.parse(e).mediaDescriptions.find(d=>d.attributes.ssrcs.some(u=>u.ssrcId===t)))===null||a===void 0?void 0:a.attributes.mid}}async getRemoteSSRC(t,e){var i,s;if(e=(i=e)!==null&&i!==void 0?i:(s=this.currentRemoteDescription)===null||s===void 0?void 0:s.sdp){var a;const d=(a=dn.parse(e).mediaDescriptions.find(u=>u.attributes.mid===t))===null||a===void 0?void 0:a.attributes.ssrcs;return d==null?void 0:d[0].ssrcId}}}function gs(n,t,e){const i=n[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return e.value=async function(){const s=this.mutex,a=await s.lock("From P2PConnection.".concat(t));try{for(var d=arguments.length,u=new Array(d),h=0;h<d;h++)u[h]=arguments[h];return await i.apply(this,u)}finally{a()}},e}var Xr;function qN(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Pa(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?qN(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):qN(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}X([gs,C("design:type",Function),C("design:paramtypes",[String]),C("design:returntype",W)],Ui.prototype,"establish",null),X([gs,C("design:type",Function),C("design:paramtypes",[String]),C("design:returntype",W)],Ui.prototype,"connect",null),X([gs,C("design:type",Function),C("design:paramtypes",[RTCIceCandidate]),C("design:returntype",W)],Ui.prototype,"addRemoteCandidate",null),X([gs,C("design:type",Function),C("design:paramtypes",[Array]),C("design:returntype",W)],Ui.prototype,"send",null),X([gs,C("design:type",Function),C("design:paramtypes",[String,String,Number]),C("design:returntype",W)],Ui.prototype,"receive",null),X([gs,C("design:type",Function),C("design:paramtypes",[String,String]),C("design:returntype",W)],Ui.prototype,"setDescription",null),X([gs,C("design:type",Function),C("design:paramtypes",[Array,String]),C("design:returntype",W)],Ui.prototype,"stopReceiving",null),X([gs,C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",W)],Ui.prototype,"restartICE",null),X([gs,C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],Ui.prototype,"close",null),X([gs,C("design:type",Function),C("design:paramtypes",[String,di]),C("design:returntype",W)],Ui.prototype,"updateEncoderConfig",null),X([gs,C("design:type",Function),C("design:paramtypes",[String,di]),C("design:returntype",W)],Ui.prototype,"updateSendParameters",null),X([gs,C("design:type",Function),C("design:paramtypes",[di,String]),C("design:returntype",W)],Ui.prototype,"replaceTrack",null),function(n){n.SEND_ONLY="SEND_ONLY",n.RECEIVE_ONLY="RECEIVE_ONLY"}(Xr||(Xr={}));class rn extends Ye{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(kt.StateChange,e,this._state)}constructor(t,e){super(),g(this,"store",void 0),g(this,"statsUploader",void 0),g(this,"sendConnection",void 0),g(this,"recvConnection",void 0),g(this,"localTrackMap",new Map),g(this,"remoteUserMap",new Map),g(this,"localDataChannels",[]),g(this,"pendingLocalTracks",[]),g(this,"pendingRemoteTracks",[]),g(this,"statsCollector",void 0),g(this,"dtlsFailedCount",0),g(this,"sendMutex",new zn("P2PChannel2-send-mutex")),g(this,"recvMutex",new zn("P2PChannel2-recv-mutex")),g(this,"_state",Ee.Disconnected),g(this,"_restartStates",["disconnected","failed"]),g(this,"_restartTimer",void 0),g(this,"handleMuteLocalTrack",async(i,s,a)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Ee.Connected)return void a(new J(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const p=this.filterTobeMutedTracks(i);if(p.length===0)return void s();const _=p.find(L=>L[0]==="videoLowTrack");_&&_[1].track._originMediaStreamTrack.stop();let m=!1;var u,h;i.trackMediaType==="video"?m=!((u=this.localTrackMap.get(Z.LocalAudioTrack))===null||u===void 0||!u.track._muted):m=((h=this.localTrackMap.get(Z.LocalVideoTrack))===null||h===void 0?void 0:h.id)===void 0;const S=p.filter(L=>{let[U,F]=L;return(U!==Z.LocalAudioTrack||m)&&F.id!==void 0}).map(L=>{let[,U]=L;return U});let y;S.length>0&&(y=await this.sendConnection.stopSending(S.map(L=>L.id)),S.forEach(L=>{L.id=void 0,L.ssrcs=void 0}));const b=this.createMuteMessage(p),I=i.trackMediaType==="video"?Zs.MUTE_LOCAL_VIDEO:Zs.MUTE_LOCAL_AUDIO,A=await tn(this,kt.RequestP2PMuteLocal,{action:I,sdp:y,message:b,isMuteAll:m});A&&await this.sendConnection.setDescription("local",A),(y||i.trackMediaType==="audio")&&await ke(this,kt.RequestMuteLocal,b),s()}catch(p){a(p)}finally{d()}}),g(this,"handleUnmuteLocalTrack",async(i,s,a)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Ee.Connected)return void a(new J(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const u=this.filterTobeUnmutedTracks(i);if(u.length===0)return void s();const h=this.createUnmuteMessage(u),p=i.trackMediaType==="video"?Zs.UNMUTE_LOCAL_VIDEO:Zs.UNMUTE_LOCAL_AUDIO;await ke(this,kt.RequestP2PMuteLocal,{action:p,message:h}),s()}catch(u){a(u)}finally{d()}}),g(this,"handleUpdateVideoEncoder",async(i,s,a)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const u=this.localTrackMap.get(Z.LocalVideoTrack);if(!this.sendConnection||!u||u.track!==i||this.state!==Ee.Connected)return void s();const{id:h,track:p}=u;h&&(await this.sendConnection.updateSendParameters(h,p),await this.sendConnection.updateEncoderConfig(h,p),this.emit(kt.UpdateVideoEncoder,p)),s()}catch(u){a(u)}finally{d()}}),g(this,"handleSetOptimizationMode",async(i,s,a)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleSetOptimizationMode");try{const u=this.localTrackMap.get(Z.LocalVideoTrack);if(!this.sendConnection||!u||u.track!==i||this.state!==Ee.Connected)return;const{id:h,track:p}=u;h&&await this.sendConnection.updateSendParameters(h,p),s()}catch(u){a(u)}finally{d()}}),g(this,"handleReplaceTrack",async(i,s,a,d)=>{let u;R.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof d=="boolean"&&d||(u=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var h;const _=Array.from(this.localTrackMap.entries()).find(m=>{let[,{track:S}]=m;return i===S});if(!this.sendConnection||!_||_[1].id===void 0||this.state!==Ee.Connected)return void s();if(await((h=this.sendConnection)===null||h===void 0?void 0:h.replaceTrack(i,_[1].id)),_[0]===Z.LocalVideoTrack&&xe().supportDualStreamEncoding){const m=this.localTrackMap.get(Z.LocalVideoLowTrack);if(m){const S=i._mediaStreamTrack.clone();m.track._originMediaStreamTrack.stop(),m.track._mediaStreamTrack=S,m.track._originMediaStreamTrack=S,await new W((y,b)=>{this.handleReplaceTrack(m.track,y,b,!0)})}}s()}catch(_){a(_)}finally{var p;(p=u)===null||p===void 0||p()}}),g(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),g(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),g(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),g(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new CN,this.bindStatsUploaderEvents()}async startP2PConnection(t,e){throw new J(O.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t,e,i,s,a,d){throw new J(O.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,e){if(this.state=Ee.New,this.sendConnection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),this.recvConnection&&(R.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),this.sendConnection=new Ui(t,this.store),this.bindConnectionEvents(this.sendConnection),this.recvConnection=new Ui(t,this.store,Vd.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection),e){this.store.peerConnectionStart(),await this.recvConnection.establish(e);const i=await this.sendConnection.establish(e);return this.statsUploader.startUploadTransportStats(!0),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ee.Connected,i}return await this.recvConnection.establish(e),this.sendConnection.establish(e)}async p2pConnect(t){if(!this.sendConnection||!this.recvConnection)throw new J(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.recvConnection.connect(t),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ee.Connected}async addRemoteCandidate(t){if(!this.sendConnection||!this.recvConnection)throw new J(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t),await this.sendConnection.addRemoteCandidate(t)}async publish(t,e,i){if(!this.sendConnection||this.state!==Ee.Connected){this.throwIfTrackTypeNotMatch(t);const d=t.filter(u=>this.pendingLocalTracks.indexOf(u)===-1);return void(this.pendingLocalTracks=this.pendingLocalTracks.concat(d))}this.store.pubId=this.store.pubId+1,li.markPublishStart(this.store.clientId,this.store.pubId);const s=this.filterTobePublishedTracks(t,e,i);if(s.length===0)return void await this.tryToUnmuteAudio(t);s.forEach(d=>{let{track:u,type:h}=d;const p=Date.now();this.store.publish(u.getTrackId(),h===Z.LocalAudioTrack?"audio":"video",p)}),this.bindLocalTrackEvents(s);const a=this.createGatewayPublishMessage(s);return this.assignLocalTracks(s),s.forEach(d=>{let{track:u,type:h}=d;const p=Date.now();this.store.publish(u.getTrackId(),h===Z.LocalAudioTrack?"audio":"video",void 0,p)}),a}async dopublish(t){if(!this.sendConnection||this.state!==Ee.Connected)return;const e=this.localTrackMap.get(t);if(e){const{sdp:i,trackMessage:s}=await this.sendConnection.send([e.track]),{mid:a,localSSRC:d}=s[0];e.id=a,e.ssrcs=d,this.statsCollector.addLocalStats(t),this.statsUploader.startUploadUplinkStats();const u=await tn(this,kt.RequestP2PPublish,{kind:t===Z.LocalAudioTrack?mt.AUDIO:mt.VIDEO,sdp:i,ssrcId:d[0].ssrcId});await this.sendConnection.setDescription("local",u);const h=this.createUnmuteMessage([[t,e]]);await ke(this,kt.RequestUnmuteLocal,h)}}async setDescription(t,e){let i,s;t==="local"?(i=await this.sendMutex.lock("From P2PChannel.restartICE"),s=this.sendConnection):(i=await this.recvMutex.lock("From P2PChannel.restartICE"),s=this.recvConnection);try{return!s||this.state!==Ee.Connected?void 0:await s.setDescription(t,e)}finally{i()}}publishLowStream(t){return qr(function*(){throw new J(O.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(R.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await tn(this,kt.RequestRePublish,this.pendingLocalTracks),this.emit(kt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublish(t){if(!this.sendConnection||this.state!==Ee.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(h=>!It(t).call(t,h)));const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;this.unbindLocalTrackEvents(e.map(h=>{let[p,{track:_}]=h;return{type:p,track:_}}));const i=e.filter(h=>{let[,{id:p}]=h;return p!==void 0});if(!this.sendConnection||this.state!==Ee.Connected)return void t.forEach(h=>{const p=this.pendingLocalTracks.indexOf(h);p!==-1&&this.pendingLocalTracks.splice(p,1)});const s=e.find(h=>h[0]==="videoLowTrack");s&&s[1].track.close();let a;const d=this.createGatewayUnpublishMessage(e);i.length>0&&(a=await this.sendConnection.stopSending(i.map(h=>{let[,{id:p}]=h;return p}))),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(h=>{let[p,{track:_}]=h;return{type:p,track:_}})),e.forEach(h=>{let[p]=h;this.statsCollector.removeLocalStats(p)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadUplinkStats();const u=this.createMuteMessage(e);return await W.all(u.map(async h=>{await ke(this,kt.RequestMuteLocal,[h])})),{sdp:a,unpubMsg:d}}async unpublishLowStream(){throw new J(O.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async doUnpublish(t){if(!this.sendConnection||this.state!==Ee.Connected)return;const e=[];if(t!==mt.AUDIO){const i=this.localTrackMap.get(Z.LocalVideoTrack);(i==null?void 0:i.id)!==void 0&&e.push([Z.LocalVideoTrack,i]);const s=this.localTrackMap.get(Z.LocalVideoLowTrack);(s==null?void 0:s.id)!==void 0&&e.push([Z.LocalVideoLowTrack,s]),this.statsCollector.removeLocalStats(Z.LocalVideoTrack),this.statsCollector.removeLocalStats(Z.LocalVideoLowTrack)}if(t!==mt.VIDEO){const i=this.localTrackMap.get(Z.LocalAudioTrack);(i==null?void 0:i.id)!==void 0&&e.push([Z.LocalAudioTrack,i]),this.statsCollector.removeLocalStats(Z.LocalAudioTrack)}if(e.length>0){const i=await this.sendConnection.stopSending(e.map(d=>{let[,u]=d;return u.id}));e.forEach(d=>{let[,u]=d;u.id=void 0,u.ssrcs=void 0});const s=await tn(this,kt.RequestP2PUnPublish,{sdp:i,kind:t});await this.sendConnection.setDescription("local",s);const a=this.createMuteMessage(e);await W.all(a.map(async d=>{await ke(this,kt.RequestMuteLocal,[d])}))}}async subscribe(t,e,i,s){var a;if(!this.recvConnection||this.state!==Ee.Connected)throw new J(O.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((a=this.remoteUserMap.get(t))!==null&&a!==void 0&&a.has(e))return;const{track:d,mid:u,sdp:h}=await this.recvConnection.receive(e,i,s);e===mt.AUDIO?(t._audioSSRC=s,t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(d):(t._audioTrack=new hs(d,t.uid,t._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=s,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(d):(t._videoTrack=new eo(d,t.uid,t._uintid,this.store),R.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),this.bindRemoteTrackEvents(t,t._videoTrack));const p=this.remoteUserMap.get(t);p?p.set(e,u):this.remoteUserMap.set(t,new Map([[e,u]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadDownlinkStats(),await ke(this,kt.RequestP2PUnmuteRemote,e);const _=this.pendingRemoteTracks.findIndex(m=>{let{user:S,kind:y}=m;return S.uid===t.uid&&e===y});return _!==-1&&(this.pendingRemoteTracks.splice(_,1),this.emit(kt.MediaReconnectEnd,t.uid)),h}async unsubscribe(t,e,i,s){const a=this.pendingRemoteTracks.filter(h=>{let{user:p,kind:_}=h;return i!==void 0?p.uid===t.uid&&i===_:p.uid===t.uid});if(a.forEach(h=>{const p=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(p,1)}),this.recvConnection&&this.state===Ee.Connected||s||a.forEach(h=>{let{kind:p}=h;var _;if(p===mt.AUDIO)(_=t._audioTrack)===null||_===void 0||_._destroy(),t._audioTrack=void 0;else if(p===mt.VIDEO){var m;(m=t._videoTrack)===null||m===void 0||m._destroy(),t._videoTrack=void 0}}),!this.recvConnection||this.state!==Ee.Connected)return;const d=this.filterTobeUnSubscribedTracks(t,i);if(d.length===0)return void(i!==mt.VIDEO&&ke(this,kt.RequestP2PMuteRemote,mt.AUDIO));const u=await this.recvConnection.stopReceiving(d.map(h=>{let[,{id:p}]=h;return p}),e);return this.withdrawRemoteTracks(d),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),d.forEach(h=>{let[p,{kind:_}]=h;var m,S;if(_===mt.VIDEO&&p._videoSSRC&&((m=this.recvConnection)===null||m===void 0||m.setStatsRemoteVideoIsReady(p._videoSSRC,!1)),_===mt.VIDEO)this.unbindRemoteTrackEvents(p._videoTrack),s||((S=p._videoTrack)===null||S===void 0||S._destroy(),p._videoTrack=void 0);else if(_===mt.AUDIO){var y;this.unbindRemoteTrackEvents(p._audioTrack),!s&&((y=p._audioTrack)===null||y===void 0||y._destroy(),p._audioTrack=void 0)}}),d.filter(h=>{let[,{kind:p}]=h;return p!==mt.AUDIO}).forEach(h=>{let[,{kind:p}]=h;ke(this,kt.RequestP2PMuteRemote,p)}),i!==mt.VIDEO&&ke(this,kt.RequestP2PMuteRemote,mt.AUDIO),u}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new J(O.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new J(O.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new J(O.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new J(O.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,e){if(!this.recvConnection)return;const i=this.remoteUserMap.get(t);if(!i)return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!i.get(e))return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const s=e===mt.VIDEO?t._videoSSRC:t._audioSSRC;s!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.recvConnection)return;const i=this.remoteUserMap.get(t);if(!i)return void R.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));i.get(e)||R.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(Z.LocalAudioTrack);if((e==null?void 0:e.track)instanceof vn){const i=e.track;return Array.from(this.localTrackMap.entries()).filter(s=>{let[a]=s;return a!==Z.LocalAudioTrack}).filter(s=>{let[a]=s;return!(t&&a===Z.LocalVideoLowTrack)}).map(s=>{let[,{track:a}]=s;return a}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[s]=i;return!(t&&s===Z.LocalVideoLowTrack)}).map(i=>{let[,{track:s}]=i;return s})}reportPublishEvent(t,e,i,s,a){if(t){const u=this.localTrackMap.get(Z.LocalAudioTrack),h=s?this.localTrackMap.get(Z.LocalVideoLowTrack):this.localTrackMap.get(Z.LocalVideoTrack);vt.publish(this.store.sessionId,{eventElapse:li.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:u==null?void 0:u.track.getTrackLabel(),videoName:h==null?void 0:h.track.getTrackLabel(),screenshare:(h==null?void 0:h.track._hints.indexOf(Fe.SCREEN_TRACK))!==-1,audio:!!u,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}else{var d;i||(i=[]);const u=i.find(p=>p instanceof Ie),h=s?(d=this.localTrackMap.get(Z.LocalVideoTrack))===null||d===void 0?void 0:d.track:i.find(p=>p instanceof te);vt.publish(this.store.sessionId,{eventElapse:li.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:u==null?void 0:u.getTrackLabel(),videoName:h==null?void 0:h.getTrackLabel(),screenshare:(h==null?void 0:h._hints.indexOf(Fe.SCREEN_TRACK))!==-1,audio:!!u,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}}reportSubscribeEvent(t,e,i,s){const a=s===mt.VIDEO?i._videoSSRC:i._audioSSRC;a&&vt.subscribe(this.store.sessionId,{succ:t,ec:e,video:s===mt.VIDEO,audio:s===mt.AUDIO,peerid:i.uid,subscribeRequestid:s===mt.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:li.measureFromSubscribeStart(this.store.clientId,a)})}reset(){R.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new zn("P2PChannel2-send-mutex"),this.sendMutex=new zn("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Z.LocalAudioTrack);if((t==null?void 0:t.track)instanceof vn){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(i=>{e.removeAudioTrack(i)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=Ee.Disconnected}getStats(t){var e,i;return t?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(e=this.sendConnection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.recvConnection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Z.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Z.LocalVideoTrack);if(t)return{width:t.track._videoWidth||0,height:t.track._videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof te||e&&e.track instanceof Ie?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!e||i.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(t);return!!i&&(!e||i.has(e))}getRemoteMedia(t){var e;const i=Array.from(gr(e=this.remoteUserMap).call(e)).find(s=>s.uid===t);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(i=>{let[s]=i;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(Z.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=eu(t).call(t,(i,s)=>i.level-s.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(R.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Ee.Reconnecting,x("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var i;e._videoTrack&&e._videoTrack._player&&((i=e._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[i,{track:s}]=t;switch(i){case Z.LocalVideoTrack:It(e=s._hints).call(e,Fe.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case Z.LocalAudioTrack:s instanceof vn?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case Z.LocalVideoLowTrack:}}),this.emit(kt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,i]=t;Array.from(gr(i).call(i)).forEach(s=>{this.setPendingRemoteMedia(e,s)}),this.emit(kt.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),R.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,e){for(const i of this.pendingRemoteTracks){const{user:s,kind:a}=i;if((t instanceof ui?t.uid:t)===s.uid&&e===a)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}async restartICE(t){let e;e=t.direction===Vd.SEND_ONLY?await this.sendMutex.lock("From P2PChannel.restartICE"):await this.recvMutex.lock("From P2PChannel.restartICE");try{const i=await t.restartICE(),s=await tn(this,kt.RequestP2PRestartICE,i);t.setDescription("local",s)}finally{e()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),e=this.localTrackMap.get(Z.LocalVideoTrack),i=this.localTrackMap.get(Z.LocalAudioTrack),s=t.videoSend.find(b=>{var I;return b.ssrc===(e==null||(I=e.ssrcs)===null||I===void 0?void 0:I[0].ssrcId)}),a=t.audioSend.find(b=>{var I;return b.ssrc===(i==null||(I=i.ssrcs)===null||I===void 0?void 0:I[0].ssrcId)});if(!s||!a)return 1;const d=Ki(this,kt.NeedSignalRTT),u=s?s.rttMs:void 0,h=a?a.rttMs:void 0,p=u&&h?(u+h)/2:u||h,_=(p&&d?(p+d)/2:p||d)||0,m=100*t.sendPacketLossRate*.7/50+.3*_/1500,S=m<.17?1:m<.36?2:m<.59?3:m<.1?4:5,y=e==null?void 0:e.track;if(y&&y._encoderConfig&&y._hints.indexOf(Fe.SCREEN_TRACK)===-1){const b=y._encoderConfig.bitrateMax,I=t.bitrate.actualEncoded;if(b&&I){const A=(1e3*b-I)/(1e3*b);return NA[A<.15?0:A<.3?1:A<.45?2:A<.6?3:4][S]}}return S}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[s]=i;const a=s._audioSSRC,d=s._videoSSRC,u=t.audioRecv.find(I=>I.ssrc===a),h=t.videoRecv.find(I=>I.ssrc===d);if(!u&&!h)return void(e+=1);const p=Ki(this,kt.NeedSignalRTT),_=t.rtt,m=(_&&p?(_+p)/2:_||p)||0,S=u?u.jitterMs:void 0,y=t.recvPacketLossRate;let b=.7*y*100/50+.3*m/1500;S&&(b=.6*y*100/50+.2*m/1500+.2*S/400),e+=b<.1?1:b<.17?2:b<.36?3:b<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new W((e,i)=>{this.handleMuteLocalTrack(t,e,i)})}filterTobePublishedTracks(t,e,i){const s=[],a=xe(),d=this.getAllTracks();t=Dd(t=t.filter(p=>d.indexOf(p)===-1));let u=!1,h=!1;for(const p of t){if(p instanceof te&&(this.localTrackMap.has(Z.LocalVideoTrack)||u?new J(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:p,type:Z.LocalVideoTrack}),u=!0),e)){const _=this.getLowVideoTrack(p,i);s.push({track:_,type:Z.LocalVideoLowTrack})}if(p instanceof Ie){const _=this.localTrackMap.get(Z.LocalAudioTrack);if(_){if(!(_.track instanceof vn))throw new J(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(p._bypassWebAudio)throw new J(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");_.track.addAudioTrack(p),this.bindLocalAudioTrackEvents(p,!0)}else if(h){const m=s.find(S=>{let{type:y}=S;return y===Z.LocalAudioTrack});if(!(m.track instanceof vn))throw new J(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(p._bypassWebAudio)throw new J(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");m.track.addAudioTrack(p)}else{if(!a.webAudioMediaStreamDest||p instanceof vn||p._bypassWebAudio)s.push({track:p,type:Z.LocalAudioTrack});else{const m=new vn;m.addAudioTrack(p),s.push({track:m,type:Z.LocalAudioTrack})}h=!0}}}return s}filterTobeUnpublishedTracks(t){const e=[],i=this.getAllTracks();t=Dd(t=t.filter(s=>i.indexOf(s)!==-1));for(const s of t){if(s instanceof Ie){const a=this.localTrackMap.get(Z.LocalAudioTrack);if(!a)continue;a.track instanceof vn?(a.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),a.track.trackList.length===0&&(e.push([Z.LocalAudioTrack,a]),a.track.close())):e.push([Z.LocalAudioTrack,a])}if(s instanceof te){const a=this.localTrackMap.get(Z.LocalVideoTrack);if(!a)continue;e.push([Z.LocalVideoTrack,a]);const d=this.localTrackMap.get(Z.LocalVideoLowTrack);d&&e.push([Z.LocalVideoLowTrack,d])}}return e}bindLocalTrackEvents(t){t.forEach(e=>{let{track:i,type:s}=e;switch(s){case Z.LocalVideoTrack:i.addListener(ft.GET_STATS,this.handleGetLocalVideoStats),i.addListener(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(ft.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(ft.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),i.addListener(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Z.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Z.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof vn?t.trackList.forEach(i=>{i.addListener(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(ft.GET_STATS,this.handleGetLocalAudioStats),i.addListener(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(ft.GET_STATS,this.handleGetLocalAudioStats),t.addListener(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||t.addListener(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[i,{track:s}]=e;return{track:s,type:i}})),t.forEach(e=>{let{track:i,type:s}=e;switch(s){case Z.LocalVideoTrack:i.off(ft.GET_STATS,this.handleGetLocalVideoStats),i.off(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(ft.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(ft.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),i.off(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Z.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Z.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof vn?t.trackList.forEach(e=>{e.off(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(ft.GET_STATS,this.handleGetLocalAudioStats),e.off(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(ft.GET_STATS,this.handleGetLocalAudioStats),t.off(ft.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(ft.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(ft.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(ft.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(ft.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof eo&&e.addListener(ft.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(t))}),e instanceof hs&&e.addListener(ft.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(ft.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,i]=t;i.has(mt.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),i.has(mt.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t){return t.map(e=>{var i;let s,a,{track:d,type:u}=e;switch(u){case Z.LocalAudioTrack:s=Ae.Audio,a={dtx:d instanceof Sa&&d._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Z.LocalVideoTrack:s=It(i=d._hints).call(i,Fe.SCREEN_TRACK)?Ae.Screen:Ae.High,a=Pa(Pa({},If(d)),{},{codec:this.store.codec});break;case Z.LocalVideoLowTrack:s=Ae.Low,a=Pa(Pa({},If(d)),{},{codec:this.store.codec})}return{kind:u===Z.LocalAudioTrack?mt.AUDIO:mt.VIDEO,stream_type:s,attributes:a,isMuted:d.muted||!d.enabled}})}createGatewayUnpublishMessage(t){return t.map(e=>{var i;let s,[a,{track:d,ssrcs:u,id:h}]=e;switch(a){case Z.LocalVideoTrack:s=It(i=d._hints).call(i,Fe.SCREEN_TRACK)?Ae.Screen:Ae.High;break;case Z.LocalAudioTrack:s=Ae.Audio;break;case Z.LocalVideoLowTrack:s=Ae.Low}return{stream_type:s,ssrcs:u,mid:h}})}assignLocalTracks(t){t.forEach(e=>{let{track:i,type:s}=e;this.localTrackMap.set(s,{track:i})})}withdrawLocalTracks(t){t.forEach(e=>{let[i]=e;this.localTrackMap.delete(i)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{var i;if(R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit(kt.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),It(i=this._restartStates).call(i,e)||t.direction===Vd.SEND_ONLY){if(this._restartTimer)return;const s=()=>{(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")&&(R.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE")),Ki(this,kt.QueryClientConnectionState)==="CONNECTED"&&this.restartICE(t))};this._restartTimer=window.setTimeout(()=>{s(),this._restartTimer=void 0},800)}},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),vt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:Je.TRACER}).onSuccess(),this.emit(kt.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var i;const s=Array.from(gr(i=this.remoteUserMap).call(i)).find(d=>d._audioSSRC===e);var a;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(a=s.audioTrack)===null||a===void 0||a.emit(wc.FIRST_FRAME_DECODED),vt.firstRemoteFrame(this.store.sessionId,Wn.FIRST_AUDIO_DECODE,Ke.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:li.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var i;const s=Array.from(gr(i=this.remoteUserMap).call(i)).find(a=>a._audioSSRC===e);s&&vt.firstRemoteFrame(this.store.sessionId,Wn.FIRST_AUDIO_RECEIVED,Ke.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:li.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,i,s)=>{this.reportVideoFirstFrameDecoded(e,i,s)},t.onFirstVideoReceived=e=>{var i;const s=Array.from(gr(i=this.remoteUserMap).call(i)).find(a=>a._videoSSRC===e);s&&vt.firstRemoteFrame(this.store.sessionId,Wn.FIRST_VIDEO_RECEIVED,Ke.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:li.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,i)=>{const s=e.candidateType==="relay",a=i.candidateType==="relay";i.candidateType!=="unknown"&&s===a||this.emit(kt.ConnectionTypeChange,s),R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(ba(i))," -> ").concat(JSON.stringify(ba(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,i)=>{R.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(ba(i))," -> ").concat(JSON.stringify(ba(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.onLocalCandidate=e=>{this.emit(kt.LocalCandidate,e)}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const i=this.localTrackMap.get(Z.LocalAudioTrack);if(t instanceof Ie&&(i==null?void 0:i.track)instanceof vn)return i.track.isActive||e.push([Z.LocalAudioTrack,i]),e;const s=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:d}]=a;return t===d});if(s&&(e.push(s),s[0]===Z.LocalVideoTrack)){const a=this.localTrackMap.get(Z.LocalVideoLowTrack);a&&e.push([Z.LocalVideoLowTrack,a])}return e}filterTobeUnmutedTracks(t){const e=[],i=this.localTrackMap.get(Z.LocalAudioTrack);if(t instanceof Ie&&(i==null?void 0:i.track)instanceof vn)return i.track.isActive&&e.push([Z.LocalAudioTrack,i]),e;const s=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:d}]=a;return t===d});if(s)if(s[0]===Z.LocalVideoTrack){e.push(s);const a=this.localTrackMap.get(Z.LocalVideoLowTrack);a&&e.push([Z.LocalVideoLowTrack,a])}else e.push(s);return e}createMuteMessage(t){return t.map(e=>{var i;let s,[a,{track:d,ssrcs:u,id:h}]=e;switch(a){case Z.LocalAudioTrack:s=Ae.Audio;break;case Z.LocalVideoTrack:s=It(i=d._hints).call(i,Fe.SCREEN_TRACK)?Ae.Screen:Ae.High;break;case Z.LocalVideoLowTrack:s=Ae.Low}return{stream_type:s,ssrcs:u,mid:h}})}createUnmuteMessage(t){return t.map(e=>{var i;let s,[a,{track:d,ssrcs:u,id:h}]=e;switch(a){case Z.LocalAudioTrack:s=Ae.Audio;break;case Z.LocalVideoTrack:s=It(i=d._hints).call(i,Fe.SCREEN_TRACK)?Ae.Screen:Ae.High;break;case Z.LocalVideoLowTrack:s=Ae.Low}return{stream_type:s,ssrcs:u,mid:h}})}filterTobeUnSubscribedTracks(t,e){const i=[],s=this.remoteUserMap.get(t);if(!s)return i;if(e){const a=s.get(e);if(!a)return i;i.push([t,{kind:e,id:a}])}else Array.from(s.entries()).forEach(a=>{let[d,u]=a;i.push([t,{kind:d,id:u}])});return i}createUnsubscribeMessage(t){const e=[];return t.forEach(i=>{let[s,{kind:a,id:d}]=i;switch(a){case mt.VIDEO:return void(s._videoSSRC&&e.push({stream_type:mt.VIDEO,ssrcId:s._videoSSRC}));case mt.AUDIO:return void(s._audioSSRC&&e.push({stream_type:mt.AUDIO,ssrcId:s._audioSSRC}))}}),e}withdrawRemoteTracks(t){t.forEach(e=>{let[i,{kind:s}]=e;const a=this.remoteUserMap.get(i);a&&(a.delete(s),Array.from(a.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(Z.LocalVideoTrack),i=this.localTrackMap.get(Z.LocalVideoLowTrack);e&&await e.track.setBitrateLimit(t.uplink),i&&t.low_stream_uplink&&await i.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,e=this.recvConnection.peerConnectionState;return t!=="connected"&&e!=="connected"}return!0}async tryToUnmuteAudio(t){for(let e=0;e<t.length;e++)if(t[e]instanceof Ie){const i=this.filterTobeUnmutedTracks(t[e]);if(i.length===0)continue;const s=this.createUnmuteMessage(i);return void await ke(this,kt.RequestUnmuteLocal,s)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:e}]=t;return!!e}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.recvConnection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(kt.RequestUploadStats,t,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await si(Up(this.dtlsFailedCount,Rn)),this.emit(kt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Z.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof te)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof te).length>1)throw new J(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof Ie).length>1&&(t.some(e=>e instanceof Ie&&e._bypassWebAudio)||!xe().webAudioMediaStreamDest))throw new J(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof te&&this.pendingLocalTracks.some(i=>i instanceof te))throw new J(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof Ie&&this.pendingLocalTracks.some(i=>i instanceof Ie)&&(!xe().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Ie&&i._bypassWebAudio)))throw new J(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const i=!x("DISABLE_DUAL_STREAM_USE_ENCODING")&&xe().supportDualStreamEncoding,s=Pa(Pa({},{width:160,height:120,framerate:15,bitrate:50}),e);let a;a=i?t._mediaStreamTrack.clone():hT(t,s);const d=Le(8,"track-low-"),u=new te(a,Pa(Pa({},i&&{scaleResolutionDownBy:JS(s,t)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,d);return u.on(Wd.TRANSCEIVER_UPDATED,h=>{t._updateRtpTransceiver(h,Ea.LOW_STREAM)}),u._hints.push(Fe.LOW_STREAM),t.addListener(ft.NEED_CLOSE,()=>{u.close()}),u}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,e,i,s){var a;const d=Array.from(gr(a=this.remoteUserMap).call(a)).find(u=>u._videoSSRC===t);if(d){s||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const u=this.store.keyMetrics,h=u.subscribe.find(p=>p.userId===d.uid&&p.type==="video");vt.firstRemoteVideoDecode(this.store.sessionId,Wn.FIRST_VIDEO_DECODE,Ke.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:e,videoheight:i,subscribeElapse:li.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:u.requestAPEnd||0,apStart:u.requestAPStart||0,joinGwEnd:u.joinGatewayEnd||0,joinGwStart:u.joinGatewayStart||0,pcEnd:u.peerConnectionEnd||0,pcStart:u.peerConnectionStart||0,subscriberEnd:(h==null?void 0:h.subscribeEnd)||0,subscriberStart:(h==null?void 0:h.subscribeStart)||0,videoAddNotify:(h==null?void 0:h.streamAdded)||0,state:s?1:0})}}async remoteMediaSsrcChanged(t,e,i){if(!this.recvConnection)return!1;const s=this.remoteUserMap.get(t);if(!s)return!1;const a=s.get(e);if(!a)return!1;const d=await this.recvConnection.getRemoteSSRC(a);return d!==void 0&&d!==i}resetConnection(t){R.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(t)),this.state===Ee.Connected?(R.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}async publishDataChannel(t){throw new J(O.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new J(O.NOT_SUPPORTED)}async subscribeDataChannel(t,e){throw new J(O.NOT_SUPPORTED)}async unsubscribeDataChannel(t,e){throw new J(O.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,e){throw new J(O.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,e){throw new J(O.NOT_SUPPORTED)}async preConnect(t,e,i,s,a,d){throw new J(O.NOT_SUPPORTED)}getEstablishParams(){throw new J(O.NOT_SUPPORTED)}async reSubscribe(t){throw new J(O.NOT_SUPPORTED)}async updateVideoStreamParameter(t,e){throw new J(O.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:i}]=t;e===Z.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Ea.LOW_STREAM):i._updateRtpTransceiver(void 0)})}}function Qr(n){return function(t,e,i){const s=t[e];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var a=arguments.length,d=new Array(a),u=0;u<a;u++)d[u]=arguments[u];switch(n){case Xr.SEND_ONLY:{const h=await this.sendMutex.lock("From P2PChannel2.".concat(e));try{return await s.apply(this,d)}finally{h()}}case Xr.RECEIVE_ONLY:{const h=await this.recvMutex.lock("From P2PChannel2.".concat(e));try{return await s.apply(this,d)}finally{h()}}default:{const h=await this.sendMutex.lock("From P2PChannel2.".concat(e)),p=await this.recvMutex.lock("From P2PChannel2.".concat(e));try{return await s.apply(this,d)}finally{h(),p()}}}},i}}function zN(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function JN(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?zN(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):zN(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}X([Qr(),C("design:type",Function),C("design:paramtypes",[Object,String]),C("design:returntype",W)],rn.prototype,"startP2P",null),X([Qr(),C("design:type",Function),C("design:paramtypes",[String]),C("design:returntype",W)],rn.prototype,"p2pConnect",null),X([Qr(Xr.SEND_ONLY),C("design:type",Function),C("design:paramtypes",[String]),C("design:returntype",W)],rn.prototype,"dopublish",null),X([Qr(Xr.SEND_ONLY),C("design:type",Function),C("design:paramtypes",[Array]),C("design:returntype",W)],rn.prototype,"unpublish",null),X([Qr(),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",W)],rn.prototype,"unpublishLowStream",null),X([Qr(Xr.SEND_ONLY),C("design:type",Function),C("design:paramtypes",[String]),C("design:returntype",W)],rn.prototype,"doUnpublish",null),X([Qr(Xr.RECEIVE_ONLY),C("design:type",Function),C("design:paramtypes",[ui,String,String,Number]),C("design:returntype",W)],rn.prototype,"subscribe",null),X([Qr(Xr.RECEIVE_ONLY),C("design:type",Function),C("design:paramtypes",[ui,String,String,Boolean]),C("design:returntype",W)],rn.prototype,"unsubscribe",null),X([Qr(Xr.RECEIVE_ONLY),C("design:type",Function),C("design:paramtypes",[ui,String]),C("design:returntype",W)],rn.prototype,"muteRemote",null),X([Qr(Xr.RECEIVE_ONLY),C("design:type",Function),C("design:paramtypes",[ui,String]),C("design:returntype",W)],rn.prototype,"unmuteRemote",null),X([Qr(Xr.RECEIVE_ONLY),C("design:type",Function),C("design:paramtypes",[ui,String]),C("design:returntype",W)],rn.prototype,"hasRemoteMediaWithLock",null),X([Qr(),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",W)],rn.prototype,"disconnectForReconnect",null),X([Qr(Xr.RECEIVE_ONLY),C("design:type",Function),C("design:paramtypes",[ui,String,Number]),C("design:returntype",W)],rn.prototype,"remoteMediaSsrcChanged",null);const M5=Date.now(),U5=20,vT=new Map,qf=new Map;async function XN(n){const t=vT.get(n),e=Array.isArray(t)&&t[t.length-1],i=qf.get(n);if(!e)return void(i.isSyncing=!1);const s={uid:e.uid,payload:Pp(e.payload)};i.firstRecvTs===0&&(i.firstRecvTs=e.recvTs,i.firstSendTs=e.sendTs);const a=e.sendTs-i.firstSendTs,d=a-(Date.now()-i.firstRecvTs);d>0&&(i.firstRecvTs=Date.now()-a);let u=e.mediaDelay+d;u<=0?(t.pop(),QN(e.context,s),u=0):u=Math.min(u,U5),setTimeout(()=>t.length&&XN(n),u)}function QN(n,t){n.safeEmit(de.STREAM_MESSAGE,t.uid,t.payload),n.onStreamMessage&&n.onStreamMessage(t)}function x5(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;if(!n.syncWithAudio)return QN(e,{uid:n.uid,payload:Pp(n.payload)});const i="".concat(e.id,"-").concat(n.uid),s=vT.get(i)||[],a=s.findIndex(p=>n.sendTs>=p.sendTs),d=JN(JN({},n),{},{context:e,mediaDelay:t,recvTs:Date.now()});a===-1?s.push(d):s.splice(a,0,d),vT.set(i,s);let u=!1;var h;qf.has(i)?u=!((h=qf.get(i))===null||h===void 0||!h.isSyncing):qf.set(i,{isSyncing:u,firstRecvTs:0,firstSendTs:0}),u||XN(i)}const V5=Se().name;function F5(){return!function(n,t,e){const i=Se();if(i.os!==Fn.IOS||!i.osVersion)return!1;const s=i.osVersion.split(".");return e?t&&Number(s[0])===n&&Number(s[1])<t||Number(s[0])<n:t?Number(s[0])===n&&Number(s[1])<=t||Number(s[0])<n:Number(s[0])<=n}(16,0,!0)&&!function(n,t,e){const i=Se();if(i.name!==Ce.SAFARI||!i.osVersion)return!1;const s=i.version.split(".");return e?t&&Number(s[0])===n&&Number(s[1])<t||Number(s[0])<n:t?Number(s[0])===n&&Number(s[1])<=t||Number(s[0])<n:Number(s[0])<=n}(16,0,!0)}function $N(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function Yu(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?$N(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):$N(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}zn.setLogger(R);class Me extends Ye{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t){let e;if(super(),g(this,"store",void 0),g(this,"_uid",void 0),g(this,"_channelName",void 0),g(this,"_uintUid",void 0),g(this,"_users",[]),g(this,"_config",void 0),g(this,"_clientId",void 0),g(this,"_appId",void 0),g(this,"_sessionId",null),g(this,"_key",void 0),g(this,"_joinInfo",void 0),g(this,"_gateway",void 0),g(this,"_statsCollector",void 0),g(this,"_configDistribute",void 0),g(this,"_leaveMutex",new zn("client-leave")),g(this,"_publishMutex",new zn("client-publish")),g(this,"_renewTokenMutex",new zn("client-renewtoken")),g(this,"_subscribeMutex",new zn("client-subscribe")),g(this,"_encryptionMode","none"),g(this,"_encryptionSecret",null),g(this,"_encryptionSalt",null),g(this,"_proxyServer",void 0),g(this,"_turnServer",{servers:[],mode:"auto"}),g(this,"_cloudProxyServerMode","disabled"),g(this,"_isDualStreamEnabled",!1),g(this,"_defaultStreamFallbackType",void 0),g(this,"_lowStreamParameter",void 0),g(this,"_streamFallbackTypeCacheMap",new Map),g(this,"_remoteStreamTypeCacheMap",new Map),g(this,"_axiosCancelSource",qi.CancelToken.source()),g(this,"_audioVolumeIndicationInterval",void 0),g(this,"_networkQualityInterval",void 0),g(this,"_userOfflineTimeout",void 0),g(this,"_streamRemovedTimeout",void 0),g(this,"_injectStreamingClient",void 0),g(this,"_liveTranscodeStreamingClient",void 0),g(this,"_liveRawStreamingClient",void 0),g(this,"_channelMediaRelayClient",void 0),g(this,"_networkQualitySensitivity","normal"),g(this,"_p2pChannel",void 0),g(this,"_useLocalAccessPoint",!1),g(this,"_setLocalAPVersion",void 0),g(this,"_joinAndNotLeaveYet",!1),g(this,"_numberOfJoinCount",0),g(this,"_remoteDefaultVideoStreamType",void 0),g(this,"_inspect",void 0),g(this,"_moderation",void 0),g(this,"_license",void 0),g(this,"_pendingPublishedUsers",[]),g(this,"ntpAlignErrorCount",0),g(this,"remoteInboundOffset",0),g(this,"_handleLocalTrackEnable",(i,s,a)=>{this.publish(i,!1).then(s).catch(a)}),g(this,"_handleLocalTrackDisable",(i,s,a)=>{this.unpublish(i).then(s).catch(a)}),g(this,"_handleUserOnline",i=>{if(x("BLOCK_LOCAL_CLIENT")&&Cc(i.uid,this.channelName))return void R.debug("[".concat(i.uid,"] will be ignored in local"));this.isStringUID&&typeof i.uid!="string"&&R.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const s=this._users.find(a=>a.uid===i.uid);if(s)s._trust_in_room_=!0;else{const a=new ui(i.uid,i.uint_id||i.uid);this._users.push(a),R.debug("[".concat(this._clientId,"] user online"),i.uid),this.safeEmit(de.USER_JOINED,a)}}),g(this,"_handleUserOffline",i=>{if(x("BLOCK_LOCAL_CLIENT")&&Cc(i.uid,this.channelName))return;const s=this._users.find(a=>a.uid===i.uid);s&&(this._handleRemoveStream(i),this._handleRemoveDataChannels(i),bg(this._users,s),this._remoteStreamTypeCacheMap.delete(s.uid),this._streamFallbackTypeCacheMap.delete(s.uid),R.debug("[".concat(this._clientId,"] user offline"),i.uid,"reason:",i.reason),this.safeEmit(de.USER_LEAVED,s,i.reason))}),g(this,"_handleAddAudioOrVideoStream",(i,s,a,d,u,h,p)=>{if(x("BLOCK_LOCAL_CLIENT")&&Cc(s,this.channelName))return;const _=this._users.find(S=>S.uid===s);if(!_)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(i)),this.store.subscribe(_.uid,i,void 0,void 0,void 0,Date.now());const m=i==="audio"?_.hasAudio:_.hasVideo;_._uintid||(_._uintid=u||s),i==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,i==="audio"?(_._audio_added_=!0,a!==void 0&&(_._audioSSRC=a),d!==void 0&&(_._cname=d),h&&(_._audioOrtc=h)):(_._video_added_=!0,a!==void 0&&(_._videoSSRC=a),d!==void 0&&(_._cname=d),p!==void 0&&(_._rtxSsrcId=p),h&&(_._videoOrtc=h)),(i==="audio"?_.hasAudio:_.hasVideo)&&!m&&(R.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(i)),this.safeEmit(de.USER_PUBLISHED,_,i)),i==="video"?vt.onGatewayStream(this._sessionId,Wn.ON_ADD_VIDEO_STREAM,Ke.ON_ADD_VIDEO_STREAM,{peer:u||s,ssrc:_._videoSSRC}):vt.onGatewayStream(this._sessionId,Wn.ON_ADD_AUDIO_STREAM,Ke.ON_ADD_AUDIO_STREAM,{peer:u||s,ssrc:_._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(_,i,a).then(S=>{if(S&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(_.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Zn))return this._p2pChannel.unsubscribe(_,i,!0).then(()=>this._subscribe(_,i,!0).catch(y=>{R.error("[".concat(this._clientId,"] resubscribe error"),y.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(_,i)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,i,!0).catch(S=>{R.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),g(this,"_handleRemoveStream",(i,s,a)=>{if(x("BLOCK_LOCAL_CLIENT")&&Cc(i.uid,this.channelName))return;const d=this._users.find(h=>h.uid===i.uid);if(!d)return void R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));R.debug("[".concat(this._clientId,"] stream removed with uid ").concat(i.uid));let u=()=>{};if(d.hasAudio&&d.hasVideo?u=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(de.USER_UNPUBLISHED,d,"audio"),R.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(de.USER_UNPUBLISHED,d,"video")}:d.hasVideo?u=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(de.USER_UNPUBLISHED,d,"video")}:d.hasAudio&&(u=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(de.USER_UNPUBLISHED,d,"audio")}),d._trust_audio_stream_added_state_=!0,d._trust_video_stream_added_state_=!0,d._audio_added_=!1,d._video_added_=!1,this._p2pChannel instanceof Zn)this._p2pChannel.unsubscribe(d).then(h=>{if(h)return this._gateway.unsubscribe(h,d.uid)});else if(s&&a)if(i.sdp){const{sdp:h}=i;this._p2pChannel.unsubscribe(d,h).then(p=>{p&&s(p)}).catch(a)}else s&&s();d._audioSSRC=void 0,d._videoSSRC=void 0,d._audioOrtc=void 0,d._videoOrtc=void 0,d._rtxSsrcId=void 0,vt.onGatewayStream(this._sessionId,Wn.ON_REMOVE_STREAM,Ke.ON_REMOVE_STREAM,{peer:i.uint_id||i.uid}),u()}),g(this,"_handleSetStreamLocalEnable",(i,s,a)=>{if(x("BLOCK_LOCAL_CLIENT")&&Cc(s,this.channelName))return;const d=this._users.find(p=>p.uid===s);if(!d)return void R.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));R.debug("[".concat(this._clientId,"] local ").concat(i," ").concat(a?"enabled":"disabled"," with uid ").concat(s));const u=i==="audio"?d.hasAudio:d.hasVideo;if(i==="audio"){d._trust_audio_enabled_state_=!0;const p=d._audio_enabled_;if(d._audio_enabled_=a,d._audio_enabled_===p)return;{const _=d._audio_enabled_?"enable-local-audio":"disable-local-audio";R.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(s,", msg: ").concat(_)),this.safeEmit(de.USER_INFO_UPDATED,s,_)}}else{d._trust_video_enabled_state_=!0;const p=d._video_enabled_;if(d._video_enabled_=a,d._video_enabled_===p)return;{const _=d._video_enabled_?"enable-local-video":"disable-local-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(_)),this.safeEmit(de.USER_INFO_UPDATED,s,_)}}const h=i==="audio"?d.hasAudio:d.hasVideo;return u!==h?!u&&h?(R.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(i)),void this.safeEmit(de.USER_PUBLISHED,d,i)):(i==="video"&&d._videoTrack&&d._videoTrack._destroy(),i==="audio"&&d._audioTrack,this._p2pChannel.muteRemote(d,i),R.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(i)),void this.safeEmit(de.USER_UNPUBLISHED,d,i)):void 0}),g(this,"_handleMuteStream",(i,s,a,d,u,h)=>{if(x("BLOCK_LOCAL_CLIENT")&&Cc(i,this.channelName))return;R.debug("[".concat(this._clientId,"] receive mute message"),i,s,a);const p=this._users.find(S=>S.uid===i);if(!p)return void R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i));const _=s==="audio"?p.hasAudio:p.hasVideo;if(s==="audio"){p._trust_audio_mute_state_=!0;const S=p._audio_muted_;if(p._audio_muted_=a,p._audio_muted_===S)return;{const y=p._audio_muted_?"mute-audio":"unmute-audio";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(y)),this.safeEmit(de.USER_INFO_UPDATED,i,y)}}else{p._trust_video_mute_state_=!0;const S=p._video_muted_;if(p._video_muted_=a,p._video_muted_===S)return;{const y=p._video_muted_?"mute-video":"unmute-video";R.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(y)),this.safeEmit(de.USER_INFO_UPDATED,i,y)}}const m=s==="audio"?p.hasAudio:p.hasVideo;if(_!==m){if(!_&&m)return!this.store.useP2P&&!(s==="audio"?p._audioSSRC:p._videoSSRC)?void R.warning("[".concat(this._clientId,"] remote user ").concat(i," receive ").concat(s," unmute message  before add stream message, ").concat(s," SSRC doesn't exist yet.")):(R.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(s)),void this.safeEmit(de.USER_PUBLISHED,p,s));s==="video"&&p._videoTrack&&p._videoTrack._destroy(),s==="audio"&&p._audioTrack,u&&h&&this._p2pChannel instanceof rn&&(d?this._p2pChannel.unsubscribe(p,d,s).then(S=>{u(S)}).catch(h):u()),this._p2pChannel.muteRemote(p,s),R.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(s)),this.safeEmit(de.USER_UNPUBLISHED,p,s)}}),g(this,"_handleP2PLost",async i=>{R.debug("[".concat(this._clientId,"] receive p2p lost"),i),parseInt(i.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():R.warning("[".concat(this._clientId,"] P2PLost stream not found"),i)}),g(this,"_handleTokenWillExpire",()=>{R.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(de.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),g(this,"_handleBeforeUnload",i=>{i.type==="beforeunload"&&i.returnValue!==void 0&&i.returnValue!==""||(this.leave(),R.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),g(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(de.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const i={downlinkNetworkQuality:0,uplinkNetworkQuality:0};i.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),i.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(de.NETWORK_QUALITY,i)}),g(this,"_handleP2PAddAudioOrVideoStream",(i,s)=>{const a=this._users.find(u=>u.uid===s);if(!a)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));R.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(i)),this.store.subscribe(a.uid,i,void 0,void 0,void 0,Date.now());const d=i==="audio"?a.hasAudio:a.hasVideo;i==="audio"?a._trust_audio_stream_added_state_=!0:a._trust_video_stream_added_state_=!0,i==="audio"?a._audio_added_=!0:a._video_added_=!0,(i==="audio"?a.hasAudio:a.hasVideo)&&!d&&(R.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published ").concat(i)),this.safeEmit(de.USER_PUBLISHED,a,i)),this._p2pChannel.hasPendingRemoteMedia(a,i)&&(R.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(a.uid," after reconnect.")),this._subscribe(a,i,!0).catch(u=>{R.error("[".concat(this._clientId,"] resubscribe error"),u.toString())}))}),this._config=t,this._clientId=Le(5,"client-"),this.store=new H3(t.codec,t.audioCodec,t.mode,this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),R.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(jr," build: ").concat(Xg,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{Ew(t.clientRoleOptions),e=Object.assign({},t.clientRoleOptions)}catch(i){R.warning("[".concat(this._clientId,"] ").concat(i.toString()))}this._statsCollector=new $d(this.store),this._statsCollector.onStatsException=(i,s,a)=>{R.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(i,", msg: ").concat(s,", uid: ").concat(a)),this.safeEmit(de.EXCEPTION,{code:i,msg:s,uid:a})},this._statsCollector.onUploadPublishDuration=(i,s,a,d)=>{const u=this._users.find(h=>h.uid===i);u&&vt.peerPublishStatus(this._sessionId,{subscribeElapse:d,audioPublishDuration:s,videoPublishDuration:a,peer:u._uintid})},this.store.useDataChannel=xe().supportDataChannel&&x("SIGNAL_CHANNEL"),this.store.useP2P=x("P2P"),this._gateway=new q4(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||Rn,httpRetryConfig:t.httpRetryConfig||Rn,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:e}),this._configDistribute=new n5,this.store.useP2P?(this._p2pChannel=new rn(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new Zn(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,e,i,s,a){let d=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],u=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Ne("JOIN_GATEWAY_USE_443PORT_ONLY",d),Ne("JOIN_GATEWAY_USE_DUAL_DOMAIN",u);const h=this._gateway.signal.websocket;return h instanceof gu&&(h.use443PortOnly=d,h.tryDoubleDomain=u),async function(p,_,m){bp.get(p)||bp.set(p,[]),wp.get(p)||wp.set(p,_),zs.get(p)||zs.set(p,0);const S=bp.get(p),y=wp.get(p);if(!S||!y)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(zs.get(p)===y){const U=lu();S.push(U),await U.promise}zs.set(p,zs.get(p)+1);for(var b=arguments.length,I=new Array(b>3?b-3:0),A=3;A<b;A++)I[A-3]=arguments[A];const L=await m(...I);return zs.set(p,zs.get(p)-1),zs.get(p)===y-1&&S.length>0&&(S[0].resolve(),S.shift()),zs.get(p)===0&&(bp.set(p,[]),wp.set(p,0),zs.set(p,0)),L}("client.join",x("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,e,i,s,a)}async join(t,e,i,s,a){const d=++this._numberOfJoinCount;this.store.joinStart(),s&&(this.store.uid=s);const u=G3(),h=yA()?window.isSecureContext:"Browser Not Support";if(!yA()&&!u||!window.isSecureContext){const I="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";R.warning(I)}const p=wg();this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),R.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart)));const _=vt.reportApiInvoke(p,{name:An.JOIN,options:[t,e,i,s],states:{isHttps:u,isSecureContext:h},tag:Je.TRACER});vt.setAppId(t);try{if(!i&&i!==null)throw new B(O.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&ai(i,"token",1,2047),ai(t,"appid",1,2047),tS(e),s&&eS(s),a&&ai(a,"optionalInfo",1,2047)}catch(I){throw _.onError(I),I}if(R.info("[".concat(this._clientId,"] start join channel ").concat(e,", join number: ").concat(d)),this._leaveMutex.isLocked&&(R.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),R.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const I=new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw _.onError(I),I}this._sessionId||(this._sessionId=p,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const m=Yu({clientId:this._clientId,appId:t,sid:this._sessionId,cname:e,uid:typeof s!="string"?s:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:a,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(m.setLocalAPVersion=this._setLocalAPVersion),typeof s=="string"&&(m.stringUid=s,this._uintUid?(m.uid=this._uintUid,this._uintUid=void 0):m.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(m.aesmode=this._encryptionMode,m.aespassword=await QG(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(m.aessalt=this._encryptionSalt)}this._startSession(this._sessionId,{channel:e,appId:t});const S=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&S===this._sessionId&&vt.joinChannelTimeout(this._sessionId,5)},5e3);try{var y;let I;const A=m.cloudProxyServer;if(It(y=["proxy3","proxy4","proxy5"]).call(y,A)){const $=x("PROXY_SERVER_TYPE3");Array.isArray($)?m.proxyServer=$[0]:m.proxyServer=$}if(vt.setProxyServer(m.proxyServer),R.setProxyServer(m.proxyServer),this.store.requestAPStart(),m.stringUid&&!m.uid){const $=await x0(m.stringUid,m,this._axiosCancelSource.token,this._config.httpRetryConfig||Rn,this.store);R.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(m.stringUid," => ").concat($)),m.uid=$,I=await U0(m,this._axiosCancelSource.token,this._config.httpRetryConfig||Rn,!0,this.store)}else I=await U0(m,this._axiosCancelSource.token,this._config.httpRetryConfig||Rn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(m,this._axiosCancelSource.token),this._configDistribute.on(Eu.UPDATE_BITRATE_LIMIT,$=>{this._p2pChannel.updateBitrateLimit($)})},0),this._key=i||t;const L=I.gatewayInfo;this._joinInfo=Yu(Yu({},m),{},{cid:L.cid,uid:m.uid?m.uid:L.uid,vid:L.vid,apResponse:L.res,uni_lbs_ip:L.uni_lbs_ip,gatewayAddrs:L.gatewayAddrs});const U=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));_.onSuccess(U),this._appId=t,this._channelName=m.cname,this._uid=U,this.store.uid=U,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(bi()?"beforeunload":"pagehide",this._handleBeforeUnload)},0);const F=m.stringUid?"string uid: ".concat(m.stringUid,",uid: ").concat(m.uid):"uid: ".concat(this._uid);return R.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(e,",").concat(F)),setTimeout(()=>{R.startUpload()},5e3),this.store.joinEnd(),b=this,It(pa).call(pa,b)||pa.push(b),U}catch(I){const A=Array.isArray(I)?I[0]:I;throw A&&A.code===O.OPERATION_ABORTED?R.warning("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),A):R.error("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),A),A.code!==O.OPERATION_ABORTED&&this._numberOfJoinCount===d&&(this._gateway.state="DISCONNECTED",this._reset()),_.onError(A),A}var b}_joinGateway(){if(!this._joinInfo||!this._key)throw new B(O.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!x("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(t=>t).catch(t=>{if(t.code===O.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,oe.FALLBACK),t;if(t.code===O.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,oe.FALLBACK),t;throw t}).then(t=>{if(t instanceof B){if(t.code===O.INIT_WEBSOCKET_TIMEOUT){if(R.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new B(O.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const e=x("PROXY_SERVER_TYPE3");if(Array.isArray(e))if(this._joinInfo.apUrl){const s=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),a=s.slice(s.length-2).join(".");e.forEach(d=>{this._joinInfo&&It(d).call(d,a)&&(this._joinInfo.proxyServer=d)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=e[0])}else this._joinInfo.proxyServer=e[0];else this._joinInfo.proxyServer=e;const i=x("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return i&&i[1]&&i[1]!=="443"&&R.setProxyServer(this._joinInfo.proxyServer),x("STATS_COLLECTOR_PORT").toString()!=="443"&&vt.setProxyServer(this._joinInfo.proxyServer),vt.reportApiInvoke(this._sessionId,{name:An.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:Je.TRACER}).onSuccess(),this.safeEmit(de.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),x("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(s=>{"forceturn"in s&&(s.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(R.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new B(O.INVALID_OPERATION);return vt.reportApiInvoke(this._sessionId,{name:An.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:Je.TRACER}).onSuccess(),this._joinGateway()}return t}).then(t=>t)}async leave(){R.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(bi()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const i=pa.indexOf(e);i!==-1&&pa.splice(i,1)}(this);const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return R.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED"),R.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof di))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new B(O.INVALID_PARAMS,"param list is empty");const i=t;if(this._gateway.role==="audience")throw new B(O.INVALID_OPERATION,"audience can not publish stream");for(const a of i){if(!(a instanceof di))throw new B(O.INVALID_PARAMS,"parameter is not local track");if(!a._enabled&&e)throw new B(O.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(a.getTrackId()))}R.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(a=>"".concat(a.getTrackId()," "))));const s=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),e&&i.forEach(a=>{const d=this._configDistribute.getBitrateLimit();a instanceof te&&d&&a.setBitrateLimit(d.uplink)});try{await this._publishHighStream(i),R.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(a=>"".concat(a.getTrackId()," "))))}catch(a){throw R.error("[".concat(this._clientId,"] publish error"),a.toString()),a}finally{s()}}async _publishDataChannel(t){Pe(t.id,"id",0,65535,!0),gc(t.ordered,"ordered"),ai(t.metadata,"metadata",0,512),R.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const e=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(s=>s.id===t.id)!==-1)throw new B(O.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new B(O.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&x("FORCE_TURN")&&!x("TURN_ENABLE_TCP")&&!x("TURN_ENABLE_UDP"))throw new B(O.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const i=new E0(t);await this._p2pChannel.publishDataChannel([i]);try{const s={streamId:t.id,ordered:t.ordered,maxRetransmits:x("DATASTREAM_MAX_RETRANSMITS"),metadata:t.metadata,channelId:i._originDataChannelId};await this._gateway.publishDataChannel(this._uid,s,!0)}catch(s){if(s.code!==O.DISCONNECT_P2P)throw s}return await i._waitTillOpen(),R.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw R.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{e()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new B(O.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let e=[];if(t)if(Array.isArray(t))e=t;else{if(!(t instanceof di))return this._unpublishDataChannel([t]);e=[t]}else this.store.useP2P||await this._unpublishDataChannel(),e=this._p2pChannel.getAllTracks(!0);R.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(s=>"".concat(s.getTrackId()," "))," "));const i=await this._publishMutex.lock();try{if(this._p2pChannel instanceof rn){const s=await this._p2pChannel.unpublish(e);if(s){const a=await this._gateway.sendExtensionMessage(Ve.UNPUBLISH,s);a&&await this._p2pChannel.setDescription("local",a)}}else{const s=await this._p2pChannel.unpublish(e);s&&await this._gateway.unpublish(s,this._uid),R.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(a=>"".concat(a.getTrackId()))))}}catch(s){throw R.error("[".concat(this._clientId,"] unpublish error"),s.toString()),s}finally{i&&i()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),R.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(i=>"".concat(i.id," "))," "));const e=await this._publishMutex.lock();try{const i=await this._p2pChannel.unpublishDataChannel(t);i&&await this._gateway.unpublishDataChannel(i),R.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(s=>"".concat(s.id))))}catch(i){throw R.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{e&&e()}}async subscribe(t,e,i){return e==="datachannel"?this._subscribeDataChannel(t,i):this._subscribe(t,e)}async _subscribeDataChannel(t,e){var i;if(Pe(e,"channelId",0,65535,!0),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===t))throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new B(O.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new B(O.INVALID_REMOTE_USER,"user is not published");const s=(i=t._dataChannels)===null||i===void 0?void 0:i.find(u=>u.id===e);if(!s)throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new B(O.REMOTE_USER_IS_NOT_PUBLISHED);const a=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const u=await this._p2pChannel.subscribeDataChannel(t,[s]);if(u&&It(u).call(u,s.id))try{var d;if(!s._originDataChannelId)throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new B(O.REMOTE_USER_IS_NOT_PUBLISHED);const h={id:s.id,datachannelId:s._originDataChannelId,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:(d=s.metadata)!==null&&d!==void 0?d:""};await this._gateway.subscribeDataChannel(t.uid,h,!0)}catch(h){if((h==null?void 0:h.code)!==O.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[s]),h;await this._p2pChannel.unsubscribeDataChannel(t,[s]),this._p2pChannel.setPendingRemoteDataChannel(t,s.id)}return await s._waitTillOpen(),R.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),s}finally{a()}}async _p2pSubscribe(t,e,i){if(Bn(e,"mediaType",["audio","video"]),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(d=>d===t)){const d=new B(O.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),d}if(!t.hasAudio&&!t.hasVideo){const d=new B(O.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),d}if(!i&&(e==="audio"&&!t.hasAudio||e==="video"&&!t.hasVideo)){const d=new B(O.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),d}const s=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));const a=e==="audio"?Z.LocalAudioTrack:this._joinInfo.defaultVideoStream===ef.LOW_STREAM?Z.LocalVideoLowTrack:Z.LocalVideoTrack;try{await this._p2pChannel.hasRemoteMediaWithLock(t,e)?await this._p2pChannel.unmuteRemote(t,e):(this.store.subscribe(t.uid,e,Date.now()),this._p2pChannel instanceof rn&&await this._gateway.sendExtensionMessage(Ve.SUBSCRIBE,{trackType:a})),R.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(u=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),u)});const d=e==="audio"?t._audioTrack:t._videoTrack;if(!d)throw new B(O.UNEXPECTED_ERROR,"can not find remote track in user object");return d}catch(d){throw R.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),d),d}finally{s()}}async _subscribe(t,e,i){if(this._p2pChannel instanceof rn)return this._p2pSubscribe(t,e);if(Bn(e,"mediaType",["audio","video"]),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(p=>p===t)){const p=new B(O.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),p}if(!t.hasAudio&&!t.hasVideo){const p=new B(O.INVALID_REMOTE_USER,"user is not published");throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),p}if(!(i||(e!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(e!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const p=new B(O.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),p}let s=e==="audio"?t._audioSSRC:t._videoSSRC,a=e==="audio"?t._audioOrtc:t._videoOrtc,d=e==="video"?t._rtxSsrcId:void 0,u={stream_type:e==="audio"?mt.AUDIO:mt.VIDEO,ssrcId:s};const h=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const _=e==="audio"?t._audioSSRC:t._videoSSRC;_!==void 0&&_!==s&&(s=_,a=e==="audio"?t._audioOrtc:t._videoOrtc,d=e==="video"?t._rtxSsrcId:void 0,u={stream_type:e==="audio"?mt.AUDIO:mt.VIDEO,ssrcId:s}),li.markSubscribeStart(this.store.clientId,s),this.store.subscribe(t.uid,e,Date.now()),await this._p2pChannel.subscribe(t,e,s,d,a);try{await this._gateway.subscribe(t.uid,u,!0)}catch(m){if((m==null?void 0:m.code)!==O.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,e),m;await this._p2pChannel.unsubscribe(t,e,!0),this._p2pChannel.setPendingRemoteMedia(t,e)}this.store.subscribe(t.uid,e,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,e)}catch(_){throw this._p2pChannel.reportSubscribeEvent(!1,_==null?void 0:_.code,t,e),_}R.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(_=>{R.warning("[".concat(this._clientId,"] auto set fallback failed"),_)});const p=e==="audio"?t._audioTrack:t._videoTrack;if(!p)throw new B(O.UNEXPECTED_ERROR,"can not find remote track in user object");return p}catch(p){throw R.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),p),p}finally{h()}}async massSubscribe(t){if(Oo(t,"subscribeList"),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const e=Date.now(),i=new Map,s=await this._subscribeMutex.lock();R.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(h=>{let{user:p,mediaType:_}=h;return"user: ".concat(p==null?void 0:p.uid,", mediaType: ").concat(_)}).join("; ")));const a=(t=[...t]).map(h=>{let{user:p,mediaType:_}=h;return{user:p,mediaType:_}}),d=await this._p2pChannel.globalLock();try{var u;for(let p=t.length-1;p>=0;p--){const _=t[p],{user:m,mediaType:S}=_;if(Bn(S,"mediaType",["audio","video"]),!m){const I=new B(O.INVALID_PARAMS,"user property does not exist in subscribeList item");throw R.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),I}if(!this._users.find(I=>I===m)){const I=new B(O.INVALID_REMOTE_USER,"user is not in the channel");R.error("[".concat(this._clientId,"] can not massSubscribe ").concat(m.uid,", this user is not in the channel")),a[p].error=I,t.splice(p,1);continue}if(S==="audio"&&(!m.hasAudio||m._audioSSRC===void 0)||S==="video"&&(!m.hasVideo||m._videoSSRC===void 0)){const I=new B(O.REMOTE_USER_IS_NOT_PUBLISHED);R.error("[".concat(this._clientId,"] can not subscribe ").concat(m.uid," with mediaType ").concat(S,", remote user is not published")),a[p].error=I,t.splice(p,1);continue}const y=On.Video|On.LwoVideo,b=i.get(m);if(b){if(S==="video"?b&y:b&On.Audio){t.splice(p,1),R.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(m.uid,", mediaType:").concat(S," twice"));continue}i.set(m,b|(S==="video"?y:On.Audio))}else i.set(m,S==="video"?y:On.Audio)}for(let p=t.length-1;p>=0;p--){const _=t[p],{user:m,mediaType:S}=_,y=On.Video|On.LwoVideo;if(this._p2pChannel.hasRemoteMedia(m,S)){await this._p2pChannel.unmuteRemoteNoLock(m,S);const b=i.get(m);i.set(m,S==="video"?b^y:b^On.Audio),t.splice(p,1)}}this.store.massSubscribe(t.map(p=>({userId:p.user.uid,type:p.mediaType})),e);const h=yc(u=Array.from(i.entries())).call(u,(p,_)=>{let[m,S]=_;if(S===0)return p;const y={stream_id:m.uid,stream_type:S};return S&On.Audio&&(y.audio_ssrc=m._audioSSRC),S&On.Video&&(y.video_ssrc=m._videoSSRC),p.push(y),p},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(_=>{let{user:m,mediaType:S}=_;return{user:m,mediaType:S,ssrcId:S===mt.VIDEO?m._videoSSRC:m._audioSSRC,rtxSsrcId:S===mt.VIDEO?m._rtxSsrcId:void 0}}));const p=new Map;if(h.length>0){const _=await this._gateway.subscribeAll(h,!0);((_==null?void 0:_.users)||[]).forEach(m=>{let{stream_id:S,video_error_code:y,audio_error_code:b,error_code:I}=m;(y||b||I)&&p.set(S,{video_error_code:y,audio_error_code:b,error_code:I})})}if(Array.from(p.entries()).length>0){const _=Array.from(p.entries()).map(m=>{let S,[y,b]=m;return b.error_code||b.video_error_code&&b.audio_error_code?S=void 0:b.video_error_code?S=mt.VIDEO:b.audio_error_code&&(S=mt.AUDIO),{user:this.remoteUsers.find(I=>I.uid===y),mediaType:S}});await this._p2pChannel.massUnsubscribeNoLock(_)}for(const _ of a){const m=p.get(_.user.uid);if(m){const S=m.error_code||_.mediaType==="audio"&&m.audio_error_code||_.mediaType==="video"&&m.video_error_code;if(S){const y=bc(S);R.error("user:".concat(_.user.uid," mediaType:").concat(_.mediaType," has massSubscribe error ").concat(y.desc)),_.error=new B(O.SUBSCRIBE_FAILED,"code ".concat(S,": ").concat(y.desc))}}_.error||(_.mediaType==="video"?_.track=_.user.videoTrack:_.track=_.user.audioTrack)}return this.store.massSubscribe(a.filter(_=>!_.error).map(_=>({userId:_.user.uid,type:_.mediaType})),void 0,Date.now()),a.forEach(_=>{var m;vt.subscribe(this.store.sessionId,{succ:!!_.error,ec:((m=_.error)===null||m===void 0?void 0:m.code)||null,video:_.mediaType===mt.VIDEO,audio:_.mediaType===mt.AUDIO,peerid:_.user.uid,subscribeRequestid:_.mediaType===mt.VIDEO?_.user._videoSSRC:_.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-e)},!0)}),R.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(_=>{let{user:m,mediaType:S}=_;return"user: ".concat(m==null?void 0:m.uid,", mediaType: ").concat(S)}).join("; "))),a}catch(p){throw await this._p2pChannel.massUnsubscribeNoLock(t),p}}finally{d(),s()}}async unsubscribe(t,e,i){if(e||this.store.useP2P){if(e==="datachannel")return this._unsubscribeDataChannel(t,i)}else await this._unsubscribeDataChannel(t,i);if(e&&Bn(e,"mediaType",["audio","video"]),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(a=>a===t)){const a=new B(O.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),a}R.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(e));const s=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof rn)await this._gateway.sendExtensionMessage(Ve.UNSUBSCRIBE,{mediaType:e});else{const a=await this._p2pChannel.unsubscribe(t,e);a&&await this._gateway.unsubscribe(a,t.uid),R.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(e))}}catch(a){if(a.code===O.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),a.toString()),a}finally{s()}}async _unsubscribeDataChannel(t,e){if(e&&Pe(e,"id",0,65535,!0),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(s=>s===t)){const s=new B(O.INVALID_REMOTE_USER,"user is not in the channel");throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),s}let i;if(typeof e=="number"){const s=t._dataChannels.find(a=>a.id===e);s&&(i=[s])}else i=t._dataChannels;if(i===void 0){const s=new B(O.REMOTE_USER_IS_NOT_PUBLISHED);throw R.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(e,", remote datachannel is not published")),s}R.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(i.map(s=>s.id)));try{const s=await this._p2pChannel.unsubscribeDataChannel(t,i);s&&await this._gateway.unsubscribeDataChannel(s,t.uid),R.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(s))}catch(s){if(s.code===O.DISCONNECT_P2P)return void R.warning("disconnecting p2p, abort unsubscribe request.");throw R.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),s.toString()),s}}async massUnsubscribe(t){if(Oo(t,"unsubscribeList"),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");R.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(i=>{let{user:s,mediaType:a}=i;return"user: ".concat(s==null?void 0:s.uid,", mediaType: ").concat(a,";")}).join())),t=[...t];const e=new Map;for(let i=t.length-1;i>=0;i--){const{user:s,mediaType:a}=t[i];if(!s){const u=new B(O.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw R.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),u}if(Bn(a,"mediaType",["video","audio",void 0]),!this._users.find(u=>u===s)){R.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(s.uid,", user is not in the channel")),t.splice(i,1);continue}const d=On.Video|On.LwoVideo;if(e.has(s)){const u=e.get(s);let h;switch(a){case"video":h=u&d;break;case"audio":h=u&On.Audio;break;default:h=u&(On.Audio|d)}if(h){R.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(s.uid,",mediaType:").concat(a," twice.")),t.splice(i,1);continue}a?a==="audio"?e.set(s,u|On.Audio):a==="video"&&e.set(s,u|d):e.set(s,u|On.Audio|d)}else a?a==="audio"?e.set(s,On.Audio):a==="video"&&e.set(s,d):e.set(s,On.Audio|d)}try{const i=await this._p2pChannel.massUnsubscribe(t);i&&await this._gateway.massUnsubscribe(i),R.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(s=>{let{user:a,mediaType:d}=s;return"user: ".concat(a==null?void 0:a.uid,", mediaType: ").concat(d,";")}).join()))}catch(i){if(i.code===O.DISCONNECT_P2P)return void R.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw R.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(t){(function(i){if(!i)throw new J(O.INVALID_PARAMS);Ze(i.width)||vg(i.width,"streamParameter.width"),Ze(i.height)||vg(i.height,"streamParameter.height"),Ze(i.framerate)||vg(i.framerate,"streamParameter.framerate"),Ze(i.bitrate)||Pe(i.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&R.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),R.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const e=this._configDistribute.getLowStreamConfigDistribute();if(e&&e.bitrate&&t.bitrate&&e.bitrate<t.bitrate&&(t.bitrate=e.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,Z.LocalVideoLowTrack)}async enableDualStream(){if(!xe().supportDualStream)throw vt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new B(O.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new B(O.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw vt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,vt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),R.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Z.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw vt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,vt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),R.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,e){if(function(i){Bn(i,"role",["audience","host"])}(t),e&&Ew(e),this.mode==="rtc")throw R.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole")),new B(O.INVALID_OPERATION,"rtc mode can not use setClientRole");if(e&&e.level&&t==="host")throw new B(O.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new B(O.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(t,e),this._config.role=t,R.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(e&&e.level))}getRemoteInboundOffset(){var t;const e=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!e||!e.timestamp)return 0;const i=e.timestamp-Date.now();return Math.abs(i)>1e3+e.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,e){if(ai(t,"proxyServer"),!e){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new B(O.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,vt.setProxyServer(this._proxyServer),R.setProxyServer(this._proxyServer),R.info("[".concat(this._clientId,"] Set proxy server ").concat(e?"by initialize call":""," success."))}setTurnServer(t,e){if(Array.isArray(t)||(t=[t]),!e){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new B(O.INVALID_OPERATION,"You have already set the proxy")}if(Nd(t))return this._turnServer={servers:t,mode:"original-manual"},void R.info("[".concat(this._clientId,"] Set original turnserver ").concat(e?"by initialize call":""," success: ").concat(t.map(i=>i.urls).join(","),"."));t.forEach(i=>mw(i)),this._turnServer={servers:t,mode:"manual"},R.info("[".concat(this._clientId,"] Set turnserver ").concat(e?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"you should set license before join channel");if(ai(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new B(O.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,R.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new B(O.INVALID_OPERATION,"You have already set the proxy");const e=[3,4,5];let i;switch(t===void 0&&(t=3),t){case 1:case 2:throw new B(O.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new B(O.INVALID_PARAMS,"proxy server mode must be ".concat(e.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"Stop proxy server after leave channel");vt.setProxyServer(),R.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",R.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new B(O.INVALID_PARAMS,"accessPoints is required.");Oo(t.accessPoints.serverList,"accessPoints.serverList"),ai(t.accessPoints.domain,"accessPoints.domain");const e=(y,b)=>{Pe(y,b,0,65535,!0)};let i=443;if(t.accessPoints.port&&(e(t.accessPoints.port,"accessPoints.port"),i=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new B(O.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");x("CLOSE_AFB_FOR_LOCAL_AP")&&(Ne("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Ne("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const s=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,a=t.accessPoints.domain,d=t.accessPoints.serverList.map(y=>s.test(y)?"".concat(y.replace(/\./g,"-"),".").concat(a):y),u=d.map(y=>"".concat(y,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Ne("WEBCS_DOMAIN",u),Ne("WEBCS_DOMAIN_BACKUP_LIST",u),Ne("GATEWAY_DOMAINS",[a]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(Oo(t.report.hostname,"report.hostname"),Ne("EVENT_REPORT_DOMAIN",t.report.hostname[0]),Ne("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(Ne("EVENT_REPORT_DOMAIN",d[0]),Ne("EVENT_REPORT_BACKUP_DOMAIN",d[1]||d[0]));let h=6443;t.report&&t.report.port&&(e(t.report.port,"report.port"),h=t.report.port),Ne("STATS_COLLECTOR_PORT",h),t.report?Ne("ENABLE_EVENT_REPORT",!0):Ne("ENABLE_EVENT_REPORT",!1);let p="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(Oo(t.log.hostname,"log.hostname"),p=t.log.hostname[0]):p=d[0];let _=6444;t.log&&t.log.port&&(e(t.log.port,"log.port"),_=t.log.port),Ne("LOG_UPLOAD_SERVER","".concat(p,":").concat(_));let m=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(Oo(t.cds.hostname,"cds.hostname"),m=t.cds.hostname):m=d;let S=443;t.cds&&t.cds.port&&(e(t.cds.port,"cds.port"),S=t.cds.port),Ne("CDS_AP",m.map(y=>"".concat(y,":").concat(S))),t.cds?Ne("ENABLE_CONFIG_DISTRIBUTE",!0):Ne("ENABLE_CONFIG_DISTRIBUTE",!1),R.info("set local access point v2 success")}setLocalAccessPoints(t,e){if(Oo(t,"serverList"),ai(e,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new B(O.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(s=>i.test(s)?"".concat(s.replace(/\./g,"-"),".").concat(e):s),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Ne("WEBCS_DOMAIN",t),Ne("WEBCS_DOMAIN_BACKUP_LIST",t),Ne("GATEWAY_DOMAINS",[e]),Ne("EVENT_REPORT_DOMAIN",t[0]),Ne("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),Ne("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),R.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(Bn(t,"streamType",[0,1]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw R.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else R.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,e){Bn(e,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(t,e),setTimeout(()=>{const i=this._users.find(s=>s.uid===t);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw R.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}R.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(e)),this._remoteStreamTypeCacheMap.set(t,e)}async setStreamFallbackOption(t,e){Bn(e,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(t,e)}catch(i){throw R.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}R.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(e)),this._streamFallbackTypeCacheMap.set(t,e)}setEncryptionConfig(t,e,i){(function(a){Bn(a,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),ai(e,"secret");const s=["aes-128-gcm2","aes-256-gcm2"];if(It(s).call(s,t)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new B(O.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new B(O.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(e)||R.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=e,i&&(this._encryptionSalt=kp(i))}async renewToken(t){if(ai(t,"token",1,2047),!this._key||!this._joinInfo)throw new B(O.INVALID_OPERATION,"renewToken should not be called before user join");const e=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const i=await this._renewTokenMutex.lock();try{if(x("USE_NEW_TOKEN")){R.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const s=await e5(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Rn);R.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:s})}else R.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});R.debug("[".concat(this._clientId,"] renewToken success"))}catch(s){throw this._key=e,this._joinInfo.token=e,R.error("[".concat(this._clientId,"] renewToken failed"),s.toString()),s}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?R.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(de.VOLUME_INDICATOR,t)},x("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),e=this._gateway.getInChannelInfo();return t.Duration=Math.round(e.duration/1e3),t}async startLiveStreaming(t,e){if(!e){if(this.codec!=="h264")throw new B(O.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new B(O.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new B(O.LIVE_STREAMING_TASK_CONFLICT);const i=e?kn.TRANSCODE:kn.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(t,i)}setLiveTranscoding(t){return this._createLiveStreamingClient(kn.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const e=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(t));if(!e.length)throw new B(O.INVALID_PARAMS,"can not find live streaming url to stop");await W.all(e.map(i=>i&&i.stopLiveStreamingTask(t)))}async addInjectStreamUrl(t,e){if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const i=this._createLiveStreamingClient(kn.INJECT);i.setInjectStreamConfig(e,0),await i.startLiveStreamingTask(t,kn.INJECT)}async removeInjectStreamUrl(){var t;const e=this._createLiveStreamingClient(kn.INJECT),i=Array.from(Qs(t=e.streamingTasks).call(t)).find(s=>s.mode===kn.INJECT);if(!this._joinInfo||!i)throw new B(O.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await e.stopLiveStreamingTask(i.url)}async startChannelMediaRelay(t){H0(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){H0(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendStreamMessage(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const i=new TextEncoder;t.payload=i.encode(t.payload)}if(new Blob([t.payload]).size>1024)throw new B(O.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(yt.DATA_STREAM,{payload:kp(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-M5},!e)}sendMetadata(t){if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new B(O.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(yt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:kp(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(K3),!this._joinInfo)throw new B(O.INVALID_OPERATION,"can not send custom report, not joined");await vt.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,e){Bn(e.spatialLayer,"spatialLayer",[0,1,2,3]),Bn(e.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,e)}catch(i){throw R.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}setRTM2Flag(t){if(Bn(t,"flag",[0,1]),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't setRtm2Flag, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"Can't setRtm2Flag in ".concat(this.connectionState," state"));return this._gateway.setRTM2Flag(t)}_reset(){if(R.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=qi.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(e=>e._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new zn("client-publish"),this._subscribeMutex=new zn("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,e){const i=t||wg();t?R.debug("[".concat(this._clientId,"] new Session ").concat(i)):R.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i)),this._sessionId=i,this.store.sessionId=i,e?vt.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:e.channel,appid:e.appId,mode:this.mode}):this._joinInfo?vt.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this.mode}):this._gateway.joinInfo&&vt.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this.mode}),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new B(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&x("FORCE_TURN")&&!x("TURN_ENABLE_TCP")&&!x("TURN_ENABLE_UDP"))throw new B(O.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");R.debug("[".concat(this._clientId,"] publish high stream"));try{if(this._p2pChannel instanceof rn){const i=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(i)try{await this._gateway.sendExtensionMessage(Ve.PUBLISH,i)}catch(s){throw this._p2pChannel.unpublish(t),s}}else{const i=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter),s=(await i.next()).value;if(s){var e;let a;try{a=await this._gateway.publish(this._uid,s,!0)}catch(d){if(d.code!==O.DISCONNECT_P2P)throw i.throw(d),d}await i.next(((e=a)===null||e===void 0?void 0:e.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const a of t)a instanceof te&&a._encoderConfig&&this._gateway.setVideoProfile(a._encoderConfig),!a.muted&&a.enabled||await this._p2pChannel.muteLocalTrack(a)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,t),(i==null?void 0:i.code)===O.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new B(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));R.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),s=(await i.next()).value;if(s){var e;let a;try{a=await this._gateway.publish(this._uid,s,!0)}catch(d){if(d.code!==O.DISCONNECT_P2P)throw i.throw(d),d}i.next(((e=a)===null||e===void 0?void 0:e.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===O.WS_ABORT)return;throw i}}_createLiveStreamingClient(t){if(!this._joinInfo||!this._appId)return new B(O.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const e=()=>new r5(this._joinInfo,this._config.websocketRetryConfig||Rn,this._config.httpRetryConfig||Rn),i=s=>{s.onLiveStreamError=(a,d)=>{vt.reportApiInvoke(this._sessionId,{name:An.ON_LIVE_STREAM_ERROR,options:[a,d],tag:Je.TRACER}).onSuccess(),this.safeEmit(de.LIVE_STREAMING_ERROR,a,d)},s.onLiveStreamWarning=(a,d)=>{vt.reportApiInvoke(this._sessionId,{name:An.ON_LIVE_STREAM_WARNING,options:[a,d],tag:Je.TRACER}).onSuccess(),this.safeEmit(de.LIVE_STREAMING_WARNING,a,d)},s.on(Fd.REQUEST_WORKER_MANAGER_LIST,(a,d,u)=>{if(!this._joinInfo)return u(new B(O.INVALID_OPERATION,"can not find join info to get worker manager"));F0(a,this._joinInfo,this._axiosCancelSource.token,Rn).then(d).catch(u)})};switch(t){case kn.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=e(),i(this._liveRawStreamingClient)),this._liveRawStreamingClient;case kn.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=e(),i(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case kn.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=e(),this._injectStreamingClient.on(Fd.REQUEST_WORKER_MANAGER_LIST,(s,a,d)=>{if(!this._joinInfo)return d(new B(O.INVALID_OPERATION,"can not find join info to get worker manager"));F0(s,this._joinInfo,this._axiosCancelSource.token,Rn).then(a).catch(d)}),this._injectStreamingClient.onInjectStatusChange=(s,a,d)=>{this.safeEmit(de.INJECT_STREAM_STATUS,s,a,d)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new B(O.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:e}=this.getLocalVideoStats(),i={width:t,height:e};this._channelMediaRelayClient=new o5(this._joinInfo,this._clientId,this._config.websocketRetryConfig||Rn,this._config.httpRetryConfig||Rn,i),this._channelMediaRelayClient.on("state",s=>{s===Li.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(de.CHANNEL_MEDIA_RELAY_STATE,s)}),this._channelMediaRelayClient.on("event",s=>{this.safeEmit(de.CHANNEL_MEDIA_RELAY_EVENT,s)}),this._statsCollector.onStatsChanged=(s,a)=>{var d;s==="resolution"&&((d=this._channelMediaRelayClient)===null||d===void 0||d.setVideoProfile(a))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(t,e){const{added:i,deleted:s}=t,a=[];Array.isArray(i)&&i.length>0&&i.forEach(d=>{const{uid:u,stream_id:h,ordered:p,max_retrans_times:_,metadata:m}=d,S=this._users.find(y=>y._uintid===u);if(!S)return void R.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(R.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(u)),It(a).call(a,S)||a.push(S),S._uintid||(S._uintid=u),S._dataChannels.findIndex(y=>y.id===d.stream_id)===-1){const y={id:h,ordered:!!p,maxRetransmits:_,metadata:m},b=new W4(y);S._dataChannels.push(b),R.info("[".concat(this._clientId,"] remote user ").concat(S.uid," published datachannel")),e||this.safeEmit(de.USER_PUBLISHED,S,"datachannel",y)}this._p2pChannel.hasPendingRemoteDataChannel(S,d.stream_id)&&(R.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(S.uid," after reconnect.")),this._subscribeDataChannel(S,d.stream_id).catch(y=>{R.error("[".concat(this._clientId,"] resubscribe datachannel error"),y.toString())}))}),e&&(this.safeEmit(de.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(s)&&s.length>0&&s.forEach(d=>{const{uid:u,stream_id:h}=d,p=this._users.find(m=>m._uintid===u);if(!p)return void R.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const _=p._dataChannels.find(m=>m.id===d.stream_id);_&&(R.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(u)),this._p2pChannel.unsubscribeDataChannel(p,[_]).then(m=>{if(m)return p._dataChannels=p._dataChannels.filter(S=>S!==_),this._gateway.unsubscribeDataChannel(m,p.uid)}),R.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished datachannel ,id:").concat(_.id)),this.safeEmit(de.USER_UNPUBLISHED,p,"datachannel",_._config))})}_handleRemoveDataChannels(t){const e=this._users.find(i=>i.uid===t.uid);if(e){if(e._dataChannels!==void 0&&e._dataChannels.length>0){R.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const i=()=>{R.info("[".concat(this._clientId,"] remote user ").concat(e.uid," unpublished datachannel")),e._dataChannels.forEach(s=>{this.safeEmit(de.USER_UNPUBLISHED,e,"datachannel",s._config)})};this._p2pChannel.unsubscribeDataChannel(e,e._dataChannels).then(s=>{if(s)return this._gateway.unsubscribeDataChannel(s,e.uid)}),i()}}else R.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(nn.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(nn.CONNECTION_STATE_CHANGE,(t,e,i)=>{var s;if(i===oe.FALLBACK)return;const a=()=>{this.safeEmit(de.CONNECTION_STATE_CHANGE,t,e,i)};if(vt.reportApiInvoke(this._sessionId||((s=this._gateway.joinInfo)===null||s===void 0?void 0:s.sid)||null,{name:An.CONNECTION_STATE_CHANGE,options:[t,e,i],tag:Je.TRACER}).onSuccess(JSON.stringify({cur:t,prev:e,reason:i})),R.info("[".concat(this._clientId,"] connection state change: ").concat(e," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void a();if(t==="RECONNECTING")this._users.forEach(u=>{u._trust_in_room_=!1,u._trust_audio_enabled_state_=!1,u._trust_video_enabled_state_=!1,u._trust_audio_mute_state_=!1,u._trust_video_mute_state_=!1,u._trust_audio_stream_added_state_=!1,u._trust_video_stream_added_state_=!1,u._audioSSRC=void 0,u._videoSSRC=void 0,u._videoOrtc=void 0,u._audioOrtc=void 0,u._cname=void 0,u._rtxSsrcId=void 0}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var d;this._streamFallbackTypeCacheMap.forEach((u,h)=>{this._gateway.setStreamFallbackOption(h,u).catch(p=>{R.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),p)})}),this._remoteStreamTypeCacheMap.forEach((u,h)=>{this._gateway.setRemoteVideoStreamType(h,u).catch(p=>{R.warning("[".concat(this._clientId,"] auto set remote stream type failed"),p)})}),this._remoteDefaultVideoStreamType!==void 0&&((d=this._joinInfo)===null||d===void 0?void 0:d.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{R.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(u=>{R.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(u))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(u=>!u._trust_in_room_).forEach(u=>{R.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(u.uid)),this._handleUserOffline({uid:u.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(u=>{u._trust_audio_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(u.uid)),this._handleMuteStream(u.uid,mt.AUDIO,!1)),u._trust_video_mute_state_||(R.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(u.uid)),this._handleMuteStream(u.uid,mt.VIDEO,!1)),u._trust_audio_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(u.uid)),this._handleSetStreamLocalEnable("audio",u.uid,!0)),u._trust_video_enabled_state_||(R.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(u.uid)),this._handleSetStreamLocalEnable("video",u.uid,!0)),u._trust_video_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(u.uid)),this._handleResetAddStream(u,"video")),u._trust_audio_stream_added_state_||(R.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(u.uid)),this._handleResetAddStream(u,"audio")),u._video_added_||u._audio_added_||(R.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(u.uid)),this._handleRemoveStream({uid:u.uid,uint_id:u._uintid}))}))},1e3))}a()}),this._gateway.on(nn.REQUEST_NEW_GATEWAY_LIST,(t,e)=>{if(!this._joinInfo)return e(new B(O.UNEXPECTED_ERROR,"can not recover, no join info"));iT(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Rn,this.store).then(i=>{this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);const s=[];i.gatewayInfo.gatewayAddrs.forEach(a=>{let{address:d}=a;const[u,h]=d.split(":");this._joinInfo&&this._joinInfo.proxyServer?s.push({proxy:this._joinInfo.proxyServer,host:u,port:h}):s.push({host:u,port:h})}),t(s)}).catch(e)}),this._gateway.on(nn.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(de.NETWORK_QUALITY,t)}),this._gateway.on(nn.STREAM_TYPE_CHANGE,(t,e)=>{this.safeEmit(de.STREAM_TYPE_CHANGED,t,e),vt.reportApiInvoke(this._sessionId,{name:An.STREAM_TYPE_CHANGE,options:[t,e],tag:Je.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:e}))}),this._gateway.on(nn.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(nn.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(nn.REQUEST_P2P_CONNECTION_PARAMS,async(t,e,i)=>{try{e(await this._p2pChannel.startP2PConnection(t))}catch(s){i(s)}}),this._gateway.on(nn.JOIN_RESPONSE,(t,e)=>{if(this.store.useP2P)return;const{dtlsParameters:i,iceParameters:s,candidates:a,rtpCapabilities:d,setup:u,cname:h}=Q0(t.ortc,e);this._p2pChannel.connect(s,i,a,d,u,h)}),this._gateway.on(nn.REQUEST_DC_CONNECTION_PARAMS,t=>{t(this._p2pChannel.getEstablishParams())}),this._gateway.on(nn.RESET_SIGNAL,t=>{this._p2pChannel.resetConnection(t),this._handleGatewaySignalEvents()}),this._gateway.on(nn.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(nn.DATACHANNEL_PRECONNECT,async(t,e,i,s)=>{var a,d,u,h,p,_;await this._p2pChannel.startP2PConnection({turnServer:(a=this._joinInfo)===null||a===void 0?void 0:a.turnServer},!0);const m=function(S,y){let b;return y&&y.ip&&typeof y.port=="number"?(b=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:y.ip,port:y.port.toString(),type:"host",extension:{}}],R.debug("Using remote candidate from AP ".concat(y.ip,":").concat(y.port)),y.ip6&&(b.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:y.ip6,port:y.port.toString(),type:"host",extension:{}}),R.debug("Using IPV6 remote candidate from AP ".concat(y.ip6,":").concat(y.port)))):b=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:S.ip,port:S.port.toString(),type:"host",extension:{}}],b}(t,e);return this._p2pChannel.preConnect({iceUfrag:"".concat((d=this._joinInfo)===null||d===void 0?void 0:d.apResponse.cid,"_").concat((u=this._joinInfo)===null||u===void 0?void 0:u.apResponse.cert),icePwd:"".concat((h=this._joinInfo)===null||h===void 0?void 0:h.apResponse.cid,"_").concat((p=this._joinInfo)===null||p===void 0?void 0:p.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:(_=x("FINGERPRINT"))!==null&&_!==void 0?_:t.fingerprint}]},m,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(i).catch(s)})}_handleGatewaySignalEvents(){this._gateway.signal.on(Kt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Kt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Kt.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(Kt.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(Kt.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(Kt.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams,deleted:[]},!0)}),this._gateway.signal.on(Kt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Kt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Kt.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,mt.AUDIO,!0)),this._gateway.signal.on(Kt.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,mt.AUDIO,!1)),this._gateway.signal.on(Kt.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,mt.VIDEO,!0)),this._gateway.signal.on(Kt.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,mt.VIDEO,!1)),this._gateway.signal.on(Kt.RECEIVE_METADATA,t=>{const e=Pp(t.metadata);this.safeEmit(de.RECEIVE_METADATA,t.uid,e)}),this._gateway.signal.on(Kt.ON_DATA_STREAM,async t=>{if(!t)return;let e=0;if(t.ordered||t.syncWithAudio){const i=this._p2pChannel.getStats(),s=this.remoteUsers.find(d=>d.uid===t.uid),a=i==null?void 0:i.audioRecv.find(d=>d.ssrc===(s==null?void 0:s._audioSSRC));e=a==null?void 0:a.jitterBufferMs}e==null&&(e=0),x5(t,e,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Kt.ON_CRYPT_ERROR,()=>{pu(()=>{R.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(de.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Kt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Kt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{R.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,oe.TOKEN_EXPIRE),this.safeEmit(de.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Kt.ON_STREAM_FALLBACK_UPDATE,t=>{R.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(de.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Kt.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),R.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(Kt.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(Kt.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(ht.REQUEST_TIMEOUT,(t,e)=>{if(this._joinInfo)switch(t){case yt.PUBLISH:{if(!e)return;const a=e.ortc;if(a){var i,s;const d=a.some(p=>{let{stream_type:_}=p;return _===Ae.Audio}),u=a.some(p=>{let{stream_type:_}=p;return _!==Ae.Audio}),h=a.some(p=>{let{stream_type:_}=p;return _===Ae.Screen||_===Ae.ScreenLow});e.state==="offer"&&vt.publish(this._joinInfo.sid,{eventElapse:li.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:O.TIMEOUT,audio:d,video:u,p2pid:e.p2p_id,publishRequestid:this.store.pubId,screenshare:h,audioName:d?(i=a.find(p=>{let{stream_type:_}=p;return _===Ae.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:u?(s=a.find(p=>{let{stream_type:_}=p;return _!==Ae.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0})}break}case yt.SUBSCRIBE:e&&vt.subscribe(this._joinInfo.sid,{succ:!1,ec:O.TIMEOUT,audio:e.stream_type===mt.AUDIO,video:e.stream_type===mt.VIDEO,peerid:e.stream_id,subscribeRequestid:e.ssrcId,p2pid:this.store.p2pId,eventElapse:li.measureFromSubscribeStart(this.store.clientId,e.ssrcId)})}}),this._gateway.signal.on(Kt.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(Kt.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;x("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(s=>!Cc(s.string_id||s.stream_id,this.channelName)));const e=[],i=[];for(const s of t.users){let a=this._users.find(m=>m._uintid===s.stream_id);a?a._trust_in_room_=!0:(a=new ui(s.string_id||s.stream_id,s.stream_id),this._users.push(a),this.getListeners(de.PUBLISHED_USER_LIST).length===0&&(R.debug("[".concat(this._clientId,"] user online"),s.stream_id),this.safeEmit(de.USER_JOINED,a)));const d=On.Audio&s.stream_type,u=(On.Video|On.LwoVideo)&s.stream_type,h=(65280&s.stream_type)!=0,p=d&&a.hasAudio,_=u&&a.hasVideo;u&&(a._trust_video_stream_added_state_=!0,a._video_added_=!0,a._videoSSRC=s.video_ssrc,a._rtxSsrcId=s.video_rtx),d&&(a._trust_audio_stream_added_state_=!0,a._audio_added_=!0,a._audioSSRC=s.audio_ssrc),d&&!p&&this.getListeners(de.PUBLISHED_USER_LIST).length===0&&(R.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published audio")),this.safeEmit(de.USER_PUBLISHED,a,"audio")),u&&!_&&this.getListeners(de.PUBLISHED_USER_LIST).length===0&&(R.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published video")),this.safeEmit(de.USER_PUBLISHED,a,"video")),(d&&!p||u&&!_||h)&&e.push(a),u&&this._p2pChannel.hasPendingRemoteMedia(a,"video")&&i.push({user:a,mediaType:"video"}),d&&this._p2pChannel.hasPendingRemoteMedia(a,"audio")&&i.push({user:a,mediaType:"audio"})}i.length>0&&(R.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(s=>"user: ".concat(s.user.uid,", mediaType: ").concat(s.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(s=>{R.error("[".concat(this._clientId,"] mass resubscribe error"),s.toString())})),this.getListeners(de.PUBLISHED_USER_LIST).length>0?x("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=e:(R.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(e.map(s=>s.uid).join(", "))),this.safeEmit(de.PUBLISHED_USER_LIST,e)):R.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(e.map(s=>s.uid).join(", ")))}),this._gateway.signal.on(Kt.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:e}=t;this._p2pChannel instanceof Zn&&this._p2pChannel.updateRemoteRTPCapabilities(e.map(i=>i.toLowerCase()).filter(i=>{var s;return It(s=Object.keys(vc)).call(s,i)}))})}_handleP2PEvents(){this._gateway.signal.on(Kt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Ve.PUBLISH,async(t,e)=>{t.forEach(i=>i.kind===mt.VIDEO?(this._handleP2PAddAudioOrVideoStream("video",e),i.isMuted?this._handleMuteStream(e,mt.VIDEO,!0):this._handleMuteStream(e,mt.VIDEO,!1)):(this._handleP2PAddAudioOrVideoStream("audio",e),i.isMuted?this._handleMuteStream(e,mt.AUDIO,!0):this._handleMuteStream(e,mt.AUDIO,!1)))}),this._gateway.signal.on(ht.P2P_START,async(t,e)=>{if(this._p2pChannel instanceof rn){var i;e(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},t))}}),this._gateway.signal.on(ht.P2P_CONNECTION,async t=>{this._p2pChannel instanceof rn&&await this._p2pChannel.p2pConnect(t)}),this._gateway.signal.on(ht.P2P_REMOTE_CANDIDATE_UPDATE,t=>{this._p2pChannel instanceof rn&&this._p2pChannel.addRemoteCandidate(JSON.parse(t))}),this._gateway.signal.on(Ve.SUBSCRIBE,async(t,e,i)=>{if(this._p2pChannel instanceof rn){const{trackType:s}=JSON.parse(t);try{await this._p2pChannel.dopublish(s),e()}catch(a){i(a)}}}),this._gateway.signal.on(Ve.UNSUBSCRIBE,async(t,e,i)=>{if(this._p2pChannel instanceof rn){const{mediaType:s}=JSON.parse(t);try{await this._p2pChannel.doUnpublish(s),e()}catch(a){i(a)}}}),this._gateway.signal.on(Ve.EXCHANGE_SDP,async(t,e,i)=>{if(this._p2pChannel instanceof rn){const{type:s,sdp:a}=JSON.parse(t);try{e(await this._p2pChannel.setDescription(s,a))}catch(d){i(d)}}}),this._gateway.signal.on(Ve.UNPUBLISH,async(t,e,i)=>{if(this._p2pChannel instanceof rn){const{unpubMsg:s,uid:a}=t;if(s.length===1){const d=s[0].stream_type===Ae.Audio?mt.AUDIO:mt.VIDEO;this._handleMuteStream(a,d,!0);const{sdp:u}=t;if(this._p2pChannel instanceof rn&&u){const h=this._users.find(p=>p.uid===a);if(!h)return R.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(a)),void e();this._p2pChannel.unsubscribe(h,u,d).then(p=>{p&&e(p)}).catch(i)}else e()}else this._handleRemoveStream(t,e,i)}}),this._gateway.signal.on(Ve.CONTROL,async(t,e,i)=>{const{action:s,sdp:a,isMuteAll:d,uid:u}=t;switch(s){case Zs.MUTE_LOCAL_VIDEO:this._handleMuteStream(u,mt.VIDEO,!0,a,e,i);break;case Zs.MUTE_LOCAL_AUDIO:e(),this._handleMuteStream(u,mt.AUDIO,!0);break;case Zs.UNMUTE_LOCAL_VIDEO:e(),this._handleP2PAddAudioOrVideoStream("video",u),this._handleMuteStream(u,mt.VIDEO,!1);break;case Zs.UNMUTE_LOCAL_AUDIO:e(),this._handleP2PAddAudioOrVideoStream("audio",u),this._handleMuteStream(u,mt.AUDIO,!1)}d&&this._handleRemoveStream(t,e,i)}),this._gateway.signal.on(Ve.DO_SUBSCRIBE,async(t,e,i)=>{if(this._p2pChannel instanceof rn){const{kind:s,sdp:a,ssrcId:d,uid:u}=t,h=this._users.find(p=>p.uid===u);if(!h)return R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)")),void e();try{e(await this._p2pChannel.subscribe(h,s,a,d))}catch(p){i(p)}}}),this._gateway.signal.on(Ve.DO_UNSUBSCRIBE,async(t,e,i)=>{if(this._p2pChannel instanceof rn){const{uid:s,kind:a,sdp:d}=t,u=this._users.find(h=>h.uid===s);if(!u)return R.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)")),void e();try{e(await this._p2pChannel.unsubscribe(u,d,a))}catch(h){i(h)}}}),this._gateway.signal.on(Ve.RESTART_ICE,async(t,e,i)=>{if(this._p2pChannel instanceof rn)try{e(await this._p2pChannel.setDescription("remote",t))}catch(s){i(s)}}),this._p2pChannel.on(kt.RequestP2PRestartICE,async(t,e,i)=>{try{e(await this._gateway.sendExtensionMessage(Ve.RESTART_ICE,t))}catch(s){i(s)}}),this._p2pChannel.on(kt.LocalCandidate,t=>{this._gateway.sendExtensionMessage(Ve.CANDIDATE,JSON.stringify(t))}),this._p2pChannel.on(kt.RequestP2PMuteLocal,async(t,e,i)=>{try{e(await this._gateway.sendExtensionMessage(Ve.CONTROL,t))}catch(s){i(s)}}),this._p2pChannel.on(kt.RequestP2PPublish,async(t,e,i)=>{try{e(await this._gateway.sendExtensionMessage(Ve.DO_SUBSCRIBE,t))}catch(s){i(s)}}),this._p2pChannel.on(kt.RequestP2PUnPublish,async(t,e,i)=>{try{e(await this._gateway.sendExtensionMessage(Ve.DO_UNSUBSCRIBE,t))}catch(s){i(s)}}),this._p2pChannel.on(kt.RequestP2PUnmuteRemote,async(t,e,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(s){s.code===O.DISCONNECT_P2P?e():i(s)}else e()}),this._p2pChannel.on(kt.RequestP2PMuteRemote,async(t,e,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(s){s.code===O.DISCONNECT_P2P?e():i(s)}else e()}),this._p2pChannel.on(kt.StateChange,(t,e)=>{e===Ee.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(kt.RequestMuteLocal,async(t,e,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(s){s.code===O.DISCONNECT_P2P?e():i(s)}else e()}),this._p2pChannel.on(kt.RequestUnmuteLocal,async(t,e,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(s){s.code===O.DISCONNECT_P2P?e():i(s)}else e()}),this._p2pChannel.on(kt.RequestRePublish,(t,e,i)=>{this.publish(t,!1).then(e).catch(i)}),this._p2pChannel.on(kt.RequestRePublishDataChannel,(t,e,i)=>{W.all(t.map(async s=>{await this._p2pChannel.publishDataChannel([s]);const a={streamId:s.id,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:s.metadata,channelId:s._originDataChannelId};try{await this._gateway.publishDataChannel(this._uid,a,!0)}catch(d){if(d.code!==O.DISCONNECT_P2P)throw d}})).then(e).catch(i)}),this._p2pChannel.on(kt.RequestReSubscribe,async(t,e,i)=>{try{for(const{user:s,kind:a}of t)a===mt.VIDEO?await this.subscribe(s,"video"):await this.subscribe(s,"audio");e()}catch(s){i(s)}}),this._p2pChannel.on(kt.RequestUploadStats,(t,e)=>{this._gateway.uploadStats(t,e)}),this._p2pChannel.on(kt.MediaReconnectStart,t=>{this.safeEmit(de.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(kt.MediaReconnectEnd,t=>{this.safeEmit(de.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(kt.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(kt.RequestRestartICE,async t=>{if(this._p2pChannel instanceof rn)return;const e=await this._p2pChannel.restartICE(t),i=await e.next();if(i.done)return;const s=i.value;let a;try{a=await this._gateway.restartICE({iceParameters:s})}catch(u){return void e.throw(u)}const{iceParameters:d}=function(u){const h=u.iceParameters;return{iceParameters:{iceUfrag:h.iceUfrag,icePwd:h.icePwd}}}(a);await e.next({remoteIceParameters:d})}),this._p2pChannel.on(kt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(kt.RequestReconnectPC,async()=>{var t;const{iceParameters:e,dtlsParameters:i,rtpCapabilities:s}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:a,gatewayAddress:d}=await this._gateway.reconnectPC({iceParameters:e,dtlsParameters:i,rtpCapabilities:s}),{dtlsParameters:u,iceParameters:h,candidates:p,rtpCapabilities:_,setup:m,cname:S}=Q0(a,d);await this._p2pChannel.connect(h,u,p,_,m,S),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(kt.RequestUnpublishForReconnectPC,async(t,e,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),e()):i()}),this._p2pChannel.on(kt.P2PLost,()=>{this.safeEmit(de.P2P_LOST,this.store.uid)}),this._p2pChannel.on(kt.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(kt.ConnectionTypeChange,t=>{this.safeEmit(de.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(kt.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(kt.QueryClientConnectionState,t=>{t(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!t)throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!t.inspectType||!Array.isArray(t.inspectType))throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const e=[...new Set(t.inspectType)];e.forEach(i=>{var s;if(!It(s=["supervise","moderation"]).call(s,i))throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(i," is not a valid inspect type."))}),t.inspectType=e}if(t&&t.extraInfo&&t.extraInfo.length>1024)throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const e=new Gf(t);this._inspect=e,this.handleVideoInspectEvents(this._inspect),await e.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},Rn)}catch(e){throw Array.isArray(e)?e[0]:e}}async disableContentInspect(){if(!this._inspect)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,e){if(gc(t,"enabled"),t){if(!e)throw new B(O.INVALID_PARAMS,"[".concat(this._clientId,"] config is necessary"));if(Pe(e.interval,"interval",1e3,1/0),this.connectionState!=="CONNECTED"||!this._joinInfo)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,'] can not enable image moderation, not joined"'));try{if(this._moderation)return void this._moderation.updateConfig(e);const i=new RT(e);this._moderation=i,this.handleImageModerationEvents(this._moderation),await i.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},Rn)}catch(i){throw Array.isArray(i)?i[0]:i}}else{if(!this._moderation)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}handleImageModerationEvents(t){t.on(Gr.CONNECTION_STATE_CHANGE,(e,i)=>{if(this.safeEmit(de.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,e,i),e===ar.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new B(O.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(Gr.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}handleVideoInspectEvents(t){t.on(Ln.CONNECTION_STATE_CHANGE,(e,i)=>{if(this.safeEmit(de.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,e,i),i===Rr.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(de.CONTENT_INSPECT_ERROR,new B(O.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(Ln.INSPECT_RESULT,(e,i)=>{var s;if((i==null?void 0:i.code)===O.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return R.debug("Stop inspect content because that has left channel"),this==null||(s=this._inspect)===null||s===void 0||s.close(),void(this._inspect=void 0);this.safeEmit(de.CONTENT_INSPECT_RESULT,e,i)}),t.on(Ln.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}getJoinChannelServiceRecords(){return R.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){gc(t,"enabled"),Ne("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,e){switch(e){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}}X([Lt(),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",W)],Me.prototype,"leave",null),X([Lt({argsMap:(n,t)=>{if(!Array.isArray(t)){if(!(t instanceof di))return[t];t=[t]}return t.map(e=>e?Object(e).toString():"null")}}),C("design:type",Function),C("design:paramtypes",[Object,Boolean]),C("design:returntype",W)],Me.prototype,"publish",null),X([Lt({argsMap:(n,t)=>(t||(t=[]),t instanceof E0?[t.getChannelId()]:(Array.isArray(t)||(t=[t]),t.map(e=>e.getTrackId())))}),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",W)],Me.prototype,"unpublish",null),X([Lt({argsMap:(n,t,e,i)=>[t.uid,e,i]}),C("design:type",Function),C("design:paramtypes",[ui,String,Number]),C("design:returntype",W)],Me.prototype,"subscribe",null),X([Lt({argsMap:(n,t)=>t.map(e=>{let{user:i,mediaType:s}=e;return[i==null?void 0:i.uid,s]})}),C("design:type",Function),C("design:paramtypes",[Array]),C("design:returntype",W)],Me.prototype,"massSubscribe",null),X([Lt({argsMap:(n,t,e,i)=>[t.uid,e,i]}),C("design:type",Function),C("design:paramtypes",[ui,String,Number]),C("design:returntype",W)],Me.prototype,"unsubscribe",null),X([Lt({argsMap:(n,t)=>t.map(e=>{let{user:i,mediaType:s}=e;return{uid:i==null?void 0:i.uid,mediaType:s}})}),C("design:type",Function),C("design:paramtypes",[Array]),C("design:returntype",W)],Me.prototype,"massUnsubscribe",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",W)],Me.prototype,"setLowStreamParameter",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",W)],Me.prototype,"enableDualStream",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",W)],Me.prototype,"disableDualStream",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[String,Object]),C("design:returntype",W)],Me.prototype,"setClientRole",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[String,Boolean]),C("design:returntype",void 0)],Me.prototype,"setProxyServer",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[Object,Boolean]),C("design:returntype",void 0)],Me.prototype,"setTurnServer",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[String]),C("design:returntype",void 0)],Me.prototype,"setLicense",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[Number]),C("design:returntype",void 0)],Me.prototype,"startProxyServer",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],Me.prototype,"stopProxyServer",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",void 0)],Me.prototype,"setLocalAccessPointsV2",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[Array,String]),C("design:returntype",void 0)],Me.prototype,"setLocalAccessPoints",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[Number]),C("design:returntype",W)],Me.prototype,"setRemoteDefaultVideoStreamType",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[Object,Number]),C("design:returntype",W)],Me.prototype,"setRemoteVideoStreamType",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[Object,Number]),C("design:returntype",W)],Me.prototype,"setStreamFallbackOption",null),X([Lt({argsMap:(n,t)=>[t]}),C("design:type",Function),C("design:paramtypes",[String,String,Uint8Array]),C("design:returntype",void 0)],Me.prototype,"setEncryptionConfig",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[String]),C("design:returntype",W)],Me.prototype,"renewToken",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",void 0)],Me.prototype,"enableAudioVolumeIndicator",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[String,Boolean]),C("design:returntype",W)],Me.prototype,"startLiveStreaming",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",W)],Me.prototype,"setLiveTranscoding",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[String]),C("design:returntype",W)],Me.prototype,"stopLiveStreaming",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[String,Object]),C("design:returntype",W)],Me.prototype,"addInjectStreamUrl",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",W)],Me.prototype,"removeInjectStreamUrl",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[Df]),C("design:returntype",W)],Me.prototype,"startChannelMediaRelay",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[Df]),C("design:returntype",W)],Me.prototype,"updateChannelMediaRelay",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",W)],Me.prototype,"stopChannelMediaRelay",null),X([Lt({argsMap:(n,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",W)],Me.prototype,"sendCustomReportMessage",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[Object,Object]),C("design:returntype",W)],Me.prototype,"pickSVCLayer",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[Number]),C("design:returntype",W)],Me.prototype,"setRTM2Flag",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[Object]),C("design:returntype",W)],Me.prototype,"enableContentInspect",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",W)],Me.prototype,"disableContentInspect",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[Boolean,Object]),C("design:returntype",W)],Me.prototype,"setImageModeration",null),X([Lt({reportResult:!0}),C("design:type",Function),C("design:paramtypes",[]),C("design:returntype",Array)],Me.prototype,"getJoinChannelServiceRecords",null),X([Lt(),C("design:type",Function),C("design:paramtypes",[Boolean]),C("design:returntype",W)],Me.prototype,"setPublishAudioFilterEnabled",null);class Ku{constructor(t,e){g(this,"id",0),g(this,"element",void 0),g(this,"peerPair",void 0),g(this,"context",void 0),g(this,"audioPlayerElement",void 0),g(this,"audioTrack",void 0),Ku.count+=1,this.id=Ku.count,this.element=t,this.context=e}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const e=document.createElement("audio");e.srcObject=new MediaStream([t.track]),e.play(),this.audioPlayerElement=e}}async switchSdp(){if(!this.peerPair)return;const t=async(i,s)=>{const a=s==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(a),i.iceGatheringState==="complete"?i.localDescription:new W(d=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&d(i.localDescription)}})},e=async(i,s)=>await i.setRemoteDescription(s);try{const i=await t(this.peerPair[0],"offer");await e(this.peerPair[1],i);const s=await t(this.peerPair[1],"answer");await e(this.peerPair[0],s)}catch(i){throw new B(O.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let e;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),e=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(e)}catch(s){throw new B(O.LOCAL_AEC_ERROR,s.toString()).print()}if(!e)throw new B(O.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=e.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,e=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(e),await this.switchSdp()}close(){R.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}g(Ku,"count",0);const B5=window.AudioContext||window.webkitAudioContext;class ZN{constructor(){g(this,"units",[]),g(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return R.debug("the system does not need to process local aec"),-1;this.context||(this.context=new B5);let e=this.units.find(i=>i&&i.getElement()===t);return e||(e=new Ku(t,this.context),this.units.push(e)),e.startEchoCancellation(),R.debug("start processing local audio echo cancellation, id is",e.id),e.id}_doesEnvironmentNeedAEC(){return Se().name!==Ce.SAFARI}}X([Lt({report:vt}),C("design:type",Function),C("design:paramtypes",[HTMLAudioElement]),C("design:returntype",Number)],ZN.prototype,"processExternalMediaAEC",null);const j5=new ZN;function tD(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),e.push.apply(e,i)}return e}function eD(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?tD(Object(e),!0).forEach(function(i){g(n,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):tD(Object(e)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(e,i))})}return n}const CT=window||document;function nD(n){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!CT)return;const e=Gn._cspEventHandlerPointer;if(e&&t)return void console.error(e,t);const i=s=>{if(!(s&&s.blockedURI&&(Gn.onSecurityPolicyViolation||Gn.getListeners(ks.SECURITY_POLICY_VIOLATION).length>0)))return;const a=s.blockedURI;x("CSP_DETECTED_HOSTNAME_LIST").some(d=>It(a).call(a,d))&&(Gn.onSecurityPolicyViolation&&typeof Gn.onSecurityPolicyViolation=="function"&&Gn.onSecurityPolicyViolation(s),Gn.getListeners(ks.SECURITY_POLICY_VIOLATION).length>0&&Gn.safeEmit(ks.SECURITY_POLICY_VIOLATION,s))};e&&CT.removeEventListener("securitypolicyviolation",e),(t||n&&typeof n=="function"||Gn.getListeners(ks.SECURITY_POLICY_VIOLATION).length>0)&&CT.addEventListener("securitypolicyviolation",i),Gn._cspEventHandlerPointer=i}Ne("PROCESS_ID","process-".concat(Le(8,""),"-").concat(Le(4,""),"-").concat(Le(4,""),"-").concat(Le(4,""),"-").concat(Le(12,""))),function(){const n=Se();Ti.getDisplayMedia=function(t){return!!(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)}(),Ti.getStreamFromExtension=n.name===Ce.CHROME&&Number(n.version)>34,Ti.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let e=!1;try{t.addTransceiver("audio"),e=!0}catch{}return t.close(),e}(),Ti.supportMinBitrate=n.name===Ce.CHROME||n.name===Ce.EDGE,Ti.supportSetRtpSenderParameters=function(){const t=Se();return!window.RTCRtpSender||!window.RTCRtpSender.prototype.setParameters||!window.RTCRtpSender.prototype.getParameters?!1:!!la()||!(!bi()&&!Op())||t.name===Ce.FIREFOX&&Number(t.version)>=64}(),n.name===Ce.SAFARI&&(Number(n.version)>=14?Ti.supportDualStream=!0:Ti.supportDualStream=!1),Ti.webAudioMediaStreamDest=function(){const t=Se();return!(t.name===Ce.SAFARI&&Number(t.version)<12)}(),Ti.supportReplaceTrack=function(){return window.RTCRtpSender?typeof RTCRtpSender.prototype.replaceTrack=="function":!1}(),Ti.supportWebGL=typeof WebGLRenderingContext<"u",Ti.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,la()||(Ti.webAudioWithAEC=!0),Ti.supportShareAudio=function(){const t=Se();return(t.os===Fn.WIN_10||t.os===Fn.WIN_81||t.os===Fn.WIN_7||t.os===Fn.LINUX||t.os===Fn.MAC_OS)&&t.name===Ce.CHROME&&Number(t.version)>=74}(),Ti.supportDataChannel=function(){return!!(yg(76)||function(t){const e=Se();return!(e.name!==Ce.FIREFOX||!e.osVersion)&&Number(e.version)>=t}(68)||function(t){const e=Se();return!(e.name!==Ce.SAFARI||!e.osVersion)&&Number(e.version)>=t}(14))}(),Ti.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!We()&&!!t&&t.prototype.setConfiguration instanceof Function}(),Ti.supportWebRTCEncodedTransform=function(){const t=Se();return t.name==="Chrome"&&Number(t.version)>=86}(),Ti.supportWebRTCInsertableStream=function(){const t=Se();return(t.name===Ce.CHROME||t.name===Ce.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),ds(()=>{Ti.supportDualStreamEncoding=function(){const t=Se();return x("DISABLE_WEBAUDIO")?!0:t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&x("CHROME_DUAL_STREAM_USE_ENCODING"))}(),R.info("browser compatibility",JSON.stringify(Ti),JSON.stringify(n))})}(),function(){let n;try{n=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void R.error("Error loading sdk config",t.message)}if(n)try{const t=JSON.parse(window.atob(n)),e=Date.now();R.debug("Loading global parameters from cache",t),Object.keys(t).forEach(i=>{if(Object.prototype.hasOwnProperty.call(ki,i)){const{value:s,expires:a}=t[i];if(a&&a<=e)return;ha[i]=s,ki[i]=s}})}catch(t){R.error("Error loading mutableParamsCache: ".concat(n),t.message)}}(),Array.isArray(ha.AREAS)&&ha.AREAS.length>0&&ZS(ha.AREAS,!0);const Gn=function(n){const t=new Ye,e=n,i={getListeners:t.getListeners.bind(t),on:(s,a)=>(function(d,u){d===ks.SECURITY_POLICY_VIOLATION&&nD(u,!0)}(s,a),t.on.bind(t)(s,a)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return eD(eD({},e),i)}({__TRACK_LIST__:jd,VERSION:jr,BUILD:Xg,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:(n,t,e)=>{R.debug("setParameter key:".concat(n,", value:").concat(JSON.stringify(t))),Ne(n,t,e)},getParameter:x,getSupportedCodec:async function(){let n={audio:[],video:[]};try{let t=new RTCPeerConnection;t.addTransceiver("video",{direction:"recvonly"}),t.addTransceiver("audio",{direction:"recvonly"});const e=(await t.createOffer()).sdp;if(!e)return n;t.close(),t=null,n=function(i){const s={video:[],audio:[]};return i.match(/ VP8/i)&&s.video.push("VP8"),i.match(/ VP9/i)&&s.video.push("VP9"),i.match(/ AV1/i)&&s.video.push("AV1"),i.match(/ H264/i)&&s.video.push("H264"),i.match(/ H265/i)&&s.video.push("H265"),i.match(/ opus/i)&&s.audio.push("OPUS"),i.match(/ PCMU/i)&&s.audio.push("PCMU"),i.match(/ PCMA/i)&&s.audio.push("PCMA"),i.match(/ G722/i)&&s.audio.push("G722"),s}(e)}catch(t){throw new B(O.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return n},checkSystemRequirements:function(){const n=vt.reportApiInvoke(null,{name:An.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Je.TRACER});let t=!1;try{const a=window.RTCPeerConnection,d=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,u=window.WebSocket;t=!!(a&&d&&u)}catch(a){return R.error("check system requirement failed: ",a),!1}let e=!1;const i=Se();i.name===Ce.CHROME&&Number(i.version)>=58&&(!XG()||JG())&&(e=!0),i.name===Ce.FIREFOX&&Number(i.version)>=56&&(e=!0),i.name===Ce.OPERA&&Number(i.version)>=45&&(e=!0),i.name===Ce.SAFARI&&Number(i.version)>=11&&(e=!0),(aw()||Se().name===Ce.QQ)&&(e=!0),R.debug("checkSystemRequirements, api:",t,"browser",e);const s=t&&e;return n.onSuccess(s),s},getDevices:function(n){return br.enumerateDevices(!0,!0,n)},getMicrophones:function(n){return br.getRecordingDevices(n)},getCameras:function(n){return br.getCamerasDevices(n)},getElectronScreenSources:sO,getPlaybackDevices:function(n){return br.getSpeakers(n)},createClient:function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const t=vt.reportApiInvoke(null,{name:An.CREATE_CLIENT,options:[n],tag:Je.TRACER});try{(function(e){Bn(e.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Bn(e.mode,"config.mode",["rtc","live"]),e.audioCodec!==void 0&&Bn(e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),e.proxyServer!==void 0&&ai(e.proxyServer,"config.proxyServer",1,1e4),e.turnServer!==void 0&&mw(e.turnServer),e.httpRetryConfig!==void 0&&_w(e.httpRetryConfig),e.websocketRetryConfig!==void 0&&_w(e.websocketRetryConfig)})(n)}catch(e){throw t.onError(e),e}return F5()||(n.codec==="vp9"&&(n.codec="vp8",R.debug("browser not support vp9, force use vp8")),Ne("UNSUPPORTED_VIDEO_CODEC",["vp9"])),n.audioCodec===void 0&&(n.audioCodec="opus"),t.onSuccess(),new Me(Yu(Yu({forceWaitGatewayResponse:!0},n),{},{role:n.mode==="rtc"?"host":n.role||"audience"}))},createCameraVideoTrack:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=vt.reportApiInvoke(null,{tag:Je.TRACER,name:An.CREATE_CAM_VIDEO_TRACK,options:[df({},n)]}),e=cf(n),i=Le(8,"track-cam-");let s=null;const a=n.encoderConfig==="720p_auto";R.info("start create camera video track with config",JSON.stringify(n),"trackId",i);try{s=(await Ir({video:e},i)).getVideoTracks()[0]||null}catch(u){throw t.onError(u),u}if(!s){const u=new J(O.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(u),u.throw(R)}n.optimizationMode&&IS(i,s,n,to(n.encoderConfig));const d=new ya(s,n,e,n.scalabiltyMode?Zp(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,i);return a&&d.startMonitorStats(),t.onSuccess(d.getTrackId()),R.info("create camera video success, trackId:",i),d},createCustomVideoTrack:function(n){const t=vt.reportApiInvoke(null,{tag:Je.TRACER,name:An.CREATE_CUSTOM_VIDEO_TRACK,options:[n]}),e=new te(n.mediaStreamTrack,{width:n.width,height:n.height,frameRate:n.frameRate,bitrateMax:n.bitrateMax,bitrateMin:n.bitrateMin},n.scalabiltyMode?Zp(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,Le(8,"track-cus-"),[Fe.CUSTOM_TRACK]);return t.onSuccess(e.getTrackId()),R.info("create custom video track success with config",n,"trackId",e.getTrackId()),e},createScreenVideoTrack:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const e=vt.reportApiInvoke(null,{tag:Je.TRACER,name:An.CREATE_SCREEN_VIDEO_TRACK,options:[df({},n),t]}),i=n.encoderConfig==="720p_auto";n.encoderConfig?typeof n.encoderConfig=="string"||n.encoderConfig.width&&n.encoderConfig.height||(n.encoderConfig.width={max:1920},n.encoderConfig.height={max:1080}):n.encoderConfig="1080p_2";const s=function(m){const S={};m.screenSourceType&&(S.mediaSource=m.screenSourceType),m.extensionId&&Tg()&&(S.extensionId=m.extensionId);const{displaySurface:y,selfBrowserSurface:b,surfaceSwitching:I,systemAudio:A}=m;(yg(107)||nw(107)||iw(93))&&(y&&(Bn(y,"displaySurface",["browser","window","monitor"]),S.displaySurface=y),b?(Bn(b,"selfBrowserSurface",["exclude","include"]),S.selfBrowserSurface=b):S.selfBrowserSurface="include",I&&(Bn(I,"surfaceSwitching",["exclude","include"]),S.surfaceSwitching=I)),(yg(105)||nw(105)||iw(91))&&A&&(Bn(A,"systemAudio",["exclude","include"]),S.systemAudio=A),m.electronScreenSourceId&&(S.sourceId=m.electronScreenSourceId);const L=m.encoderConfig?lS(m.encoderConfig):null;return S.mandatory={chromeMediaSource:"desktop",maxWidth:L?L.width:void 0,maxHeight:L?L.height:void 0},L&&(L.frameRate&&(typeof L.frameRate=="number"?(S.mandatory.maxFrameRate=L.frameRate,S.mandatory.minFrameRate=L.frameRate):(S.mandatory.maxFrameRate=L.frameRate.max||L.frameRate.ideal||L.frameRate.exact||void 0,S.mandatory.minFrameRate=L.frameRate.min||L.frameRate.ideal||L.frameRate.exact||void 0),S.frameRate=L.frameRate),L.width&&(S.width=L.width),L.height&&(S.height=L.height)),S}(n),a=Le(8,"track-scr-v-");let d=null,u=null;const h=xe();if(!h.supportShareAudio&&t==="enable"){const m=new J(O.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return e.onError(m),m.throw(R)}R.info("start create screen video track with config",n,"withAudio",t,"trackId",a);try{const m=await Ir({screen:s,screenAudio:t==="auto"?h.supportShareAudio:t==="enable"},a);d=m.getVideoTracks()[0]||null,u=m.getAudioTracks()[0]||null}catch(m){throw e.onError(m),m}if(!d){const m=new J(O.UNEXPECTED_ERROR,"can not find track in media stream");return e.onError(m),m.throw(R)}if(!u&&t==="enable"){d&&d.stop();const m=new J(O.SHARE_AUDIO_NOT_ALLOWED);return e.onError(m),m.throw(R)}n.optimizationMode||(n.optimizationMode="detail"),n.optimizationMode&&(IS(a,d,n,n.encoderConfig&&lS(n.encoderConfig)||void 0),n.encoderConfig&&typeof n.encoderConfig!="string"&&(n.encoderConfig.bitrateMin=n.encoderConfig.bitrateMax));const p=new te(d,n.encoderConfig?lS(n.encoderConfig):{},n.scalabiltyMode?Zp(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,a,[Fe.SCREEN_TRACK]);if(i&&p.startMonitorStats(),!u)return e.onSuccess(p.getTrackId()),R.info("create screen video track success","video:",p.getTrackId()),p;const _=new Ie(u,void 0,Le(8,"track-scr-a-"),!1,!0);return e.onSuccess([p.getTrackId(),_.getTrackId()]),R.info("create screen video track success","video:",p.getTrackId(),"audio:",_.getTrackId()),[p,_]},createMicrophoneAndCameraTracks:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=vt.reportApiInvoke(null,{tag:Je.TRACER,name:An.CREATE_MIC_AND_CAM_TRACKS,options:[n,t]}),i=t.encoderConfig==="720p_auto",s=cf(t),a=EO(n),d=Le(8,"track-mic-"),u=Le(8,"track-cam-");let h=null,p=null;R.info("start create camera video track(".concat(u,") and microphone audio track(").concat(d,") with config, audio: ").concat(JSON.stringify(n),", video: ").concat(JSON.stringify(t)));try{const S=await Ir({audio:a,video:s},"".concat(d,"-").concat(u));h=S.getAudioTracks()[0],p=S.getVideoTracks()[0]}catch(S){throw e.onError(S),S}if(!h||!p){const S=new J(O.UNEXPECTED_ERROR,"can not find tracks in media stream");return e.onError(S),S.throw(R)}t.optimizationMode&&IS(u,p,t,to(t.encoderConfig));const _=new Sa(h,n,a,d),m=new ya(p,t,s,t.scalabiltyMode?Zp(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,u);return i&&m.startMonitorStats(),e.onSuccess([_.getTrackId(),m.getTrackId()]),R.info("create camera video track(".concat(u,") and microphone audio track(").concat(d,") success")),[_,m]},createMicrophoneAudioTrack:async function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=vt.reportApiInvoke(null,{tag:Je.TRACER,name:An.CREATE_MIC_AUDIO_TRACK,options:[n]}),e=EO(n),i=Le(8,"track-mic-");let s=null;R.info("start create microphone audio track with config",JSON.stringify(n),"trackId",i);try{s=(await Ir({audio:e},i)).getAudioTracks()[0]||null}catch(d){throw t.onError(d),d}if(!s){const d=new J(O.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(d),d.throw(R)}const a=new Sa(s,n,e,i);return t.onSuccess(a.getTrackId()),R.info("create microphone audio track success, trackId:",i),a},createCustomAudioTrack:function(n){const t=vt.reportApiInvoke(null,{tag:Je.TRACER,name:An.CREATE_CUSTOM_AUDIO_TRACK,options:[n]}),e=new Ie(n.mediaStreamTrack,n.encoderConfig?tf(n.encoderConfig):{},Le(8,"track-cus-"),!1,!0);return R.info("create custom audio track success with config",n,"trackId",e.getTrackId()),t.onSuccess(e.getTrackId()),e},createBufferSourceAudioTrack:async function(n){var t;const{cacheOnlineFile:e,encoderConfig:i}=n;let{source:s}=n;const a={source:s instanceof AudioBuffer?"AudioBuffer":s instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":s,cacheOnlineFile:e,encoderConfig:i},d=vt.reportApiInvoke(null,{tag:Je.TRACER,name:An.CREATE_BUFFER_AUDIO_TRACK,options:[a]});if(x("DISABLE_WEBAUDIO"))throw new J(O.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const u=Le(8,"track-buf-");R.info("start create buffer source audio track with config",JSON.stringify(a),"trackId",u);const h=s;if(!(s instanceof AudioBuffer))try{s=await MH(s,e)}catch(m){return d.onError(m),m.throw(R)}const p=new LH(s),_=new Ta(h,p,i?tf(i):{},u);return R.info("create buffer source audio track success, trackId:",u),d.onSuccess(_.getTrackId()),_},setAppType:function(n){if(R.debug("setAppType: ".concat(n)),!(Number.isInteger(n)&&n>=0))throw R.debug("Invalid appType"),new B(O.INVALID_PARAMS,"invalid app type",n);Ne("APP_TYPE",Math.floor(n))},setLogLevel:function(n){R.setLogLevel(n)},enableLogUpload:function(){x("USE_NEW_LOG")?Ne("UPLOAD_LOG",!0):R.enableLogUpload()},disableLogUpload:function(){x("USE_NEW_LOG")?Ne("UPLOAD_LOG",!1):R.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new Df},checkAudioTrackIsActive:async function(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const e=vt.reportApiInvoke(null,{tag:Je.TRACER,name:An.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(n instanceof Ie||n instanceof hs)){const h=new B(O.INVALID_TRACK,"the parameter is not a audio track");return e.onError(h),h.throw()}t&&t<1e3&&(t=1e3);const i=n instanceof Ie?n.getTrackLabel():"remote_track",s=n.getVolumeLevel();let a=s,d=s;const u=Date.now();return new W(h=>{const p=setInterval(()=>{const _=n.getVolumeLevel();a=_>a?_:a,d=_<d?_:d;const m=a-d>1e-4,S=Date.now()-u;if(m||S>t){clearInterval(p);const y=m,b={duration:S,deviceLabel:i,maxVolumeLevel:a,result:y};R.info("[track-".concat(n.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(b))),e.onSuccess(b),h(y)}},200)})},checkVideoTrackIsActive:async function(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const e=vt.reportApiInvoke(null,{tag:Je.TRACER,name:An.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(n instanceof te||n instanceof eo)){const m=new B(O.INVALID_TRACK,"the parameter is not a video track");return e.onError(m),m.throw()}t&&t<1e3&&(t=1e3);const i=n instanceof te?n.getTrackLabel():"remote_track",s=n.getMediaStreamTrack(!0),a=document.createElement("video");a.style.width="1px",a.style.height="1px",a.setAttribute("muted",""),a.muted=!0,a.setAttribute("playsinline",""),a.controls=!1,(bi()||Op())&&(a.style.opacity="0.01",a.style.position="fixed",a.style.left="0",a.style.top="0",document.body.appendChild(a)),a.srcObject=new MediaStream([s]),a.play();const d=document.createElement("canvas");d.width=160,d.height=120;let u=0,h=0;try{const m=Date.now();u=await function(S,y,b,I){let A,L=0,U=null;return new W((F,$)=>{function z(){L>I&&A&&(A(),F(L));const G=b.getContext("2d");if(!G){const ut=new B(O.UNEXPECTED_ERROR,"can not get canvas 2d context.");return R.error(ut.toString()),void $(ut)}G.drawImage(S,0,0,160,120);const Y=G.getImageData(0,0,b.width,b.height),q=Math.floor(Y.data.length/3);if(U){for(let ut=0;ut<q;ut+=3)if(Y.data[ut]!==U[ut])return L+=1,void(U=Y.data);U=Y.data}else U=Y.data}setTimeout(()=>{A&&(A(),F(L))},y),A=mS(()=>{z()},30)})}(a,t,d,4),h=Date.now()-m}catch(m){throw e.onError(m),m}V5===Ce.SAFARI&&(a.pause(),a.remove()),a.srcObject=null;const p=u>4,_={duration:h,changedPicNum:u,deviceLabel:i,result:p};return R.info("[track-".concat(n.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(_))),e.onSuccess(_),p},setArea:ZS,audioElementPlayCenter:cr,processExternalMediaAEC:function(n){j5.processExternalMediaAEC(n)},registerExtensions:function(n){n.forEach(t=>{const e=t;e.__registered__=!0,e.logger.hookLog=R.extLog,e.reporter.hookApiInvoke=vt.extApiInvoke,e.parameters&&Object.keys(e.parameters).forEach(i=>{e.parameters[i]=x(i)})})},ChannelMediaRelayError:_a,ChannelMediaRelayEvent:Ds,ChannelMediaRelayState:Li,RemoteStreamFallbackType:uS,RemoteStreamType:ef,ConnectionDisconnectedReason:oe,AudienceLatencyLevelType:Ig,AREAS:me});return Object.defineProperties(Gn,{onAudioAutoplayFailed:{get:()=>wr.onAudioAutoplayFailed,set:n=>{wr.onAudioAutoplayFailed=n}},onAutoplayFailed:{get:()=>wr.onAutoplayFailed,set:n=>{wr.onAutoplayFailed=n}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Gn._onSecurityPolicyViolation,set(n){Gn._onSecurityPolicyViolation=n,nD(n)}},__CLIENT_LIST__:{get:()=>x("SHOW_GLOBAL_CLIENT_LIST")?pa:[]}}),br.on(Po.CAMERA_DEVICE_CHANGED,n=>{R.info("camera device changed",JSON.stringify(n)),Gn.onCameraChanged&&Gn.onCameraChanged(n),Gn.safeEmit(ks.CAMERA_CHANGED,n)}),br.on(Po.RECORDING_DEVICE_CHANGED,n=>{R.info("microphone device changed",JSON.stringify(n)),Gn.onMicrophoneChanged&&Gn.onMicrophoneChanged(n),Gn.safeEmit(ks.MICROPHONE_CHANGED,n)}),br.on(Po.PLAYOUT_DEVICE_CHANGED,n=>{R.debug("playout device changed",JSON.stringify(n)),Gn.onPlaybackDeviceChanged&&Gn.onPlaybackDeviceChanged(n),Gn.safeEmit(ks.PLAYBACK_DEVICE_CHANGED,n)}),cr.onAutoplayFailed=()=>{R.info("detect audio element autoplay failed"),wr.onAudioAutoplayFailed&&wr.onAudioAutoplayFailed()},Oe.on("autoplay-failed",()=>{R.info("detect webaudio autoplay failed"),wr.onAudioAutoplayFailed&&wr.onAudioAutoplayFailed(),Gn.safeEmit(ks.AUTOPLAY_FAILED)}),Tn.on(No.NETWORK_STATE_CHANGE,(n,t)=>{R.info("[network-indicator] network state changed, ".concat(t," => ").concat(n))}),window&&(window.__ARTC__=Gn),Gn})})(jL);var xq=jL.exports;const o$=Uq(xq),go=Object.create(null);go.open="0";go.close="1";go.ping="2";go.pong="3";go.message="4";go.upgrade="5";go.noop="6";const m_=Object.create(null);Object.keys(go).forEach(r=>{m_[go[r]]=r});const Sy={type:"error",data:"parser error"},WL=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",GL=typeof ArrayBuffer=="function",HL=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,RR=({type:r,data:o},c,l)=>WL&&o instanceof Blob?c?l(o):dP(o,l):GL&&(o instanceof ArrayBuffer||HL(o))?c?l(o):dP(new Blob([o]),l):l(go[r]+(o||"")),dP=(r,o)=>{const c=new FileReader;return c.onload=function(){const l=c.result.split(",")[1];o("b"+(l||""))},c.readAsDataURL(r)};function lP(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}let VT;function Vq(r,o){if(WL&&r.data instanceof Blob)return r.data.arrayBuffer().then(lP).then(o);if(GL&&(r.data instanceof ArrayBuffer||HL(r.data)))return o(lP(r.data));RR(r,!1,c=>{VT||(VT=new TextEncoder),o(VT.encode(c))})}const uP="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",rh=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let r=0;r<uP.length;r++)rh[uP.charCodeAt(r)]=r;const Fq=r=>{let o=r.length*.75,c=r.length,l,f=0,E,T,w,N;r[r.length-1]==="="&&(o--,r[r.length-2]==="="&&o--);const D=new ArrayBuffer(o),k=new Uint8Array(D);for(l=0;l<c;l+=4)E=rh[r.charCodeAt(l)],T=rh[r.charCodeAt(l+1)],w=rh[r.charCodeAt(l+2)],N=rh[r.charCodeAt(l+3)],k[f++]=E<<2|T>>4,k[f++]=(T&15)<<4|w>>2,k[f++]=(w&3)<<6|N&63;return D},Bq=typeof ArrayBuffer=="function",vR=(r,o)=>{if(typeof r!="string")return{type:"message",data:YL(r,o)};const c=r.charAt(0);return c==="b"?{type:"message",data:jq(r.substring(1),o)}:m_[c]?r.length>1?{type:m_[c],data:r.substring(1)}:{type:m_[c]}:Sy},jq=(r,o)=>{if(Bq){const c=Fq(r);return YL(c,o)}else return{base64:!0,data:r}},YL=(r,o)=>{switch(o){case"blob":return r instanceof Blob?r:new Blob([r]);case"arraybuffer":default:return r instanceof ArrayBuffer?r:r.buffer}},KL=String.fromCharCode(30),Wq=(r,o)=>{const c=r.length,l=new Array(c);let f=0;r.forEach((E,T)=>{RR(E,!1,w=>{l[T]=w,++f===c&&o(l.join(KL))})})},Gq=(r,o)=>{const c=r.split(KL),l=[];for(let f=0;f<c.length;f++){const E=vR(c[f],o);if(l.push(E),E.type==="error")break}return l};function Hq(){return new TransformStream({transform(r,o){Vq(r,c=>{const l=c.length;let f;if(l<126)f=new Uint8Array(1),new DataView(f.buffer).setUint8(0,l);else if(l<65536){f=new Uint8Array(3);const E=new DataView(f.buffer);E.setUint8(0,126),E.setUint16(1,l)}else{f=new Uint8Array(9);const E=new DataView(f.buffer);E.setUint8(0,127),E.setBigUint64(1,BigInt(l))}r.data&&typeof r.data!="string"&&(f[0]|=128),o.enqueue(f),o.enqueue(c)})}})}let FT;function c_(r){return r.reduce((o,c)=>o+c.length,0)}function d_(r,o){if(r[0].length===o)return r.shift();const c=new Uint8Array(o);let l=0;for(let f=0;f<o;f++)c[f]=r[0][l++],l===r[0].length&&(r.shift(),l=0);return r.length&&l<r[0].length&&(r[0]=r[0].slice(l)),c}function Yq(r,o){FT||(FT=new TextDecoder);const c=[];let l=0,f=-1,E=!1;return new TransformStream({transform(T,w){for(c.push(T);;){if(l===0){if(c_(c)<1)break;const N=d_(c,1);E=(N[0]&128)===128,f=N[0]&127,f<126?l=3:f===126?l=1:l=2}else if(l===1){if(c_(c)<2)break;const N=d_(c,2);f=new DataView(N.buffer,N.byteOffset,N.length).getUint16(0),l=3}else if(l===2){if(c_(c)<8)break;const N=d_(c,8),D=new DataView(N.buffer,N.byteOffset,N.length),k=D.getUint32(0);if(k>Math.pow(2,53-32)-1){w.enqueue(Sy);break}f=k*Math.pow(2,32)+D.getUint32(4),l=3}else{if(c_(c)<f)break;const N=d_(c,f);w.enqueue(vR(E?N:FT.decode(N),o)),l=0}if(f===0||f>r){w.enqueue(Sy);break}}}})}const qL=4;function vi(r){if(r)return Kq(r)}function Kq(r){for(var o in vi.prototype)r[o]=vi.prototype[o];return r}vi.prototype.on=vi.prototype.addEventListener=function(r,o){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(o),this};vi.prototype.once=function(r,o){function c(){this.off(r,c),o.apply(this,arguments)}return c.fn=o,this.on(r,c),this};vi.prototype.off=vi.prototype.removeListener=vi.prototype.removeAllListeners=vi.prototype.removeEventListener=function(r,o){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var c=this._callbacks["$"+r];if(!c)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var l,f=0;f<c.length;f++)if(l=c[f],l===o||l.fn===o){c.splice(f,1);break}return c.length===0&&delete this._callbacks["$"+r],this};vi.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var o=new Array(arguments.length-1),c=this._callbacks["$"+r],l=1;l<arguments.length;l++)o[l-1]=arguments[l];if(c){c=c.slice(0);for(var l=0,f=c.length;l<f;++l)c[l].apply(this,o)}return this};vi.prototype.emitReserved=vi.prototype.emit;vi.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};vi.prototype.hasListeners=function(r){return!!this.listeners(r).length};const Ts=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function zL(r,...o){return o.reduce((c,l)=>(r.hasOwnProperty(l)&&(c[l]=r[l]),c),{})}const qq=Ts.setTimeout,zq=Ts.clearTimeout;function fm(r,o){o.useNativeTimers?(r.setTimeoutFn=qq.bind(Ts),r.clearTimeoutFn=zq.bind(Ts)):(r.setTimeoutFn=Ts.setTimeout.bind(Ts),r.clearTimeoutFn=Ts.clearTimeout.bind(Ts))}const Jq=1.33;function Xq(r){return typeof r=="string"?Qq(r):Math.ceil((r.byteLength||r.size)*Jq)}function Qq(r){let o=0,c=0;for(let l=0,f=r.length;l<f;l++)o=r.charCodeAt(l),o<128?c+=1:o<2048?c+=2:o<55296||o>=57344?c+=3:(l++,c+=4);return c}function $q(r){let o="";for(let c in r)r.hasOwnProperty(c)&&(o.length&&(o+="&"),o+=encodeURIComponent(c)+"="+encodeURIComponent(r[c]));return o}function Zq(r){let o={},c=r.split("&");for(let l=0,f=c.length;l<f;l++){let E=c[l].split("=");o[decodeURIComponent(E[0])]=decodeURIComponent(E[1])}return o}class tz extends Error{constructor(o,c,l){super(o),this.description=c,this.context=l,this.type="TransportError"}}class CR extends vi{constructor(o){super(),this.writable=!1,fm(this,o),this.opts=o,this.query=o.query,this.socket=o.socket}onError(o,c,l){return super.emitReserved("error",new tz(o,c,l)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(o){this.readyState==="open"&&this.write(o)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(o){const c=vR(o,this.socket.binaryType);this.onPacket(c)}onPacket(o){super.emitReserved("packet",o)}onClose(o){this.readyState="closed",super.emitReserved("close",o)}pause(o){}createUri(o,c={}){return o+"://"+this._hostname()+this._port()+this.opts.path+this._query(c)}_hostname(){const o=this.opts.hostname;return o.indexOf(":")===-1?o:"["+o+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(o){const c=$q(o);return c.length?"?"+c:""}}const JL="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Ty=64,ez={};let hP=0,l_=0,pP;function fP(r){let o="";do o=JL[r%Ty]+o,r=Math.floor(r/Ty);while(r>0);return o}function XL(){const r=fP(+new Date);return r!==pP?(hP=0,pP=r):r+"."+fP(hP++)}for(;l_<Ty;l_++)ez[JL[l_]]=l_;let QL=!1;try{QL=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const nz=QL;function $L(r){const o=r.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!o||nz))return new XMLHttpRequest}catch{}if(!o)try{return new Ts[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function iz(){}const rz=function(){return new $L({xdomain:!1}).responseType!=null}();class sz extends CR{constructor(o){if(super(o),this.polling=!1,typeof location<"u"){const l=location.protocol==="https:";let f=location.port;f||(f=l?"443":"80"),this.xd=typeof location<"u"&&o.hostname!==location.hostname||f!==o.port}const c=o&&o.forceBase64;this.supportsBinary=rz&&!c,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(o){this.readyState="pausing";const c=()=>{this.readyState="paused",o()};if(this.polling||!this.writable){let l=0;this.polling&&(l++,this.once("pollComplete",function(){--l||c()})),this.writable||(l++,this.once("drain",function(){--l||c()}))}else c()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(o){const c=l=>{if(this.readyState==="opening"&&l.type==="open"&&this.onOpen(),l.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(l)};Gq(o,this.socket.binaryType).forEach(c),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const o=()=>{this.write([{type:"close"}])};this.readyState==="open"?o():this.once("open",o)}write(o){this.writable=!1,Wq(o,c=>{this.doWrite(c,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const o=this.opts.secure?"https":"http",c=this.query||{};return this.opts.timestampRequests!==!1&&(c[this.opts.timestampParam]=XL()),!this.supportsBinary&&!c.sid&&(c.b64=1),this.createUri(o,c)}request(o={}){return Object.assign(o,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new mo(this.uri(),o)}doWrite(o,c){const l=this.request({method:"POST",data:o});l.on("success",c),l.on("error",(f,E)=>{this.onError("xhr post error",f,E)})}doPoll(){const o=this.request();o.on("data",this.onData.bind(this)),o.on("error",(c,l)=>{this.onError("xhr poll error",c,l)}),this.pollXhr=o}}class mo extends vi{constructor(o,c){super(),fm(this,c),this.opts=c,this.method=c.method||"GET",this.uri=o,this.data=c.data!==void 0?c.data:null,this.create()}create(){var o;const c=zL(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");c.xdomain=!!this.opts.xd;const l=this.xhr=new $L(c);try{l.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){l.setDisableHeaderCheck&&l.setDisableHeaderCheck(!0);for(let f in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(f)&&l.setRequestHeader(f,this.opts.extraHeaders[f])}}catch{}if(this.method==="POST")try{l.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{l.setRequestHeader("Accept","*/*")}catch{}(o=this.opts.cookieJar)===null||o===void 0||o.addCookies(l),"withCredentials"in l&&(l.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(l.timeout=this.opts.requestTimeout),l.onreadystatechange=()=>{var f;l.readyState===3&&((f=this.opts.cookieJar)===null||f===void 0||f.parseCookies(l)),l.readyState===4&&(l.status===200||l.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof l.status=="number"?l.status:0)},0))},l.send(this.data)}catch(f){this.setTimeoutFn(()=>{this.onError(f)},0);return}typeof document<"u"&&(this.index=mo.requestsCount++,mo.requests[this.index]=this)}onError(o){this.emitReserved("error",o,this.xhr),this.cleanup(!0)}cleanup(o){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=iz,o)try{this.xhr.abort()}catch{}typeof document<"u"&&delete mo.requests[this.index],this.xhr=null}}onLoad(){const o=this.xhr.responseText;o!==null&&(this.emitReserved("data",o),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}mo.requestsCount=0;mo.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",_P);else if(typeof addEventListener=="function"){const r="onpagehide"in Ts?"pagehide":"unload";addEventListener(r,_P,!1)}}function _P(){for(let r in mo.requests)mo.requests.hasOwnProperty(r)&&mo.requests[r].abort()}const IR=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?o=>Promise.resolve().then(o):(o,c)=>c(o,0))(),u_=Ts.WebSocket||Ts.MozWebSocket,mP=!0,oz="arraybuffer",EP=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class az extends CR{constructor(o){super(o),this.supportsBinary=!o.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const o=this.uri(),c=this.opts.protocols,l=EP?{}:zL(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(l.headers=this.opts.extraHeaders);try{this.ws=mP&&!EP?c?new u_(o,c):new u_(o):new u_(o,c,l)}catch(f){return this.emitReserved("error",f)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=o=>this.onClose({description:"websocket connection closed",context:o}),this.ws.onmessage=o=>this.onData(o.data),this.ws.onerror=o=>this.onError("websocket error",o)}write(o){this.writable=!1;for(let c=0;c<o.length;c++){const l=o[c],f=c===o.length-1;RR(l,this.supportsBinary,E=>{const T={};try{mP&&this.ws.send(E)}catch{}f&&IR(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const o=this.opts.secure?"wss":"ws",c=this.query||{};return this.opts.timestampRequests&&(c[this.opts.timestampParam]=XL()),this.supportsBinary||(c.b64=1),this.createUri(o,c)}check(){return!!u_}}class cz extends CR{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(o=>{this.onError("webtransport error",o)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(o=>{const c=Yq(Number.MAX_SAFE_INTEGER,this.socket.binaryType),l=o.readable.pipeThrough(c).getReader(),f=Hq();f.readable.pipeTo(o.writable),this.writer=f.writable.getWriter();const E=()=>{l.read().then(({done:w,value:N})=>{w||(this.onPacket(N),E())}).catch(w=>{})};E();const T={type:"open"};this.query.sid&&(T.data=`{"sid":"${this.query.sid}"}`),this.writer.write(T).then(()=>this.onOpen())})}))}write(o){this.writable=!1;for(let c=0;c<o.length;c++){const l=o[c],f=c===o.length-1;this.writer.write(l).then(()=>{f&&IR(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var o;(o=this.transport)===null||o===void 0||o.close()}}const dz={websocket:az,webtransport:cz,polling:sz},lz=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,uz=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function yy(r){if(r.length>2e3)throw"URI too long";const o=r,c=r.indexOf("["),l=r.indexOf("]");c!=-1&&l!=-1&&(r=r.substring(0,c)+r.substring(c,l).replace(/:/g,";")+r.substring(l,r.length));let f=lz.exec(r||""),E={},T=14;for(;T--;)E[uz[T]]=f[T]||"";return c!=-1&&l!=-1&&(E.source=o,E.host=E.host.substring(1,E.host.length-1).replace(/;/g,":"),E.authority=E.authority.replace("[","").replace("]","").replace(/;/g,":"),E.ipv6uri=!0),E.pathNames=hz(E,E.path),E.queryKey=pz(E,E.query),E}function hz(r,o){const c=/\/{2,9}/g,l=o.replace(c,"/").split("/");return(o.slice(0,1)=="/"||o.length===0)&&l.splice(0,1),o.slice(-1)=="/"&&l.splice(l.length-1,1),l}function pz(r,o){const c={};return o.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(l,f,E){f&&(c[f]=E)}),c}let ZL=class pl extends vi{constructor(o,c={}){super(),this.binaryType=oz,this.writeBuffer=[],o&&typeof o=="object"&&(c=o,o=null),o?(o=yy(o),c.hostname=o.host,c.secure=o.protocol==="https"||o.protocol==="wss",c.port=o.port,o.query&&(c.query=o.query)):c.host&&(c.hostname=yy(c.host).host),fm(this,c),this.secure=c.secure!=null?c.secure:typeof location<"u"&&location.protocol==="https:",c.hostname&&!c.port&&(c.port=this.secure?"443":"80"),this.hostname=c.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=c.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=c.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},c),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Zq(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(o){const c=Object.assign({},this.opts.query);c.EIO=qL,c.transport=o,this.id&&(c.sid=this.id);const l=Object.assign({},this.opts,{query:c,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[o]);return new dz[o](l)}open(){let o;if(this.opts.rememberUpgrade&&pl.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)o="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else o=this.transports[0];this.readyState="opening";try{o=this.createTransport(o)}catch{this.transports.shift(),this.open();return}o.open(),this.setTransport(o)}setTransport(o){this.transport&&this.transport.removeAllListeners(),this.transport=o,o.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",c=>this.onClose("transport close",c))}probe(o){let c=this.createTransport(o),l=!1;pl.priorWebsocketSuccess=!1;const f=()=>{l||(c.send([{type:"ping",data:"probe"}]),c.once("packet",M=>{if(!l)if(M.type==="pong"&&M.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",c),!c)return;pl.priorWebsocketSuccess=c.name==="websocket",this.transport.pause(()=>{l||this.readyState!=="closed"&&(k(),this.setTransport(c),c.send([{type:"upgrade"}]),this.emitReserved("upgrade",c),c=null,this.upgrading=!1,this.flush())})}else{const j=new Error("probe error");j.transport=c.name,this.emitReserved("upgradeError",j)}}))};function E(){l||(l=!0,k(),c.close(),c=null)}const T=M=>{const j=new Error("probe error: "+M);j.transport=c.name,E(),this.emitReserved("upgradeError",j)};function w(){T("transport closed")}function N(){T("socket closed")}function D(M){c&&M.name!==c.name&&E()}const k=()=>{c.removeListener("open",f),c.removeListener("error",T),c.removeListener("close",w),this.off("close",N),this.off("upgrading",D)};c.once("open",f),c.once("error",T),c.once("close",w),this.once("close",N),this.once("upgrading",D),this.upgrades.indexOf("webtransport")!==-1&&o!=="webtransport"?this.setTimeoutFn(()=>{l||c.open()},200):c.open()}onOpen(){if(this.readyState="open",pl.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let o=0;const c=this.upgrades.length;for(;o<c;o++)this.probe(this.upgrades[o])}}onPacket(o){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",o),this.emitReserved("heartbeat"),this.resetPingTimeout(),o.type){case"open":this.onHandshake(JSON.parse(o.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const c=new Error("server error");c.code=o.data,this.onError(c);break;case"message":this.emitReserved("data",o.data),this.emitReserved("message",o.data);break}}onHandshake(o){this.emitReserved("handshake",o),this.id=o.sid,this.transport.query.sid=o.sid,this.upgrades=this.filterUpgrades(o.upgrades),this.pingInterval=o.pingInterval,this.pingTimeout=o.pingTimeout,this.maxPayload=o.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const o=this.getWritablePackets();this.transport.send(o),this.prevBufferLen=o.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let c=1;for(let l=0;l<this.writeBuffer.length;l++){const f=this.writeBuffer[l].data;if(f&&(c+=Xq(f)),l>0&&c>this.maxPayload)return this.writeBuffer.slice(0,l);c+=2}return this.writeBuffer}write(o,c,l){return this.sendPacket("message",o,c,l),this}send(o,c,l){return this.sendPacket("message",o,c,l),this}sendPacket(o,c,l,f){if(typeof c=="function"&&(f=c,c=void 0),typeof l=="function"&&(f=l,l=null),this.readyState==="closing"||this.readyState==="closed")return;l=l||{},l.compress=l.compress!==!1;const E={type:o,data:c,options:l};this.emitReserved("packetCreate",E),this.writeBuffer.push(E),f&&this.once("flush",f),this.flush()}close(){const o=()=>{this.onClose("forced close"),this.transport.close()},c=()=>{this.off("upgrade",c),this.off("upgradeError",c),o()},l=()=>{this.once("upgrade",c),this.once("upgradeError",c)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?l():o()}):this.upgrading?l():o()),this}onError(o){pl.priorWebsocketSuccess=!1,this.emitReserved("error",o),this.onClose("transport error",o)}onClose(o,c){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",o,c),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(o){const c=[];let l=0;const f=o.length;for(;l<f;l++)~this.transports.indexOf(o[l])&&c.push(o[l]);return c}};ZL.protocol=qL;function fz(r,o="",c){let l=r;c=c||typeof location<"u"&&location,r==null&&(r=c.protocol+"//"+c.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=c.protocol+r:r=c.host+r),/^(https?|wss?):\/\//.test(r)||(typeof c<"u"?r=c.protocol+"//"+r:r="https://"+r),l=yy(r)),l.port||(/^(http|ws)$/.test(l.protocol)?l.port="80":/^(http|ws)s$/.test(l.protocol)&&(l.port="443")),l.path=l.path||"/";const E=l.host.indexOf(":")!==-1?"["+l.host+"]":l.host;return l.id=l.protocol+"://"+E+":"+l.port+o,l.href=l.protocol+"://"+E+(c&&c.port===l.port?"":":"+l.port),l}const _z=typeof ArrayBuffer=="function",mz=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,tM=Object.prototype.toString,Ez=typeof Blob=="function"||typeof Blob<"u"&&tM.call(Blob)==="[object BlobConstructor]",gz=typeof File=="function"||typeof File<"u"&&tM.call(File)==="[object FileConstructor]";function bR(r){return _z&&(r instanceof ArrayBuffer||mz(r))||Ez&&r instanceof Blob||gz&&r instanceof File}function E_(r,o){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let c=0,l=r.length;c<l;c++)if(E_(r[c]))return!0;return!1}if(bR(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return E_(r.toJSON(),!0);for(const c in r)if(Object.prototype.hasOwnProperty.call(r,c)&&E_(r[c]))return!0;return!1}function Sz(r){const o=[],c=r.data,l=r;return l.data=Ry(c,o),l.attachments=o.length,{packet:l,buffers:o}}function Ry(r,o){if(!r)return r;if(bR(r)){const c={_placeholder:!0,num:o.length};return o.push(r),c}else if(Array.isArray(r)){const c=new Array(r.length);for(let l=0;l<r.length;l++)c[l]=Ry(r[l],o);return c}else if(typeof r=="object"&&!(r instanceof Date)){const c={};for(const l in r)Object.prototype.hasOwnProperty.call(r,l)&&(c[l]=Ry(r[l],o));return c}return r}function Tz(r,o){return r.data=vy(r.data,o),delete r.attachments,r}function vy(r,o){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<o.length)return o[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let c=0;c<r.length;c++)r[c]=vy(r[c],o);else if(typeof r=="object")for(const c in r)Object.prototype.hasOwnProperty.call(r,c)&&(r[c]=vy(r[c],o));return r}const yz=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Rz=5;var qe;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(qe||(qe={}));class vz{constructor(o){this.replacer=o}encode(o){return(o.type===qe.EVENT||o.type===qe.ACK)&&E_(o)?this.encodeAsBinary({type:o.type===qe.EVENT?qe.BINARY_EVENT:qe.BINARY_ACK,nsp:o.nsp,data:o.data,id:o.id}):[this.encodeAsString(o)]}encodeAsString(o){let c=""+o.type;return(o.type===qe.BINARY_EVENT||o.type===qe.BINARY_ACK)&&(c+=o.attachments+"-"),o.nsp&&o.nsp!=="/"&&(c+=o.nsp+","),o.id!=null&&(c+=o.id),o.data!=null&&(c+=JSON.stringify(o.data,this.replacer)),c}encodeAsBinary(o){const c=Sz(o),l=this.encodeAsString(c.packet),f=c.buffers;return f.unshift(l),f}}function gP(r){return Object.prototype.toString.call(r)==="[object Object]"}class wR extends vi{constructor(o){super(),this.reviver=o}add(o){let c;if(typeof o=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");c=this.decodeString(o);const l=c.type===qe.BINARY_EVENT;l||c.type===qe.BINARY_ACK?(c.type=l?qe.EVENT:qe.ACK,this.reconstructor=new Cz(c),c.attachments===0&&super.emitReserved("decoded",c)):super.emitReserved("decoded",c)}else if(bR(o)||o.base64)if(this.reconstructor)c=this.reconstructor.takeBinaryData(o),c&&(this.reconstructor=null,super.emitReserved("decoded",c));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+o)}decodeString(o){let c=0;const l={type:Number(o.charAt(0))};if(qe[l.type]===void 0)throw new Error("unknown packet type "+l.type);if(l.type===qe.BINARY_EVENT||l.type===qe.BINARY_ACK){const E=c+1;for(;o.charAt(++c)!=="-"&&c!=o.length;);const T=o.substring(E,c);if(T!=Number(T)||o.charAt(c)!=="-")throw new Error("Illegal attachments");l.attachments=Number(T)}if(o.charAt(c+1)==="/"){const E=c+1;for(;++c&&!(o.charAt(c)===","||c===o.length););l.nsp=o.substring(E,c)}else l.nsp="/";const f=o.charAt(c+1);if(f!==""&&Number(f)==f){const E=c+1;for(;++c;){const T=o.charAt(c);if(T==null||Number(T)!=T){--c;break}if(c===o.length)break}l.id=Number(o.substring(E,c+1))}if(o.charAt(++c)){const E=this.tryParse(o.substr(c));if(wR.isPayloadValid(l.type,E))l.data=E;else throw new Error("invalid payload")}return l}tryParse(o){try{return JSON.parse(o,this.reviver)}catch{return!1}}static isPayloadValid(o,c){switch(o){case qe.CONNECT:return gP(c);case qe.DISCONNECT:return c===void 0;case qe.CONNECT_ERROR:return typeof c=="string"||gP(c);case qe.EVENT:case qe.BINARY_EVENT:return Array.isArray(c)&&(typeof c[0]=="number"||typeof c[0]=="string"&&yz.indexOf(c[0])===-1);case qe.ACK:case qe.BINARY_ACK:return Array.isArray(c)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Cz{constructor(o){this.packet=o,this.buffers=[],this.reconPack=o}takeBinaryData(o){if(this.buffers.push(o),this.buffers.length===this.reconPack.attachments){const c=Tz(this.reconPack,this.buffers);return this.finishedReconstruction(),c}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Iz=Object.freeze(Object.defineProperty({__proto__:null,Decoder:wR,Encoder:vz,get PacketType(){return qe},protocol:Rz},Symbol.toStringTag,{value:"Module"}));function Ms(r,o,c){return r.on(o,c),function(){r.off(o,c)}}const bz=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class eM extends vi{constructor(o,c,l){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=o,this.nsp=c,l&&l.auth&&(this.auth=l.auth),this._opts=Object.assign({},l),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const o=this.io;this.subs=[Ms(o,"open",this.onopen.bind(this)),Ms(o,"packet",this.onpacket.bind(this)),Ms(o,"error",this.onerror.bind(this)),Ms(o,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...o){return o.unshift("message"),this.emit.apply(this,o),this}emit(o,...c){if(bz.hasOwnProperty(o))throw new Error('"'+o.toString()+'" is a reserved event name');if(c.unshift(o),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(c),this;const l={type:qe.EVENT,data:c};if(l.options={},l.options.compress=this.flags.compress!==!1,typeof c[c.length-1]=="function"){const T=this.ids++,w=c.pop();this._registerAckCallback(T,w),l.id=T}const f=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!f||!this.connected)||(this.connected?(this.notifyOutgoingListeners(l),this.packet(l)):this.sendBuffer.push(l)),this.flags={},this}_registerAckCallback(o,c){var l;const f=(l=this.flags.timeout)!==null&&l!==void 0?l:this._opts.ackTimeout;if(f===void 0){this.acks[o]=c;return}const E=this.io.setTimeoutFn(()=>{delete this.acks[o];for(let T=0;T<this.sendBuffer.length;T++)this.sendBuffer[T].id===o&&this.sendBuffer.splice(T,1);c.call(this,new Error("operation has timed out"))},f);this.acks[o]=(...T)=>{this.io.clearTimeoutFn(E),c.apply(this,[null,...T])}}emitWithAck(o,...c){const l=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((f,E)=>{c.push((T,w)=>l?T?E(T):f(w):f(T)),this.emit(o,...c)})}_addToQueue(o){let c;typeof o[o.length-1]=="function"&&(c=o.pop());const l={id:this._queueSeq++,tryCount:0,pending:!1,args:o,flags:Object.assign({fromQueue:!0},this.flags)};o.push((f,...E)=>l!==this._queue[0]?void 0:(f!==null?l.tryCount>this._opts.retries&&(this._queue.shift(),c&&c(f)):(this._queue.shift(),c&&c(null,...E)),l.pending=!1,this._drainQueue())),this._queue.push(l),this._drainQueue()}_drainQueue(o=!1){if(!this.connected||this._queue.length===0)return;const c=this._queue[0];c.pending&&!o||(c.pending=!0,c.tryCount++,this.flags=c.flags,this.emit.apply(this,c.args))}packet(o){o.nsp=this.nsp,this.io._packet(o)}onopen(){typeof this.auth=="function"?this.auth(o=>{this._sendConnectPacket(o)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(o){this.packet({type:qe.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},o):o})}onerror(o){this.connected||this.emitReserved("connect_error",o)}onclose(o,c){this.connected=!1,delete this.id,this.emitReserved("disconnect",o,c)}onpacket(o){if(o.nsp===this.nsp)switch(o.type){case qe.CONNECT:o.data&&o.data.sid?this.onconnect(o.data.sid,o.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case qe.EVENT:case qe.BINARY_EVENT:this.onevent(o);break;case qe.ACK:case qe.BINARY_ACK:this.onack(o);break;case qe.DISCONNECT:this.ondisconnect();break;case qe.CONNECT_ERROR:this.destroy();const l=new Error(o.data.message);l.data=o.data.data,this.emitReserved("connect_error",l);break}}onevent(o){const c=o.data||[];o.id!=null&&c.push(this.ack(o.id)),this.connected?this.emitEvent(c):this.receiveBuffer.push(Object.freeze(c))}emitEvent(o){if(this._anyListeners&&this._anyListeners.length){const c=this._anyListeners.slice();for(const l of c)l.apply(this,o)}super.emit.apply(this,o),this._pid&&o.length&&typeof o[o.length-1]=="string"&&(this._lastOffset=o[o.length-1])}ack(o){const c=this;let l=!1;return function(...f){l||(l=!0,c.packet({type:qe.ACK,id:o,data:f}))}}onack(o){const c=this.acks[o.id];typeof c=="function"&&(c.apply(this,o.data),delete this.acks[o.id])}onconnect(o,c){this.id=o,this.recovered=c&&this._pid===c,this._pid=c,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(o=>this.emitEvent(o)),this.receiveBuffer=[],this.sendBuffer.forEach(o=>{this.notifyOutgoingListeners(o),this.packet(o)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(o=>o()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:qe.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(o){return this.flags.compress=o,this}get volatile(){return this.flags.volatile=!0,this}timeout(o){return this.flags.timeout=o,this}onAny(o){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(o),this}prependAny(o){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(o),this}offAny(o){if(!this._anyListeners)return this;if(o){const c=this._anyListeners;for(let l=0;l<c.length;l++)if(o===c[l])return c.splice(l,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(o){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(o),this}prependAnyOutgoing(o){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(o),this}offAnyOutgoing(o){if(!this._anyOutgoingListeners)return this;if(o){const c=this._anyOutgoingListeners;for(let l=0;l<c.length;l++)if(o===c[l])return c.splice(l,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(o){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const c=this._anyOutgoingListeners.slice();for(const l of c)l.apply(this,o.data)}}}function Vl(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}Vl.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var o=Math.random(),c=Math.floor(o*this.jitter*r);r=Math.floor(o*10)&1?r+c:r-c}return Math.min(r,this.max)|0};Vl.prototype.reset=function(){this.attempts=0};Vl.prototype.setMin=function(r){this.ms=r};Vl.prototype.setMax=function(r){this.max=r};Vl.prototype.setJitter=function(r){this.jitter=r};class Cy extends vi{constructor(o,c){var l;super(),this.nsps={},this.subs=[],o&&typeof o=="object"&&(c=o,o=void 0),c=c||{},c.path=c.path||"/socket.io",this.opts=c,fm(this,c),this.reconnection(c.reconnection!==!1),this.reconnectionAttempts(c.reconnectionAttempts||1/0),this.reconnectionDelay(c.reconnectionDelay||1e3),this.reconnectionDelayMax(c.reconnectionDelayMax||5e3),this.randomizationFactor((l=c.randomizationFactor)!==null&&l!==void 0?l:.5),this.backoff=new Vl({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(c.timeout==null?2e4:c.timeout),this._readyState="closed",this.uri=o;const f=c.parser||Iz;this.encoder=new f.Encoder,this.decoder=new f.Decoder,this._autoConnect=c.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(o){return arguments.length?(this._reconnection=!!o,this):this._reconnection}reconnectionAttempts(o){return o===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=o,this)}reconnectionDelay(o){var c;return o===void 0?this._reconnectionDelay:(this._reconnectionDelay=o,(c=this.backoff)===null||c===void 0||c.setMin(o),this)}randomizationFactor(o){var c;return o===void 0?this._randomizationFactor:(this._randomizationFactor=o,(c=this.backoff)===null||c===void 0||c.setJitter(o),this)}reconnectionDelayMax(o){var c;return o===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=o,(c=this.backoff)===null||c===void 0||c.setMax(o),this)}timeout(o){return arguments.length?(this._timeout=o,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(o){if(~this._readyState.indexOf("open"))return this;this.engine=new ZL(this.uri,this.opts);const c=this.engine,l=this;this._readyState="opening",this.skipReconnect=!1;const f=Ms(c,"open",function(){l.onopen(),o&&o()}),E=w=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",w),o?o(w):this.maybeReconnectOnOpen()},T=Ms(c,"error",E);if(this._timeout!==!1){const w=this._timeout,N=this.setTimeoutFn(()=>{f(),E(new Error("timeout")),c.close()},w);this.opts.autoUnref&&N.unref(),this.subs.push(()=>{this.clearTimeoutFn(N)})}return this.subs.push(f),this.subs.push(T),this}connect(o){return this.open(o)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const o=this.engine;this.subs.push(Ms(o,"ping",this.onping.bind(this)),Ms(o,"data",this.ondata.bind(this)),Ms(o,"error",this.onerror.bind(this)),Ms(o,"close",this.onclose.bind(this)),Ms(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(o){try{this.decoder.add(o)}catch(c){this.onclose("parse error",c)}}ondecoded(o){IR(()=>{this.emitReserved("packet",o)},this.setTimeoutFn)}onerror(o){this.emitReserved("error",o)}socket(o,c){let l=this.nsps[o];return l?this._autoConnect&&!l.active&&l.connect():(l=new eM(this,o,c),this.nsps[o]=l),l}_destroy(o){const c=Object.keys(this.nsps);for(const l of c)if(this.nsps[l].active)return;this._close()}_packet(o){const c=this.encoder.encode(o);for(let l=0;l<c.length;l++)this.engine.write(c[l],o.options)}cleanup(){this.subs.forEach(o=>o()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(o,c){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",o,c),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const o=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const c=this.backoff.duration();this._reconnecting=!0;const l=this.setTimeoutFn(()=>{o.skipReconnect||(this.emitReserved("reconnect_attempt",o.backoff.attempts),!o.skipReconnect&&o.open(f=>{f?(o._reconnecting=!1,o.reconnect(),this.emitReserved("reconnect_error",f)):o.onreconnect()}))},c);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}}onreconnect(){const o=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",o)}}const Xu={};function BT(r,o){typeof r=="object"&&(o=r,r=void 0),o=o||{};const c=fz(r,o.path||"/socket.io"),l=c.source,f=c.id,E=c.path,T=Xu[f]&&E in Xu[f].nsps,w=o.forceNew||o["force new connection"]||o.multiplex===!1||T;let N;return w?N=new Cy(l,o):(Xu[f]||(Xu[f]=new Cy(l,o)),N=Xu[f]),c.query&&!o.query&&(o.query=c.queryKey),N.socket(c.path,o)}Object.assign(BT,{Manager:Cy,Socket:eM,io:BT,connect:BT});function nM(r,o){return function(){return r.apply(o,arguments)}}const{toString:wz}=Object.prototype,{getPrototypeOf:AR}=Object,_m=(r=>o=>{const c=wz.call(o);return r[c]||(r[c]=c.slice(8,-1).toLowerCase())})(Object.create(null)),To=r=>(r=r.toLowerCase(),o=>_m(o)===r),mm=r=>o=>typeof o===r,{isArray:Fl}=Array,Ih=mm("undefined");function Az(r){return r!==null&&!Ih(r)&&r.constructor!==null&&!Ih(r.constructor)&&Cs(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const iM=To("ArrayBuffer");function Oz(r){let o;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?o=ArrayBuffer.isView(r):o=r&&r.buffer&&iM(r.buffer),o}const Nz=mm("string"),Cs=mm("function"),rM=mm("number"),Em=r=>r!==null&&typeof r=="object",Dz=r=>r===!0||r===!1,g_=r=>{if(_m(r)!=="object")return!1;const o=AR(r);return(o===null||o===Object.prototype||Object.getPrototypeOf(o)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},Pz=To("Date"),kz=To("File"),Lz=To("Blob"),Mz=To("FileList"),Uz=r=>Em(r)&&Cs(r.pipe),xz=r=>{let o;return r&&(typeof FormData=="function"&&r instanceof FormData||Cs(r.append)&&((o=_m(r))==="formdata"||o==="object"&&Cs(r.toString)&&r.toString()==="[object FormData]"))},Vz=To("URLSearchParams"),Fz=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function xh(r,o,{allOwnKeys:c=!1}={}){if(r===null||typeof r>"u")return;let l,f;if(typeof r!="object"&&(r=[r]),Fl(r))for(l=0,f=r.length;l<f;l++)o.call(null,r[l],l,r);else{const E=c?Object.getOwnPropertyNames(r):Object.keys(r),T=E.length;let w;for(l=0;l<T;l++)w=E[l],o.call(null,r[w],w,r)}}function sM(r,o){o=o.toLowerCase();const c=Object.keys(r);let l=c.length,f;for(;l-- >0;)if(f=c[l],o===f.toLowerCase())return f;return null}const oM=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),aM=r=>!Ih(r)&&r!==oM;function Iy(){const{caseless:r}=aM(this)&&this||{},o={},c=(l,f)=>{const E=r&&sM(o,f)||f;g_(o[E])&&g_(l)?o[E]=Iy(o[E],l):g_(l)?o[E]=Iy({},l):Fl(l)?o[E]=l.slice():o[E]=l};for(let l=0,f=arguments.length;l<f;l++)arguments[l]&&xh(arguments[l],c);return o}const Bz=(r,o,c,{allOwnKeys:l}={})=>(xh(o,(f,E)=>{c&&Cs(f)?r[E]=nM(f,c):r[E]=f},{allOwnKeys:l}),r),jz=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),Wz=(r,o,c,l)=>{r.prototype=Object.create(o.prototype,l),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:o.prototype}),c&&Object.assign(r.prototype,c)},Gz=(r,o,c,l)=>{let f,E,T;const w={};if(o=o||{},r==null)return o;do{for(f=Object.getOwnPropertyNames(r),E=f.length;E-- >0;)T=f[E],(!l||l(T,r,o))&&!w[T]&&(o[T]=r[T],w[T]=!0);r=c!==!1&&AR(r)}while(r&&(!c||c(r,o))&&r!==Object.prototype);return o},Hz=(r,o,c)=>{r=String(r),(c===void 0||c>r.length)&&(c=r.length),c-=o.length;const l=r.indexOf(o,c);return l!==-1&&l===c},Yz=r=>{if(!r)return null;if(Fl(r))return r;let o=r.length;if(!rM(o))return null;const c=new Array(o);for(;o-- >0;)c[o]=r[o];return c},Kz=(r=>o=>r&&o instanceof r)(typeof Uint8Array<"u"&&AR(Uint8Array)),qz=(r,o)=>{const l=(r&&r[Symbol.iterator]).call(r);let f;for(;(f=l.next())&&!f.done;){const E=f.value;o.call(r,E[0],E[1])}},zz=(r,o)=>{let c;const l=[];for(;(c=r.exec(o))!==null;)l.push(c);return l},Jz=To("HTMLFormElement"),Xz=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(c,l,f){return l.toUpperCase()+f}),SP=(({hasOwnProperty:r})=>(o,c)=>r.call(o,c))(Object.prototype),Qz=To("RegExp"),cM=(r,o)=>{const c=Object.getOwnPropertyDescriptors(r),l={};xh(c,(f,E)=>{let T;(T=o(f,E,r))!==!1&&(l[E]=T||f)}),Object.defineProperties(r,l)},$z=r=>{cM(r,(o,c)=>{if(Cs(r)&&["arguments","caller","callee"].indexOf(c)!==-1)return!1;const l=r[c];if(Cs(l)){if(o.enumerable=!1,"writable"in o){o.writable=!1;return}o.set||(o.set=()=>{throw Error("Can not rewrite read-only method '"+c+"'")})}})},Zz=(r,o)=>{const c={},l=f=>{f.forEach(E=>{c[E]=!0})};return Fl(r)?l(r):l(String(r).split(o)),c},tJ=()=>{},eJ=(r,o)=>(r=+r,Number.isFinite(r)?r:o),jT="abcdefghijklmnopqrstuvwxyz",TP="0123456789",dM={DIGIT:TP,ALPHA:jT,ALPHA_DIGIT:jT+jT.toUpperCase()+TP},nJ=(r=16,o=dM.ALPHA_DIGIT)=>{let c="";const{length:l}=o;for(;r--;)c+=o[Math.random()*l|0];return c};function iJ(r){return!!(r&&Cs(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}const rJ=r=>{const o=new Array(10),c=(l,f)=>{if(Em(l)){if(o.indexOf(l)>=0)return;if(!("toJSON"in l)){o[f]=l;const E=Fl(l)?[]:{};return xh(l,(T,w)=>{const N=c(T,f+1);!Ih(N)&&(E[w]=N)}),o[f]=void 0,E}}return l};return c(r,0)},sJ=To("AsyncFunction"),oJ=r=>r&&(Em(r)||Cs(r))&&Cs(r.then)&&Cs(r.catch),Et={isArray:Fl,isArrayBuffer:iM,isBuffer:Az,isFormData:xz,isArrayBufferView:Oz,isString:Nz,isNumber:rM,isBoolean:Dz,isObject:Em,isPlainObject:g_,isUndefined:Ih,isDate:Pz,isFile:kz,isBlob:Lz,isRegExp:Qz,isFunction:Cs,isStream:Uz,isURLSearchParams:Vz,isTypedArray:Kz,isFileList:Mz,forEach:xh,merge:Iy,extend:Bz,trim:Fz,stripBOM:jz,inherits:Wz,toFlatObject:Gz,kindOf:_m,kindOfTest:To,endsWith:Hz,toArray:Yz,forEachEntry:qz,matchAll:zz,isHTMLForm:Jz,hasOwnProperty:SP,hasOwnProp:SP,reduceDescriptors:cM,freezeMethods:$z,toObjectSet:Zz,toCamelCase:Xz,noop:tJ,toFiniteNumber:eJ,findKey:sM,global:oM,isContextDefined:aM,ALPHABET:dM,generateString:nJ,isSpecCompliantForm:iJ,toJSONObject:rJ,isAsyncFn:sJ,isThenable:oJ};function Xe(r,o,c,l,f){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",o&&(this.code=o),c&&(this.config=c),l&&(this.request=l),f&&(this.response=f)}Et.inherits(Xe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Et.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const lM=Xe.prototype,uM={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{uM[r]={value:r}});Object.defineProperties(Xe,uM);Object.defineProperty(lM,"isAxiosError",{value:!0});Xe.from=(r,o,c,l,f,E)=>{const T=Object.create(lM);return Et.toFlatObject(r,T,function(N){return N!==Error.prototype},w=>w!=="isAxiosError"),Xe.call(T,r.message,o,c,l,f),T.cause=r,T.name=r.name,E&&Object.assign(T,E),T};const aJ=null;function by(r){return Et.isPlainObject(r)||Et.isArray(r)}function hM(r){return Et.endsWith(r,"[]")?r.slice(0,-2):r}function yP(r,o,c){return r?r.concat(o).map(function(f,E){return f=hM(f),!c&&E?"["+f+"]":f}).join(c?".":""):o}function cJ(r){return Et.isArray(r)&&!r.some(by)}const dJ=Et.toFlatObject(Et,{},null,function(o){return/^is[A-Z]/.test(o)});function gm(r,o,c){if(!Et.isObject(r))throw new TypeError("target must be an object");o=o||new FormData,c=Et.toFlatObject(c,{metaTokens:!0,dots:!1,indexes:!1},!1,function(at,Ot){return!Et.isUndefined(Ot[at])});const l=c.metaTokens,f=c.visitor||k,E=c.dots,T=c.indexes,N=(c.Blob||typeof Blob<"u"&&Blob)&&Et.isSpecCompliantForm(o);if(!Et.isFunction(f))throw new TypeError("visitor must be a function");function D(rt){if(rt===null)return"";if(Et.isDate(rt))return rt.toISOString();if(!N&&Et.isBlob(rt))throw new Xe("Blob is not supported. Use a Buffer instead.");return Et.isArrayBuffer(rt)||Et.isTypedArray(rt)?N&&typeof Blob=="function"?new Blob([rt]):Buffer.from(rt):rt}function k(rt,at,Ot){let wt=rt;if(rt&&!Ot&&typeof rt=="object"){if(Et.endsWith(at,"{}"))at=l?at:at.slice(0,-2),rt=JSON.stringify(rt);else if(Et.isArray(rt)&&cJ(rt)||(Et.isFileList(rt)||Et.endsWith(at,"[]"))&&(wt=Et.toArray(rt)))return at=hM(at),wt.forEach(function(it,Q){!(Et.isUndefined(it)||it===null)&&o.append(T===!0?yP([at],Q,E):T===null?at:at+"[]",D(it))}),!1}return by(rt)?!0:(o.append(yP(Ot,at,E),D(rt)),!1)}const M=[],j=Object.assign(dJ,{defaultVisitor:k,convertValue:D,isVisitable:by});function nt(rt,at){if(!Et.isUndefined(rt)){if(M.indexOf(rt)!==-1)throw Error("Circular reference detected in "+at.join("."));M.push(rt),Et.forEach(rt,function(wt,dt){(!(Et.isUndefined(wt)||wt===null)&&f.call(o,wt,Et.isString(dt)?dt.trim():dt,at,j))===!0&&nt(wt,at?at.concat(dt):[dt])}),M.pop()}}if(!Et.isObject(r))throw new TypeError("data must be an object");return nt(r),o}function RP(r){const o={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(l){return o[l]})}function OR(r,o){this._pairs=[],r&&gm(r,this,o)}const pM=OR.prototype;pM.append=function(o,c){this._pairs.push([o,c])};pM.toString=function(o){const c=o?function(l){return o.call(this,l,RP)}:RP;return this._pairs.map(function(f){return c(f[0])+"="+c(f[1])},"").join("&")};function lJ(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function fM(r,o,c){if(!o)return r;const l=c&&c.encode||lJ,f=c&&c.serialize;let E;if(f?E=f(o,c):E=Et.isURLSearchParams(o)?o.toString():new OR(o,c).toString(l),E){const T=r.indexOf("#");T!==-1&&(r=r.slice(0,T)),r+=(r.indexOf("?")===-1?"?":"&")+E}return r}class uJ{constructor(){this.handlers=[]}use(o,c,l){return this.handlers.push({fulfilled:o,rejected:c,synchronous:l?l.synchronous:!1,runWhen:l?l.runWhen:null}),this.handlers.length-1}eject(o){this.handlers[o]&&(this.handlers[o]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(o){Et.forEach(this.handlers,function(l){l!==null&&o(l)})}}const vP=uJ,_M={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},hJ=typeof URLSearchParams<"u"?URLSearchParams:OR,pJ=typeof FormData<"u"?FormData:null,fJ=typeof Blob<"u"?Blob:null,_J={isBrowser:!0,classes:{URLSearchParams:hJ,FormData:pJ,Blob:fJ},protocols:["http","https","file","blob","url","data"]},mM=typeof window<"u"&&typeof document<"u",mJ=(r=>mM&&["ReactNative","NativeScript","NS"].indexOf(r)<0)(typeof navigator<"u"&&navigator.product),EJ=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),gJ=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:mM,hasStandardBrowserEnv:mJ,hasStandardBrowserWebWorkerEnv:EJ},Symbol.toStringTag,{value:"Module"})),fo={...gJ,..._J};function SJ(r,o){return gm(r,new fo.classes.URLSearchParams,Object.assign({visitor:function(c,l,f,E){return fo.isNode&&Et.isBuffer(c)?(this.append(l,c.toString("base64")),!1):E.defaultVisitor.apply(this,arguments)}},o))}function TJ(r){return Et.matchAll(/\w+|\[(\w*)]/g,r).map(o=>o[0]==="[]"?"":o[1]||o[0])}function yJ(r){const o={},c=Object.keys(r);let l;const f=c.length;let E;for(l=0;l<f;l++)E=c[l],o[E]=r[E];return o}function EM(r){function o(c,l,f,E){let T=c[E++];const w=Number.isFinite(+T),N=E>=c.length;return T=!T&&Et.isArray(f)?f.length:T,N?(Et.hasOwnProp(f,T)?f[T]=[f[T],l]:f[T]=l,!w):((!f[T]||!Et.isObject(f[T]))&&(f[T]=[]),o(c,l,f[T],E)&&Et.isArray(f[T])&&(f[T]=yJ(f[T])),!w)}if(Et.isFormData(r)&&Et.isFunction(r.entries)){const c={};return Et.forEachEntry(r,(l,f)=>{o(TJ(l),f,c,0)}),c}return null}function RJ(r,o,c){if(Et.isString(r))try{return(o||JSON.parse)(r),Et.trim(r)}catch(l){if(l.name!=="SyntaxError")throw l}return(c||JSON.stringify)(r)}const NR={transitional:_M,adapter:["xhr","http"],transformRequest:[function(o,c){const l=c.getContentType()||"",f=l.indexOf("application/json")>-1,E=Et.isObject(o);if(E&&Et.isHTMLForm(o)&&(o=new FormData(o)),Et.isFormData(o))return f&&f?JSON.stringify(EM(o)):o;if(Et.isArrayBuffer(o)||Et.isBuffer(o)||Et.isStream(o)||Et.isFile(o)||Et.isBlob(o))return o;if(Et.isArrayBufferView(o))return o.buffer;if(Et.isURLSearchParams(o))return c.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),o.toString();let w;if(E){if(l.indexOf("application/x-www-form-urlencoded")>-1)return SJ(o,this.formSerializer).toString();if((w=Et.isFileList(o))||l.indexOf("multipart/form-data")>-1){const N=this.env&&this.env.FormData;return gm(w?{"files[]":o}:o,N&&new N,this.formSerializer)}}return E||f?(c.setContentType("application/json",!1),RJ(o)):o}],transformResponse:[function(o){const c=this.transitional||NR.transitional,l=c&&c.forcedJSONParsing,f=this.responseType==="json";if(o&&Et.isString(o)&&(l&&!this.responseType||f)){const T=!(c&&c.silentJSONParsing)&&f;try{return JSON.parse(o)}catch(w){if(T)throw w.name==="SyntaxError"?Xe.from(w,Xe.ERR_BAD_RESPONSE,this,null,this.response):w}}return o}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:fo.classes.FormData,Blob:fo.classes.Blob},validateStatus:function(o){return o>=200&&o<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Et.forEach(["delete","get","head","post","put","patch"],r=>{NR.headers[r]={}});const DR=NR,vJ=Et.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),CJ=r=>{const o={};let c,l,f;return r&&r.split(`
`).forEach(function(T){f=T.indexOf(":"),c=T.substring(0,f).trim().toLowerCase(),l=T.substring(f+1).trim(),!(!c||o[c]&&vJ[c])&&(c==="set-cookie"?o[c]?o[c].push(l):o[c]=[l]:o[c]=o[c]?o[c]+", "+l:l)}),o},CP=Symbol("internals");function Qu(r){return r&&String(r).trim().toLowerCase()}function S_(r){return r===!1||r==null?r:Et.isArray(r)?r.map(S_):String(r)}function IJ(r){const o=Object.create(null),c=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let l;for(;l=c.exec(r);)o[l[1]]=l[2];return o}const bJ=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function WT(r,o,c,l,f){if(Et.isFunction(l))return l.call(this,o,c);if(f&&(o=c),!!Et.isString(o)){if(Et.isString(l))return o.indexOf(l)!==-1;if(Et.isRegExp(l))return l.test(o)}}function wJ(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(o,c,l)=>c.toUpperCase()+l)}function AJ(r,o){const c=Et.toCamelCase(" "+o);["get","set","has"].forEach(l=>{Object.defineProperty(r,l+c,{value:function(f,E,T){return this[l].call(this,o,f,E,T)},configurable:!0})})}class Sm{constructor(o){o&&this.set(o)}set(o,c,l){const f=this;function E(w,N,D){const k=Qu(N);if(!k)throw new Error("header name must be a non-empty string");const M=Et.findKey(f,k);(!M||f[M]===void 0||D===!0||D===void 0&&f[M]!==!1)&&(f[M||N]=S_(w))}const T=(w,N)=>Et.forEach(w,(D,k)=>E(D,k,N));return Et.isPlainObject(o)||o instanceof this.constructor?T(o,c):Et.isString(o)&&(o=o.trim())&&!bJ(o)?T(CJ(o),c):o!=null&&E(c,o,l),this}get(o,c){if(o=Qu(o),o){const l=Et.findKey(this,o);if(l){const f=this[l];if(!c)return f;if(c===!0)return IJ(f);if(Et.isFunction(c))return c.call(this,f,l);if(Et.isRegExp(c))return c.exec(f);throw new TypeError("parser must be boolean|regexp|function")}}}has(o,c){if(o=Qu(o),o){const l=Et.findKey(this,o);return!!(l&&this[l]!==void 0&&(!c||WT(this,this[l],l,c)))}return!1}delete(o,c){const l=this;let f=!1;function E(T){if(T=Qu(T),T){const w=Et.findKey(l,T);w&&(!c||WT(l,l[w],w,c))&&(delete l[w],f=!0)}}return Et.isArray(o)?o.forEach(E):E(o),f}clear(o){const c=Object.keys(this);let l=c.length,f=!1;for(;l--;){const E=c[l];(!o||WT(this,this[E],E,o,!0))&&(delete this[E],f=!0)}return f}normalize(o){const c=this,l={};return Et.forEach(this,(f,E)=>{const T=Et.findKey(l,E);if(T){c[T]=S_(f),delete c[E];return}const w=o?wJ(E):String(E).trim();w!==E&&delete c[E],c[w]=S_(f),l[w]=!0}),this}concat(...o){return this.constructor.concat(this,...o)}toJSON(o){const c=Object.create(null);return Et.forEach(this,(l,f)=>{l!=null&&l!==!1&&(c[f]=o&&Et.isArray(l)?l.join(", "):l)}),c}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([o,c])=>o+": "+c).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(o){return o instanceof this?o:new this(o)}static concat(o,...c){const l=new this(o);return c.forEach(f=>l.set(f)),l}static accessor(o){const l=(this[CP]=this[CP]={accessors:{}}).accessors,f=this.prototype;function E(T){const w=Qu(T);l[w]||(AJ(f,T),l[w]=!0)}return Et.isArray(o)?o.forEach(E):E(o),this}}Sm.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Et.reduceDescriptors(Sm.prototype,({value:r},o)=>{let c=o[0].toUpperCase()+o.slice(1);return{get:()=>r,set(l){this[c]=l}}});Et.freezeMethods(Sm);const Xo=Sm;function GT(r,o){const c=this||DR,l=o||c,f=Xo.from(l.headers);let E=l.data;return Et.forEach(r,function(w){E=w.call(c,E,f.normalize(),o?o.status:void 0)}),f.normalize(),E}function gM(r){return!!(r&&r.__CANCEL__)}function Vh(r,o,c){Xe.call(this,r??"canceled",Xe.ERR_CANCELED,o,c),this.name="CanceledError"}Et.inherits(Vh,Xe,{__CANCEL__:!0});function OJ(r,o,c){const l=c.config.validateStatus;!c.status||!l||l(c.status)?r(c):o(new Xe("Request failed with status code "+c.status,[Xe.ERR_BAD_REQUEST,Xe.ERR_BAD_RESPONSE][Math.floor(c.status/100)-4],c.config,c.request,c))}const NJ=fo.hasStandardBrowserEnv?{write(r,o,c,l,f,E){const T=[r+"="+encodeURIComponent(o)];Et.isNumber(c)&&T.push("expires="+new Date(c).toGMTString()),Et.isString(l)&&T.push("path="+l),Et.isString(f)&&T.push("domain="+f),E===!0&&T.push("secure"),document.cookie=T.join("; ")},read(r){const o=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return o?decodeURIComponent(o[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function DJ(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function PJ(r,o){return o?r.replace(/\/+$/,"")+"/"+o.replace(/^\/+/,""):r}function SM(r,o){return r&&!DJ(o)?PJ(r,o):o}const kJ=fo.hasStandardBrowserEnv?function(){const o=/(msie|trident)/i.test(navigator.userAgent),c=document.createElement("a");let l;function f(E){let T=E;return o&&(c.setAttribute("href",T),T=c.href),c.setAttribute("href",T),{href:c.href,protocol:c.protocol?c.protocol.replace(/:$/,""):"",host:c.host,search:c.search?c.search.replace(/^\?/,""):"",hash:c.hash?c.hash.replace(/^#/,""):"",hostname:c.hostname,port:c.port,pathname:c.pathname.charAt(0)==="/"?c.pathname:"/"+c.pathname}}return l=f(window.location.href),function(T){const w=Et.isString(T)?f(T):T;return w.protocol===l.protocol&&w.host===l.host}}():function(){return function(){return!0}}();function LJ(r){const o=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return o&&o[1]||""}function MJ(r,o){r=r||10;const c=new Array(r),l=new Array(r);let f=0,E=0,T;return o=o!==void 0?o:1e3,function(N){const D=Date.now(),k=l[E];T||(T=D),c[f]=N,l[f]=D;let M=E,j=0;for(;M!==f;)j+=c[M++],M=M%r;if(f=(f+1)%r,f===E&&(E=(E+1)%r),D-T<o)return;const nt=k&&D-k;return nt?Math.round(j*1e3/nt):void 0}}function IP(r,o){let c=0;const l=MJ(50,250);return f=>{const E=f.loaded,T=f.lengthComputable?f.total:void 0,w=E-c,N=l(w),D=E<=T;c=E;const k={loaded:E,total:T,progress:T?E/T:void 0,bytes:w,rate:N||void 0,estimated:N&&T&&D?(T-E)/N:void 0,event:f};k[o?"download":"upload"]=!0,r(k)}}const UJ=typeof XMLHttpRequest<"u",xJ=UJ&&function(r){return new Promise(function(c,l){let f=r.data;const E=Xo.from(r.headers).normalize();let{responseType:T,withXSRFToken:w}=r,N;function D(){r.cancelToken&&r.cancelToken.unsubscribe(N),r.signal&&r.signal.removeEventListener("abort",N)}let k;if(Et.isFormData(f)){if(fo.hasStandardBrowserEnv||fo.hasStandardBrowserWebWorkerEnv)E.setContentType(!1);else if((k=E.getContentType())!==!1){const[at,...Ot]=k?k.split(";").map(wt=>wt.trim()).filter(Boolean):[];E.setContentType([at||"multipart/form-data",...Ot].join("; "))}}let M=new XMLHttpRequest;if(r.auth){const at=r.auth.username||"",Ot=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";E.set("Authorization","Basic "+btoa(at+":"+Ot))}const j=SM(r.baseURL,r.url);M.open(r.method.toUpperCase(),fM(j,r.params,r.paramsSerializer),!0),M.timeout=r.timeout;function nt(){if(!M)return;const at=Xo.from("getAllResponseHeaders"in M&&M.getAllResponseHeaders()),wt={data:!T||T==="text"||T==="json"?M.responseText:M.response,status:M.status,statusText:M.statusText,headers:at,config:r,request:M};OJ(function(it){c(it),D()},function(it){l(it),D()},wt),M=null}if("onloadend"in M?M.onloadend=nt:M.onreadystatechange=function(){!M||M.readyState!==4||M.status===0&&!(M.responseURL&&M.responseURL.indexOf("file:")===0)||setTimeout(nt)},M.onabort=function(){M&&(l(new Xe("Request aborted",Xe.ECONNABORTED,r,M)),M=null)},M.onerror=function(){l(new Xe("Network Error",Xe.ERR_NETWORK,r,M)),M=null},M.ontimeout=function(){let Ot=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const wt=r.transitional||_M;r.timeoutErrorMessage&&(Ot=r.timeoutErrorMessage),l(new Xe(Ot,wt.clarifyTimeoutError?Xe.ETIMEDOUT:Xe.ECONNABORTED,r,M)),M=null},fo.hasStandardBrowserEnv&&(w&&Et.isFunction(w)&&(w=w(r)),w||w!==!1&&kJ(j))){const at=r.xsrfHeaderName&&r.xsrfCookieName&&NJ.read(r.xsrfCookieName);at&&E.set(r.xsrfHeaderName,at)}f===void 0&&E.setContentType(null),"setRequestHeader"in M&&Et.forEach(E.toJSON(),function(Ot,wt){M.setRequestHeader(wt,Ot)}),Et.isUndefined(r.withCredentials)||(M.withCredentials=!!r.withCredentials),T&&T!=="json"&&(M.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&M.addEventListener("progress",IP(r.onDownloadProgress,!0)),typeof r.onUploadProgress=="function"&&M.upload&&M.upload.addEventListener("progress",IP(r.onUploadProgress)),(r.cancelToken||r.signal)&&(N=at=>{M&&(l(!at||at.type?new Vh(null,r,M):at),M.abort(),M=null)},r.cancelToken&&r.cancelToken.subscribe(N),r.signal&&(r.signal.aborted?N():r.signal.addEventListener("abort",N)));const rt=LJ(j);if(rt&&fo.protocols.indexOf(rt)===-1){l(new Xe("Unsupported protocol "+rt+":",Xe.ERR_BAD_REQUEST,r));return}M.send(f||null)})},wy={http:aJ,xhr:xJ};Et.forEach(wy,(r,o)=>{if(r){try{Object.defineProperty(r,"name",{value:o})}catch{}Object.defineProperty(r,"adapterName",{value:o})}});const bP=r=>`- ${r}`,VJ=r=>Et.isFunction(r)||r===null||r===!1,TM={getAdapter:r=>{r=Et.isArray(r)?r:[r];const{length:o}=r;let c,l;const f={};for(let E=0;E<o;E++){c=r[E];let T;if(l=c,!VJ(c)&&(l=wy[(T=String(c)).toLowerCase()],l===void 0))throw new Xe(`Unknown adapter '${T}'`);if(l)break;f[T||"#"+E]=l}if(!l){const E=Object.entries(f).map(([w,N])=>`adapter ${w} `+(N===!1?"is not supported by the environment":"is not available in the build"));let T=o?E.length>1?`since :
`+E.map(bP).join(`
`):" "+bP(E[0]):"as no adapter specified";throw new Xe("There is no suitable adapter to dispatch the request "+T,"ERR_NOT_SUPPORT")}return l},adapters:wy};function HT(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Vh(null,r)}function wP(r){return HT(r),r.headers=Xo.from(r.headers),r.data=GT.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),TM.getAdapter(r.adapter||DR.adapter)(r).then(function(l){return HT(r),l.data=GT.call(r,r.transformResponse,l),l.headers=Xo.from(l.headers),l},function(l){return gM(l)||(HT(r),l&&l.response&&(l.response.data=GT.call(r,r.transformResponse,l.response),l.response.headers=Xo.from(l.response.headers))),Promise.reject(l)})}const AP=r=>r instanceof Xo?r.toJSON():r;function Pl(r,o){o=o||{};const c={};function l(D,k,M){return Et.isPlainObject(D)&&Et.isPlainObject(k)?Et.merge.call({caseless:M},D,k):Et.isPlainObject(k)?Et.merge({},k):Et.isArray(k)?k.slice():k}function f(D,k,M){if(Et.isUndefined(k)){if(!Et.isUndefined(D))return l(void 0,D,M)}else return l(D,k,M)}function E(D,k){if(!Et.isUndefined(k))return l(void 0,k)}function T(D,k){if(Et.isUndefined(k)){if(!Et.isUndefined(D))return l(void 0,D)}else return l(void 0,k)}function w(D,k,M){if(M in o)return l(D,k);if(M in r)return l(void 0,D)}const N={url:E,method:E,data:E,baseURL:T,transformRequest:T,transformResponse:T,paramsSerializer:T,timeout:T,timeoutMessage:T,withCredentials:T,withXSRFToken:T,adapter:T,responseType:T,xsrfCookieName:T,xsrfHeaderName:T,onUploadProgress:T,onDownloadProgress:T,decompress:T,maxContentLength:T,maxBodyLength:T,beforeRedirect:T,transport:T,httpAgent:T,httpsAgent:T,cancelToken:T,socketPath:T,responseEncoding:T,validateStatus:w,headers:(D,k)=>f(AP(D),AP(k),!0)};return Et.forEach(Object.keys(Object.assign({},r,o)),function(k){const M=N[k]||f,j=M(r[k],o[k],k);Et.isUndefined(j)&&M!==w||(c[k]=j)}),c}const yM="1.6.2",PR={};["object","boolean","number","function","string","symbol"].forEach((r,o)=>{PR[r]=function(l){return typeof l===r||"a"+(o<1?"n ":" ")+r}});const OP={};PR.transitional=function(o,c,l){function f(E,T){return"[Axios v"+yM+"] Transitional option '"+E+"'"+T+(l?". "+l:"")}return(E,T,w)=>{if(o===!1)throw new Xe(f(T," has been removed"+(c?" in "+c:"")),Xe.ERR_DEPRECATED);return c&&!OP[T]&&(OP[T]=!0,console.warn(f(T," has been deprecated since v"+c+" and will be removed in the near future"))),o?o(E,T,w):!0}};function FJ(r,o,c){if(typeof r!="object")throw new Xe("options must be an object",Xe.ERR_BAD_OPTION_VALUE);const l=Object.keys(r);let f=l.length;for(;f-- >0;){const E=l[f],T=o[E];if(T){const w=r[E],N=w===void 0||T(w,E,r);if(N!==!0)throw new Xe("option "+E+" must be "+N,Xe.ERR_BAD_OPTION_VALUE);continue}if(c!==!0)throw new Xe("Unknown option "+E,Xe.ERR_BAD_OPTION)}}const Ay={assertOptions:FJ,validators:PR},Fa=Ay.validators;class x_{constructor(o){this.defaults=o,this.interceptors={request:new vP,response:new vP}}request(o,c){typeof o=="string"?(c=c||{},c.url=o):c=o||{},c=Pl(this.defaults,c);const{transitional:l,paramsSerializer:f,headers:E}=c;l!==void 0&&Ay.assertOptions(l,{silentJSONParsing:Fa.transitional(Fa.boolean),forcedJSONParsing:Fa.transitional(Fa.boolean),clarifyTimeoutError:Fa.transitional(Fa.boolean)},!1),f!=null&&(Et.isFunction(f)?c.paramsSerializer={serialize:f}:Ay.assertOptions(f,{encode:Fa.function,serialize:Fa.function},!0)),c.method=(c.method||this.defaults.method||"get").toLowerCase();let T=E&&Et.merge(E.common,E[c.method]);E&&Et.forEach(["delete","get","head","post","put","patch","common"],rt=>{delete E[rt]}),c.headers=Xo.concat(T,E);const w=[];let N=!0;this.interceptors.request.forEach(function(at){typeof at.runWhen=="function"&&at.runWhen(c)===!1||(N=N&&at.synchronous,w.unshift(at.fulfilled,at.rejected))});const D=[];this.interceptors.response.forEach(function(at){D.push(at.fulfilled,at.rejected)});let k,M=0,j;if(!N){const rt=[wP.bind(this),void 0];for(rt.unshift.apply(rt,w),rt.push.apply(rt,D),j=rt.length,k=Promise.resolve(c);M<j;)k=k.then(rt[M++],rt[M++]);return k}j=w.length;let nt=c;for(M=0;M<j;){const rt=w[M++],at=w[M++];try{nt=rt(nt)}catch(Ot){at.call(this,Ot);break}}try{k=wP.call(this,nt)}catch(rt){return Promise.reject(rt)}for(M=0,j=D.length;M<j;)k=k.then(D[M++],D[M++]);return k}getUri(o){o=Pl(this.defaults,o);const c=SM(o.baseURL,o.url);return fM(c,o.params,o.paramsSerializer)}}Et.forEach(["delete","get","head","options"],function(o){x_.prototype[o]=function(c,l){return this.request(Pl(l||{},{method:o,url:c,data:(l||{}).data}))}});Et.forEach(["post","put","patch"],function(o){function c(l){return function(E,T,w){return this.request(Pl(w||{},{method:o,headers:l?{"Content-Type":"multipart/form-data"}:{},url:E,data:T}))}}x_.prototype[o]=c(),x_.prototype[o+"Form"]=c(!0)});const T_=x_;class kR{constructor(o){if(typeof o!="function")throw new TypeError("executor must be a function.");let c;this.promise=new Promise(function(E){c=E});const l=this;this.promise.then(f=>{if(!l._listeners)return;let E=l._listeners.length;for(;E-- >0;)l._listeners[E](f);l._listeners=null}),this.promise.then=f=>{let E;const T=new Promise(w=>{l.subscribe(w),E=w}).then(f);return T.cancel=function(){l.unsubscribe(E)},T},o(function(E,T,w){l.reason||(l.reason=new Vh(E,T,w),c(l.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(o){if(this.reason){o(this.reason);return}this._listeners?this._listeners.push(o):this._listeners=[o]}unsubscribe(o){if(!this._listeners)return;const c=this._listeners.indexOf(o);c!==-1&&this._listeners.splice(c,1)}static source(){let o;return{token:new kR(function(f){o=f}),cancel:o}}}const BJ=kR;function jJ(r){return function(c){return r.apply(null,c)}}function WJ(r){return Et.isObject(r)&&r.isAxiosError===!0}const Oy={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Oy).forEach(([r,o])=>{Oy[o]=r});const GJ=Oy;function RM(r){const o=new T_(r),c=nM(T_.prototype.request,o);return Et.extend(c,T_.prototype,o,{allOwnKeys:!0}),Et.extend(c,o,null,{allOwnKeys:!0}),c.create=function(f){return RM(Pl(r,f))},c}const Ci=RM(DR);Ci.Axios=T_;Ci.CanceledError=Vh;Ci.CancelToken=BJ;Ci.isCancel=gM;Ci.VERSION=yM;Ci.toFormData=gm;Ci.AxiosError=Xe;Ci.Cancel=Ci.CanceledError;Ci.all=function(o){return Promise.all(o)};Ci.spread=jJ;Ci.isAxiosError=WJ;Ci.mergeConfig=Pl;Ci.AxiosHeaders=Xo;Ci.formToJSON=r=>EM(Et.isHTMLForm(r)?new FormData(r):r);Ci.getAdapter=TM.getAdapter;Ci.HttpStatusCode=GJ;Ci.default=Ci;const a$=Ci;//! moment.js
//! version : 2.29.4
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
var vM;function Yt(){return vM.apply(null,arguments)}function HJ(r){vM=r}function js(r){return r instanceof Array||Object.prototype.toString.call(r)==="[object Array]"}function Zc(r){return r!=null&&Object.prototype.toString.call(r)==="[object Object]"}function on(r,o){return Object.prototype.hasOwnProperty.call(r,o)}function LR(r){if(Object.getOwnPropertyNames)return Object.getOwnPropertyNames(r).length===0;var o;for(o in r)if(on(r,o))return!1;return!0}function Pr(r){return r===void 0}function $o(r){return typeof r=="number"||Object.prototype.toString.call(r)==="[object Number]"}function Fh(r){return r instanceof Date||Object.prototype.toString.call(r)==="[object Date]"}function CM(r,o){var c=[],l,f=r.length;for(l=0;l<f;++l)c.push(o(r[l],l));return c}function Ha(r,o){for(var c in o)on(o,c)&&(r[c]=o[c]);return on(o,"toString")&&(r.toString=o.toString),on(o,"valueOf")&&(r.valueOf=o.valueOf),r}function yo(r,o,c,l){return zM(r,o,c,l,!0).utc()}function YJ(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function Ue(r){return r._pf==null&&(r._pf=YJ()),r._pf}var Ny;Array.prototype.some?Ny=Array.prototype.some:Ny=function(r){var o=Object(this),c=o.length>>>0,l;for(l=0;l<c;l++)if(l in o&&r.call(this,o[l],l,o))return!0;return!1};function MR(r){if(r._isValid==null){var o=Ue(r),c=Ny.call(o.parsedDateParts,function(f){return f!=null}),l=!isNaN(r._d.getTime())&&o.overflow<0&&!o.empty&&!o.invalidEra&&!o.invalidMonth&&!o.invalidWeekday&&!o.weekdayMismatch&&!o.nullInput&&!o.invalidFormat&&!o.userInvalidated&&(!o.meridiem||o.meridiem&&c);if(r._strict&&(l=l&&o.charsLeftOver===0&&o.unusedTokens.length===0&&o.bigHour===void 0),Object.isFrozen==null||!Object.isFrozen(r))r._isValid=l;else return l}return r._isValid}function Tm(r){var o=yo(NaN);return r!=null?Ha(Ue(o),r):Ue(o).userInvalidated=!0,o}var NP=Yt.momentProperties=[],YT=!1;function UR(r,o){var c,l,f,E=NP.length;if(Pr(o._isAMomentObject)||(r._isAMomentObject=o._isAMomentObject),Pr(o._i)||(r._i=o._i),Pr(o._f)||(r._f=o._f),Pr(o._l)||(r._l=o._l),Pr(o._strict)||(r._strict=o._strict),Pr(o._tzm)||(r._tzm=o._tzm),Pr(o._isUTC)||(r._isUTC=o._isUTC),Pr(o._offset)||(r._offset=o._offset),Pr(o._pf)||(r._pf=Ue(o)),Pr(o._locale)||(r._locale=o._locale),E>0)for(c=0;c<E;c++)l=NP[c],f=o[l],Pr(f)||(r[l]=f);return r}function Bh(r){UR(this,r),this._d=new Date(r._d!=null?r._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),YT===!1&&(YT=!0,Yt.updateOffset(this),YT=!1)}function Ws(r){return r instanceof Bh||r!=null&&r._isAMomentObject!=null}function IM(r){Yt.suppressDeprecationWarnings===!1&&typeof console<"u"&&console.warn&&console.warn("Deprecation warning: "+r)}function Is(r,o){var c=!0;return Ha(function(){if(Yt.deprecationHandler!=null&&Yt.deprecationHandler(null,r),c){var l=[],f,E,T,w=arguments.length;for(E=0;E<w;E++){if(f="",typeof arguments[E]=="object"){f+=`
[`+E+"] ";for(T in arguments[0])on(arguments[0],T)&&(f+=T+": "+arguments[0][T]+", ");f=f.slice(0,-2)}else f=arguments[E];l.push(f)}IM(r+`
Arguments: `+Array.prototype.slice.call(l).join("")+`
`+new Error().stack),c=!1}return o.apply(this,arguments)},o)}var DP={};function bM(r,o){Yt.deprecationHandler!=null&&Yt.deprecationHandler(r,o),DP[r]||(IM(o),DP[r]=!0)}Yt.suppressDeprecationWarnings=!1;Yt.deprecationHandler=null;function Ro(r){return typeof Function<"u"&&r instanceof Function||Object.prototype.toString.call(r)==="[object Function]"}function KJ(r){var o,c;for(c in r)on(r,c)&&(o=r[c],Ro(o)?this[c]=o:this["_"+c]=o);this._config=r,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function Dy(r,o){var c=Ha({},r),l;for(l in o)on(o,l)&&(Zc(r[l])&&Zc(o[l])?(c[l]={},Ha(c[l],r[l]),Ha(c[l],o[l])):o[l]!=null?c[l]=o[l]:delete c[l]);for(l in r)on(r,l)&&!on(o,l)&&Zc(r[l])&&(c[l]=Ha({},c[l]));return c}function xR(r){r!=null&&this.set(r)}var Py;Object.keys?Py=Object.keys:Py=function(r){var o,c=[];for(o in r)on(r,o)&&c.push(o);return c};var qJ={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function zJ(r,o,c){var l=this._calendar[r]||this._calendar.sameElse;return Ro(l)?l.call(o,c):l}function So(r,o,c){var l=""+Math.abs(r),f=o-l.length,E=r>=0;return(E?c?"+":"":"-")+Math.pow(10,Math.max(0,f)).toString().substr(1)+l}var VR=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,h_=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,KT={},yl={};function ue(r,o,c,l){var f=l;typeof l=="string"&&(f=function(){return this[l]()}),r&&(yl[r]=f),o&&(yl[o[0]]=function(){return So(f.apply(this,arguments),o[1],o[2])}),c&&(yl[c]=function(){return this.localeData().ordinal(f.apply(this,arguments),r)})}function JJ(r){return r.match(/\[[\s\S]/)?r.replace(/^\[|\]$/g,""):r.replace(/\\/g,"")}function XJ(r){var o=r.match(VR),c,l;for(c=0,l=o.length;c<l;c++)yl[o[c]]?o[c]=yl[o[c]]:o[c]=JJ(o[c]);return function(f){var E="",T;for(T=0;T<l;T++)E+=Ro(o[T])?o[T].call(f,r):o[T];return E}}function y_(r,o){return r.isValid()?(o=wM(o,r.localeData()),KT[o]=KT[o]||XJ(o),KT[o](r)):r.localeData().invalidDate()}function wM(r,o){var c=5;function l(f){return o.longDateFormat(f)||f}for(h_.lastIndex=0;c>=0&&h_.test(r);)r=r.replace(h_,l),h_.lastIndex=0,c-=1;return r}var QJ={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function $J(r){var o=this._longDateFormat[r],c=this._longDateFormat[r.toUpperCase()];return o||!c?o:(this._longDateFormat[r]=c.match(VR).map(function(l){return l==="MMMM"||l==="MM"||l==="DD"||l==="dddd"?l.slice(1):l}).join(""),this._longDateFormat[r])}var ZJ="Invalid date";function tX(){return this._invalidDate}var eX="%d",nX=/\d{1,2}/;function iX(r){return this._ordinal.replace("%d",r)}var rX={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function sX(r,o,c,l){var f=this._relativeTime[c];return Ro(f)?f(r,o,c,l):f.replace(/%d/i,r)}function oX(r,o){var c=this._relativeTime[r>0?"future":"past"];return Ro(c)?c(o):c.replace(/%s/i,o)}var fh={};function rr(r,o){var c=r.toLowerCase();fh[c]=fh[c+"s"]=fh[o]=r}function bs(r){return typeof r=="string"?fh[r]||fh[r.toLowerCase()]:void 0}function FR(r){var o={},c,l;for(l in r)on(r,l)&&(c=bs(l),c&&(o[c]=r[l]));return o}var AM={};function sr(r,o){AM[r]=o}function aX(r){var o=[],c;for(c in r)on(r,c)&&o.push({unit:c,priority:AM[c]});return o.sort(function(l,f){return l.priority-f.priority}),o}function ym(r){return r%4===0&&r%100!==0||r%400===0}function ys(r){return r<0?Math.ceil(r)||0:Math.floor(r)}function Be(r){var o=+r,c=0;return o!==0&&isFinite(o)&&(c=ys(o)),c}function Bl(r,o){return function(c){return c!=null?(OM(this,r,c),Yt.updateOffset(this,o),this):V_(this,r)}}function V_(r,o){return r.isValid()?r._d["get"+(r._isUTC?"UTC":"")+o]():NaN}function OM(r,o,c){r.isValid()&&!isNaN(c)&&(o==="FullYear"&&ym(r.year())&&r.month()===1&&r.date()===29?(c=Be(c),r._d["set"+(r._isUTC?"UTC":"")+o](c,r.month(),wm(c,r.month()))):r._d["set"+(r._isUTC?"UTC":"")+o](c))}function cX(r){return r=bs(r),Ro(this[r])?this[r]():this}function dX(r,o){if(typeof r=="object"){r=FR(r);var c=aX(r),l,f=c.length;for(l=0;l<f;l++)this[c[l].unit](r[c[l].unit])}else if(r=bs(r),Ro(this[r]))return this[r](o);return this}var NM=/\d/,ss=/\d\d/,DM=/\d{3}/,BR=/\d{4}/,Rm=/[+-]?\d{6}/,Kn=/\d\d?/,PM=/\d\d\d\d?/,kM=/\d\d\d\d\d\d?/,vm=/\d{1,3}/,jR=/\d{1,4}/,Cm=/[+-]?\d{1,6}/,jl=/\d+/,Im=/[+-]?\d+/,lX=/Z|[+-]\d\d:?\d\d/gi,bm=/Z|[+-]\d\d(?::?\d\d)?/gi,uX=/[+-]?\d+(\.\d{1,3})?/,jh=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,F_;F_={};function zt(r,o,c){F_[r]=Ro(o)?o:function(l,f){return l&&c?c:o}}function hX(r,o){return on(F_,r)?F_[r](o._strict,o._locale):new RegExp(pX(r))}function pX(r){return es(r.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(o,c,l,f,E){return c||l||f||E}))}function es(r){return r.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var ky={};function wn(r,o){var c,l=o,f;for(typeof r=="string"&&(r=[r]),$o(o)&&(l=function(E,T){T[o]=Be(E)}),f=r.length,c=0;c<f;c++)ky[r[c]]=l}function Wh(r,o){wn(r,function(c,l,f,E){f._w=f._w||{},o(c,f._w,f,E)})}function fX(r,o,c){o!=null&&on(ky,r)&&ky[r](o,c._a,c,r)}var ir=0,Ko=1,po=2,Ni=3,Vs=4,qo=5,qc=6,_X=7,mX=8;function EX(r,o){return(r%o+o)%o}var fi;Array.prototype.indexOf?fi=Array.prototype.indexOf:fi=function(r){var o;for(o=0;o<this.length;++o)if(this[o]===r)return o;return-1};function wm(r,o){if(isNaN(r)||isNaN(o))return NaN;var c=EX(o,12);return r+=(o-c)/12,c===1?ym(r)?29:28:31-c%7%2}ue("M",["MM",2],"Mo",function(){return this.month()+1});ue("MMM",0,0,function(r){return this.localeData().monthsShort(this,r)});ue("MMMM",0,0,function(r){return this.localeData().months(this,r)});rr("month","M");sr("month",8);zt("M",Kn);zt("MM",Kn,ss);zt("MMM",function(r,o){return o.monthsShortRegex(r)});zt("MMMM",function(r,o){return o.monthsRegex(r)});wn(["M","MM"],function(r,o){o[Ko]=Be(r)-1});wn(["MMM","MMMM"],function(r,o,c,l){var f=c._locale.monthsParse(r,l,c._strict);f!=null?o[Ko]=f:Ue(c).invalidMonth=r});var gX="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),LM="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),MM=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,SX=jh,TX=jh;function yX(r,o){return r?js(this._months)?this._months[r.month()]:this._months[(this._months.isFormat||MM).test(o)?"format":"standalone"][r.month()]:js(this._months)?this._months:this._months.standalone}function RX(r,o){return r?js(this._monthsShort)?this._monthsShort[r.month()]:this._monthsShort[MM.test(o)?"format":"standalone"][r.month()]:js(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function vX(r,o,c){var l,f,E,T=r.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],l=0;l<12;++l)E=yo([2e3,l]),this._shortMonthsParse[l]=this.monthsShort(E,"").toLocaleLowerCase(),this._longMonthsParse[l]=this.months(E,"").toLocaleLowerCase();return c?o==="MMM"?(f=fi.call(this._shortMonthsParse,T),f!==-1?f:null):(f=fi.call(this._longMonthsParse,T),f!==-1?f:null):o==="MMM"?(f=fi.call(this._shortMonthsParse,T),f!==-1?f:(f=fi.call(this._longMonthsParse,T),f!==-1?f:null)):(f=fi.call(this._longMonthsParse,T),f!==-1?f:(f=fi.call(this._shortMonthsParse,T),f!==-1?f:null))}function CX(r,o,c){var l,f,E;if(this._monthsParseExact)return vX.call(this,r,o,c);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),l=0;l<12;l++){if(f=yo([2e3,l]),c&&!this._longMonthsParse[l]&&(this._longMonthsParse[l]=new RegExp("^"+this.months(f,"").replace(".","")+"$","i"),this._shortMonthsParse[l]=new RegExp("^"+this.monthsShort(f,"").replace(".","")+"$","i")),!c&&!this._monthsParse[l]&&(E="^"+this.months(f,"")+"|^"+this.monthsShort(f,""),this._monthsParse[l]=new RegExp(E.replace(".",""),"i")),c&&o==="MMMM"&&this._longMonthsParse[l].test(r))return l;if(c&&o==="MMM"&&this._shortMonthsParse[l].test(r))return l;if(!c&&this._monthsParse[l].test(r))return l}}function UM(r,o){var c;if(!r.isValid())return r;if(typeof o=="string"){if(/^\d+$/.test(o))o=Be(o);else if(o=r.localeData().monthsParse(o),!$o(o))return r}return c=Math.min(r.date(),wm(r.year(),o)),r._d["set"+(r._isUTC?"UTC":"")+"Month"](o,c),r}function xM(r){return r!=null?(UM(this,r),Yt.updateOffset(this,!0),this):V_(this,"Month")}function IX(){return wm(this.year(),this.month())}function bX(r){return this._monthsParseExact?(on(this,"_monthsRegex")||VM.call(this),r?this._monthsShortStrictRegex:this._monthsShortRegex):(on(this,"_monthsShortRegex")||(this._monthsShortRegex=SX),this._monthsShortStrictRegex&&r?this._monthsShortStrictRegex:this._monthsShortRegex)}function wX(r){return this._monthsParseExact?(on(this,"_monthsRegex")||VM.call(this),r?this._monthsStrictRegex:this._monthsRegex):(on(this,"_monthsRegex")||(this._monthsRegex=TX),this._monthsStrictRegex&&r?this._monthsStrictRegex:this._monthsRegex)}function VM(){function r(T,w){return w.length-T.length}var o=[],c=[],l=[],f,E;for(f=0;f<12;f++)E=yo([2e3,f]),o.push(this.monthsShort(E,"")),c.push(this.months(E,"")),l.push(this.months(E,"")),l.push(this.monthsShort(E,""));for(o.sort(r),c.sort(r),l.sort(r),f=0;f<12;f++)o[f]=es(o[f]),c[f]=es(c[f]);for(f=0;f<24;f++)l[f]=es(l[f]);this._monthsRegex=new RegExp("^("+l.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+c.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+o.join("|")+")","i")}ue("Y",0,0,function(){var r=this.year();return r<=9999?So(r,4):"+"+r});ue(0,["YY",2],0,function(){return this.year()%100});ue(0,["YYYY",4],0,"year");ue(0,["YYYYY",5],0,"year");ue(0,["YYYYYY",6,!0],0,"year");rr("year","y");sr("year",1);zt("Y",Im);zt("YY",Kn,ss);zt("YYYY",jR,BR);zt("YYYYY",Cm,Rm);zt("YYYYYY",Cm,Rm);wn(["YYYYY","YYYYYY"],ir);wn("YYYY",function(r,o){o[ir]=r.length===2?Yt.parseTwoDigitYear(r):Be(r)});wn("YY",function(r,o){o[ir]=Yt.parseTwoDigitYear(r)});wn("Y",function(r,o){o[ir]=parseInt(r,10)});function _h(r){return ym(r)?366:365}Yt.parseTwoDigitYear=function(r){return Be(r)+(Be(r)>68?1900:2e3)};var FM=Bl("FullYear",!0);function AX(){return ym(this.year())}function OX(r,o,c,l,f,E,T){var w;return r<100&&r>=0?(w=new Date(r+400,o,c,l,f,E,T),isFinite(w.getFullYear())&&w.setFullYear(r)):w=new Date(r,o,c,l,f,E,T),w}function bh(r){var o,c;return r<100&&r>=0?(c=Array.prototype.slice.call(arguments),c[0]=r+400,o=new Date(Date.UTC.apply(null,c)),isFinite(o.getUTCFullYear())&&o.setUTCFullYear(r)):o=new Date(Date.UTC.apply(null,arguments)),o}function B_(r,o,c){var l=7+o-c,f=(7+bh(r,0,l).getUTCDay()-o)%7;return-f+l-1}function BM(r,o,c,l,f){var E=(7+c-l)%7,T=B_(r,l,f),w=1+7*(o-1)+E+T,N,D;return w<=0?(N=r-1,D=_h(N)+w):w>_h(r)?(N=r+1,D=w-_h(r)):(N=r,D=w),{year:N,dayOfYear:D}}function wh(r,o,c){var l=B_(r.year(),o,c),f=Math.floor((r.dayOfYear()-l-1)/7)+1,E,T;return f<1?(T=r.year()-1,E=f+Qo(T,o,c)):f>Qo(r.year(),o,c)?(E=f-Qo(r.year(),o,c),T=r.year()+1):(T=r.year(),E=f),{week:E,year:T}}function Qo(r,o,c){var l=B_(r,o,c),f=B_(r+1,o,c);return(_h(r)-l+f)/7}ue("w",["ww",2],"wo","week");ue("W",["WW",2],"Wo","isoWeek");rr("week","w");rr("isoWeek","W");sr("week",5);sr("isoWeek",5);zt("w",Kn);zt("ww",Kn,ss);zt("W",Kn);zt("WW",Kn,ss);Wh(["w","ww","W","WW"],function(r,o,c,l){o[l.substr(0,1)]=Be(r)});function NX(r){return wh(r,this._week.dow,this._week.doy).week}var DX={dow:0,doy:6};function PX(){return this._week.dow}function kX(){return this._week.doy}function LX(r){var o=this.localeData().week(this);return r==null?o:this.add((r-o)*7,"d")}function MX(r){var o=wh(this,1,4).week;return r==null?o:this.add((r-o)*7,"d")}ue("d",0,"do","day");ue("dd",0,0,function(r){return this.localeData().weekdaysMin(this,r)});ue("ddd",0,0,function(r){return this.localeData().weekdaysShort(this,r)});ue("dddd",0,0,function(r){return this.localeData().weekdays(this,r)});ue("e",0,0,"weekday");ue("E",0,0,"isoWeekday");rr("day","d");rr("weekday","e");rr("isoWeekday","E");sr("day",11);sr("weekday",11);sr("isoWeekday",11);zt("d",Kn);zt("e",Kn);zt("E",Kn);zt("dd",function(r,o){return o.weekdaysMinRegex(r)});zt("ddd",function(r,o){return o.weekdaysShortRegex(r)});zt("dddd",function(r,o){return o.weekdaysRegex(r)});Wh(["dd","ddd","dddd"],function(r,o,c,l){var f=c._locale.weekdaysParse(r,l,c._strict);f!=null?o.d=f:Ue(c).invalidWeekday=r});Wh(["d","e","E"],function(r,o,c,l){o[l]=Be(r)});function UX(r,o){return typeof r!="string"?r:isNaN(r)?(r=o.weekdaysParse(r),typeof r=="number"?r:null):parseInt(r,10)}function xX(r,o){return typeof r=="string"?o.weekdaysParse(r)%7||7:isNaN(r)?null:r}function WR(r,o){return r.slice(o,7).concat(r.slice(0,o))}var VX="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),jM="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),FX="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),BX=jh,jX=jh,WX=jh;function GX(r,o){var c=js(this._weekdays)?this._weekdays:this._weekdays[r&&r!==!0&&this._weekdays.isFormat.test(o)?"format":"standalone"];return r===!0?WR(c,this._week.dow):r?c[r.day()]:c}function HX(r){return r===!0?WR(this._weekdaysShort,this._week.dow):r?this._weekdaysShort[r.day()]:this._weekdaysShort}function YX(r){return r===!0?WR(this._weekdaysMin,this._week.dow):r?this._weekdaysMin[r.day()]:this._weekdaysMin}function KX(r,o,c){var l,f,E,T=r.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],l=0;l<7;++l)E=yo([2e3,1]).day(l),this._minWeekdaysParse[l]=this.weekdaysMin(E,"").toLocaleLowerCase(),this._shortWeekdaysParse[l]=this.weekdaysShort(E,"").toLocaleLowerCase(),this._weekdaysParse[l]=this.weekdays(E,"").toLocaleLowerCase();return c?o==="dddd"?(f=fi.call(this._weekdaysParse,T),f!==-1?f:null):o==="ddd"?(f=fi.call(this._shortWeekdaysParse,T),f!==-1?f:null):(f=fi.call(this._minWeekdaysParse,T),f!==-1?f:null):o==="dddd"?(f=fi.call(this._weekdaysParse,T),f!==-1||(f=fi.call(this._shortWeekdaysParse,T),f!==-1)?f:(f=fi.call(this._minWeekdaysParse,T),f!==-1?f:null)):o==="ddd"?(f=fi.call(this._shortWeekdaysParse,T),f!==-1||(f=fi.call(this._weekdaysParse,T),f!==-1)?f:(f=fi.call(this._minWeekdaysParse,T),f!==-1?f:null)):(f=fi.call(this._minWeekdaysParse,T),f!==-1||(f=fi.call(this._weekdaysParse,T),f!==-1)?f:(f=fi.call(this._shortWeekdaysParse,T),f!==-1?f:null))}function qX(r,o,c){var l,f,E;if(this._weekdaysParseExact)return KX.call(this,r,o,c);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),l=0;l<7;l++){if(f=yo([2e3,1]).day(l),c&&!this._fullWeekdaysParse[l]&&(this._fullWeekdaysParse[l]=new RegExp("^"+this.weekdays(f,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[l]=new RegExp("^"+this.weekdaysShort(f,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[l]=new RegExp("^"+this.weekdaysMin(f,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[l]||(E="^"+this.weekdays(f,"")+"|^"+this.weekdaysShort(f,"")+"|^"+this.weekdaysMin(f,""),this._weekdaysParse[l]=new RegExp(E.replace(".",""),"i")),c&&o==="dddd"&&this._fullWeekdaysParse[l].test(r))return l;if(c&&o==="ddd"&&this._shortWeekdaysParse[l].test(r))return l;if(c&&o==="dd"&&this._minWeekdaysParse[l].test(r))return l;if(!c&&this._weekdaysParse[l].test(r))return l}}function zX(r){if(!this.isValid())return r!=null?this:NaN;var o=this._isUTC?this._d.getUTCDay():this._d.getDay();return r!=null?(r=UX(r,this.localeData()),this.add(r-o,"d")):o}function JX(r){if(!this.isValid())return r!=null?this:NaN;var o=(this.day()+7-this.localeData()._week.dow)%7;return r==null?o:this.add(r-o,"d")}function XX(r){if(!this.isValid())return r!=null?this:NaN;if(r!=null){var o=xX(r,this.localeData());return this.day(this.day()%7?o:o-7)}else return this.day()||7}function QX(r){return this._weekdaysParseExact?(on(this,"_weekdaysRegex")||GR.call(this),r?this._weekdaysStrictRegex:this._weekdaysRegex):(on(this,"_weekdaysRegex")||(this._weekdaysRegex=BX),this._weekdaysStrictRegex&&r?this._weekdaysStrictRegex:this._weekdaysRegex)}function $X(r){return this._weekdaysParseExact?(on(this,"_weekdaysRegex")||GR.call(this),r?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(on(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=jX),this._weekdaysShortStrictRegex&&r?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function ZX(r){return this._weekdaysParseExact?(on(this,"_weekdaysRegex")||GR.call(this),r?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(on(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=WX),this._weekdaysMinStrictRegex&&r?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function GR(){function r(k,M){return M.length-k.length}var o=[],c=[],l=[],f=[],E,T,w,N,D;for(E=0;E<7;E++)T=yo([2e3,1]).day(E),w=es(this.weekdaysMin(T,"")),N=es(this.weekdaysShort(T,"")),D=es(this.weekdays(T,"")),o.push(w),c.push(N),l.push(D),f.push(w),f.push(N),f.push(D);o.sort(r),c.sort(r),l.sort(r),f.sort(r),this._weekdaysRegex=new RegExp("^("+f.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+l.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+c.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+o.join("|")+")","i")}function HR(){return this.hours()%12||12}function t7(){return this.hours()||24}ue("H",["HH",2],0,"hour");ue("h",["hh",2],0,HR);ue("k",["kk",2],0,t7);ue("hmm",0,0,function(){return""+HR.apply(this)+So(this.minutes(),2)});ue("hmmss",0,0,function(){return""+HR.apply(this)+So(this.minutes(),2)+So(this.seconds(),2)});ue("Hmm",0,0,function(){return""+this.hours()+So(this.minutes(),2)});ue("Hmmss",0,0,function(){return""+this.hours()+So(this.minutes(),2)+So(this.seconds(),2)});function WM(r,o){ue(r,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),o)})}WM("a",!0);WM("A",!1);rr("hour","h");sr("hour",13);function GM(r,o){return o._meridiemParse}zt("a",GM);zt("A",GM);zt("H",Kn);zt("h",Kn);zt("k",Kn);zt("HH",Kn,ss);zt("hh",Kn,ss);zt("kk",Kn,ss);zt("hmm",PM);zt("hmmss",kM);zt("Hmm",PM);zt("Hmmss",kM);wn(["H","HH"],Ni);wn(["k","kk"],function(r,o,c){var l=Be(r);o[Ni]=l===24?0:l});wn(["a","A"],function(r,o,c){c._isPm=c._locale.isPM(r),c._meridiem=r});wn(["h","hh"],function(r,o,c){o[Ni]=Be(r),Ue(c).bigHour=!0});wn("hmm",function(r,o,c){var l=r.length-2;o[Ni]=Be(r.substr(0,l)),o[Vs]=Be(r.substr(l)),Ue(c).bigHour=!0});wn("hmmss",function(r,o,c){var l=r.length-4,f=r.length-2;o[Ni]=Be(r.substr(0,l)),o[Vs]=Be(r.substr(l,2)),o[qo]=Be(r.substr(f)),Ue(c).bigHour=!0});wn("Hmm",function(r,o,c){var l=r.length-2;o[Ni]=Be(r.substr(0,l)),o[Vs]=Be(r.substr(l))});wn("Hmmss",function(r,o,c){var l=r.length-4,f=r.length-2;o[Ni]=Be(r.substr(0,l)),o[Vs]=Be(r.substr(l,2)),o[qo]=Be(r.substr(f))});function e7(r){return(r+"").toLowerCase().charAt(0)==="p"}var n7=/[ap]\.?m?\.?/i,i7=Bl("Hours",!0);function r7(r,o,c){return r>11?c?"pm":"PM":c?"am":"AM"}var HM={calendar:qJ,longDateFormat:QJ,invalidDate:ZJ,ordinal:eX,dayOfMonthOrdinalParse:nX,relativeTime:rX,months:gX,monthsShort:LM,week:DX,weekdays:VX,weekdaysMin:FX,weekdaysShort:jM,meridiemParse:n7},ti={},$u={},Ah;function s7(r,o){var c,l=Math.min(r.length,o.length);for(c=0;c<l;c+=1)if(r[c]!==o[c])return c;return l}function PP(r){return r&&r.toLowerCase().replace("_","-")}function o7(r){for(var o=0,c,l,f,E;o<r.length;){for(E=PP(r[o]).split("-"),c=E.length,l=PP(r[o+1]),l=l?l.split("-"):null;c>0;){if(f=Am(E.slice(0,c).join("-")),f)return f;if(l&&l.length>=c&&s7(E,l)>=c-1)break;c--}o++}return Ah}function a7(r){return r.match("^[^/\\\\]*$")!=null}function Am(r){var o=null,c;if(ti[r]===void 0&&typeof module<"u"&&module&&module.exports&&a7(r))try{o=Ah._abbr,c=require,c("./locale/"+r),Ja(o)}catch{ti[r]=null}return ti[r]}function Ja(r,o){var c;return r&&(Pr(o)?c=ea(r):c=YR(r,o),c?Ah=c:typeof console<"u"&&console.warn&&console.warn("Locale "+r+" not found. Did you forget to load it?")),Ah._abbr}function YR(r,o){if(o!==null){var c,l=HM;if(o.abbr=r,ti[r]!=null)bM("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),l=ti[r]._config;else if(o.parentLocale!=null)if(ti[o.parentLocale]!=null)l=ti[o.parentLocale]._config;else if(c=Am(o.parentLocale),c!=null)l=c._config;else return $u[o.parentLocale]||($u[o.parentLocale]=[]),$u[o.parentLocale].push({name:r,config:o}),null;return ti[r]=new xR(Dy(l,o)),$u[r]&&$u[r].forEach(function(f){YR(f.name,f.config)}),Ja(r),ti[r]}else return delete ti[r],null}function c7(r,o){if(o!=null){var c,l,f=HM;ti[r]!=null&&ti[r].parentLocale!=null?ti[r].set(Dy(ti[r]._config,o)):(l=Am(r),l!=null&&(f=l._config),o=Dy(f,o),l==null&&(o.abbr=r),c=new xR(o),c.parentLocale=ti[r],ti[r]=c),Ja(r)}else ti[r]!=null&&(ti[r].parentLocale!=null?(ti[r]=ti[r].parentLocale,r===Ja()&&Ja(r)):ti[r]!=null&&delete ti[r]);return ti[r]}function ea(r){var o;if(r&&r._locale&&r._locale._abbr&&(r=r._locale._abbr),!r)return Ah;if(!js(r)){if(o=Am(r),o)return o;r=[r]}return o7(r)}function d7(){return Py(ti)}function KR(r){var o,c=r._a;return c&&Ue(r).overflow===-2&&(o=c[Ko]<0||c[Ko]>11?Ko:c[po]<1||c[po]>wm(c[ir],c[Ko])?po:c[Ni]<0||c[Ni]>24||c[Ni]===24&&(c[Vs]!==0||c[qo]!==0||c[qc]!==0)?Ni:c[Vs]<0||c[Vs]>59?Vs:c[qo]<0||c[qo]>59?qo:c[qc]<0||c[qc]>999?qc:-1,Ue(r)._overflowDayOfYear&&(o<ir||o>po)&&(o=po),Ue(r)._overflowWeeks&&o===-1&&(o=_X),Ue(r)._overflowWeekday&&o===-1&&(o=mX),Ue(r).overflow=o),r}var l7=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,u7=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,h7=/Z|[+-]\d\d(?::?\d\d)?/,p_=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],qT=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],p7=/^\/?Date\((-?\d+)/i,f7=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,_7={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function YM(r){var o,c,l=r._i,f=l7.exec(l)||u7.exec(l),E,T,w,N,D=p_.length,k=qT.length;if(f){for(Ue(r).iso=!0,o=0,c=D;o<c;o++)if(p_[o][1].exec(f[1])){T=p_[o][0],E=p_[o][2]!==!1;break}if(T==null){r._isValid=!1;return}if(f[3]){for(o=0,c=k;o<c;o++)if(qT[o][1].exec(f[3])){w=(f[2]||" ")+qT[o][0];break}if(w==null){r._isValid=!1;return}}if(!E&&w!=null){r._isValid=!1;return}if(f[4])if(h7.exec(f[4]))N="Z";else{r._isValid=!1;return}r._f=T+(w||"")+(N||""),zR(r)}else r._isValid=!1}function m7(r,o,c,l,f,E){var T=[E7(r),LM.indexOf(o),parseInt(c,10),parseInt(l,10),parseInt(f,10)];return E&&T.push(parseInt(E,10)),T}function E7(r){var o=parseInt(r,10);return o<=49?2e3+o:o<=999?1900+o:o}function g7(r){return r.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function S7(r,o,c){if(r){var l=jM.indexOf(r),f=new Date(o[0],o[1],o[2]).getDay();if(l!==f)return Ue(c).weekdayMismatch=!0,c._isValid=!1,!1}return!0}function T7(r,o,c){if(r)return _7[r];if(o)return 0;var l=parseInt(c,10),f=l%100,E=(l-f)/100;return E*60+f}function KM(r){var o=f7.exec(g7(r._i)),c;if(o){if(c=m7(o[4],o[3],o[2],o[5],o[6],o[7]),!S7(o[1],c,r))return;r._a=c,r._tzm=T7(o[8],o[9],o[10]),r._d=bh.apply(null,r._a),r._d.setUTCMinutes(r._d.getUTCMinutes()-r._tzm),Ue(r).rfc2822=!0}else r._isValid=!1}function y7(r){var o=p7.exec(r._i);if(o!==null){r._d=new Date(+o[1]);return}if(YM(r),r._isValid===!1)delete r._isValid;else return;if(KM(r),r._isValid===!1)delete r._isValid;else return;r._strict?r._isValid=!1:Yt.createFromInputFallback(r)}Yt.createFromInputFallback=Is("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(r){r._d=new Date(r._i+(r._useUTC?" UTC":""))});function fl(r,o,c){return r??o??c}function R7(r){var o=new Date(Yt.now());return r._useUTC?[o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate()]:[o.getFullYear(),o.getMonth(),o.getDate()]}function qR(r){var o,c,l=[],f,E,T;if(!r._d){for(f=R7(r),r._w&&r._a[po]==null&&r._a[Ko]==null&&v7(r),r._dayOfYear!=null&&(T=fl(r._a[ir],f[ir]),(r._dayOfYear>_h(T)||r._dayOfYear===0)&&(Ue(r)._overflowDayOfYear=!0),c=bh(T,0,r._dayOfYear),r._a[Ko]=c.getUTCMonth(),r._a[po]=c.getUTCDate()),o=0;o<3&&r._a[o]==null;++o)r._a[o]=l[o]=f[o];for(;o<7;o++)r._a[o]=l[o]=r._a[o]==null?o===2?1:0:r._a[o];r._a[Ni]===24&&r._a[Vs]===0&&r._a[qo]===0&&r._a[qc]===0&&(r._nextDay=!0,r._a[Ni]=0),r._d=(r._useUTC?bh:OX).apply(null,l),E=r._useUTC?r._d.getUTCDay():r._d.getDay(),r._tzm!=null&&r._d.setUTCMinutes(r._d.getUTCMinutes()-r._tzm),r._nextDay&&(r._a[Ni]=24),r._w&&typeof r._w.d<"u"&&r._w.d!==E&&(Ue(r).weekdayMismatch=!0)}}function v7(r){var o,c,l,f,E,T,w,N,D;o=r._w,o.GG!=null||o.W!=null||o.E!=null?(E=1,T=4,c=fl(o.GG,r._a[ir],wh(Yn(),1,4).year),l=fl(o.W,1),f=fl(o.E,1),(f<1||f>7)&&(N=!0)):(E=r._locale._week.dow,T=r._locale._week.doy,D=wh(Yn(),E,T),c=fl(o.gg,r._a[ir],D.year),l=fl(o.w,D.week),o.d!=null?(f=o.d,(f<0||f>6)&&(N=!0)):o.e!=null?(f=o.e+E,(o.e<0||o.e>6)&&(N=!0)):f=E),l<1||l>Qo(c,E,T)?Ue(r)._overflowWeeks=!0:N!=null?Ue(r)._overflowWeekday=!0:(w=BM(c,l,f,E,T),r._a[ir]=w.year,r._dayOfYear=w.dayOfYear)}Yt.ISO_8601=function(){};Yt.RFC_2822=function(){};function zR(r){if(r._f===Yt.ISO_8601){YM(r);return}if(r._f===Yt.RFC_2822){KM(r);return}r._a=[],Ue(r).empty=!0;var o=""+r._i,c,l,f,E,T,w=o.length,N=0,D,k;for(f=wM(r._f,r._locale).match(VR)||[],k=f.length,c=0;c<k;c++)E=f[c],l=(o.match(hX(E,r))||[])[0],l&&(T=o.substr(0,o.indexOf(l)),T.length>0&&Ue(r).unusedInput.push(T),o=o.slice(o.indexOf(l)+l.length),N+=l.length),yl[E]?(l?Ue(r).empty=!1:Ue(r).unusedTokens.push(E),fX(E,l,r)):r._strict&&!l&&Ue(r).unusedTokens.push(E);Ue(r).charsLeftOver=w-N,o.length>0&&Ue(r).unusedInput.push(o),r._a[Ni]<=12&&Ue(r).bigHour===!0&&r._a[Ni]>0&&(Ue(r).bigHour=void 0),Ue(r).parsedDateParts=r._a.slice(0),Ue(r).meridiem=r._meridiem,r._a[Ni]=C7(r._locale,r._a[Ni],r._meridiem),D=Ue(r).era,D!==null&&(r._a[ir]=r._locale.erasConvertYear(D,r._a[ir])),qR(r),KR(r)}function C7(r,o,c){var l;return c==null?o:r.meridiemHour!=null?r.meridiemHour(o,c):(r.isPM!=null&&(l=r.isPM(c),l&&o<12&&(o+=12),!l&&o===12&&(o=0)),o)}function I7(r){var o,c,l,f,E,T,w=!1,N=r._f.length;if(N===0){Ue(r).invalidFormat=!0,r._d=new Date(NaN);return}for(f=0;f<N;f++)E=0,T=!1,o=UR({},r),r._useUTC!=null&&(o._useUTC=r._useUTC),o._f=r._f[f],zR(o),MR(o)&&(T=!0),E+=Ue(o).charsLeftOver,E+=Ue(o).unusedTokens.length*10,Ue(o).score=E,w?E<l&&(l=E,c=o):(l==null||E<l||T)&&(l=E,c=o,T&&(w=!0));Ha(r,c||o)}function b7(r){if(!r._d){var o=FR(r._i),c=o.day===void 0?o.date:o.day;r._a=CM([o.year,o.month,c,o.hour,o.minute,o.second,o.millisecond],function(l){return l&&parseInt(l,10)}),qR(r)}}function w7(r){var o=new Bh(KR(qM(r)));return o._nextDay&&(o.add(1,"d"),o._nextDay=void 0),o}function qM(r){var o=r._i,c=r._f;return r._locale=r._locale||ea(r._l),o===null||c===void 0&&o===""?Tm({nullInput:!0}):(typeof o=="string"&&(r._i=o=r._locale.preparse(o)),Ws(o)?new Bh(KR(o)):(Fh(o)?r._d=o:js(c)?I7(r):c?zR(r):A7(r),MR(r)||(r._d=null),r))}function A7(r){var o=r._i;Pr(o)?r._d=new Date(Yt.now()):Fh(o)?r._d=new Date(o.valueOf()):typeof o=="string"?y7(r):js(o)?(r._a=CM(o.slice(0),function(c){return parseInt(c,10)}),qR(r)):Zc(o)?b7(r):$o(o)?r._d=new Date(o):Yt.createFromInputFallback(r)}function zM(r,o,c,l,f){var E={};return(o===!0||o===!1)&&(l=o,o=void 0),(c===!0||c===!1)&&(l=c,c=void 0),(Zc(r)&&LR(r)||js(r)&&r.length===0)&&(r=void 0),E._isAMomentObject=!0,E._useUTC=E._isUTC=f,E._l=c,E._i=r,E._f=o,E._strict=l,w7(E)}function Yn(r,o,c,l){return zM(r,o,c,l,!1)}var O7=Is("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var r=Yn.apply(null,arguments);return this.isValid()&&r.isValid()?r<this?this:r:Tm()}),N7=Is("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var r=Yn.apply(null,arguments);return this.isValid()&&r.isValid()?r>this?this:r:Tm()});function JM(r,o){var c,l;if(o.length===1&&js(o[0])&&(o=o[0]),!o.length)return Yn();for(c=o[0],l=1;l<o.length;++l)(!o[l].isValid()||o[l][r](c))&&(c=o[l]);return c}function D7(){var r=[].slice.call(arguments,0);return JM("isBefore",r)}function P7(){var r=[].slice.call(arguments,0);return JM("isAfter",r)}var k7=function(){return Date.now?Date.now():+new Date},Zu=["year","quarter","month","week","day","hour","minute","second","millisecond"];function L7(r){var o,c=!1,l,f=Zu.length;for(o in r)if(on(r,o)&&!(fi.call(Zu,o)!==-1&&(r[o]==null||!isNaN(r[o]))))return!1;for(l=0;l<f;++l)if(r[Zu[l]]){if(c)return!1;parseFloat(r[Zu[l]])!==Be(r[Zu[l]])&&(c=!0)}return!0}function M7(){return this._isValid}function U7(){return Hs(NaN)}function Om(r){var o=FR(r),c=o.year||0,l=o.quarter||0,f=o.month||0,E=o.week||o.isoWeek||0,T=o.day||0,w=o.hour||0,N=o.minute||0,D=o.second||0,k=o.millisecond||0;this._isValid=L7(o),this._milliseconds=+k+D*1e3+N*6e4+w*1e3*60*60,this._days=+T+E*7,this._months=+f+l*3+c*12,this._data={},this._locale=ea(),this._bubble()}function R_(r){return r instanceof Om}function Ly(r){return r<0?Math.round(-1*r)*-1:Math.round(r)}function x7(r,o,c){var l=Math.min(r.length,o.length),f=Math.abs(r.length-o.length),E=0,T;for(T=0;T<l;T++)(c&&r[T]!==o[T]||!c&&Be(r[T])!==Be(o[T]))&&E++;return E+f}function XM(r,o){ue(r,0,0,function(){var c=this.utcOffset(),l="+";return c<0&&(c=-c,l="-"),l+So(~~(c/60),2)+o+So(~~c%60,2)})}XM("Z",":");XM("ZZ","");zt("Z",bm);zt("ZZ",bm);wn(["Z","ZZ"],function(r,o,c){c._useUTC=!0,c._tzm=JR(bm,r)});var V7=/([\+\-]|\d\d)/gi;function JR(r,o){var c=(o||"").match(r),l,f,E;return c===null?null:(l=c[c.length-1]||[],f=(l+"").match(V7)||["-",0,0],E=+(f[1]*60)+Be(f[2]),E===0?0:f[0]==="+"?E:-E)}function XR(r,o){var c,l;return o._isUTC?(c=o.clone(),l=(Ws(r)||Fh(r)?r.valueOf():Yn(r).valueOf())-c.valueOf(),c._d.setTime(c._d.valueOf()+l),Yt.updateOffset(c,!1),c):Yn(r).local()}function My(r){return-Math.round(r._d.getTimezoneOffset())}Yt.updateOffset=function(){};function F7(r,o,c){var l=this._offset||0,f;if(!this.isValid())return r!=null?this:NaN;if(r!=null){if(typeof r=="string"){if(r=JR(bm,r),r===null)return this}else Math.abs(r)<16&&!c&&(r=r*60);return!this._isUTC&&o&&(f=My(this)),this._offset=r,this._isUTC=!0,f!=null&&this.add(f,"m"),l!==r&&(!o||this._changeInProgress?ZM(this,Hs(r-l,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,Yt.updateOffset(this,!0),this._changeInProgress=null)),this}else return this._isUTC?l:My(this)}function B7(r,o){return r!=null?(typeof r!="string"&&(r=-r),this.utcOffset(r,o),this):-this.utcOffset()}function j7(r){return this.utcOffset(0,r)}function W7(r){return this._isUTC&&(this.utcOffset(0,r),this._isUTC=!1,r&&this.subtract(My(this),"m")),this}function G7(){if(this._tzm!=null)this.utcOffset(this._tzm,!1,!0);else if(typeof this._i=="string"){var r=JR(lX,this._i);r!=null?this.utcOffset(r):this.utcOffset(0,!0)}return this}function H7(r){return this.isValid()?(r=r?Yn(r).utcOffset():0,(this.utcOffset()-r)%60===0):!1}function Y7(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function K7(){if(!Pr(this._isDSTShifted))return this._isDSTShifted;var r={},o;return UR(r,this),r=qM(r),r._a?(o=r._isUTC?yo(r._a):Yn(r._a),this._isDSTShifted=this.isValid()&&x7(r._a,o.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}function q7(){return this.isValid()?!this._isUTC:!1}function z7(){return this.isValid()?this._isUTC:!1}function QM(){return this.isValid()?this._isUTC&&this._offset===0:!1}var J7=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,X7=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function Hs(r,o){var c=r,l=null,f,E,T;return R_(r)?c={ms:r._milliseconds,d:r._days,M:r._months}:$o(r)||!isNaN(+r)?(c={},o?c[o]=+r:c.milliseconds=+r):(l=J7.exec(r))?(f=l[1]==="-"?-1:1,c={y:0,d:Be(l[po])*f,h:Be(l[Ni])*f,m:Be(l[Vs])*f,s:Be(l[qo])*f,ms:Be(Ly(l[qc]*1e3))*f}):(l=X7.exec(r))?(f=l[1]==="-"?-1:1,c={y:Gc(l[2],f),M:Gc(l[3],f),w:Gc(l[4],f),d:Gc(l[5],f),h:Gc(l[6],f),m:Gc(l[7],f),s:Gc(l[8],f)}):c==null?c={}:typeof c=="object"&&("from"in c||"to"in c)&&(T=Q7(Yn(c.from),Yn(c.to)),c={},c.ms=T.milliseconds,c.M=T.months),E=new Om(c),R_(r)&&on(r,"_locale")&&(E._locale=r._locale),R_(r)&&on(r,"_isValid")&&(E._isValid=r._isValid),E}Hs.fn=Om.prototype;Hs.invalid=U7;function Gc(r,o){var c=r&&parseFloat(r.replace(",","."));return(isNaN(c)?0:c)*o}function kP(r,o){var c={};return c.months=o.month()-r.month()+(o.year()-r.year())*12,r.clone().add(c.months,"M").isAfter(o)&&--c.months,c.milliseconds=+o-+r.clone().add(c.months,"M"),c}function Q7(r,o){var c;return r.isValid()&&o.isValid()?(o=XR(o,r),r.isBefore(o)?c=kP(r,o):(c=kP(o,r),c.milliseconds=-c.milliseconds,c.months=-c.months),c):{milliseconds:0,months:0}}function $M(r,o){return function(c,l){var f,E;return l!==null&&!isNaN(+l)&&(bM(o,"moment()."+o+"(period, number) is deprecated. Please use moment()."+o+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),E=c,c=l,l=E),f=Hs(c,l),ZM(this,f,r),this}}function ZM(r,o,c,l){var f=o._milliseconds,E=Ly(o._days),T=Ly(o._months);r.isValid()&&(l=l??!0,T&&UM(r,V_(r,"Month")+T*c),E&&OM(r,"Date",V_(r,"Date")+E*c),f&&r._d.setTime(r._d.valueOf()+f*c),l&&Yt.updateOffset(r,E||T))}var $7=$M(1,"add"),Z7=$M(-1,"subtract");function t1(r){return typeof r=="string"||r instanceof String}function t9(r){return Ws(r)||Fh(r)||t1(r)||$o(r)||n9(r)||e9(r)||r===null||r===void 0}function e9(r){var o=Zc(r)&&!LR(r),c=!1,l=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],f,E,T=l.length;for(f=0;f<T;f+=1)E=l[f],c=c||on(r,E);return o&&c}function n9(r){var o=js(r),c=!1;return o&&(c=r.filter(function(l){return!$o(l)&&t1(r)}).length===0),o&&c}function i9(r){var o=Zc(r)&&!LR(r),c=!1,l=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],f,E;for(f=0;f<l.length;f+=1)E=l[f],c=c||on(r,E);return o&&c}function r9(r,o){var c=r.diff(o,"days",!0);return c<-6?"sameElse":c<-1?"lastWeek":c<0?"lastDay":c<1?"sameDay":c<2?"nextDay":c<7?"nextWeek":"sameElse"}function s9(r,o){arguments.length===1&&(arguments[0]?t9(arguments[0])?(r=arguments[0],o=void 0):i9(arguments[0])&&(o=arguments[0],r=void 0):(r=void 0,o=void 0));var c=r||Yn(),l=XR(c,this).startOf("day"),f=Yt.calendarFormat(this,l)||"sameElse",E=o&&(Ro(o[f])?o[f].call(this,c):o[f]);return this.format(E||this.localeData().calendar(f,this,Yn(c)))}function o9(){return new Bh(this)}function a9(r,o){var c=Ws(r)?r:Yn(r);return this.isValid()&&c.isValid()?(o=bs(o)||"millisecond",o==="millisecond"?this.valueOf()>c.valueOf():c.valueOf()<this.clone().startOf(o).valueOf()):!1}function c9(r,o){var c=Ws(r)?r:Yn(r);return this.isValid()&&c.isValid()?(o=bs(o)||"millisecond",o==="millisecond"?this.valueOf()<c.valueOf():this.clone().endOf(o).valueOf()<c.valueOf()):!1}function d9(r,o,c,l){var f=Ws(r)?r:Yn(r),E=Ws(o)?o:Yn(o);return this.isValid()&&f.isValid()&&E.isValid()?(l=l||"()",(l[0]==="("?this.isAfter(f,c):!this.isBefore(f,c))&&(l[1]===")"?this.isBefore(E,c):!this.isAfter(E,c))):!1}function l9(r,o){var c=Ws(r)?r:Yn(r),l;return this.isValid()&&c.isValid()?(o=bs(o)||"millisecond",o==="millisecond"?this.valueOf()===c.valueOf():(l=c.valueOf(),this.clone().startOf(o).valueOf()<=l&&l<=this.clone().endOf(o).valueOf())):!1}function u9(r,o){return this.isSame(r,o)||this.isAfter(r,o)}function h9(r,o){return this.isSame(r,o)||this.isBefore(r,o)}function p9(r,o,c){var l,f,E;if(!this.isValid())return NaN;if(l=XR(r,this),!l.isValid())return NaN;switch(f=(l.utcOffset()-this.utcOffset())*6e4,o=bs(o),o){case"year":E=v_(this,l)/12;break;case"month":E=v_(this,l);break;case"quarter":E=v_(this,l)/3;break;case"second":E=(this-l)/1e3;break;case"minute":E=(this-l)/6e4;break;case"hour":E=(this-l)/36e5;break;case"day":E=(this-l-f)/864e5;break;case"week":E=(this-l-f)/6048e5;break;default:E=this-l}return c?E:ys(E)}function v_(r,o){if(r.date()<o.date())return-v_(o,r);var c=(o.year()-r.year())*12+(o.month()-r.month()),l=r.clone().add(c,"months"),f,E;return o-l<0?(f=r.clone().add(c-1,"months"),E=(o-l)/(l-f)):(f=r.clone().add(c+1,"months"),E=(o-l)/(f-l)),-(c+E)||0}Yt.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";Yt.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function f9(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function _9(r){if(!this.isValid())return null;var o=r!==!0,c=o?this.clone().utc():this;return c.year()<0||c.year()>9999?y_(c,o?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):Ro(Date.prototype.toISOString)?o?this.toDate().toISOString():new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",y_(c,"Z")):y_(c,o?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function m9(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var r="moment",o="",c,l,f,E;return this.isLocal()||(r=this.utcOffset()===0?"moment.utc":"moment.parseZone",o="Z"),c="["+r+'("]',l=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",f="-MM-DD[T]HH:mm:ss.SSS",E=o+'[")]',this.format(c+l+f+E)}function E9(r){r||(r=this.isUtc()?Yt.defaultFormatUtc:Yt.defaultFormat);var o=y_(this,r);return this.localeData().postformat(o)}function g9(r,o){return this.isValid()&&(Ws(r)&&r.isValid()||Yn(r).isValid())?Hs({to:this,from:r}).locale(this.locale()).humanize(!o):this.localeData().invalidDate()}function S9(r){return this.from(Yn(),r)}function T9(r,o){return this.isValid()&&(Ws(r)&&r.isValid()||Yn(r).isValid())?Hs({from:this,to:r}).locale(this.locale()).humanize(!o):this.localeData().invalidDate()}function y9(r){return this.to(Yn(),r)}function e1(r){var o;return r===void 0?this._locale._abbr:(o=ea(r),o!=null&&(this._locale=o),this)}var n1=Is("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(r){return r===void 0?this.localeData():this.locale(r)});function i1(){return this._locale}var j_=1e3,Rl=60*j_,W_=60*Rl,r1=(365*400+97)*24*W_;function vl(r,o){return(r%o+o)%o}function s1(r,o,c){return r<100&&r>=0?new Date(r+400,o,c)-r1:new Date(r,o,c).valueOf()}function o1(r,o,c){return r<100&&r>=0?Date.UTC(r+400,o,c)-r1:Date.UTC(r,o,c)}function R9(r){var o,c;if(r=bs(r),r===void 0||r==="millisecond"||!this.isValid())return this;switch(c=this._isUTC?o1:s1,r){case"year":o=c(this.year(),0,1);break;case"quarter":o=c(this.year(),this.month()-this.month()%3,1);break;case"month":o=c(this.year(),this.month(),1);break;case"week":o=c(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":o=c(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":o=c(this.year(),this.month(),this.date());break;case"hour":o=this._d.valueOf(),o-=vl(o+(this._isUTC?0:this.utcOffset()*Rl),W_);break;case"minute":o=this._d.valueOf(),o-=vl(o,Rl);break;case"second":o=this._d.valueOf(),o-=vl(o,j_);break}return this._d.setTime(o),Yt.updateOffset(this,!0),this}function v9(r){var o,c;if(r=bs(r),r===void 0||r==="millisecond"||!this.isValid())return this;switch(c=this._isUTC?o1:s1,r){case"year":o=c(this.year()+1,0,1)-1;break;case"quarter":o=c(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":o=c(this.year(),this.month()+1,1)-1;break;case"week":o=c(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":o=c(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":o=c(this.year(),this.month(),this.date()+1)-1;break;case"hour":o=this._d.valueOf(),o+=W_-vl(o+(this._isUTC?0:this.utcOffset()*Rl),W_)-1;break;case"minute":o=this._d.valueOf(),o+=Rl-vl(o,Rl)-1;break;case"second":o=this._d.valueOf(),o+=j_-vl(o,j_)-1;break}return this._d.setTime(o),Yt.updateOffset(this,!0),this}function C9(){return this._d.valueOf()-(this._offset||0)*6e4}function I9(){return Math.floor(this.valueOf()/1e3)}function b9(){return new Date(this.valueOf())}function w9(){var r=this;return[r.year(),r.month(),r.date(),r.hour(),r.minute(),r.second(),r.millisecond()]}function A9(){var r=this;return{years:r.year(),months:r.month(),date:r.date(),hours:r.hours(),minutes:r.minutes(),seconds:r.seconds(),milliseconds:r.milliseconds()}}function O9(){return this.isValid()?this.toISOString():null}function N9(){return MR(this)}function D9(){return Ha({},Ue(this))}function P9(){return Ue(this).overflow}function k9(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}ue("N",0,0,"eraAbbr");ue("NN",0,0,"eraAbbr");ue("NNN",0,0,"eraAbbr");ue("NNNN",0,0,"eraName");ue("NNNNN",0,0,"eraNarrow");ue("y",["y",1],"yo","eraYear");ue("y",["yy",2],0,"eraYear");ue("y",["yyy",3],0,"eraYear");ue("y",["yyyy",4],0,"eraYear");zt("N",QR);zt("NN",QR);zt("NNN",QR);zt("NNNN",H9);zt("NNNNN",Y9);wn(["N","NN","NNN","NNNN","NNNNN"],function(r,o,c,l){var f=c._locale.erasParse(r,l,c._strict);f?Ue(c).era=f:Ue(c).invalidEra=r});zt("y",jl);zt("yy",jl);zt("yyy",jl);zt("yyyy",jl);zt("yo",K9);wn(["y","yy","yyy","yyyy"],ir);wn(["yo"],function(r,o,c,l){var f;c._locale._eraYearOrdinalRegex&&(f=r.match(c._locale._eraYearOrdinalRegex)),c._locale.eraYearOrdinalParse?o[ir]=c._locale.eraYearOrdinalParse(r,f):o[ir]=parseInt(r,10)});function L9(r,o){var c,l,f,E=this._eras||ea("en")._eras;for(c=0,l=E.length;c<l;++c){switch(typeof E[c].since){case"string":f=Yt(E[c].since).startOf("day"),E[c].since=f.valueOf();break}switch(typeof E[c].until){case"undefined":E[c].until=1/0;break;case"string":f=Yt(E[c].until).startOf("day").valueOf(),E[c].until=f.valueOf();break}}return E}function M9(r,o,c){var l,f,E=this.eras(),T,w,N;for(r=r.toUpperCase(),l=0,f=E.length;l<f;++l)if(T=E[l].name.toUpperCase(),w=E[l].abbr.toUpperCase(),N=E[l].narrow.toUpperCase(),c)switch(o){case"N":case"NN":case"NNN":if(w===r)return E[l];break;case"NNNN":if(T===r)return E[l];break;case"NNNNN":if(N===r)return E[l];break}else if([T,w,N].indexOf(r)>=0)return E[l]}function U9(r,o){var c=r.since<=r.until?1:-1;return o===void 0?Yt(r.since).year():Yt(r.since).year()+(o-r.offset)*c}function x9(){var r,o,c,l=this.localeData().eras();for(r=0,o=l.length;r<o;++r)if(c=this.clone().startOf("day").valueOf(),l[r].since<=c&&c<=l[r].until||l[r].until<=c&&c<=l[r].since)return l[r].name;return""}function V9(){var r,o,c,l=this.localeData().eras();for(r=0,o=l.length;r<o;++r)if(c=this.clone().startOf("day").valueOf(),l[r].since<=c&&c<=l[r].until||l[r].until<=c&&c<=l[r].since)return l[r].narrow;return""}function F9(){var r,o,c,l=this.localeData().eras();for(r=0,o=l.length;r<o;++r)if(c=this.clone().startOf("day").valueOf(),l[r].since<=c&&c<=l[r].until||l[r].until<=c&&c<=l[r].since)return l[r].abbr;return""}function B9(){var r,o,c,l,f=this.localeData().eras();for(r=0,o=f.length;r<o;++r)if(c=f[r].since<=f[r].until?1:-1,l=this.clone().startOf("day").valueOf(),f[r].since<=l&&l<=f[r].until||f[r].until<=l&&l<=f[r].since)return(this.year()-Yt(f[r].since).year())*c+f[r].offset;return this.year()}function j9(r){return on(this,"_erasNameRegex")||$R.call(this),r?this._erasNameRegex:this._erasRegex}function W9(r){return on(this,"_erasAbbrRegex")||$R.call(this),r?this._erasAbbrRegex:this._erasRegex}function G9(r){return on(this,"_erasNarrowRegex")||$R.call(this),r?this._erasNarrowRegex:this._erasRegex}function QR(r,o){return o.erasAbbrRegex(r)}function H9(r,o){return o.erasNameRegex(r)}function Y9(r,o){return o.erasNarrowRegex(r)}function K9(r,o){return o._eraYearOrdinalRegex||jl}function $R(){var r=[],o=[],c=[],l=[],f,E,T=this.eras();for(f=0,E=T.length;f<E;++f)o.push(es(T[f].name)),r.push(es(T[f].abbr)),c.push(es(T[f].narrow)),l.push(es(T[f].name)),l.push(es(T[f].abbr)),l.push(es(T[f].narrow));this._erasRegex=new RegExp("^("+l.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+o.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+r.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+c.join("|")+")","i")}ue(0,["gg",2],0,function(){return this.weekYear()%100});ue(0,["GG",2],0,function(){return this.isoWeekYear()%100});function Nm(r,o){ue(0,[r,r.length],0,o)}Nm("gggg","weekYear");Nm("ggggg","weekYear");Nm("GGGG","isoWeekYear");Nm("GGGGG","isoWeekYear");rr("weekYear","gg");rr("isoWeekYear","GG");sr("weekYear",1);sr("isoWeekYear",1);zt("G",Im);zt("g",Im);zt("GG",Kn,ss);zt("gg",Kn,ss);zt("GGGG",jR,BR);zt("gggg",jR,BR);zt("GGGGG",Cm,Rm);zt("ggggg",Cm,Rm);Wh(["gggg","ggggg","GGGG","GGGGG"],function(r,o,c,l){o[l.substr(0,2)]=Be(r)});Wh(["gg","GG"],function(r,o,c,l){o[l]=Yt.parseTwoDigitYear(r)});function q9(r){return a1.call(this,r,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function z9(r){return a1.call(this,r,this.isoWeek(),this.isoWeekday(),1,4)}function J9(){return Qo(this.year(),1,4)}function X9(){return Qo(this.isoWeekYear(),1,4)}function Q9(){var r=this.localeData()._week;return Qo(this.year(),r.dow,r.doy)}function $9(){var r=this.localeData()._week;return Qo(this.weekYear(),r.dow,r.doy)}function a1(r,o,c,l,f){var E;return r==null?wh(this,l,f).year:(E=Qo(r,l,f),o>E&&(o=E),Z9.call(this,r,o,c,l,f))}function Z9(r,o,c,l,f){var E=BM(r,o,c,l,f),T=bh(E.year,0,E.dayOfYear);return this.year(T.getUTCFullYear()),this.month(T.getUTCMonth()),this.date(T.getUTCDate()),this}ue("Q",0,"Qo","quarter");rr("quarter","Q");sr("quarter",7);zt("Q",NM);wn("Q",function(r,o){o[Ko]=(Be(r)-1)*3});function tQ(r){return r==null?Math.ceil((this.month()+1)/3):this.month((r-1)*3+this.month()%3)}ue("D",["DD",2],"Do","date");rr("date","D");sr("date",9);zt("D",Kn);zt("DD",Kn,ss);zt("Do",function(r,o){return r?o._dayOfMonthOrdinalParse||o._ordinalParse:o._dayOfMonthOrdinalParseLenient});wn(["D","DD"],po);wn("Do",function(r,o){o[po]=Be(r.match(Kn)[0])});var c1=Bl("Date",!0);ue("DDD",["DDDD",3],"DDDo","dayOfYear");rr("dayOfYear","DDD");sr("dayOfYear",4);zt("DDD",vm);zt("DDDD",DM);wn(["DDD","DDDD"],function(r,o,c){c._dayOfYear=Be(r)});function eQ(r){var o=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return r==null?o:this.add(r-o,"d")}ue("m",["mm",2],0,"minute");rr("minute","m");sr("minute",14);zt("m",Kn);zt("mm",Kn,ss);wn(["m","mm"],Vs);var nQ=Bl("Minutes",!1);ue("s",["ss",2],0,"second");rr("second","s");sr("second",15);zt("s",Kn);zt("ss",Kn,ss);wn(["s","ss"],qo);var iQ=Bl("Seconds",!1);ue("S",0,0,function(){return~~(this.millisecond()/100)});ue(0,["SS",2],0,function(){return~~(this.millisecond()/10)});ue(0,["SSS",3],0,"millisecond");ue(0,["SSSS",4],0,function(){return this.millisecond()*10});ue(0,["SSSSS",5],0,function(){return this.millisecond()*100});ue(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3});ue(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4});ue(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5});ue(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6});rr("millisecond","ms");sr("millisecond",16);zt("S",vm,NM);zt("SS",vm,ss);zt("SSS",vm,DM);var Ya,d1;for(Ya="SSSS";Ya.length<=9;Ya+="S")zt(Ya,jl);function rQ(r,o){o[qc]=Be(("0."+r)*1e3)}for(Ya="S";Ya.length<=9;Ya+="S")wn(Ya,rQ);d1=Bl("Milliseconds",!1);ue("z",0,0,"zoneAbbr");ue("zz",0,0,"zoneName");function sQ(){return this._isUTC?"UTC":""}function oQ(){return this._isUTC?"Coordinated Universal Time":""}var Nt=Bh.prototype;Nt.add=$7;Nt.calendar=s9;Nt.clone=o9;Nt.diff=p9;Nt.endOf=v9;Nt.format=E9;Nt.from=g9;Nt.fromNow=S9;Nt.to=T9;Nt.toNow=y9;Nt.get=cX;Nt.invalidAt=P9;Nt.isAfter=a9;Nt.isBefore=c9;Nt.isBetween=d9;Nt.isSame=l9;Nt.isSameOrAfter=u9;Nt.isSameOrBefore=h9;Nt.isValid=N9;Nt.lang=n1;Nt.locale=e1;Nt.localeData=i1;Nt.max=N7;Nt.min=O7;Nt.parsingFlags=D9;Nt.set=dX;Nt.startOf=R9;Nt.subtract=Z7;Nt.toArray=w9;Nt.toObject=A9;Nt.toDate=b9;Nt.toISOString=_9;Nt.inspect=m9;typeof Symbol<"u"&&Symbol.for!=null&&(Nt[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"});Nt.toJSON=O9;Nt.toString=f9;Nt.unix=I9;Nt.valueOf=C9;Nt.creationData=k9;Nt.eraName=x9;Nt.eraNarrow=V9;Nt.eraAbbr=F9;Nt.eraYear=B9;Nt.year=FM;Nt.isLeapYear=AX;Nt.weekYear=q9;Nt.isoWeekYear=z9;Nt.quarter=Nt.quarters=tQ;Nt.month=xM;Nt.daysInMonth=IX;Nt.week=Nt.weeks=LX;Nt.isoWeek=Nt.isoWeeks=MX;Nt.weeksInYear=Q9;Nt.weeksInWeekYear=$9;Nt.isoWeeksInYear=J9;Nt.isoWeeksInISOWeekYear=X9;Nt.date=c1;Nt.day=Nt.days=zX;Nt.weekday=JX;Nt.isoWeekday=XX;Nt.dayOfYear=eQ;Nt.hour=Nt.hours=i7;Nt.minute=Nt.minutes=nQ;Nt.second=Nt.seconds=iQ;Nt.millisecond=Nt.milliseconds=d1;Nt.utcOffset=F7;Nt.utc=j7;Nt.local=W7;Nt.parseZone=G7;Nt.hasAlignedHourOffset=H7;Nt.isDST=Y7;Nt.isLocal=q7;Nt.isUtcOffset=z7;Nt.isUtc=QM;Nt.isUTC=QM;Nt.zoneAbbr=sQ;Nt.zoneName=oQ;Nt.dates=Is("dates accessor is deprecated. Use date instead.",c1);Nt.months=Is("months accessor is deprecated. Use month instead",xM);Nt.years=Is("years accessor is deprecated. Use year instead",FM);Nt.zone=Is("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",B7);Nt.isDSTShifted=Is("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",K7);function aQ(r){return Yn(r*1e3)}function cQ(){return Yn.apply(null,arguments).parseZone()}function l1(r){return r}var an=xR.prototype;an.calendar=zJ;an.longDateFormat=$J;an.invalidDate=tX;an.ordinal=iX;an.preparse=l1;an.postformat=l1;an.relativeTime=sX;an.pastFuture=oX;an.set=KJ;an.eras=L9;an.erasParse=M9;an.erasConvertYear=U9;an.erasAbbrRegex=W9;an.erasNameRegex=j9;an.erasNarrowRegex=G9;an.months=yX;an.monthsShort=RX;an.monthsParse=CX;an.monthsRegex=wX;an.monthsShortRegex=bX;an.week=NX;an.firstDayOfYear=kX;an.firstDayOfWeek=PX;an.weekdays=GX;an.weekdaysMin=YX;an.weekdaysShort=HX;an.weekdaysParse=qX;an.weekdaysRegex=QX;an.weekdaysShortRegex=$X;an.weekdaysMinRegex=ZX;an.isPM=e7;an.meridiem=r7;function G_(r,o,c,l){var f=ea(),E=yo().set(l,o);return f[c](E,r)}function u1(r,o,c){if($o(r)&&(o=r,r=void 0),r=r||"",o!=null)return G_(r,o,c,"month");var l,f=[];for(l=0;l<12;l++)f[l]=G_(r,l,c,"month");return f}function ZR(r,o,c,l){typeof r=="boolean"?($o(o)&&(c=o,o=void 0),o=o||""):(o=r,c=o,r=!1,$o(o)&&(c=o,o=void 0),o=o||"");var f=ea(),E=r?f._week.dow:0,T,w=[];if(c!=null)return G_(o,(c+E)%7,l,"day");for(T=0;T<7;T++)w[T]=G_(o,(T+E)%7,l,"day");return w}function dQ(r,o){return u1(r,o,"months")}function lQ(r,o){return u1(r,o,"monthsShort")}function uQ(r,o,c){return ZR(r,o,c,"weekdays")}function hQ(r,o,c){return ZR(r,o,c,"weekdaysShort")}function pQ(r,o,c){return ZR(r,o,c,"weekdaysMin")}Ja("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(r){var o=r%10,c=Be(r%100/10)===1?"th":o===1?"st":o===2?"nd":o===3?"rd":"th";return r+c}});Yt.lang=Is("moment.lang is deprecated. Use moment.locale instead.",Ja);Yt.langData=Is("moment.langData is deprecated. Use moment.localeData instead.",ea);var jo=Math.abs;function fQ(){var r=this._data;return this._milliseconds=jo(this._milliseconds),this._days=jo(this._days),this._months=jo(this._months),r.milliseconds=jo(r.milliseconds),r.seconds=jo(r.seconds),r.minutes=jo(r.minutes),r.hours=jo(r.hours),r.months=jo(r.months),r.years=jo(r.years),this}function h1(r,o,c,l){var f=Hs(o,c);return r._milliseconds+=l*f._milliseconds,r._days+=l*f._days,r._months+=l*f._months,r._bubble()}function _Q(r,o){return h1(this,r,o,1)}function mQ(r,o){return h1(this,r,o,-1)}function LP(r){return r<0?Math.floor(r):Math.ceil(r)}function EQ(){var r=this._milliseconds,o=this._days,c=this._months,l=this._data,f,E,T,w,N;return r>=0&&o>=0&&c>=0||r<=0&&o<=0&&c<=0||(r+=LP(Uy(c)+o)*864e5,o=0,c=0),l.milliseconds=r%1e3,f=ys(r/1e3),l.seconds=f%60,E=ys(f/60),l.minutes=E%60,T=ys(E/60),l.hours=T%24,o+=ys(T/24),N=ys(p1(o)),c+=N,o-=LP(Uy(N)),w=ys(c/12),c%=12,l.days=o,l.months=c,l.years=w,this}function p1(r){return r*4800/146097}function Uy(r){return r*146097/4800}function gQ(r){if(!this.isValid())return NaN;var o,c,l=this._milliseconds;if(r=bs(r),r==="month"||r==="quarter"||r==="year")switch(o=this._days+l/864e5,c=this._months+p1(o),r){case"month":return c;case"quarter":return c/3;case"year":return c/12}else switch(o=this._days+Math.round(Uy(this._months)),r){case"week":return o/7+l/6048e5;case"day":return o+l/864e5;case"hour":return o*24+l/36e5;case"minute":return o*1440+l/6e4;case"second":return o*86400+l/1e3;case"millisecond":return Math.floor(o*864e5)+l;default:throw new Error("Unknown unit "+r)}}function SQ(){return this.isValid()?this._milliseconds+this._days*864e5+this._months%12*2592e6+Be(this._months/12)*31536e6:NaN}function na(r){return function(){return this.as(r)}}var TQ=na("ms"),yQ=na("s"),RQ=na("m"),vQ=na("h"),CQ=na("d"),IQ=na("w"),bQ=na("M"),wQ=na("Q"),AQ=na("y");function OQ(){return Hs(this)}function NQ(r){return r=bs(r),this.isValid()?this[r+"s"]():NaN}function ad(r){return function(){return this.isValid()?this._data[r]:NaN}}var DQ=ad("milliseconds"),PQ=ad("seconds"),kQ=ad("minutes"),LQ=ad("hours"),MQ=ad("days"),UQ=ad("months"),xQ=ad("years");function VQ(){return ys(this.days()/7)}var Ho=Math.round,_l={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function FQ(r,o,c,l,f){return f.relativeTime(o||1,!!c,r,l)}function BQ(r,o,c,l){var f=Hs(r).abs(),E=Ho(f.as("s")),T=Ho(f.as("m")),w=Ho(f.as("h")),N=Ho(f.as("d")),D=Ho(f.as("M")),k=Ho(f.as("w")),M=Ho(f.as("y")),j=E<=c.ss&&["s",E]||E<c.s&&["ss",E]||T<=1&&["m"]||T<c.m&&["mm",T]||w<=1&&["h"]||w<c.h&&["hh",w]||N<=1&&["d"]||N<c.d&&["dd",N];return c.w!=null&&(j=j||k<=1&&["w"]||k<c.w&&["ww",k]),j=j||D<=1&&["M"]||D<c.M&&["MM",D]||M<=1&&["y"]||["yy",M],j[2]=o,j[3]=+r>0,j[4]=l,FQ.apply(null,j)}function jQ(r){return r===void 0?Ho:typeof r=="function"?(Ho=r,!0):!1}function WQ(r,o){return _l[r]===void 0?!1:o===void 0?_l[r]:(_l[r]=o,r==="s"&&(_l.ss=o-1),!0)}function GQ(r,o){if(!this.isValid())return this.localeData().invalidDate();var c=!1,l=_l,f,E;return typeof r=="object"&&(o=r,r=!1),typeof r=="boolean"&&(c=r),typeof o=="object"&&(l=Object.assign({},_l,o),o.s!=null&&o.ss==null&&(l.ss=o.s-1)),f=this.localeData(),E=BQ(this,!c,l,f),c&&(E=f.pastFuture(+this,E)),f.postformat(E)}var zT=Math.abs;function ll(r){return(r>0)-(r<0)||+r}function Dm(){if(!this.isValid())return this.localeData().invalidDate();var r=zT(this._milliseconds)/1e3,o=zT(this._days),c=zT(this._months),l,f,E,T,w=this.asSeconds(),N,D,k,M;return w?(l=ys(r/60),f=ys(l/60),r%=60,l%=60,E=ys(c/12),c%=12,T=r?r.toFixed(3).replace(/\.?0+$/,""):"",N=w<0?"-":"",D=ll(this._months)!==ll(w)?"-":"",k=ll(this._days)!==ll(w)?"-":"",M=ll(this._milliseconds)!==ll(w)?"-":"",N+"P"+(E?D+E+"Y":"")+(c?D+c+"M":"")+(o?k+o+"D":"")+(f||l||r?"T":"")+(f?M+f+"H":"")+(l?M+l+"M":"")+(r?M+T+"S":"")):"P0D"}var Qe=Om.prototype;Qe.isValid=M7;Qe.abs=fQ;Qe.add=_Q;Qe.subtract=mQ;Qe.as=gQ;Qe.asMilliseconds=TQ;Qe.asSeconds=yQ;Qe.asMinutes=RQ;Qe.asHours=vQ;Qe.asDays=CQ;Qe.asWeeks=IQ;Qe.asMonths=bQ;Qe.asQuarters=wQ;Qe.asYears=AQ;Qe.valueOf=SQ;Qe._bubble=EQ;Qe.clone=OQ;Qe.get=NQ;Qe.milliseconds=DQ;Qe.seconds=PQ;Qe.minutes=kQ;Qe.hours=LQ;Qe.days=MQ;Qe.weeks=VQ;Qe.months=UQ;Qe.years=xQ;Qe.humanize=GQ;Qe.toISOString=Dm;Qe.toString=Dm;Qe.toJSON=Dm;Qe.locale=e1;Qe.localeData=i1;Qe.toIsoString=Is("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Dm);Qe.lang=n1;ue("X",0,0,"unix");ue("x",0,0,"valueOf");zt("x",Im);zt("X",uX);wn("X",function(r,o,c){c._d=new Date(parseFloat(r)*1e3)});wn("x",function(r,o,c){c._d=new Date(Be(r))});//! moment.js
Yt.version="2.29.4";HJ(Yn);Yt.fn=Nt;Yt.min=D7;Yt.max=P7;Yt.now=k7;Yt.utc=yo;Yt.unix=aQ;Yt.months=dQ;Yt.isDate=Fh;Yt.locale=Ja;Yt.invalid=Tm;Yt.duration=Hs;Yt.isMoment=Ws;Yt.weekdays=uQ;Yt.parseZone=cQ;Yt.localeData=ea;Yt.isDuration=R_;Yt.monthsShort=lQ;Yt.weekdaysMin=pQ;Yt.defineLocale=YR;Yt.updateLocale=c7;Yt.locales=d7;Yt.weekdaysShort=hQ;Yt.normalizeUnits=bs;Yt.relativeTimeRounding=jQ;Yt.relativeTimeThreshold=WQ;Yt.calendarFormat=r9;Yt.prototype=Nt;Yt.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"};export{mR as $,o$ as A,r$ as B,i$ as C,gk as D,RY as E,Gi as F,rm as G,Ph as H,_R as I,nL as J,Uq as K,Lh as L,dm as M,s$ as N,xT as O,Uh as P,qa as Q,Sk as R,sY as S,_o as T,ta as U,Oi as V,o8 as W,aL as X,CY as Y,Dh as Z,XQ as _,oK as a,ZQ as a0,t$ as a1,dR as b,ns as c,Hn as d,cR as e,lK as f,r8 as g,gY as h,n$ as i,e$ as j,a$ as k,BT as l,Yt as m,$Q as n,om as o,a8 as p,dK as q,iY as r,Xc as s,r6 as t,QQ as u,Ul as v,$y as w,mY as x,L_ as y,lR as z};
